import{j as e}from"./ui-vendor-izRNgCO_.js";import{r as s}from"./react-vendor-r9Et1EnL.js";import{e as t,a,u as r,b as i,h as n,m as l,A as c,f as d,g as o,C as x,F as m,B as p}from"./index-Dpso9GU3.js";import{C as h,d as j,a as g,b as u,c as y}from"./card-Sps0XDlE.js";import{D as N,e as f,a as v,b,c as w,f as k,d as C}from"./dialog-CzuAHObH.js";import{T as F}from"./textarea-Bh8QdlON.js";import{L as A}from"./label-BnKDd-HG.js";import{M as E}from"./mail-BO1CeZ5_.js";import{C as P,a as S}from"./circle-x-DHByMjyv.js";import"./chart-vendor-D0NPwkge.js";function q(){const[q,D]=s.useState([]),[R,$]=s.useState([]),[T,I]=s.useState(!0),[M,O]=s.useState("requests"),[L,H]=s.useState(!1),[U,G]=s.useState(null),[J,Y]=s.useState(""),[B,V]=s.useState(!1),[_,z]=s.useState(!1),[K,Q]=s.useState(""),[W,X]=s.useState(null),[Z,ee]=s.useState(!1),se=t(e=>e.user),te="http://localhost:5000/api";s.useEffect(()=>{"DOCTOR"===(null==se?void 0:se.role)&&ae()},[se]);const ae=async()=>{var e;try{I(!0);const e=await a.get(`${te}/doctor/pending-requests`,{withCredentials:!0}),s=await a.get(`${te}/doctor/all-appointments`,{withCredentials:!0});e.data.success&&$(e.data.data),s.data.success&&D(s.data.data)}catch(s){a.isAxiosError(s)&&s.response?r.error((null==(e=s.response.data)?void 0:e.message)||"Failed to fetch appointments"):r.error("Failed to fetch appointments")}finally{I(!1)}},re=e=>{if("OFFLINE"!==e.appointmentType||"CONFIRMED"!==e.status)return!1;try{const s=new Date(e.date),[t,a]=e.time.split(":");return s.setHours(parseInt(t,10),parseInt(a,10),0,0),s.getTime()<=Date.now()}catch{return!0}},ie=async()=>{var e;if(U&&J.trim())try{V(!0);(await a.patch(`${te}/doctor/appointment-requests/${U.id}/respond`,{action:"reject",rejectionReason:J.trim()},{withCredentials:!0})).data.success&&(r.success("Appointment request rejected"),H(!1),Y(""),G(null),ae())}catch(s){a.isAxiosError(s)&&s.response?r.error((null==(e=s.response.data)?void 0:e.message)||"Failed to reject appointment"):r.error("Failed to reject appointment")}finally{V(!1)}else r.error("Please provide a reason for rejection")},ne=s=>{const t={PENDING:{label:"Pending",cls:"bg-gradient-to-r from-amber-400/15 to-yellow-500/15 text-amber-700 dark:text-amber-200 border-amber-400/30"},CONFIRMED:{label:"Confirmed",cls:"bg-gradient-to-r from-emerald-400/15 to-teal-500/15 text-emerald-700 dark:text-emerald-200 border-emerald-400/30"},COMPLETED:{label:"Completed",cls:"bg-gradient-to-r from-sky-400/15 to-indigo-500/15 text-sky-700 dark:text-sky-200 border-sky-400/30"},CANCELLED:{label:"Cancelled",cls:"bg-gradient-to-r from-rose-400/15 to-red-500/15 text-rose-700 dark:text-rose-200 border-rose-400/30"},REJECTED:{label:"Rejected",cls:"bg-gradient-to-r from-rose-400/15 to-red-500/15 text-rose-700 dark:text-rose-200 border-rose-400/30"}},a=t[s]||t.PENDING;return e.jsx(i,{variant:"outline",className:`backdrop-blur-sm rounded-full px-2.5 py-1 border shadow-sm text-xs font-medium ${a.cls}`,children:a.label})},le=e=>new Date(e).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),ce=e=>new Date(`2000-01-01T${e}`).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0});return T?e.jsx("div",{className:"p-6 md:p-8",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-600"})})}):e.jsxs("div",{className:"p-6 md:p-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-2",children:"Appointment Management"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Manage your appointment requests and view all appointments"})]}),e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex space-x-1 bg-gray-100 dark:bg-gray-800 p-1 rounded-lg w-fit",children:[e.jsxs("button",{onClick:()=>O("requests"),className:"px-4 py-2 rounded-md text-sm font-medium transition-colors "+("requests"===M?"bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white"),children:["Pending Requests (",R.length,")"]}),e.jsxs("button",{onClick:()=>O("all"),className:"px-4 py-2 rounded-md text-sm font-medium transition-colors "+("all"===M?"bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white"),children:["All Appointments (",q.length,")"]})]})}),"requests"===M&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Pending Appointment Requests"}),e.jsxs(i,{variant:"secondary",className:"bg-yellow-100 text-yellow-800",children:[R.length," requests"]})]}),0===R.length?e.jsx(h,{children:e.jsxs(j,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(n,{className:"h-12 w-12 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No pending requests"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-center",children:"You don't have any pending appointment requests at the moment."})]})}):e.jsx("div",{className:"grid gap-6",children:R.map(s=>e.jsx(l.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},children:e.jsxs(h,{className:"border-l-4 border-l-yellow-500",children:[e.jsx(g,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(c,{className:"h-12 w-12",children:[e.jsx(d,{src:s.patient.profilePicture}),e.jsx(o,{children:s.patient.name.charAt(0)})]}),e.jsxs("div",{children:[e.jsx(u,{className:"text-lg",children:s.patient.name}),e.jsxs(y,{className:"flex items-center space-x-2",children:[e.jsx(E,{className:"h-4 w-4"}),e.jsx("span",{children:s.patient.email})]})]})]}),ne(s.status)]})}),e.jsxs(j,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(n,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:le(s.date)})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(x,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:ce(s.time)})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(m,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:s.appointmentType})]}),s.consultationFee&&e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:["₹",s.consultationFee]})})]}),s.notes&&e.jsxs("div",{className:"mb-4",children:[e.jsx(A,{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Patient Notes:"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:s.notes})]}),s.patient.medicalHistory&&e.jsxs("div",{className:"mb-4",children:[e.jsx(A,{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Medical History:"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:s.patient.medicalHistory})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs(p,{onClick:()=>(async e=>{var s;try{V(!0),(await a.patch(`${te}/doctor/appointment-requests/${e}/respond`,{action:"accept"},{withCredentials:!0})).data.success&&(r.success("Appointment accepted successfully!"),ae())}catch(t){a.isAxiosError(t)&&t.response?r.error((null==(s=t.response.data)?void 0:s.message)||"Failed to accept appointment"):r.error("Failed to accept appointment")}finally{V(!1)}})(s.id),disabled:B,className:"bg-green-600 hover:bg-green-700 text-white",children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),"Accept"]}),e.jsxs(N,{open:L,onOpenChange:H,children:[e.jsx(f,{asChild:!0,children:e.jsxs(p,{variant:"destructive",onClick:()=>G(s),disabled:B,children:[e.jsx(S,{className:"h-4 w-4 mr-2"}),"Reject"]})}),e.jsxs(v,{children:[e.jsxs(b,{children:[e.jsx(w,{children:"Reject Appointment Request"}),e.jsx(k,{children:"Please provide a reason for rejecting this appointment request. The patient will be notified with your feedback."})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx(A,{htmlFor:"rejection-reason",children:"Reason for rejection"}),e.jsx(F,{id:"rejection-reason",placeholder:"e.g., Time slot not available, suggest alternative time...",value:J,onChange:e=>Y(e.target.value),className:"mt-1"})]})}),e.jsxs(C,{children:[e.jsx(p,{variant:"outline",onClick:()=>{H(!1),Y(""),G(null)},children:"Cancel"}),e.jsx(p,{variant:"destructive",onClick:ie,disabled:B||!J.trim(),children:B?"Rejecting...":"Reject Request"})]})]})]})]})]})]})},s.id))})]}),"all"===M&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"All Appointments"}),e.jsxs(i,{variant:"secondary",children:[q.length," total"]})]}),0===q.length?e.jsx(h,{children:e.jsxs(j,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(n,{className:"h-12 w-12 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"No appointments found"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-center",children:"You don't have any appointments scheduled yet."})]})}):e.jsx("div",{className:"grid gap-4",children:q.map(s=>e.jsx(l.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},children:e.jsx(h,{children:e.jsxs(j,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(c,{className:"h-10 w-10",children:[e.jsx(d,{src:s.patient.profilePicture}),e.jsx(o,{children:s.patient.name.charAt(0)})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:s.patient.name}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:s.patient.email})]})]}),ne(s.status)]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(n,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:le(s.date)})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(x,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:ce(s.time)})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(m,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:s.appointmentType})]}),s.consultationFee&&e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs("span",{className:"font-medium text-gray-900 dark:text-white",children:["₹",s.consultationFee]})})]}),s.notes&&e.jsx("div",{className:"mt-4 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("strong",{children:"Notes:"})," ",s.notes]})}),e.jsxs("div",{className:"mt-4 flex flex-wrap gap-2",children:["CONFIRMED"===s.status&&e.jsx(p,{variant:"outline",onClick:()=>{X(s.id),z(!0)},disabled:B,children:"Upload Prescription"}),s.prescriptionId&&e.jsx(p,{variant:"secondary",onClick:()=>window.open(`${te}/patient/prescription-pdf/${s.prescriptionId}`,"_blank"),children:"View Prescription"}),re(s)&&e.jsx(p,{className:"bg-blue-600 hover:bg-blue-700 text-white",onClick:()=>(async e=>{X(e),ee(!0),z(!0)})(s.id),disabled:B,children:"Mark as Completed"})]})]})})},s.id))})]}),e.jsx(N,{open:_,onOpenChange:z,children:e.jsxs(v,{children:[e.jsxs(b,{children:[e.jsx(w,{children:"Upload Prescription"}),e.jsx(k,{children:"Add prescription details for this appointment. Patients will be able to view it as a PDF."})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx(A,{htmlFor:"prescription-text",children:"Prescription"}),e.jsx(F,{id:"prescription-text",placeholder:"Medication, dosage, instructions...",value:K,onChange:e=>Q(e.target.value),className:"mt-1",rows:8})]})}),e.jsxs(C,{children:[e.jsx(p,{variant:"outline",onClick:()=>{z(!1),Q(""),X(null)},children:"Cancel"}),e.jsx(p,{onClick:async()=>{var e,s;if(W&&K.trim())try{V(!0);if((await a.post(`${te}/doctor/appointments/${W}/prescription`,{prescriptionText:K.trim()},{withCredentials:!0})).data.success){if(r.success("Prescription saved"),Z&&W)try{(await a.patch(`${te}/doctor/appointments/${W}/complete`,{},{withCredentials:!0})).data.success&&r.success("Appointment marked as completed")}catch(t){a.isAxiosError(t)&&t.response?r.error((null==(e=t.response.data)?void 0:e.message)||"Failed to mark as completed"):r.error("Failed to mark as completed")}ee(!1),z(!1),Q(""),X(null),ae()}}catch(t){a.isAxiosError(t)&&t.response?r.error((null==(s=t.response.data)?void 0:s.message)||"Failed to save prescription"):r.error("Failed to save prescription")}finally{V(!1)}else r.error("Please enter prescription")},disabled:B||!K.trim(),children:B?"Saving...":"Save Prescription"})]})]})})]})}export{q as default};
