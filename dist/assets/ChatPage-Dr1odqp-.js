import{j as e}from"./ui-vendor-izRNgCO_.js";import{r as s}from"./react-vendor-r9Et1EnL.js";import{a,e as t,B as r,X as i,o as l,i as c,A as d,f as n,g as o,b as m,M as x,l as h,U as g,u}from"./index-Dpso9GU3.js";import{I as p}from"./input-Bk6CaQFa.js";import{C as y,a as j,b as f,d as v,c as b}from"./card-Sps0XDlE.js";import{T as N,a as w,b as k,c as I}from"./tabs-BHKe9vPI.js";import{l as C}from"./socket-video-BniMLvTU.js";import{B as D}from"./bot-ChORE7AJ.js";import{U as S}from"./users-BiZSfXh4.js";import{P as T}from"./plus-Qr2NWtdU.js";import{T as U,S as A}from"./trash-2-DHzu3dag.js";import"./chart-vendor-D0NPwkge.js";const $="http://localhost:5000",L=C("http://localhost:5000",{withCredentials:!0}),P=e=>{L.emit("joinDmRoom",e)},O=(e,s,a)=>{L.emit("joinRoom",{event:"joinRoom",data:{roomId:e,userId:s,username:a}})},E=async(e,s=1,t=50)=>{try{return(await a.get(`${$}/api/chat/one-on-one/${e}`,{params:{page:s,limit:t},withCredentials:!0})).data}catch(r){throw r}};function R(){const[C,R]=s.useState(""),[M,z]=s.useState([]),[X,F]=s.useState("ai"),[H,J]=s.useState([]),[W,B]=s.useState([]),[V,_]=s.useState(!1),[q,G]=s.useState(!0),[K,Y]=s.useState([]),[Q,Z]=s.useState(null),[ee,se]=s.useState(!1),[ae,te]=s.useState([]),[re,ie]=s.useState(null),le=s.useRef(null),ce="http://localhost:5000/api",de=t(e=>e.user);s.useEffect(()=>{!async function(){var e;try{const e=await a.get(`${ce}/patient/fetchAllDoctors`,{withCredentials:!0});e.data.success&&z(e.data.data)}catch(s){a.isAxiosError(s)&&s.response?u.error((null==(e=s.response.data)?void 0:e.message)||"Something went wrong"):u.error("Unknown error occurred")}}()},[ce]),s.useEffect(()=>{!async function(){var e;if(de)try{const e="DOCTOR"===de.role?`${ce}/doctor/city-rooms`:`${ce}/patient/city-rooms`,s=await a.get(e,{withCredentials:!0});if(s.data.success){const e=s.data.data;B(Array.isArray(e)?e:[e])}}catch(s){a.isAxiosError(s)&&s.response?u.error((null==(e=s.response.data)?void 0:e.message)||"Something went wrong"):u.error("Unknown error ocurred")}}()},[de]);const[ne,oe]=s.useState([]),[me,xe]=s.useState(!1),[he,ge]=s.useState(()=>localStorage.getItem("ai-chat-language")||"en"),ue=e=>{const s=e.toLowerCase();return s.includes("severe")||s.includes("grave")||s.includes("severo")||s.includes("sÃ©vÃ¨re")?"severe":s.includes("moderate")||s.includes("moderado")||s.includes("modÃ©rÃ©")||s.includes("moderato")?"moderate":"mild"};s.useEffect(()=>{"DOCTOR"===(null==de?void 0:de.role)&&fe()},[de]),s.useEffect(()=>{var e;q?G(!1):(H.length>0||ne.length>0)&&le.current&&(null==(e=le.current)||e.scrollIntoView({behavior:"auto"}))},[H,ne,q]),s.useEffect(()=>{"ai"===X&&pe()},[X]);const pe=async()=>{try{const e=await a.get(`${ce}/ai-chat/history`,{withCredentials:!0});if(e.data.success){const s=e.data.data.chats||[];if(0===s.length)oe([{id:"welcome",type:"ai",message:"Hello! I'm CareXpert AI, your health assistant. Describe your symptoms and I'll help analyze them for you.",time:"Just now"}]);else{const e=s.map(e=>[{id:`${e.id}-user`,type:"user",message:e.userMessage,time:new Date(e.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})},{id:`${e.id}-ai`,type:"ai",message:ye(e),time:new Date(e.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),aiData:e}]).flat();oe(e)}}}catch(e){oe([{id:"welcome",type:"ai",message:"Hello! I'm CareXpert AI, your health assistant. Describe your symptoms and I'll help analyze them for you.",time:"Just now"}])}},ye=e=>{const s=e.probable_causes||e.probableCauses||[],{severity:a,recommendation:t,disclaimer:r}=e;let i=`**Probable Causes:**\n${s.map(e=>`â€¢ ${e}`).join("\n")}\n\n`;return i+=`**Recommendation:**\n${t}\n\n`,i+=`**Disclaimer:**\n${r}`,i};function je(e,s){return[e,s].sort().join("_")}const fe=async()=>{try{const e=await a.get(`${ce}/chat/doctor/conversations`,{withCredentials:!0});e.data.success&&te(e.data.data.conversations)}catch(e){}},ve=async e=>{try{const s=await E(e);if(s.success){const a=s.data.messages.map(s=>({roomId:je((null==de?void 0:de.id)||"",e),senderId:s.senderId,receiverId:s.receiverId,username:s.sender.name,text:s.message,time:new Date(s.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),messageType:s.messageType,imageUrl:s.imageUrl}));J(a)}}catch(s){}};s.useEffect(()=>{(async()=>{var e,s;if(de&&"object"==typeof X&&"doctor"===X.type){const e=je(de.id,X.data.userId);P(e);try{const s=await E(X.data.userId);if(s.success){const a=s.data.messages.map(s=>({roomId:e,senderId:s.senderId,receiverId:s.receiverId,username:s.sender.name,text:s.message,time:new Date(s.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),messageType:s.messageType,imageUrl:s.imageUrl}));J(a)}}catch(t){J([])}}else if("object"==typeof X&&"room"===X.type)try{const r=await(async(e,s=1,r=50)=>{try{return(await a.get(`${$}/api/chat/city/${encodeURIComponent(e)}`,{params:{page:s,limit:r},withCredentials:!0})).data}catch(t){throw t}})(X.name);if(r.success){(null==(s=null==(e=r.data)?void 0:e.room)?void 0:s.id)?(Z(r.data.room.id),de&&O(r.data.room.id,de.id,de.name)):(Z(X.id),de&&O(X.id,de.id,de.name));const a=r.data.messages.map(e=>{var s,a;return{roomId:(null==(a=null==(s=r.data)?void 0:s.room)?void 0:a.id)||X.id,senderId:e.senderId,receiverId:null,username:e.sender.name,text:e.message,time:new Date(e.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),messageType:e.messageType,imageUrl:e.imageUrl}});J(a)}await(async e=>{try{const s=await a.get(`http://localhost:5000/api/user/communities/${e}/members`,{withCredentials:!0});s.data.success&&Y(s.data.data.members)}catch(t){}})(X.id)}catch(t){J([])}else"ai"===X&&J([])})()},[X,de]);const be=async()=>{if(C.trim()&&X&&de)if("object"==typeof X&&"doctor"===X.type){const e={roomId:je(de.id,X.data.userId),senderId:de.id,receiverId:X.data.userId,username:de.name,text:C.trim(),messageType:"TEXT",time:(new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})};(e=>{L.emit("dmMessage",{event:"dmMessage",data:e})})(e),J(s=>[...s,{...e,type:"user"}]),R("")}else if("ai"===X)await(async e=>{try{xe(!0);const s={id:`user-${Date.now()}`,type:"user",message:e,time:(new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})};oe(e=>[...e,s]),R("");const t=await a.post(`${ce}/ai-chat/process`,{symptoms:e,language:he},{withCredentials:!0});if(t.data.success){const e=t.data.data,s={id:`ai-${Date.now()}`,type:"ai",message:ye(e),time:(new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),aiData:e};oe(e=>[...e,s])}}catch(s){u.error("Failed to get AI response. Please try again.");const e={id:`error-${Date.now()}`,type:"ai",message:"Sorry, I'm having trouble processing your request. Please try again.",time:(new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})};oe(s=>[...s,e])}finally{xe(!1)}})(C.trim());else if("object"==typeof X&&"room"===X.type){if(!Q)return void u.error("Connecting to room... please try again in a moment");const e={roomId:Q,senderId:de.id,username:de.name,text:C.trim(),messageType:"TEXT",time:(new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})};(e=>{L.emit("roomMessage",{event:"roomMessage",data:e})})(e),J(s=>[...s,{...e,type:"user"}]),R("")}};return s.useEffect(()=>{var e;return e=e=>{e.senderId!==(null==de?void 0:de.id)&&("object"==typeof X&&"doctor"===X.type&&je((null==de?void 0:de.id)||"",X.data.userId)===e.roomId||"object"==typeof X&&"room"===X.type&&X.id===e.roomId)&&J(s=>[...s,e])},L.on("message",s=>{e(s)}),()=>{L.off("message")}},[X,de]),e.jsxs("div",{className:"h-[calc(100%-1rem)] overflow-hidden flex flex-col mt-4",children:[e.jsx("div",{className:"lg:hidden p-4 border-b border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Chat"}),e.jsx(r,{variant:"outline",size:"sm",onClick:()=>_(!V),children:V?e.jsx(i,{className:"h-4 w-4"}):e.jsx(l,{className:"h-4 w-4"})})]})}),e.jsxs("div",{className:"flex-1 flex overflow-hidden h-full",children:[V&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-40 lg:hidden",onClick:()=>_(!1)}),e.jsxs("div",{className:(V?"block":"hidden")+" lg:block w-80 flex-shrink-0 lg:mr-6 lg:relative fixed lg:top-0 top-0 left-0 h-full z-50 lg:z-auto bg-white dark:bg-gray-900 lg:bg-transparent",children:[e.jsx("div",{className:"lg:hidden flex justify-end p-4 border-b border-gray-200 dark:border-gray-700",children:e.jsx(r,{variant:"ghost",size:"sm",onClick:()=>_(!1),children:e.jsx(i,{className:"h-4 w-4"})})}),e.jsxs(N,{defaultValue:"ai",className:"space-y-4 flex flex-col h-full",children:[e.jsxs(w,{className:"grid w-full "+("DOCTOR"===(null==de?void 0:de.role)?"grid-cols-4":"grid-cols-3"),children:[e.jsx(k,{value:"ai",className:"text-xs",children:"AI"}),e.jsx(k,{value:"doctors",className:"text-xs",children:"Doctors"}),"DOCTOR"===(null==de?void 0:de.role)&&e.jsx(k,{value:"patients",className:"text-xs",children:"Patients"}),e.jsx(k,{value:"community",className:"text-xs",children:"Community"})]}),e.jsx(I,{value:"ai",className:"flex-1 overflow-hidden",children:e.jsxs(y,{className:"h-full flex flex-col",children:[e.jsx(j,{className:"pb-3",children:e.jsxs(f,{className:"flex items-center gap-2 text-lg",children:[e.jsx(D,{className:"h-5 w-5 text-purple-600"}),"CareXpert AI"]})}),e.jsx(v,{className:"flex-1 overflow-y-auto scrollbar-hide",children:e.jsx("div",{className:"p-3 rounded-lg cursor-pointer transition-colors "+("ai"===X?"bg-purple-100 dark:bg-purple-900/30 border border-purple-200 dark:border-purple-700":"hover:bg-gray-100 dark:hover:bg-gray-800"),onClick:()=>{F("ai"),_(!1)},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-600 rounded-full flex items-center justify-center",children:e.jsx(D,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white",children:"AI Assistant"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Always available"})]})]})})})]})}),e.jsx(I,{value:"doctors",className:"flex-1 overflow-hidden",children:e.jsxs(y,{className:"h-full flex flex-col",children:[e.jsx(j,{className:"pb-3",children:e.jsxs(f,{className:"flex items-center gap-2 text-lg",children:[e.jsx(c,{className:"h-5 w-5 text-blue-600"}),"Doctor Chats"]})}),e.jsx(v,{className:"space-y-3 flex-1 overflow-y-auto scrollbar-hide",children:M.length>0?M.map(s=>e.jsx("div",{className:"p-3 rounded-lg cursor-pointer transition-colors "+("object"==typeof X&&"doctor"===X.type&&X.data.id===s.id?"bg-blue-100 dark:bg-blue-900/30 border border-blue-200 dark:border-blue-700":"hover:bg-gray-100 dark:hover:bg-gray-800"),onClick:()=>{F({type:"doctor",data:s}),_(!1)},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"relative",children:e.jsxs(d,{className:"h-10 w-10",children:[e.jsx(n,{src:s.user.profilePicture||"/placeholder.svg"}),e.jsx(o,{children:s.user.name.split(" ").map(e=>e[0]).join("")})]})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white text-sm",children:s.user.name}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:s.specialty})]})]})},s.id)):e.jsx("p",{className:"text-center text-gray-500 dark:text-gray-400",children:"No doctors found."})})]})}),"DOCTOR"===(null==de?void 0:de.role)&&e.jsx(I,{value:"patients",className:"flex-1 overflow-hidden",children:e.jsxs(y,{className:"h-full flex flex-col",children:[e.jsxs(j,{className:"pb-3",children:[e.jsxs(f,{className:"flex items-center gap-2 text-lg",children:[e.jsx(S,{className:"h-5 w-5 text-green-600"}),"Patient Messages"]}),e.jsx(b,{children:"Chat with your patients"})]}),e.jsx(v,{className:"p-0",children:e.jsx("div",{className:"h-[500px] overflow-y-auto scrollbar-hide",children:ae.length>0?ae.map(s=>e.jsx("div",{className:"p-4 border-b cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors "+((null==re?void 0:re.otherUser.id)===s.otherUser.id?"bg-green-50 dark:bg-green-900/20 border-l-4 border-l-green-500":""),onClick:()=>{(async e=>{ie(e),F({type:"doctor",data:{id:e.otherUser.id,userId:e.otherUser.id,specialty:"Patient",clinicLocation:"",user:{name:e.otherUser.name,profilePicture:e.otherUser.profilePicture}}}),J([]);const s=je((null==de?void 0:de.id)||"",e.otherUser.id);P(s),await ve(e.otherUser.id)})(s),_(!1)},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(d,{className:"h-10 w-10",children:[e.jsx(n,{src:s.otherUser.profilePicture||"/placeholder.svg"}),e.jsx(o,{children:s.otherUser.name.split(" ").map(e=>e[0]).join("")})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white text-sm",children:s.otherUser.name}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:s.lastMessage.message}),e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500",children:new Date(s.lastMessage.timestamp).toLocaleDateString()})]}),s.unreadCount>0&&e.jsx(m,{variant:"destructive",className:"text-xs",children:s.unreadCount})]})},s.otherUser.id)):e.jsxs("div",{className:"p-6 text-center text-gray-500 dark:text-gray-400",children:[e.jsx(S,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No conversations yet"}),e.jsx("p",{className:"text-sm",children:"Patients will appear here when they message you"})]})})})]})}),e.jsx(I,{value:"community",className:"flex-1 overflow-hidden",children:e.jsxs(y,{className:"h-full flex flex-col",children:[e.jsx(j,{className:"pb-3",children:e.jsxs(f,{className:"flex items-center justify-between text-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{className:"h-5 w-5 text-green-600"}),"City Rooms"]}),e.jsx("div",{children:e.jsx(T,{className:"bg-gray-200 dark:bg-gray-700 rounded-full h-8 w-8 p-1"})})]})}),e.jsx(v,{className:"space-y-3 flex-1 overflow-y-auto scrollbar-hide",children:W.length>0?W.map(s=>e.jsx("div",{className:"p-3 rounded-lg cursor-pointer transition-colors "+("object"==typeof X&&"room"===X.type&&X.name===s.name?"bg-green-100 dark:bg-green-900/30 border border-green-200 dark:border-green-700":"hover:bg-gray-100 dark:hover:bg-gray-800"),onClick:()=>{F({type:"room",...s}),_(!1)},children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white text-sm",children:s.name}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(x,{className:"h-3 w-3 text-gray-400"}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:s.name})]}),e.jsxs(m,{variant:"secondary",className:"text-xs",children:[s.members.length," members"]})]})},s.id)):e.jsx("p",{children:"Loading city rooms..."})})]})})]})]}),e.jsx("div",{className:"flex-1 flex flex-col min-w-0",children:e.jsxs(y,{className:"h-full flex flex-col",children:[e.jsxs(j,{className:"border-b",children:["ai"===X&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-600 rounded-full flex items-center justify-center",children:e.jsx(D,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{children:[e.jsx(f,{className:"text-lg",children:"CareXpert AI Assistant"}),e.jsx(b,{children:"Your personal health companion"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(r,{variant:"outline",size:"sm",onClick:async()=>{try{await a.delete(`${ce}/ai-chat/history`,{withCredentials:!0}),oe([{id:"welcome",type:"ai",message:"Chat cleared. Hello! I'm CareXpert AI. Describe your symptoms and I'll help analyze them for you.",time:(new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}]),u.success("AI chat cleared")}catch(e){u.error("Failed to clear AI chat")}},children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),"Clear Chat"]}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Language:"}),e.jsx("select",{value:he,onChange:e=>{return s=e.target.value,ge(s),void localStorage.setItem("ai-chat-language",s);var s},className:"px-3 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-purple-500",children:[{code:"en",name:"English",flag:"ðŸ‡ºðŸ‡¸"},{code:"hi",name:"à¤¹à¤¿à¤¨à¥à¤¦à¥€",flag:"ðŸ‡®ðŸ‡³"},{code:"gu",name:"àª—à«àªœàª°àª¾àª¤à«€",flag:"ðŸ‡®ðŸ‡³"},{code:"pa",name:"à¨ªà©°à¨œà¨¾à¨¬à©€",flag:"ðŸ‡®ðŸ‡³"},{code:"mr",name:"à¤®à¤°à¤¾à¤ à¥€",flag:"ðŸ‡®ðŸ‡³"},{code:"bn",name:"à¦¬à¦¾à¦‚à¦²à¦¾",flag:"ðŸ‡®ðŸ‡³"},{code:"ta",name:"à®¤à®®à®¿à®´à¯",flag:"ðŸ‡®ðŸ‡³"},{code:"te",name:"à°¤à±†à°²à±à°—à±",flag:"ðŸ‡®ðŸ‡³"},{code:"kn",name:"à²•à²¨à³à²¨à²¡",flag:"ðŸ‡®ðŸ‡³"},{code:"ml",name:"à´®à´²à´¯à´¾à´³à´‚",flag:"ðŸ‡®ðŸ‡³"},{code:"or",name:"à¬“à¬¡à¬¼à¬¿à¬†",flag:"ðŸ‡®ðŸ‡³"}].map(s=>e.jsxs("option",{value:s.code,children:[s.flag," ",s.name]},s.code))})]})]}),"object"==typeof X&&"doctor"===X.type&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(d,{className:"h-10 w-10",children:[e.jsx(n,{src:X.data.user.profilePicture}),e.jsx(o,{children:X.data.user.name.split(" ").map(e=>e[0]).join("")})]}),e.jsxs("div",{children:[e.jsx(f,{className:"text-lg",children:X.data.user.name}),e.jsxs(b,{children:[X.data.specialty," â€¢ Online"]})]})]}),"object"==typeof X&&"room"===X.type&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-green-600 rounded-full flex items-center justify-center",children:e.jsx(S,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{children:[e.jsx(f,{className:"text-lg",children:X.name}),e.jsxs(b,{children:[X.members.length," members â€¢"," ",X.name]})]})]}),e.jsxs(r,{variant:"outline",size:"sm",onClick:()=>se(!ee),className:"flex items-center gap-2",children:[e.jsx(S,{className:"h-4 w-4"}),ee?"Hide Members":"Show Members"]})]})]}),e.jsx(v,{className:"flex-1 p-4 overflow-y-auto scrollbar-hide",children:e.jsxs("div",{className:"h-full",children:["ai"===X&&e.jsxs(e.Fragment,{children:[ne.map(s=>e.jsx("div",{className:"flex mb-4 "+("user"===s.type?"justify-end":"justify-start"),children:e.jsxs("div",{className:"max-w-[80%] p-3 rounded-lg "+("user"===s.type?"bg-blue-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-900 dark:text-white"),children:["ai"===s.type?e.jsxs("div",{className:"text-sm",children:[s.aiData&&e.jsx("div",{className:"mb-3",children:e.jsxs(m,{variant:"severe"===ue(s.aiData.severity)?"destructive":"moderate"===ue(s.aiData.severity)?"default":"secondary",className:"mb-2",children:[s.aiData.severity.charAt(0).toUpperCase()+s.aiData.severity.slice(1)," ","Severity"]})}),s.message.split("\n").map((s,a)=>s.startsWith("**")&&s.endsWith("**")?e.jsx("div",{className:"font-semibold text-purple-600 dark:text-purple-400 mb-2",children:s.replace(/\*\*/g,"")},a):s.startsWith("â€¢")?e.jsx("div",{className:"ml-4 mb-1",children:s},a):""===s.trim()?e.jsx("br",{},a):e.jsx("div",{className:"mb-2",children:s},a))]}):e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:s.message}),e.jsx("p",{className:"text-xs mt-1 "+("user"===s.type?"text-blue-100":"text-gray-500 dark:text-gray-400"),children:s.time})]})},s.id)),me&&e.jsx("div",{className:"flex justify-start mb-4",children:e.jsx("div",{className:"bg-gray-200 dark:bg-gray-700 text-gray-900 dark:text-white p-3 rounded-lg max-w-[80%]",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-purple-600"}),e.jsx("span",{className:"text-sm",children:"AI is analyzing your symptoms..."})]})})})]}),"object"==typeof X&&("doctor"===X.type||"room"===X.type)&&(H.length>0?H.filter(e=>"room"!==X.type||(!e.roomId||e.roomId===(Q||X.id))).map((s,a)=>{var t,r;return e.jsxs("div",{className:"flex mb-2 "+("user"===s.type||s.senderId===(null==de?void 0:de.id)?"justify-end":"justify-start"),children:["room"===X.type&&!("user"===s.type||s.senderId===(null==de?void 0:de.id))&&e.jsx("div",{className:"mr-2 mt-[2px]",children:e.jsxs(d,{className:"h-6 w-6",children:[e.jsx(n,{src:"/placeholder-user.jpg"}),e.jsx(o,{className:"text-[10px]",children:(null==(t=s.username)?void 0:t.charAt(0))||"U"})]})}),e.jsxs("div",{className:"max-w-[80%] py-2 px-[10px] rounded-lg "+("user"===s.type||s.senderId===(null==de?void 0:de.id)?"bg-blue-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-900 dark:text-white"),children:["IMAGE"===s.messageType&&s.imageUrl?e.jsx("img",{src:s.imageUrl,alt:"sent-img",className:"rounded mb-1 max-w-full h-auto"}):e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:s.text}),e.jsx("p",{className:"text-xs mt-1 text-right text-gray-400",children:s.time})]}),"room"===X.type&&("user"===s.type||s.senderId===(null==de?void 0:de.id))&&e.jsx("div",{className:"ml-2 mt-[2px]",children:e.jsxs(d,{className:"h-6 w-6",children:[e.jsx(n,{src:null==de?void 0:de.profilePicture}),e.jsx(o,{className:"text-[10px]",children:(null==(r=null==de?void 0:de.name)?void 0:r.charAt(0))||"U"})]})})]},a)}):e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"doctor"===X.type?"Start a conversation with your doctor":"Join the community discussion"})})),e.jsx("div",{ref:le})," "]})}),"object"==typeof X&&"room"===X.type&&ee&&e.jsxs("div",{className:"border-t p-4 bg-gray-50 dark:bg-gray-800",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:["Community Members (",K.length,")"]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 max-h-48 overflow-y-auto scrollbar-hide",children:K.map(s=>{var a;return e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-white dark:bg-gray-700 rounded-lg border border-gray-200 dark:border-gray-600",children:[e.jsxs(d,{className:"h-8 w-8",children:[e.jsx(n,{src:s.profilePicture}),e.jsx(o,{className:"bg-blue-600 text-white text-sm",children:(null==(a=s.name)?void 0:a.charAt(0))||"U"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white truncate",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(m,{variant:"DOCTOR"===s.role?"default":"secondary",className:"text-xs",children:"DOCTOR"===s.role?e.jsxs(e.Fragment,{children:[e.jsx(h,{className:"h-3 w-3 mr-1"}),"Doctor"]}):e.jsxs(e.Fragment,{children:[e.jsx(g,{className:"h-3 w-3 mr-1"}),"Patient"]})}),s.specialty&&e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:s.specialty})]}),s.location&&e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:["ðŸ“ ",s.location]})]})]},s.id)})})]}),e.jsx("div",{className:"border-t p-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(p,{placeholder:"Type your message...",value:C,onChange:e=>R(e.target.value),onKeyPress:e=>"Enter"===e.key&&be(),className:"flex-1"}),e.jsx(r,{onClick:be,className:"px-6",children:e.jsx(A,{className:"h-4 w-4"})})]})})]})})]})]})}export{R as default};
