import{j as e}from"./ui-vendor-izRNgCO_.js";import{r as a}from"./react-vendor-r9Et1EnL.js";import{c as s,d as r,p as t,a as l,u as i,F as d,B as n,b as o}from"./index-Dpso9GU3.js";import{C as c,a as m,b as x,c as u,d as p}from"./card-Sps0XDlE.js";import{C as h}from"./circle-alert-BIj8_q8m.js";import"./chart-vendor-D0NPwkge.js";
/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const g=s("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),y=t("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),v=a.forwardRef(({className:a,variant:s,...t},l)=>e.jsx("div",{ref:l,role:"alert",className:r(y({variant:s}),a),...t}));v.displayName="Alert";a.forwardRef(({className:a,...s},t)=>e.jsx("h5",{ref:t,className:r("mb-1 font-medium leading-none tracking-tight",a),...s})).displayName="AlertTitle";const j=a.forwardRef(({className:a,...s},t)=>e.jsx("div",{ref:t,className:r("text-sm [&_p]:leading-relaxed",a),...s}));function f(){const[s,r]=a.useState(null),[t,y]=a.useState(!1),[,f]=a.useState(null),[N,b]=a.useState("IDLE"),[w,k]=a.useState(null),[E,I]=a.useState(null),S=a.useRef(null),C="http://localhost:5000/api",A=()=>{S.current&&(window.clearInterval(S.current),S.current=null)};a.useEffect(()=>{try{const e=localStorage.getItem("report-analyzer-state");if(e){const a=JSON.parse(e);(null==a?void 0:a.reportId)&&(f(a.reportId),b("PROCESSING"===a.status?"PROCESSING":"IDLE"),R(a.reportId))}const a=localStorage.getItem("report-analyzer-last");if(a){const e=JSON.parse(a);e&&e.id&&(k(e),b(e.status||"COMPLETED"))}}catch{}return()=>A()},[]);const R=e=>{A(),S.current=window.setInterval(async()=>{var a;try{const s=await l.get(`${C}/report/${e}`,{withCredentials:!0});if(null==(a=s.data)?void 0:a.success){const e=s.data.data;"COMPLETED"===e.status?(b("COMPLETED"),k(e),A(),y(!1),i.success("Report analyzed successfully")):"FAILED"===e.status?(b("FAILED"),I(e.error||"Analysis failed"),A(),y(!1),i.error(e.error||"Report analysis failed")):b("PROCESSING")}}catch(s){}},2e3)};return e.jsxs("div",{className:"container mx-auto p-6 max-w-4xl",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-2",children:"Analyze Report"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Upload your medical reports for AI-powered analysis and insights."})]}),e.jsxs("div",{className:"grid gap-6",children:[e.jsxs(c,{children:[e.jsxs(m,{children:[e.jsxs(x,{className:"flex items-center gap-2",children:[e.jsx(d,{className:"h-5 w-5"}),"Upload Medical Report"]}),e.jsx(u,{children:"Upload your medical reports in PDF, JPG, or PNG format for analysis."})]}),e.jsxs(p,{className:"space-y-4",children:[e.jsxs("div",{className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-8 text-center",children:[e.jsx(g,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-lg font-medium text-gray-900 dark:text-white",children:s?s.name:"Choose file or drag and drop"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"PDF, JPG, PNG up to 10MB"})]}),e.jsx("input",{type:"file",accept:".pdf,.jpg,.jpeg,.png",onChange:e=>{var a;const s=null==(a=e.target.files)?void 0:a[0];s&&r(s)},className:"hidden",id:"file-upload"}),e.jsx(n,{variant:"outline",onClick:()=>{var e;return null==(e=document.getElementById("file-upload"))?void 0:e.click()},className:"mt-4",children:"Select File"})]}),s&&e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(d,{className:"h-8 w-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:s.name}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[(s.size/1024/1024).toFixed(2)," MB"]})]})]}),e.jsx(n,{variant:"outline",size:"sm",onClick:()=>r(null),children:"Remove"})]}),e.jsxs(v,{children:[e.jsx(h,{className:"h-4 w-4"}),e.jsx(j,{children:"Your uploaded reports will be analyzed using AI to provide insights about your health condition. All data is processed securely and confidentially."})]}),e.jsx(n,{onClick:async()=>{var e,a,r,t,d,n;if(s){I(null),k(null),y(!0),b("PROCESSING");try{const d=new FormData;d.append("report",s);const n=await l.post(`${C}/report`,d,{withCredentials:!0,headers:{"Content-Type":"multipart/form-data"}});if(!(null==(e=n.data)?void 0:e.success)||!(null==(r=null==(a=n.data)?void 0:a.data)?void 0:r.reportId))throw new Error((null==(t=n.data)?void 0:t.message)||"Upload failed");{const e=n.data.data.reportId;f(e),R(e),i.message("Report uploaded",{description:"Analyzing in background..."})}}catch(o){y(!1),b("FAILED");const e=(null==(n=null==(d=null==o?void 0:o.response)?void 0:d.data)?void 0:n.message)||(null==o?void 0:o.message)||"Upload failed";I(e),i.error(e)}}},disabled:!s||t,className:"w-full",children:t?"Analyzing...":"Analyze Report"})]})]}),e.jsxs(c,{children:[e.jsxs(m,{children:[e.jsx(x,{children:"Analysis Result"}),e.jsxs(u,{children:["IDLE"===N&&"Upload a report to see results here.","PROCESSING"===N&&"We are analyzing your report. This may take a moment.","COMPLETED"===N&&"Your report has been analyzed.","FAILED"===N&&"We couldn't analyze your report."]})]}),e.jsxs(p,{children:["PROCESSING"===N&&e.jsx("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:"Analyzing... Please wait."}),"FAILED"===N&&e.jsxs(v,{className:"mb-4",children:[e.jsx(h,{className:"h-4 w-4"}),e.jsx(j,{children:E||"Something went wrong while analyzing your report."})]}),"COMPLETED"===N&&w&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Filename"}),e.jsx("div",{className:"font-medium",children:w.filename})]}),w.summary&&e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold mb-2",children:"Summary"}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300 whitespace-pre-wrap",children:w.summary})]}),Array.isArray(w.abnormalValues)&&w.abnormalValues.length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold mb-2",children:"Abnormal Values"}),e.jsx("div",{className:"space-y-3",children:w.abnormalValues.map((e,a)=>({name:e.test_name||e.testName||e.parameter||`Result ${a+1}`,value:e.value??e.measured_value??e.measuredValue,unit:e.unit||e.units||"",normal:e.normal_range||e.normalRange||e.reference||"",issue:e.issue||e.reason||e.flag||""})).map((a,s)=>e.jsx("div",{className:"rounded-lg border border-red-500/20 bg-red-500/5 p-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"font-medium truncate",children:a.name}),a.normal&&e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["Normal: ",a.normal]})]}),e.jsxs("div",{className:"shrink-0 text-right",children:[e.jsxs("div",{className:"text-red-600 font-semibold",children:[void 0!==a.value?a.value:"â€”"," ",a.unit]}),a.issue&&e.jsx(o,{variant:"secondary",className:"mt-1 bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-300",children:a.issue})]})]})},`${a.name}-${s}`))})]}),Array.isArray(w.possibleConditions)&&w.possibleConditions.length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold mb-2",children:"Possible Conditions"}),e.jsx("ul",{className:"list-disc pl-6 space-y-1",children:w.possibleConditions.map((a,s)=>e.jsx("li",{children:"string"==typeof a?a:(null==a?void 0:a.condition)||JSON.stringify(a)},s))})]}),w.recommendation&&e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold mb-2",children:"Recommendation"}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300 whitespace-pre-wrap",children:w.recommendation})]}),w.disclaimer&&e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold mb-2",children:"Disclaimer"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 whitespace-pre-wrap",children:w.disclaimer})]})]}),"IDLE"===N&&e.jsx("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:"No reports analyzed yet. Upload your first report to get started."})]})]})]})]})}j.displayName="AlertDescription";export{f as default};
