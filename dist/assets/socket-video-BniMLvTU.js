var e=Object.defineProperty,t=e=>{throw TypeError(e)},r=(t,r,n)=>((t,r,n)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[r]=n)(t,"symbol"!=typeof r?r+"":r,n),n=(e,r,n)=>r.has(e)||t("Cannot "+n),s=(e,t,r)=>(n(e,t,"read from private field"),r?r.call(e):t.get(e)),i=(e,r,n)=>r.has(e)?t("Cannot add the same private member more than once"):r instanceof WeakSet?r.add(e):r.set(e,n),a=(e,t,r,s)=>(n(e,t,"write to private field"),s?s.call(e,r):t.set(e,r),r);import{g as o,r as c,b as d}from"./react-vendor-r9Et1EnL.js";const u=Object.create(null);u.open="0",u.close="1",u.ping="2",u.pong="3",u.message="4",u.upgrade="5",u.noop="6";const l=Object.create(null);Object.keys(u).forEach(e=>{l[u[e]]=e});const p={type:"error",data:"parser error"},h="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),m="function"==typeof ArrayBuffer,f=e=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer,g=({type:e,data:t},r,n)=>h&&t instanceof Blob?r?n(t):v(t,n):m&&(t instanceof ArrayBuffer||f(t))?r?n(t):v(new Blob([t]),n):n(u[e]+(t||"")),v=(e,t)=>{const r=new FileReader;return r.onload=function(){const e=r.result.split(",")[1];t("b"+(e||""))},r.readAsDataURL(e)};function _(e){return e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}let y;const b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",w="undefined"==typeof Uint8Array?[]:new Uint8Array(256);for(let ct=0;ct<64;ct++)w[b.charCodeAt(ct)]=ct;const S="function"==typeof ArrayBuffer,R=(e,t)=>{if("string"!=typeof e)return{type:"message",data:E(e,t)};const r=e.charAt(0);if("b"===r)return{type:"message",data:k(e.substring(1),t)};return l[r]?e.length>1?{type:l[r],data:e.substring(1)}:{type:l[r]}:p},k=(e,t)=>{if(S){const r=(e=>{let t,r,n,s,i,a=.75*e.length,o=e.length,c=0;"="===e[e.length-1]&&(a--,"="===e[e.length-2]&&a--);const d=new ArrayBuffer(a),u=new Uint8Array(d);for(t=0;t<o;t+=4)r=w[e.charCodeAt(t)],n=w[e.charCodeAt(t+1)],s=w[e.charCodeAt(t+2)],i=w[e.charCodeAt(t+3)],u[c++]=r<<2|n>>4,u[c++]=(15&n)<<4|s>>2,u[c++]=(3&s)<<6|63&i;return d})(e);return E(r,t)}return{base64:!0,data:e}},E=(e,t)=>"blob"===t?e instanceof Blob?e:new Blob([e]):e instanceof ArrayBuffer?e:e.buffer,T=String.fromCharCode(30);function C(){return new TransformStream({transform(e,t){!function(e,t){h&&e.data instanceof Blob?e.data.arrayBuffer().then(_).then(t):m&&(e.data instanceof ArrayBuffer||f(e.data))?t(_(e.data)):g(e,!1,e=>{y||(y=new TextEncoder),t(y.encode(e))})}(e,r=>{const n=r.length;let s;if(n<126)s=new Uint8Array(1),new DataView(s.buffer).setUint8(0,n);else if(n<65536){s=new Uint8Array(3);const e=new DataView(s.buffer);e.setUint8(0,126),e.setUint16(1,n)}else{s=new Uint8Array(9);const e=new DataView(s.buffer);e.setUint8(0,127),e.setBigUint64(1,BigInt(n))}e.data&&"string"!=typeof e.data&&(s[0]|=128),t.enqueue(s),t.enqueue(r)})}})}let P;function O(e){return e.reduce((e,t)=>e+t.length,0)}function x(e,t){if(e[0].length===t)return e.shift();const r=new Uint8Array(t);let n=0;for(let s=0;s<t;s++)r[s]=e[0][n++],n===e[0].length&&(e.shift(),n=0);return e.length&&n<e[0].length&&(e[0]=e[0].slice(n)),r}function D(e){if(e)return function(e){for(var t in D.prototype)e[t]=D.prototype[t];return e}(e)}D.prototype.on=D.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},D.prototype.once=function(e,t){function r(){this.off(e,r),t.apply(this,arguments)}return r.fn=t,this.on(e,r),this},D.prototype.off=D.prototype.removeListener=D.prototype.removeAllListeners=D.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var r,n=this._callbacks["$"+e];if(!n)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var s=0;s<n.length;s++)if((r=n[s])===t||r.fn===t){n.splice(s,1);break}return 0===n.length&&delete this._callbacks["$"+e],this},D.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),r=this._callbacks["$"+e],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(r){n=0;for(var s=(r=r.slice(0)).length;n<s;++n)r[n].apply(this,t)}return this},D.prototype.emitReserved=D.prototype.emit,D.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},D.prototype.hasListeners=function(e){return!!this.listeners(e).length};const I="function"==typeof Promise&&"function"==typeof Promise.resolve?e=>Promise.resolve().then(e):(e,t)=>t(e,0),A="undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")();function M(e,...t){return t.reduce((t,r)=>(e.hasOwnProperty(r)&&(t[r]=e[r]),t),{})}const L=A.setTimeout,N=A.clearTimeout;function j(e,t){t.useNativeTimers?(e.setTimeoutFn=L.bind(A),e.clearTimeoutFn=N.bind(A)):(e.setTimeoutFn=A.setTimeout.bind(A),e.clearTimeoutFn=A.clearTimeout.bind(A))}function B(e){return"string"==typeof e?function(e){let t=0,r=0;for(let n=0,s=e.length;n<s;n++)t=e.charCodeAt(n),t<128?r+=1:t<2048?r+=2:t<55296||t>=57344?r+=3:(n++,r+=4);return r}(e):Math.ceil(1.33*(e.byteLength||e.size))}function U(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}class F extends Error{constructor(e,t,r){super(e),this.description=t,this.context=r,this.type="TransportError"}}class q extends D{constructor(e){super(),this.writable=!1,j(this,e),this.opts=e,this.query=e.query,this.socket=e.socket,this.supportsBinary=!e.forceBase64}onError(e,t,r){return super.emitReserved("error",new F(e,t,r)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}send(e){"open"===this.readyState&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=R(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,t={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){const e=this.opts.hostname;return-1===e.indexOf(":")?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&443!==Number(this.opts.port)||!this.opts.secure&&80!==Number(this.opts.port))?":"+this.opts.port:""}_query(e){const t=function(e){let t="";for(let r in e)e.hasOwnProperty(r)&&(t.length&&(t+="&"),t+=encodeURIComponent(r)+"="+encodeURIComponent(e[r]));return t}(e);return t.length?"?"+t:""}}class W extends q{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this._polling||!this.writable){let e=0;this._polling&&(e++,this.once("pollComplete",function(){--e||t()})),this.writable||(e++,this.once("drain",function(){--e||t()}))}else t()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){((e,t)=>{const r=e.split(T),n=[];for(let s=0;s<r.length;s++){const e=R(r[s],t);if(n.push(e),"error"===e.type)break}return n})(e,this.socket.binaryType).forEach(e=>{if("opening"===this.readyState&&"open"===e.type&&this.onOpen(),"close"===e.type)return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(e)}),"closed"!==this.readyState&&(this._polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this._poll())}doClose(){const e=()=>{this.write([{type:"close"}])};"open"===this.readyState?e():this.once("open",e)}write(e){this.writable=!1,((e,t)=>{const r=e.length,n=new Array(r);let s=0;e.forEach((e,i)=>{g(e,!1,e=>{n[i]=e,++s===r&&t(n.join(T))})})})(e,e=>{this.doWrite(e,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const e=this.opts.secure?"https":"http",t=this.query||{};return!1!==this.opts.timestampRequests&&(t[this.opts.timestampParam]=U()),this.supportsBinary||t.sid||(t.b64=1),this.createUri(e,t)}}let V=!1;try{V="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(ot){}const H=V;function z(){}class K extends W{constructor(e){if(super(e),"undefined"!=typeof location){const t="https:"===location.protocol;let r=location.port;r||(r=t?"443":"80"),this.xd="undefined"!=typeof location&&e.hostname!==location.hostname||r!==e.port}}doWrite(e,t){const r=this.request({method:"POST",data:e});r.on("success",t),r.on("error",(e,t)=>{this.onError("xhr post error",e,t)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(e,t)=>{this.onError("xhr poll error",e,t)}),this.pollXhr=e}}class G extends D{constructor(e,t,r){super(),this.createRequest=e,j(this,r),this._opts=r,this._method=r.method||"GET",this._uri=t,this._data=void 0!==r.data?r.data:null,this._create()}_create(){var e;const t=M(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this._opts.xd;const r=this._xhr=this.createRequest(t);try{r.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){r.setDisableHeaderCheck&&r.setDisableHeaderCheck(!0);for(let e in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(e)&&r.setRequestHeader(e,this._opts.extraHeaders[e])}}catch(n){}if("POST"===this._method)try{r.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(n){}try{r.setRequestHeader("Accept","*/*")}catch(n){}null===(e=this._opts.cookieJar)||void 0===e||e.addCookies(r),"withCredentials"in r&&(r.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(r.timeout=this._opts.requestTimeout),r.onreadystatechange=()=>{var e;3===r.readyState&&(null===(e=this._opts.cookieJar)||void 0===e||e.parseCookies(r.getResponseHeader("set-cookie"))),4===r.readyState&&(200===r.status||1223===r.status?this._onLoad():this.setTimeoutFn(()=>{this._onError("number"==typeof r.status?r.status:0)},0))},r.send(this._data)}catch(n){return void this.setTimeoutFn(()=>{this._onError(n)},0)}"undefined"!=typeof document&&(this._index=G.requestsCount++,G.requests[this._index]=this)}_onError(e){this.emitReserved("error",e,this._xhr),this._cleanup(!0)}_cleanup(e){if(void 0!==this._xhr&&null!==this._xhr){if(this._xhr.onreadystatechange=z,e)try{this._xhr.abort()}catch(t){}"undefined"!=typeof document&&delete G.requests[this._index],this._xhr=null}}_onLoad(){const e=this._xhr.responseText;null!==e&&(this.emitReserved("data",e),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}if(G.requestsCount=0,G.requests={},"undefined"!=typeof document)if("function"==typeof attachEvent)attachEvent("onunload",$);else if("function"==typeof addEventListener){addEventListener("onpagehide"in A?"pagehide":"unload",$,!1)}function $(){for(let e in G.requests)G.requests.hasOwnProperty(e)&&G.requests[e].abort()}const J=function(){const e=Q({xdomain:!1});return e&&null!==e.responseType}();function Q(e){const t=e.xdomain;try{if("undefined"!=typeof XMLHttpRequest&&(!t||H))return new XMLHttpRequest}catch(r){}if(!t)try{return new(A[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(r){}}const Y="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase();class X extends q{get name(){return"websocket"}doOpen(){const e=this.uri(),t=this.opts.protocols,r=Y?{}:M(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(r.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(e,t,r)}catch(ot){return this.emitReserved("error",ot)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const r=e[t],n=t===e.length-1;g(r,this.supportsBinary,e=>{try{this.doWrite(r,e)}catch(t){}n&&I(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){void 0!==this.ws&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=U()),this.supportsBinary||(t.b64=1),this.createUri(e,t)}}const Z=A.WebSocket||A.MozWebSocket;const ee={websocket:class extends X{createSocket(e,t,r){return Y?new Z(e,t,r):t?new Z(e,t):new Z(e)}doWrite(e,t){this.ws.send(t)}},webtransport:class extends q{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(ot){return this.emitReserved("error",ot)}this._transport.closed.then(()=>{this.onClose()}).catch(e=>{this.onError("webtransport error",e)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(e=>{const t=function(e,t){P||(P=new TextDecoder);const r=[];let n=0,s=-1,i=!1;return new TransformStream({transform(a,o){for(r.push(a);;){if(0===n){if(O(r)<1)break;const e=x(r,1);i=!(128&~e[0]),s=127&e[0],n=s<126?3:126===s?1:2}else if(1===n){if(O(r)<2)break;const e=x(r,2);s=new DataView(e.buffer,e.byteOffset,e.length).getUint16(0),n=3}else if(2===n){if(O(r)<8)break;const e=x(r,8),t=new DataView(e.buffer,e.byteOffset,e.length),i=t.getUint32(0);if(i>Math.pow(2,21)-1){o.enqueue(p);break}s=i*Math.pow(2,32)+t.getUint32(4),n=3}else{if(O(r)<s)break;const e=x(r,s);o.enqueue(R(i?e:P.decode(e),t)),n=0}if(0===s||s>e){o.enqueue(p);break}}}})}(Number.MAX_SAFE_INTEGER,this.socket.binaryType),r=e.readable.pipeThrough(t).getReader(),n=C();n.readable.pipeTo(e.writable),this._writer=n.writable.getWriter();const s=()=>{r.read().then(({done:e,value:t})=>{e||(this.onPacket(t),s())}).catch(e=>{})};s();const i={type:"open"};this.query.sid&&(i.data=`{"sid":"${this.query.sid}"}`),this._writer.write(i).then(()=>this.onOpen())})})}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const r=e[t],n=t===e.length-1;this._writer.write(r).then(()=>{n&&I(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var e;null===(e=this._transport)||void 0===e||e.close()}},polling:class extends K{constructor(e){super(e);const t=e&&e.forceBase64;this.supportsBinary=J&&!t}request(e={}){return Object.assign(e,{xd:this.xd},this.opts),new G(Q,this.uri(),e)}}},te=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,re=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function ne(e){if(e.length>8e3)throw"URI too long";const t=e,r=e.indexOf("["),n=e.indexOf("]");-1!=r&&-1!=n&&(e=e.substring(0,r)+e.substring(r,n).replace(/:/g,";")+e.substring(n,e.length));let s=te.exec(e||""),i={},a=14;for(;a--;)i[re[a]]=s[a]||"";return-1!=r&&-1!=n&&(i.source=t,i.host=i.host.substring(1,i.host.length-1).replace(/;/g,":"),i.authority=i.authority.replace("[","").replace("]","").replace(/;/g,":"),i.ipv6uri=!0),i.pathNames=function(e,t){const r=/\/{2,9}/g,n=t.replace(r,"/").split("/");"/"!=t.slice(0,1)&&0!==t.length||n.splice(0,1);"/"==t.slice(-1)&&n.splice(n.length-1,1);return n}(0,i.path),i.queryKey=function(e,t){const r={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(e,t,n){t&&(r[t]=n)}),r}(0,i.query),i}const se="function"==typeof addEventListener&&"function"==typeof removeEventListener,ie=[];se&&addEventListener("offline",()=>{ie.forEach(e=>e())},!1);class ae extends D{constructor(e,t){if(super(),this.binaryType="arraybuffer",this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,e&&"object"==typeof e&&(t=e,e=null),e){const r=ne(e);t.hostname=r.host,t.secure="https"===r.protocol||"wss"===r.protocol,t.port=r.port,r.query&&(t.query=r.query)}else t.host&&(t.hostname=ne(t.host).host);j(this,t),this.secure=null!=t.secure?t.secure:"undefined"!=typeof location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=t.port||("undefined"!=typeof location&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},t.transports.forEach(e=>{const t=e.prototype.name;this.transports.push(t),this._transportsByName[t]=e}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),"string"==typeof this.opts.query&&(this.opts.query=function(e){let t={},r=e.split("&");for(let n=0,s=r.length;n<s;n++){let e=r[n].split("=");t[decodeURIComponent(e[0])]=decodeURIComponent(e[1])}return t}(this.opts.query)),se&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),"localhost"!==this.hostname&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},ie.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=4,t.transport=e,this.id&&(t.sid=this.id);const r=Object.assign({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new this._transportsByName[e](r)}_open(){if(0===this.transports.length)return void this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);const e=this.opts.rememberUpgrade&&ae.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket")?"websocket":this.transports[0];this.readyState="opening";const t=this.createTransport(e);t.open(),this.setTransport(t)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",e=>this._onClose("transport close",e))}onOpen(){this.readyState="open",ae.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush()}_onPacket(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const t=new Error("server error");t.code=e.data,this._onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data)}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this._pingInterval=e.pingInterval,this._pingTimeout=e.pingTimeout,this._maxPayload=e.maxPayload,this.onOpen(),"closed"!==this.readyState&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const e=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+e,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},e),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this._getWritablePackets();this.transport.send(e),this._prevBufferLen=e.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;let e=1;for(let t=0;t<this.writeBuffer.length;t++){const r=this.writeBuffer[t].data;if(r&&(e+=B(r)),t>0&&e>this._maxPayload)return this.writeBuffer.slice(0,t);e+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const e=Date.now()>this._pingTimeoutTime;return e&&(this._pingTimeoutTime=0,I(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),e}write(e,t,r){return this._sendPacket("message",e,t,r),this}send(e,t,r){return this._sendPacket("message",e,t,r),this}_sendPacket(e,t,r,n){if("function"==typeof t&&(n=t,t=void 0),"function"==typeof r&&(n=r,r=null),"closing"===this.readyState||"closed"===this.readyState)return;(r=r||{}).compress=!1!==r.compress;const s={type:e,data:t,options:r};this.emitReserved("packetCreate",s),this.writeBuffer.push(s),n&&this.once("flush",n),this.flush()}close(){const e=()=>{this._onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},r=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?r():e()}):this.upgrading?r():e()),this}_onError(e){if(ae.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&"opening"===this.readyState)return this.transports.shift(),this._open();this.emitReserved("error",e),this._onClose("transport error",e)}_onClose(e,t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),se&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const e=ie.indexOf(this._offlineEventListener);-1!==e&&ie.splice(e,1)}this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this._prevBufferLen=0}}}ae.protocol=4;class oe extends ae{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),"open"===this.readyState&&this.opts.upgrade)for(let e=0;e<this._upgrades.length;e++)this._probe(this._upgrades[e])}_probe(e){let t=this.createTransport(e),r=!1;ae.priorWebsocketSuccess=!1;const n=()=>{r||(t.send([{type:"ping",data:"probe"}]),t.once("packet",e=>{if(!r)if("pong"===e.type&&"probe"===e.data){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;ae.priorWebsocketSuccess="websocket"===t.name,this.transport.pause(()=>{r||"closed"!==this.readyState&&(d(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())})}else{const e=new Error("probe error");e.transport=t.name,this.emitReserved("upgradeError",e)}}))};function s(){r||(r=!0,d(),t.close(),t=null)}const i=e=>{const r=new Error("probe error: "+e);r.transport=t.name,s(),this.emitReserved("upgradeError",r)};function a(){i("transport closed")}function o(){i("socket closed")}function c(e){t&&e.name!==t.name&&s()}const d=()=>{t.removeListener("open",n),t.removeListener("error",i),t.removeListener("close",a),this.off("close",o),this.off("upgrading",c)};t.once("open",n),t.once("error",i),t.once("close",a),this.once("close",o),this.once("upgrading",c),-1!==this._upgrades.indexOf("webtransport")&&"webtransport"!==e?this.setTimeoutFn(()=>{r||t.open()},200):t.open()}onHandshake(e){this._upgrades=this._filterUpgrades(e.upgrades),super.onHandshake(e)}_filterUpgrades(e){const t=[];for(let r=0;r<e.length;r++)~this.transports.indexOf(e[r])&&t.push(e[r]);return t}}let ce=class extends oe{constructor(e,t={}){const r="object"==typeof e?e:t;(!r.transports||r.transports&&"string"==typeof r.transports[0])&&(r.transports=(r.transports||["polling","websocket","webtransport"]).map(e=>ee[e]).filter(e=>!!e)),super(e,r)}};const de="function"==typeof ArrayBuffer,ue=Object.prototype.toString,le="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===ue.call(Blob),pe="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===ue.call(File);function he(e){return de&&(e instanceof ArrayBuffer||(e=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer)(e))||le&&e instanceof Blob||pe&&e instanceof File}function me(e,t){if(!e||"object"!=typeof e)return!1;if(Array.isArray(e)){for(let t=0,r=e.length;t<r;t++)if(me(e[t]))return!0;return!1}if(he(e))return!0;if(e.toJSON&&"function"==typeof e.toJSON&&1===arguments.length)return me(e.toJSON(),!0);for(const r in e)if(Object.prototype.hasOwnProperty.call(e,r)&&me(e[r]))return!0;return!1}function fe(e){const t=[],r=e.data,n=e;return n.data=ge(r,t),n.attachments=t.length,{packet:n,buffers:t}}function ge(e,t){if(!e)return e;if(he(e)){const r={_placeholder:!0,num:t.length};return t.push(e),r}if(Array.isArray(e)){const r=new Array(e.length);for(let n=0;n<e.length;n++)r[n]=ge(e[n],t);return r}if("object"==typeof e&&!(e instanceof Date)){const r={};for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=ge(e[n],t));return r}return e}function ve(e,t){return e.data=_e(e.data,t),delete e.attachments,e}function _e(e,t){if(!e)return e;if(e&&!0===e._placeholder){if("number"==typeof e.num&&e.num>=0&&e.num<t.length)return t[e.num];throw new Error("illegal attachments")}if(Array.isArray(e))for(let r=0;r<e.length;r++)e[r]=_e(e[r],t);else if("object"==typeof e)for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&(e[r]=_e(e[r],t));return e}const ye=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"];var be,we;(we=be||(be={}))[we.CONNECT=0]="CONNECT",we[we.DISCONNECT=1]="DISCONNECT",we[we.EVENT=2]="EVENT",we[we.ACK=3]="ACK",we[we.CONNECT_ERROR=4]="CONNECT_ERROR",we[we.BINARY_EVENT=5]="BINARY_EVENT",we[we.BINARY_ACK=6]="BINARY_ACK";class Se extends D{constructor(e){super(),this.reviver=e}add(e){let t;if("string"==typeof e){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);const r=t.type===be.BINARY_EVENT;r||t.type===be.BINARY_ACK?(t.type=r?be.EVENT:be.ACK,this.reconstructor=new Re(t),0===t.attachments&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else{if(!he(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t))}}decodeString(e){let t=0;const r={type:Number(e.charAt(0))};if(void 0===be[r.type])throw new Error("unknown packet type "+r.type);if(r.type===be.BINARY_EVENT||r.type===be.BINARY_ACK){const n=t+1;for(;"-"!==e.charAt(++t)&&t!=e.length;);const s=e.substring(n,t);if(s!=Number(s)||"-"!==e.charAt(t))throw new Error("Illegal attachments");r.attachments=Number(s)}if("/"===e.charAt(t+1)){const n=t+1;for(;++t;){if(","===e.charAt(t))break;if(t===e.length)break}r.nsp=e.substring(n,t)}else r.nsp="/";const n=e.charAt(t+1);if(""!==n&&Number(n)==n){const n=t+1;for(;++t;){const r=e.charAt(t);if(null==r||Number(r)!=r){--t;break}if(t===e.length)break}r.id=Number(e.substring(n,t+1))}if(e.charAt(++t)){const n=this.tryParse(e.substr(t));if(!Se.isPayloadValid(r.type,n))throw new Error("invalid payload");r.data=n}return r}tryParse(e){try{return JSON.parse(e,this.reviver)}catch(t){return!1}}static isPayloadValid(e,t){switch(e){case be.CONNECT:return ke(t);case be.DISCONNECT:return void 0===t;case be.CONNECT_ERROR:return"string"==typeof t||ke(t);case be.EVENT:case be.BINARY_EVENT:return Array.isArray(t)&&("number"==typeof t[0]||"string"==typeof t[0]&&-1===ye.indexOf(t[0]));case be.ACK:case be.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class Re{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const e=ve(this.reconPack,this.buffers);return this.finishedReconstruction(),e}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}function ke(e){return"[object Object]"===Object.prototype.toString.call(e)}const Ee=Object.freeze(Object.defineProperty({__proto__:null,Decoder:Se,Encoder:class{constructor(e){this.replacer=e}encode(e){return e.type!==be.EVENT&&e.type!==be.ACK||!me(e)?[this.encodeAsString(e)]:this.encodeAsBinary({type:e.type===be.EVENT?be.BINARY_EVENT:be.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id})}encodeAsString(e){let t=""+e.type;return e.type!==be.BINARY_EVENT&&e.type!==be.BINARY_ACK||(t+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(t+=e.nsp+","),null!=e.id&&(t+=e.id),null!=e.data&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){const t=fe(e),r=this.encodeAsString(t.packet),n=t.buffers;return n.unshift(r),n}},get PacketType(){return be}},Symbol.toStringTag,{value:"Module"}));function Te(e,t,r){return e.on(t,r),function(){e.off(t,r)}}const Ce=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Pe extends D{constructor(e,t,r){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,r&&r.auth&&(this.auth=r.auth),this._opts=Object.assign({},r),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[Te(e,"open",this.onopen.bind(this)),Te(e,"packet",this.onpacket.bind(this)),Te(e,"error",this.onerror.bind(this)),Te(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){var r,n,s;if(Ce.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;const i={type:be.EVENT,data:t,options:{}};if(i.options.compress=!1!==this.flags.compress,"function"==typeof t[t.length-1]){const e=this.ids++,r=t.pop();this._registerAckCallback(e,r),i.id=e}const a=null===(n=null===(r=this.io.engine)||void 0===r?void 0:r.transport)||void 0===n?void 0:n.writable,o=this.connected&&!(null===(s=this.io.engine)||void 0===s?void 0:s._hasPingExpired());return this.flags.volatile&&!a||(o?(this.notifyOutgoingListeners(i),this.packet(i)):this.sendBuffer.push(i)),this.flags={},this}_registerAckCallback(e,t){var r;const n=null!==(r=this.flags.timeout)&&void 0!==r?r:this._opts.ackTimeout;if(void 0===n)return void(this.acks[e]=t);const s=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let t=0;t<this.sendBuffer.length;t++)this.sendBuffer[t].id===e&&this.sendBuffer.splice(t,1);t.call(this,new Error("operation has timed out"))},n),i=(...e)=>{this.io.clearTimeoutFn(s),t.apply(this,e)};i.withError=!0,this.acks[e]=i}emitWithAck(e,...t){return new Promise((r,n)=>{const s=(e,t)=>e?n(e):r(t);s.withError=!0,t.push(s),this.emit(e,...t)})}_addToQueue(e){let t;"function"==typeof e[e.length-1]&&(t=e.pop());const r={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((e,...n)=>{this._queue[0];return null!==e?r.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(e)):(this._queue.shift(),t&&t(null,...n)),r.pending=!1,this._drainQueue()}),this._queue.push(r),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||0===this._queue.length)return;const t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){"function"==typeof this.auth?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:be.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(e=>{if(!this.sendBuffer.some(t=>String(t.id)===e)){const t=this.acks[e];delete this.acks[e],t.withError&&t.call(this,new Error("socket has been disconnected"))}})}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case be.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case be.EVENT:case be.BINARY_EVENT:this.onevent(e);break;case be.ACK:case be.BINARY_ACK:this.onack(e);break;case be.DISCONNECT:this.ondisconnect();break;case be.CONNECT_ERROR:this.destroy();const t=new Error(e.data.message);t.data=e.data.data,this.emitReserved("connect_error",t)}}onevent(e){const t=e.data||[];null!=e.id&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const r of t)r.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&"string"==typeof e[e.length-1]&&(this._lastOffset=e[e.length-1])}ack(e){const t=this;let r=!1;return function(...n){r||(r=!0,t.packet({type:be.ACK,id:e,data:n}))}}onack(e){const t=this.acks[e.id];"function"==typeof t&&(delete this.acks[e.id],t.withError&&e.data.unshift(null),t.apply(this,e.data))}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this._drainQueue(!0),this.emitReserved("connect")}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:be.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const r of t)r.apply(this,e.data)}}}function Oe(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}Oe.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),r=Math.floor(t*this.jitter*e);e=1&Math.floor(10*t)?e+r:e-r}return 0|Math.min(e,this.max)},Oe.prototype.reset=function(){this.attempts=0},Oe.prototype.setMin=function(e){this.ms=e},Oe.prototype.setMax=function(e){this.max=e},Oe.prototype.setJitter=function(e){this.jitter=e};class xe extends D{constructor(e,t){var r;super(),this.nsps={},this.subs=[],e&&"object"==typeof e&&(t=e,e=void 0),(t=t||{}).path=t.path||"/socket.io",this.opts=t,j(this,t),this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(null!==(r=t.randomizationFactor)&&void 0!==r?r:.5),this.backoff=new Oe({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this._readyState="closed",this.uri=e;const n=t.parser||Ee;this.encoder=new n.Encoder,this.decoder=new n.Decoder,this._autoConnect=!1!==t.autoConnect,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,e||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(e){return void 0===e?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return void 0===e?this._reconnectionDelay:(this._reconnectionDelay=e,null===(t=this.backoff)||void 0===t||t.setMin(e),this)}randomizationFactor(e){var t;return void 0===e?this._randomizationFactor:(this._randomizationFactor=e,null===(t=this.backoff)||void 0===t||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return void 0===e?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,null===(t=this.backoff)||void 0===t||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new ce(this.uri,this.opts);const t=this.engine,r=this;this._readyState="opening",this.skipReconnect=!1;const n=Te(t,"open",function(){r.onopen(),e&&e()}),s=t=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",t),e?e(t):this.maybeReconnectOnOpen()},i=Te(t,"error",s);if(!1!==this._timeout){const e=this._timeout,r=this.setTimeoutFn(()=>{n(),s(new Error("timeout")),t.close()},e);this.opts.autoUnref&&r.unref(),this.subs.push(()=>{this.clearTimeoutFn(r)})}return this.subs.push(n),this.subs.push(i),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(Te(e,"ping",this.onping.bind(this)),Te(e,"data",this.ondata.bind(this)),Te(e,"error",this.onerror.bind(this)),Te(e,"close",this.onclose.bind(this)),Te(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(t){this.onclose("parse error",t)}}ondecoded(e){I(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let r=this.nsps[e];return r?this._autoConnect&&!r.active&&r.connect():(r=new Pe(this,e,t),this.nsps[e]=r),r}_destroy(e){const t=Object.keys(this.nsps);for(const r of t){if(this.nsps[r].active)return}this._close()}_packet(e){const t=this.encoder.encode(e);for(let r=0;r<t.length;r++)this.engine.write(t[r],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(e,t){var r;this.cleanup(),null===(r=this.engine)||void 0===r||r.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const r=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),e.skipReconnect||e.open(t=>{t?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",t)):e.onreconnect()}))},t);this.opts.autoUnref&&r.unref(),this.subs.push(()=>{this.clearTimeoutFn(r)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const De={};function Ie(e,t){"object"==typeof e&&(t=e,e=void 0);const r=function(e,t="",r){let n=e;r=r||"undefined"!=typeof location&&location,null==e&&(e=r.protocol+"//"+r.host),"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?r.protocol+e:r.host+e),/^(https?|wss?):\/\//.test(e)||(e=void 0!==r?r.protocol+"//"+e:"https://"+e),n=ne(e)),n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";const s=-1!==n.host.indexOf(":")?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+s+":"+n.port+t,n.href=n.protocol+"://"+s+(r&&r.port===n.port?"":":"+n.port),n}(e,(t=t||{}).path||"/socket.io"),n=r.source,s=r.id,i=r.path,a=De[s]&&i in De[s].nsps;let o;return t.forceNew||t["force new connection"]||!1===t.multiplex||a?o=new xe(n,t):(De[s]||(De[s]=new xe(n,t)),o=De[s]),r.query&&!t.query&&(t.query=r.queryKey),o.socket(r.path,t)}Object.assign(Ie,{Manager:xe,Socket:Pe,io:Ie,connect:Ie});var Ae,Me={exports:{}},Le="object"==typeof Reflect?Reflect:null,Ne=Le&&"function"==typeof Le.apply?Le.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};Ae=Le&&"function"==typeof Le.ownKeys?Le.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var je=Number.isNaN||function(e){return e!=e};function Be(){Be.init.call(this)}Me.exports=Be,Me.exports.once=function(e,t){return new Promise(function(r,n){function s(r){e.removeListener(t,i),n(r)}function i(){"function"==typeof e.removeListener&&e.removeListener("error",s),r([].slice.call(arguments))}$e(e,t,i,{once:!0}),"error"!==t&&function(e,t,r){"function"==typeof e.on&&$e(e,"error",t,r)}(e,s,{once:!0})})},Be.EventEmitter=Be,Be.prototype._events=void 0,Be.prototype._eventsCount=0,Be.prototype._maxListeners=void 0;var Ue=10;function Fe(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function qe(e){return void 0===e._maxListeners?Be.defaultMaxListeners:e._maxListeners}function We(e,t,r,n){var s,i,a;if(Fe(r),void 0===(i=e._events)?(i=e._events=Object.create(null),e._eventsCount=0):(void 0!==i.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),i=e._events),a=i[t]),void 0===a)a=i[t]=r,++e._eventsCount;else if("function"==typeof a?a=i[t]=n?[r,a]:[a,r]:n?a.unshift(r):a.push(r),(s=qe(e))>0&&a.length>s&&!a.warned){a.warned=!0;var o=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");o.name="MaxListenersExceededWarning",o.emitter=e,o.type=t,o.count=a.length,console&&console.warn}return e}function Ve(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function He(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},s=Ve.bind(n);return s.listener=r,n.wrapFn=s,s}function ze(e,t,r){var n=e._events;if(void 0===n)return[];var s=n[t];return void 0===s?[]:"function"==typeof s?r?[s.listener||s]:[s]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(s):Ge(s,s.length)}function Ke(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function Ge(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}function $e(e,t,r,n){if("function"==typeof e.on)n.once?e.once(t,r):e.on(t,r);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,function s(i){n.once&&e.removeEventListener(t,s),r(i)})}}Object.defineProperty(Be,"defaultMaxListeners",{enumerable:!0,get:function(){return Ue},set:function(e){if("number"!=typeof e||e<0||je(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");Ue=e}}),Be.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},Be.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||je(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},Be.prototype.getMaxListeners=function(){return qe(this)},Be.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var n="error"===e,s=this._events;if(void 0!==s)n=n&&void 0===s.error;else if(!n)return!1;if(n){var i;if(t.length>0&&(i=t[0]),i instanceof Error)throw i;var a=new Error("Unhandled error."+(i?" ("+i.message+")":""));throw a.context=i,a}var o=s[e];if(void 0===o)return!1;if("function"==typeof o)Ne(o,this,t);else{var c=o.length,d=Ge(o,c);for(r=0;r<c;++r)Ne(d[r],this,t)}return!0},Be.prototype.addListener=function(e,t){return We(this,e,t,!1)},Be.prototype.on=Be.prototype.addListener,Be.prototype.prependListener=function(e,t){return We(this,e,t,!0)},Be.prototype.once=function(e,t){return Fe(t),this.on(e,He(this,e,t)),this},Be.prototype.prependOnceListener=function(e,t){return Fe(t),this.prependListener(e,He(this,e,t)),this},Be.prototype.removeListener=function(e,t){var r,n,s,i,a;if(Fe(t),void 0===(n=this._events))return this;if(void 0===(r=n[e]))return this;if(r===t||r.listener===t)0===--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(s=-1,i=r.length-1;i>=0;i--)if(r[i]===t||r[i].listener===t){a=r[i].listener,s=i;break}if(s<0)return this;0===s?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,s),1===r.length&&(n[e]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",e,a||t)}return this},Be.prototype.off=Be.prototype.removeListener,Be.prototype.removeAllListeners=function(e){var t,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0===--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var s,i=Object.keys(r);for(n=0;n<i.length;++n)"removeListener"!==(s=i[n])&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},Be.prototype.listeners=function(e){return ze(this,e,!0)},Be.prototype.rawListeners=function(e){return ze(this,e,!1)},Be.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):Ke.call(e,t)},Be.prototype.listenerCount=Ke,Be.prototype.eventNames=function(){return this._eventsCount>0?Ae(this._events):[]};const Je=o(Me.exports);var Qe,Ye={exports:{}};Qe={},self;var Xe=Ye.exports=(()=>(()=>{var e={11:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Chrome74=void 0;const s=n(7363),i=n(2994),a=n(1765),o=n(8046),c=n(5544),d=n(5938),u=n(4256),l=n(4893),p=n(521),h=n(1305),m=n(3303),f=new i.Logger("Chrome74"),g={OS:1024,MIS:1024};class v extends p.HandlerInterface{constructor(){super(),r(this,"_closed",!1),r(this,"_direction"),r(this,"_remoteSdp"),r(this,"_sendingRtpParametersByKind"),r(this,"_sendingRemoteRtpParametersByKind"),r(this,"_forcedLocalDtlsRole"),r(this,"_pc"),r(this,"_mapMidTransceiver",new Map),r(this,"_sendStream",new MediaStream),r(this,"_hasDataChannelMediaSection",!1),r(this,"_nextSendSctpStreamId",0),r(this,"_transportReady",!1)}static createFactory(){return()=>new v}get name(){return"Chrome74"}close(){if(f.debug("close()"),!this._closed){if(this._closed=!0,this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}}async getNativeRtpCapabilities(){f.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{e.addTransceiver("audio"),e.addTransceiver("video");const r=await e.createOffer();try{e.close()}catch(t){}const n=s.parse(r.sdp),i=c.extractRtpCapabilities({sdpObject:n});return u.addNackSupportForOpus(i),i}catch(r){try{e.close()}catch(t){}throw r}}async getNativeSctpCapabilities(){return f.debug("getNativeSctpCapabilities()"),{numStreams:g}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:s,iceServers:i,iceTransportPolicy:a,additionalSettings:c,proprietaryConstraints:d,extendedRtpCapabilities:u}){f.debug("run()"),this._direction=e,this._remoteSdp=new h.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:s}),this._sendingRtpParametersByKind={audio:o.getSendingRtpParameters("audio",u),video:o.getSendingRtpParameters("video",u)},this._sendingRemoteRtpParametersByKind={audio:o.getSendingRemoteRtpParameters("audio",u),video:o.getSendingRemoteRtpParameters("video",u)},n.role&&"auto"!==n.role&&(this._forcedLocalDtlsRole="server"===n.role?"client":"server"),this._pc=new RTCPeerConnection({iceServers:i??[],iceTransportPolicy:a??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan",...c},d),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",e=>{this.emit("@icecandidateerror",e)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):(f.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}))}async updateIceServers(e){this.assertNotClosed(),f.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(this.assertNotClosed(),f.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady)if("send"===this._direction){const e=await this._pc.createOffer({iceRestart:!0});f.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();f.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:n}){this.assertNotClosed(),this.assertSendDirection(),f.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),t&&t.length>1&&t.forEach((e,t)=>{e.rid=`r${t}`});const i=a.clone(this._sendingRtpParametersByKind[e.kind]);i.codecs=o.reduceCodecs(i.codecs,n);const u=a.clone(this._sendingRemoteRtpParametersByKind[e.kind]);u.codecs=o.reduceCodecs(u.codecs,n);const l=this._remoteSdp.getNextMediaSectionIdx(),p=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream],sendEncodings:t});let h,g=await this._pc.createOffer(),v=s.parse(g.sdp);v.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed(),this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:v});let _=!1;const y=(0,m.parse)((t??[{}])[0].scalabilityMode);t&&1===t.length&&y.spatialLayers>1&&"video/vp9"===i.codecs[0].mimeType.toLowerCase()&&(f.debug("send() | enabling legacy simulcast for VP9 SVC"),_=!0,v=s.parse(g.sdp),h=v.media[l.idx],d.addLegacySimulcast({offerMediaObject:h,numStreams:y.spatialLayers}),g={type:"offer",sdp:s.write(v)}),f.debug("send() | calling pc.setLocalDescription() [offer:%o]",g),await this._pc.setLocalDescription(g);const b=p.mid;if(i.mid=b,v=s.parse(this._pc.localDescription.sdp),h=v.media[l.idx],i.rtcp.cname=c.getCname({offerMediaObject:h}),t)if(1===t.length){let e=d.getRtpEncodings({offerMediaObject:h});Object.assign(e[0],t[0]),_&&(e=[e[0]]),i.encodings=e}else i.encodings=t;else i.encodings=d.getRtpEncodings({offerMediaObject:h});if(i.encodings.length>1&&("video/vp8"===i.codecs[0].mimeType.toLowerCase()||"video/h264"===i.codecs[0].mimeType.toLowerCase()))for(const s of i.encodings)s.scalabilityMode?s.scalabilityMode=`L1T${y.temporalLayers}`:s.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:h,reuseMid:l.reuseMid,offerRtpParameters:i,answerRtpParameters:u,codecOptions:r});const w={type:"answer",sdp:this._remoteSdp.getSdp()};return f.debug("send() | calling pc.setRemoteDescription() [answer:%o]",w),await this._pc.setRemoteDescription(w),this._mapMidTransceiver.set(b,p),{localId:b,rtpParameters:i,rtpSender:p.sender}}async stopSending(e){if(this.assertSendDirection(),f.debug("stopSending() [localId:%s]",e),this._closed)return;const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");if(t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.closeMediaSection(t.mid))try{t.stop()}catch(s){}const r=await this._pc.createOffer();f.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const n={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n),this._mapMidTransceiver.delete(e)}async pauseSending(e){this.assertNotClosed(),this.assertSendDirection(),f.debug("pauseSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive",this._remoteSdp.pauseMediaSection(e);const r=await this._pc.createOffer();f.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const n={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n)}async resumeSending(e){this.assertNotClosed(),this.assertSendDirection(),f.debug("resumeSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(this._remoteSdp.resumeSendingMediaSection(e),!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="sendonly";const r=await this._pc.createOffer();f.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const n={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n)}async replaceTrack(e,t){this.assertNotClosed(),this.assertSendDirection(),t?f.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):f.debug("replaceTrack() [localId:%s, no track]",e);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");await r.sender.replaceTrack(t)}async setMaxSpatialLayer(e,t){this.assertNotClosed(),this.assertSendDirection(),f.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const n=r.sender.getParameters();n.encodings.forEach((e,r)=>{e.active=r<=t}),await r.sender.setParameters(n),this._remoteSdp.muxMediaSectionSimulcast(e,n.encodings);const s=await this._pc.createOffer();f.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);const i={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async setRtpEncodingParameters(e,t){this.assertNotClosed(),this.assertSendDirection(),f.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const n=r.sender.getParameters();n.encodings.forEach((e,r)=>{n.encodings[r]={...e,...t}}),await r.sender.setParameters(n),this._remoteSdp.muxMediaSectionSimulcast(e,n.encodings);const s=await this._pc.createOffer();f.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);const i={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async getSenderStats(e){this.assertNotClosed(),this.assertSendDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:n,protocol:i}){this.assertNotClosed(),this.assertSendDirection();const a={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:r,protocol:i};f.debug("sendDataChannel() [options:%o]",a);const o=this._pc.createDataChannel(n,a);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%g.MIS,!this._hasDataChannelMediaSection){const e=await this._pc.createOffer(),t=s.parse(e.sdp),r=t.media.find(e=>"application"===e.type);this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:t}),f.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:r});const n={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n),this._hasDataChannelMediaSection=!0}return{dataChannel:o,sctpStreamParameters:{streamId:a.id,ordered:a.ordered,maxPacketLifeTime:a.maxPacketLifeTime,maxRetransmits:a.maxRetransmits}}}async receive(e){this.assertNotClosed(),this.assertRecvDirection();const t=[],r=new Map;for(const s of e){const{trackId:e,kind:t,rtpParameters:n,streamId:i}=s;f.debug("receive() [trackId:%s, kind:%s]",e,t);const a=n.mid??String(this._mapMidTransceiver.size);r.set(e,a),this._remoteSdp.receive({mid:a,kind:t,offerRtpParameters:n,streamId:i??n.rtcp.cname,trackId:e})}const n={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",n),await this._pc.setRemoteDescription(n);let i=await this._pc.createAnswer();const a=s.parse(i.sdp);for(const s of e){const{trackId:e,rtpParameters:t}=s,n=r.get(e),i=a.media.find(e=>String(e.mid)===n);c.applyCodecParameters({offerRtpParameters:t,answerMediaObject:i})}i={type:"answer",sdp:s.write(a)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:a}),f.debug("receive() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i);for(const s of e){const{trackId:e}=s,n=r.get(e),i=this._pc.getTransceivers().find(e=>e.mid===n);if(!i)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(n,i),t.push({localId:n,track:i.receiver.track,rtpReceiver:i.receiver})}return t}async stopReceiving(e){if(this.assertRecvDirection(),this._closed)return;for(const n of e){f.debug("stopReceiving() [localId:%s]",n);const e=this._mapMidTransceiver.get(n);if(!e)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(e.mid)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const r=await this._pc.createAnswer();f.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r);for(const n of e)this._mapMidTransceiver.delete(n)}async pauseReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(const n of e){f.debug("pauseReceiving() [localId:%s]",n);const e=this._mapMidTransceiver.get(n);if(!e)throw new Error("associated RTCRtpTransceiver not found");e.direction="inactive",this._remoteSdp.pauseMediaSection(n)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const r=await this._pc.createAnswer();f.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r)}async resumeReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(const n of e){f.debug("resumeReceiving() [localId:%s]",n);const e=this._mapMidTransceiver.get(n);if(!e)throw new Error("associated RTCRtpTransceiver not found");e.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(n)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const r=await this._pc.createAnswer();f.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r)}async getReceiverStats(e){this.assertNotClosed(),this.assertRecvDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:n,ordered:i,maxPacketLifeTime:a,maxRetransmits:o}=e,c={negotiated:!0,id:n,ordered:i,maxPacketLifeTime:a,maxRetransmits:o,protocol:r};f.debug("receiveDataChannel() [options:%o]",c);const d=this._pc.createDataChannel(t,c);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const e={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();if(!this._transportReady){const e=s.parse(t.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:e})}f.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setLocalDescription(t),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=s.parse(this._pc.localDescription.sdp));const r=c.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await new Promise((e,t)=>{this.safeEmit("@connect",{dtlsParameters:r},e,t)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new l.InvalidStateError("method called in a closed handler")}assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}t.Chrome74=v},19:function(e,t,r){var n,s,i,a,o,c,d,u,l;e.exports=(l=r(9021),r(3009),r(1025),i=(s=(n=l).lib).Base,a=s.WordArray,c=(o=n.algo).SHA256,d=o.HMAC,u=o.PBKDF2=i.extend({cfg:i.extend({keySize:4,hasher:c,iterations:25e4}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var r=this.cfg,n=d.create(r.hasher,e),s=a.create(),i=a.create([1]),o=s.words,c=i.words,u=r.keySize,l=r.iterations;o.length<u;){var p=n.update(t).finalize(i);n.reset();for(var h=p.words,m=h.length,f=p,g=1;g<l;g++){f=n.finalize(f),n.reset();for(var v=f.words,_=0;_<m;_++)h[_]^=v[_]}s.concat(p),c[0]++}return s.sigBytes=4*u,s}}),n.PBKDF2=function(e,t,r){return u.create(r).compute(e,t)},l.PBKDF2)},25:function(e,t,r){var n,s,i,a;e.exports=(a=r(9021),r(7165),s=(n=a).lib.CipherParams,i=n.enc.Hex,n.format.Hex={stringify:function(e){return e.ciphertext.toString(i)},parse:function(e){var t=i.parse(e);return s.create({ciphertext:t})}},a.format.Hex)},76:(e,t,r)=>{t.s$=t.pF=void 0,r(7833).default,r(8057);var n=r(6004);Object.defineProperty(t,"pF",{enumerable:!0,get:function(){return n.Device}});var s=r(3303);Object.defineProperty(t,"s$",{enumerable:!0,get:function(){return s.parse}}),r(8046),r(2731),r(5248)},182:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.version=t.validate=t.v7=t.v6ToV1=t.v6=t.v5=t.v4=t.v3=t.v1ToV6=t.v1=t.stringify=t.parse=t.NIL=t.MAX=void 0;var n=r(2196);Object.defineProperty(t,"MAX",{enumerable:!0,get:function(){return n.default}});var s=r(3465);Object.defineProperty(t,"NIL",{enumerable:!0,get:function(){return s.default}});var i=r(1797);Object.defineProperty(t,"parse",{enumerable:!0,get:function(){return i.default}});var a=r(6011);Object.defineProperty(t,"stringify",{enumerable:!0,get:function(){return a.default}});var o=r(1425);Object.defineProperty(t,"v1",{enumerable:!0,get:function(){return o.default}});var c=r(6568);Object.defineProperty(t,"v1ToV6",{enumerable:!0,get:function(){return c.default}});var d=r(591);Object.defineProperty(t,"v3",{enumerable:!0,get:function(){return d.default}});var u=r(8286);Object.defineProperty(t,"v4",{enumerable:!0,get:function(){return u.default}});var l=r(4557);Object.defineProperty(t,"v5",{enumerable:!0,get:function(){return l.default}});var p=r(6356);Object.defineProperty(t,"v6",{enumerable:!0,get:function(){return p.default}});var h=r(268);Object.defineProperty(t,"v6ToV1",{enumerable:!0,get:function(){return h.default}});var m=r(4299);Object.defineProperty(t,"v7",{enumerable:!0,get:function(){return m.default}});var f=r(9746);Object.defineProperty(t,"validate",{enumerable:!0,get:function(){return f.default}});var g=r(2770);Object.defineProperty(t,"version",{enumerable:!0,get:function(){return g.default}})},268:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=r(1797),s=r(6011);t.default=function(e){const t=(r="string"==typeof e?(0,n.default)(e):e,Uint8Array.of((15&r[3])<<4|r[4]>>4&15,(15&r[4])<<4|(240&r[5])>>4,(15&r[5])<<4|15&r[6],r[7],(15&r[1])<<4|(240&r[2])>>4,(15&r[2])<<4|(240&r[3])>>4,16|(240&r[0])>>4,(15&r[0])<<4|(240&r[1])>>4,r[8],r[9],r[10],r[11],r[12],r[13],r[14],r[15]));var r;return"string"==typeof e?(0,s.unsafeStringify)(t):t}},296:(e,t,r)=>{r.d(t,{A:()=>s});var n=r(7800);function s(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,s,i,a,o=[],c=!0,d=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=i.call(r)).done)&&(o.push(n.value),o.length!==t);c=!0);}catch(u){d=!0,s=u}finally{try{if(!c&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(d)throw s}}return o}}(e,t)||(0,n.A)(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}},328:(e,t,r)=>{r(8624),e.exports=self.fetch.bind(self)},338:(e,t)=>{function r(e){return 14+(e+64>>>9<<4)+1}function n(e,t){const r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}function s(e,t,r,s,i,a){return n((o=n(n(t,e),n(s,a)))<<(c=i)|o>>>32-c,r);var o,c}function i(e,t,r,n,i,a,o){return s(t&r|~t&n,e,t,i,a,o)}function a(e,t,r,n,i,a,o){return s(t&n|r&~n,e,t,i,a,o)}function o(e,t,r,n,i,a,o){return s(t^r^n,e,t,i,a,o)}function c(e,t,r,n,i,a,o){return s(r^(t|~n),e,t,i,a,o)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return function(e){const t=new Uint8Array(4*e.length);for(let r=0;r<4*e.length;r++)t[r]=e[r>>2]>>>r%4*8&255;return t}(function(e,t){const s=new Uint32Array(r(t)).fill(0);s.set(e),s[t>>5]|=128<<t%32,s[s.length-1]=t,e=s;let d=1732584193,u=-271733879,l=-1732584194,p=271733878;for(let r=0;r<e.length;r+=16){const t=d,s=u,h=l,m=p;d=i(d,u,l,p,e[r],7,-680876936),p=i(p,d,u,l,e[r+1],12,-389564586),l=i(l,p,d,u,e[r+2],17,606105819),u=i(u,l,p,d,e[r+3],22,-1044525330),d=i(d,u,l,p,e[r+4],7,-176418897),p=i(p,d,u,l,e[r+5],12,1200080426),l=i(l,p,d,u,e[r+6],17,-1473231341),u=i(u,l,p,d,e[r+7],22,-45705983),d=i(d,u,l,p,e[r+8],7,1770035416),p=i(p,d,u,l,e[r+9],12,-1958414417),l=i(l,p,d,u,e[r+10],17,-42063),u=i(u,l,p,d,e[r+11],22,-1990404162),d=i(d,u,l,p,e[r+12],7,1804603682),p=i(p,d,u,l,e[r+13],12,-40341101),l=i(l,p,d,u,e[r+14],17,-1502002290),u=i(u,l,p,d,e[r+15],22,1236535329),d=a(d,u,l,p,e[r+1],5,-165796510),p=a(p,d,u,l,e[r+6],9,-1069501632),l=a(l,p,d,u,e[r+11],14,643717713),u=a(u,l,p,d,e[r],20,-373897302),d=a(d,u,l,p,e[r+5],5,-701558691),p=a(p,d,u,l,e[r+10],9,38016083),l=a(l,p,d,u,e[r+15],14,-660478335),u=a(u,l,p,d,e[r+4],20,-405537848),d=a(d,u,l,p,e[r+9],5,568446438),p=a(p,d,u,l,e[r+14],9,-1019803690),l=a(l,p,d,u,e[r+3],14,-187363961),u=a(u,l,p,d,e[r+8],20,1163531501),d=a(d,u,l,p,e[r+13],5,-1444681467),p=a(p,d,u,l,e[r+2],9,-51403784),l=a(l,p,d,u,e[r+7],14,1735328473),u=a(u,l,p,d,e[r+12],20,-1926607734),d=o(d,u,l,p,e[r+5],4,-378558),p=o(p,d,u,l,e[r+8],11,-2022574463),l=o(l,p,d,u,e[r+11],16,1839030562),u=o(u,l,p,d,e[r+14],23,-35309556),d=o(d,u,l,p,e[r+1],4,-1530992060),p=o(p,d,u,l,e[r+4],11,1272893353),l=o(l,p,d,u,e[r+7],16,-155497632),u=o(u,l,p,d,e[r+10],23,-1094730640),d=o(d,u,l,p,e[r+13],4,681279174),p=o(p,d,u,l,e[r],11,-358537222),l=o(l,p,d,u,e[r+3],16,-722521979),u=o(u,l,p,d,e[r+6],23,76029189),d=o(d,u,l,p,e[r+9],4,-640364487),p=o(p,d,u,l,e[r+12],11,-421815835),l=o(l,p,d,u,e[r+15],16,530742520),u=o(u,l,p,d,e[r+2],23,-995338651),d=c(d,u,l,p,e[r],6,-198630844),p=c(p,d,u,l,e[r+7],10,1126891415),l=c(l,p,d,u,e[r+14],15,-1416354905),u=c(u,l,p,d,e[r+5],21,-57434055),d=c(d,u,l,p,e[r+12],6,1700485571),p=c(p,d,u,l,e[r+3],10,-1894986606),l=c(l,p,d,u,e[r+10],15,-1051523),u=c(u,l,p,d,e[r+1],21,-2054922799),d=c(d,u,l,p,e[r+8],6,1873313359),p=c(p,d,u,l,e[r+15],10,-30611744),l=c(l,p,d,u,e[r+6],15,-1560198380),u=c(u,l,p,d,e[r+13],21,1309151649),d=c(d,u,l,p,e[r+4],6,-145523070),p=c(p,d,u,l,e[r+11],10,-1120210379),l=c(l,p,d,u,e[r+2],15,718787259),u=c(u,l,p,d,e[r+9],21,-343485551),d=n(d,t),u=n(u,s),l=n(l,h),p=n(p,m)}return Uint32Array.of(d,u,l,p)}(function(e){if(0===e.length)return new Uint32Array;const t=new Uint32Array(r(8*e.length)).fill(0);for(let r=0;r<e.length;r++)t[r>>2]|=(255&e[r])<<r%4*8;return t}(e),8*e.length))}},388:(e,t,r)=>{r.d(t,{A:()=>s});var n=r(2284);function s(e,t){if(t&&("object"==(0,n.A)(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}},467:(e,t,r)=>{function n(e,t,r,n,s,i,a){try{var o=e[i](a),c=o.value}catch(d){return void r(d)}o.done?t(c):Promise.resolve(c).then(n,s)}function s(e){return function(){var t=this,r=arguments;return new Promise(function(s,i){var a=e.apply(t,r);function o(e){n(a,s,i,o,c,"next",e)}function c(e){n(a,s,i,o,c,"throw",e)}o(void 0)})}}r.d(t,{A:()=>s})},477:()=>{},482:function(e,t,r){var n;e.exports=(n=r(9021),r(7165),n.pad.Iso97971={pad:function(e,t){e.concat(n.lib.WordArray.create([2147483648],1)),n.pad.ZeroPadding.pad(e,t)},unpad:function(e){n.pad.ZeroPadding.unpad(e),e.sigBytes--}},n.pad.Iso97971)},521:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.HandlerInterface=void 0;const n=r(3953);class s extends n.EnhancedEventEmitter{constructor(){super()}}t.HandlerInterface=s},579:(e,t,r)=>{var n=r(3738).default;e.exports=function(e){if(null!=e){var t=e["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],r=0;if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length))return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}}throw new TypeError(n(e)+" is not iterable")},e.exports.__esModule=!0,e.exports.default=e.exports},591:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.URL=t.DNS=void 0;const n=r(338),s=r(2988);var i=r(2988);function a(e,t,r,i){return(0,s.default)(48,n.default,e,t,r,i)}Object.defineProperty(t,"DNS",{enumerable:!0,get:function(){return i.DNS}}),Object.defineProperty(t,"URL",{enumerable:!0,get:function(){return i.URL}}),a.DNS=s.DNS,a.URL=s.URL,t.default=a},736:(e,t,r)=>{e.exports=function(e){function t(e){let r,s,i,a=null;function o(...e){if(!o.enabled)return;const n=o,s=Number(new Date),i=s-(r||s);n.diff=i,n.prev=r,n.curr=s,r=s,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let a=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,(r,s)=>{if("%%"===r)return"%";a++;const i=t.formatters[s];if("function"==typeof i){const t=e[a];r=i.call(n,t),e.splice(a,1),a--}return r}),t.formatArgs.call(n,e),(n.log||t.log).apply(n,e)}return o.namespace=e,o.useColors=t.useColors(),o.color=t.selectColor(e),o.extend=n,o.destroy=t.destroy,Object.defineProperty(o,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==a?a:(s!==t.namespaces&&(s=t.namespaces,i=t.enabled(e)),i),set:e=>{a=e}}),"function"==typeof t.init&&t.init(o),o}function n(e,r){const n=t(this.namespace+(void 0===r?":":r)+e);return n.log=this.log,n}function s(e,t){let r=0,n=0,s=-1,i=0;for(;r<e.length;)if(n<t.length&&(t[n]===e[r]||"*"===t[n]))"*"===t[n]?(s=n,i=r,n++):(r++,n++);else{if(-1===s)return!1;n=s+1,i++,r=i}for(;n<t.length&&"*"===t[n];)n++;return n===t.length}return t.debug=t,t.default=t,t.coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){const e=[...t.names,...t.skips.map(e=>"-"+e)].join(",");return t.enable(""),e},t.enable=function(e){t.save(e),t.namespaces=e,t.names=[],t.skips=[];const r=("string"==typeof e?e:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(const n of r)"-"===n[0]?t.skips.push(n.slice(1)):t.names.push(n)},t.enabled=function(e){for(const r of t.skips)if(s(e,r))return!1;for(const r of t.names)if(s(e,r))return!0;return!1},t.humanize=r(6585),t.destroy=function(){},Object.keys(e).forEach(r=>{t[r]=e[r]}),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let r=0;for(let t=0;t<e.length;t++)r=(r<<5)-r+e.charCodeAt(t),r|=0;return t.colors[Math.abs(r)%t.colors.length]},t.enable(t.load()),t}},754:function(e,t,r){var n,s,i;e.exports=(n=r(9021),i=(s=n).lib.WordArray,s.enc.Base64={stringify:function(e){var t=e.words,r=e.sigBytes,n=this._map;e.clamp();for(var s=[],i=0;i<r;i+=3)for(var a=(t[i>>>2]>>>24-i%4*8&255)<<16|(t[i+1>>>2]>>>24-(i+1)%4*8&255)<<8|t[i+2>>>2]>>>24-(i+2)%4*8&255,o=0;o<4&&i+.75*o<r;o++)s.push(n.charAt(a>>>6*(3-o)&63));var c=n.charAt(64);if(c)for(;s.length%4;)s.push(c);return s.join("")},parse:function(e){var t=e.length,r=this._map,n=this._reverseMap;if(!n){n=this._reverseMap=[];for(var s=0;s<r.length;s++)n[r.charCodeAt(s)]=s}var a=r.charAt(64);if(a){var o=e.indexOf(a);-1!==o&&(t=o)}return function(e,t,r){for(var n=[],s=0,a=0;a<t;a++)if(a%4){var o=r[e.charCodeAt(a-1)]<<a%4*2|r[e.charCodeAt(a)]>>>6-a%4*2;n[s>>>2]|=o<<24-s%4*8,s++}return i.create(n,s)}(e,t,n)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},n.enc.Base64)},816:(e,t,r)=>{r.d(t,{A:()=>s});var n=r(2284);function s(e){var t=function(e,t){if("object"!=(0,n.A)(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var s=r.call(e,t);if("object"!=(0,n.A)(s))return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e,"string");return"symbol"==(0,n.A)(t)?t:t+""}},887:(e,t,r)=>{var n=r(6993),s=r(1791);e.exports=function(e,t,r,i,a){return new s(n().w(e,t,r,i),a||Promise)},e.exports.__esModule=!0,e.exports.default=e.exports},955:function(e,t,r){var n;e.exports=(n=r(9021),r(754),r(4636),r(9506),r(7165),function(){var e=n,t=e.lib.BlockCipher,r=e.algo,s=[],i=[],a=[],o=[],c=[],d=[],u=[],l=[],p=[],h=[];!function(){for(var e=[],t=0;t<256;t++)e[t]=t<128?t<<1:t<<1^283;var r=0,n=0;for(t=0;t<256;t++){var m=n^n<<1^n<<2^n<<3^n<<4;m=m>>>8^255&m^99,s[r]=m,i[m]=r;var f=e[r],g=e[f],v=e[g],_=257*e[m]^16843008*m;a[r]=_<<24|_>>>8,o[r]=_<<16|_>>>16,c[r]=_<<8|_>>>24,d[r]=_,_=16843009*v^65537*g^257*f^16843008*r,u[m]=_<<24|_>>>8,l[m]=_<<16|_>>>16,p[m]=_<<8|_>>>24,h[m]=_,r?(r=f^e[e[e[v^f]]],n^=e[e[n]]):r=n=1}}();var m=[0,1,2,4,8,16,32,64,128,27,54],f=r.AES=t.extend({_doReset:function(){if(!this._nRounds||this._keyPriorReset!==this._key){for(var e=this._keyPriorReset=this._key,t=e.words,r=e.sigBytes/4,n=4*((this._nRounds=r+6)+1),i=this._keySchedule=[],a=0;a<n;a++)a<r?i[a]=t[a]:(d=i[a-1],a%r?r>6&&a%r==4&&(d=s[d>>>24]<<24|s[d>>>16&255]<<16|s[d>>>8&255]<<8|s[255&d]):(d=s[(d=d<<8|d>>>24)>>>24]<<24|s[d>>>16&255]<<16|s[d>>>8&255]<<8|s[255&d],d^=m[a/r|0]<<24),i[a]=i[a-r]^d);for(var o=this._invKeySchedule=[],c=0;c<n;c++){if(a=n-c,c%4)var d=i[a];else d=i[a-4];o[c]=c<4||a<=4?d:u[s[d>>>24]]^l[s[d>>>16&255]]^p[s[d>>>8&255]]^h[s[255&d]]}}},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,a,o,c,d,s)},decryptBlock:function(e,t){var r=e[t+1];e[t+1]=e[t+3],e[t+3]=r,this._doCryptBlock(e,t,this._invKeySchedule,u,l,p,h,i),r=e[t+1],e[t+1]=e[t+3],e[t+3]=r},_doCryptBlock:function(e,t,r,n,s,i,a,o){for(var c=this._nRounds,d=e[t]^r[0],u=e[t+1]^r[1],l=e[t+2]^r[2],p=e[t+3]^r[3],h=4,m=1;m<c;m++){var f=n[d>>>24]^s[u>>>16&255]^i[l>>>8&255]^a[255&p]^r[h++],g=n[u>>>24]^s[l>>>16&255]^i[p>>>8&255]^a[255&d]^r[h++],v=n[l>>>24]^s[p>>>16&255]^i[d>>>8&255]^a[255&u]^r[h++],_=n[p>>>24]^s[d>>>16&255]^i[u>>>8&255]^a[255&l]^r[h++];d=f,u=g,l=v,p=_}f=(o[d>>>24]<<24|o[u>>>16&255]<<16|o[l>>>8&255]<<8|o[255&p])^r[h++],g=(o[u>>>24]<<24|o[l>>>16&255]<<16|o[p>>>8&255]<<8|o[255&d])^r[h++],v=(o[l>>>24]<<24|o[p>>>16&255]<<16|o[d>>>8&255]<<8|o[255&u])^r[h++],_=(o[p>>>24]<<24|o[d>>>16&255]<<16|o[u>>>8&255]<<8|o[255&l])^r[h++],e[t]=f,e[t+1]=g,e[t+2]=v,e[t+3]=_},keySize:8});e.AES=t._createHelper(f)}(),n.AES)},1025:function(e,t,r){var n,s,i;e.exports=(s=(n=r(9021)).lib.Base,i=n.enc.Utf8,void(n.algo.HMAC=s.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=i.parse(t));var r=e.blockSize,n=4*r;t.sigBytes>n&&(t=e.finalize(t)),t.clamp();for(var s=this._oKey=t.clone(),a=this._iKey=t.clone(),o=s.words,c=a.words,d=0;d<r;d++)o[d]^=1549556828,c[d]^=909522486;s.sigBytes=a.sigBytes=n,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,r=t.finalize(e);return t.reset(),t.finalize(this._oKey.clone().concat(r))}})))},1305:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RemoteSdp=void 0;const s=n(7363),i=n(2994),a=n(3471),o=new i.Logger("RemoteSdp");t.RemoteSdp=class{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:n,sctpParameters:s,plainRtpParameters:i,planB:a=!1}){if(r(this,"_iceParameters"),r(this,"_iceCandidates"),r(this,"_dtlsParameters"),r(this,"_sctpParameters"),r(this,"_plainRtpParameters"),r(this,"_planB"),r(this,"_mediaSections",[]),r(this,"_midToIndex",new Map),r(this,"_firstMid"),r(this,"_sdpObject"),this._iceParameters=e,this._iceCandidates=t,this._dtlsParameters=n,this._sctpParameters=s,this._plainRtpParameters=i,this._planB=a,this._sdpObject={version:0,origin:{address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:1e4,sessionVersion:0,username:"mediasoup-client"},name:"-",timing:{start:0,stop:0},media:[]},(null==e?void 0:e.iceLite)&&(this._sdpObject.icelite="ice-lite"),n){this._sdpObject.msidSemantic={semantic:"WMS",token:"*"};const e=this._dtlsParameters.fingerprints.length;this._sdpObject.fingerprint={type:n.fingerprints[e-1].algorithm,hash:n.fingerprints[e-1].value},this._sdpObject.groups=[{type:"BUNDLE",mids:""}]}i&&(this._sdpObject.origin.address=i.ip,this._sdpObject.origin.ipVer=i.ipVersion)}updateIceParameters(e){o.debug("updateIceParameters() [iceParameters:%o]",e),this._iceParameters=e,this._sdpObject.icelite=e.iceLite?"ice-lite":void 0;for(const t of this._mediaSections)t.setIceParameters(e)}updateDtlsRole(e){o.debug("updateDtlsRole() [role:%s]",e),this._dtlsParameters.role=e;for(const t of this._mediaSections)t.setDtlsRole(e)}setSessionExtmapAllowMixed(){o.debug("setSessionExtmapAllowMixed()"),this._sdpObject.extmapAllowMixed="extmap-allow-mixed"}getNextMediaSectionIdx(){for(let e=0;e<this._mediaSections.length;++e){const t=this._mediaSections[e];if(t.closed)return{idx:e,reuseMid:t.mid}}return{idx:this._mediaSections.length}}send({offerMediaObject:e,reuseMid:t,offerRtpParameters:r,answerRtpParameters:n,codecOptions:s}){const i=new a.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,planB:this._planB,offerMediaObject:e,offerRtpParameters:r,answerRtpParameters:n,codecOptions:s});t?this._replaceMediaSection(i,t):this._midToIndex.has(i.mid)?this._replaceMediaSection(i):this._addMediaSection(i)}receive({mid:e,kind:t,offerRtpParameters:r,streamId:n,trackId:s}){const i=this._midToIndex.get(e);let o;if(void 0!==i&&(o=this._mediaSections[i]),this.setSessionExtmapAllowMixed(),o)o.planBReceive({offerRtpParameters:r,streamId:n,trackId:s}),this._replaceMediaSection(o);else{o=new a.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,planB:this._planB,mid:e,kind:t,offerRtpParameters:r,streamId:n,trackId:s});const i=this._mediaSections.find(e=>e.closed);i?this._replaceMediaSection(o,i.mid):this._addMediaSection(o)}}pauseMediaSection(e){this._findMediaSection(e).pause()}resumeSendingMediaSection(e){this._findMediaSection(e).resume()}resumeReceivingMediaSection(e){this._findMediaSection(e).resume()}disableMediaSection(e){this._findMediaSection(e).disable()}closeMediaSection(e){const t=this._findMediaSection(e);return e===this._firstMid?(o.debug("closeMediaSection() | cannot close first media section, disabling it instead [mid:%s]",e),this.disableMediaSection(e),!1):(t.close(),this._regenerateBundleMids(),!0)}muxMediaSectionSimulcast(e,t){const r=this._findMediaSection(e);r.muxSimulcastStreams(t),this._replaceMediaSection(r)}planBStopReceiving({mid:e,offerRtpParameters:t}){const r=this._findMediaSection(e);r.planBStopReceiving({offerRtpParameters:t}),this._replaceMediaSection(r)}sendSctpAssociation({offerMediaObject:e}){const t=new a.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,offerMediaObject:e});this._addMediaSection(t)}receiveSctpAssociation({oldDataChannelSpec:e=!1}={}){const t=new a.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,mid:"datachannel",kind:"application",oldDataChannelSpec:e});this._addMediaSection(t)}getSdp(){return this._sdpObject.origin.sessionVersion++,s.write(this._sdpObject)}_addMediaSection(e){this._firstMid||(this._firstMid=e.mid),this._mediaSections.push(e),this._midToIndex.set(e.mid,this._mediaSections.length-1),this._sdpObject.media.push(e.getObject()),this._regenerateBundleMids()}_replaceMediaSection(e,t){if("string"==typeof t){const r=this._midToIndex.get(t);if(void 0===r)throw new Error(`no media section found for reuseMid '${t}'`);const n=this._mediaSections[r];this._mediaSections[r]=e,this._midToIndex.delete(n.mid),this._midToIndex.set(e.mid,r),this._sdpObject.media[r]=e.getObject(),this._regenerateBundleMids()}else{const t=this._midToIndex.get(e.mid);if(void 0===t)throw new Error(`no media section found with mid '${e.mid}'`);this._mediaSections[t]=e,this._sdpObject.media[t]=e.getObject()}}_findMediaSection(e){const t=this._midToIndex.get(e);if(void 0===t)throw new Error(`no media section found with mid '${e}'`);return this._mediaSections[t]}_regenerateBundleMids(){this._dtlsParameters&&(this._sdpObject.groups[0].mids=this._mediaSections.filter(e=>!e.closed).map(e=>e.mid).join(" "))}}},1380:function(e,t,r){var n;e.exports=(n=r(9021),r(3240),function(){var e=n,t=e.lib.Hasher,r=e.x64,s=r.Word,i=r.WordArray,a=e.algo;function o(){return s.create.apply(s,arguments)}var c=[o(1116352408,3609767458),o(1899447441,602891725),o(3049323471,3964484399),o(3921009573,2173295548),o(961987163,4081628472),o(1508970993,3053834265),o(2453635748,2937671579),o(2870763221,3664609560),o(3624381080,2734883394),o(310598401,1164996542),o(607225278,1323610764),o(1426881987,3590304994),o(1925078388,4068182383),o(2162078206,991336113),o(2614888103,633803317),o(3248222580,3479774868),o(3835390401,2666613458),o(4022224774,944711139),o(264347078,2341262773),o(604807628,2007800933),o(770255983,1495990901),o(1249150122,1856431235),o(1555081692,3175218132),o(1996064986,2198950837),o(2554220882,3999719339),o(2821834349,766784016),o(2952996808,2566594879),o(3210313671,3203337956),o(3336571891,1034457026),o(3584528711,2466948901),o(113926993,3758326383),o(338241895,168717936),o(666307205,1188179964),o(773529912,1546045734),o(1294757372,1522805485),o(1396182291,2643833823),o(1695183700,2343527390),o(1986661051,1014477480),o(2177026350,1206759142),o(2456956037,344077627),o(2730485921,1290863460),o(2820302411,3158454273),o(3259730800,3505952657),o(3345764771,106217008),o(3516065817,3606008344),o(3600352804,1432725776),o(4094571909,1467031594),o(275423344,851169720),o(430227734,3100823752),o(506948616,1363258195),o(659060556,3750685593),o(883997877,3785050280),o(958139571,3318307427),o(1322822218,3812723403),o(1537002063,2003034995),o(1747873779,3602036899),o(1955562222,1575990012),o(2024104815,1125592928),o(2227730452,2716904306),o(2361852424,442776044),o(2428436474,593698344),o(2756734187,3733110249),o(3204031479,2999351573),o(3329325298,3815920427),o(3391569614,3928383900),o(3515267271,566280711),o(3940187606,3454069534),o(4118630271,4000239992),o(116418474,1914138554),o(174292421,2731055270),o(289380356,3203993006),o(460393269,320620315),o(685471733,587496836),o(852142971,1086792851),o(1017036298,365543100),o(1126000580,2618297676),o(1288033470,3409855158),o(1501505948,4234509866),o(1607167915,987167468),o(1816402316,1246189591)],d=[];!function(){for(var e=0;e<80;e++)d[e]=o()}();var u=a.SHA512=t.extend({_doReset:function(){this._hash=new i.init([new s.init(1779033703,4089235720),new s.init(3144134277,2227873595),new s.init(1013904242,4271175723),new s.init(2773480762,1595750129),new s.init(1359893119,2917565137),new s.init(2600822924,725511199),new s.init(528734635,4215389547),new s.init(1541459225,327033209)])},_doProcessBlock:function(e,t){for(var r=this._hash.words,n=r[0],s=r[1],i=r[2],a=r[3],o=r[4],u=r[5],l=r[6],p=r[7],h=n.high,m=n.low,f=s.high,g=s.low,v=i.high,_=i.low,y=a.high,b=a.low,w=o.high,S=o.low,R=u.high,k=u.low,E=l.high,T=l.low,C=p.high,P=p.low,O=h,x=m,D=f,I=g,A=v,M=_,L=y,N=b,j=w,B=S,U=R,F=k,q=E,W=T,V=C,H=P,z=0;z<80;z++){var K,G,$=d[z];if(z<16)G=$.high=0|e[t+2*z],K=$.low=0|e[t+2*z+1];else{var J=d[z-15],Q=J.high,Y=J.low,X=(Q>>>1|Y<<31)^(Q>>>8|Y<<24)^Q>>>7,Z=(Y>>>1|Q<<31)^(Y>>>8|Q<<24)^(Y>>>7|Q<<25),ee=d[z-2],te=ee.high,re=ee.low,ne=(te>>>19|re<<13)^(te<<3|re>>>29)^te>>>6,se=(re>>>19|te<<13)^(re<<3|te>>>29)^(re>>>6|te<<26),ie=d[z-7],ae=ie.high,oe=ie.low,ce=d[z-16],de=ce.high,ue=ce.low;G=(G=(G=X+ae+((K=Z+oe)>>>0<Z>>>0?1:0))+ne+((K+=se)>>>0<se>>>0?1:0))+de+((K+=ue)>>>0<ue>>>0?1:0),$.high=G,$.low=K}var le,pe=j&U^~j&q,he=B&F^~B&W,me=O&D^O&A^D&A,fe=x&I^x&M^I&M,ge=(O>>>28|x<<4)^(O<<30|x>>>2)^(O<<25|x>>>7),ve=(x>>>28|O<<4)^(x<<30|O>>>2)^(x<<25|O>>>7),_e=(j>>>14|B<<18)^(j>>>18|B<<14)^(j<<23|B>>>9),ye=(B>>>14|j<<18)^(B>>>18|j<<14)^(B<<23|j>>>9),be=c[z],we=be.high,Se=be.low,Re=V+_e+((le=H+ye)>>>0<H>>>0?1:0),ke=ve+fe;V=q,H=W,q=U,W=F,U=j,F=B,j=L+(Re=(Re=(Re=Re+pe+((le+=he)>>>0<he>>>0?1:0))+we+((le+=Se)>>>0<Se>>>0?1:0))+G+((le+=K)>>>0<K>>>0?1:0))+((B=N+le|0)>>>0<N>>>0?1:0)|0,L=A,N=M,A=D,M=I,D=O,I=x,O=Re+(ge+me+(ke>>>0<ve>>>0?1:0))+((x=le+ke|0)>>>0<le>>>0?1:0)|0}m=n.low=m+x,n.high=h+O+(m>>>0<x>>>0?1:0),g=s.low=g+I,s.high=f+D+(g>>>0<I>>>0?1:0),_=i.low=_+M,i.high=v+A+(_>>>0<M>>>0?1:0),b=a.low=b+N,a.high=y+L+(b>>>0<N>>>0?1:0),S=o.low=S+B,o.high=w+j+(S>>>0<B>>>0?1:0),k=u.low=k+F,u.high=R+U+(k>>>0<F>>>0?1:0),T=l.low=T+W,l.high=E+q+(T>>>0<W>>>0?1:0),P=p.low=P+H,p.high=C+V+(P>>>0<H>>>0?1:0)},_doFinalize:function(){var e=this._data,t=e.words,r=8*this._nDataBytes,n=8*e.sigBytes;return t[n>>>5]|=128<<24-n%32,t[30+(n+128>>>10<<5)]=Math.floor(r/4294967296),t[31+(n+128>>>10<<5)]=r,e.sigBytes=4*t.length,this._process(),this._hash.toX32()},clone:function(){var e=t.clone.call(this);return e._hash=this._hash.clone(),e},blockSize:32});e.SHA512=t._createHelper(u),e.HmacSHA512=t._createHmacHelper(u)}(),n.SHA512)},1396:function(e,t,r){var n;e.exports=(n=r(9021),r(3240),r(6440),r(5503),r(754),r(4725),r(4636),r(5471),r(3009),r(6308),r(1380),r(9557),r(5953),r(8056),r(1025),r(19),r(9506),r(7165),r(2169),r(6939),r(6372),r(3797),r(8454),r(2073),r(4905),r(482),r(2155),r(8124),r(25),r(955),r(7628),r(7193),r(6298),r(2696),r(3128),n)},1425:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.updateV1State=void 0;const n=r(2291),s=r(6011),i={};function a(e,t,r){return e.msecs??(e.msecs=-1/0),e.nsecs??(e.nsecs=0),t===e.msecs?(e.nsecs++,e.nsecs>=1e4&&(e.node=void 0,e.nsecs=0)):t>e.msecs?e.nsecs=0:t<e.msecs&&(e.node=void 0),e.node||(e.node=r.slice(10,16),e.node[0]|=1,e.clockseq=16383&(r[8]<<8|r[9])),e.msecs=t,e}function o(e,t,r,n,s,i,a=0){if(e.length<16)throw new Error("Random bytes length must be >= 16");if(i){if(a<0||a+16>i.length)throw new RangeError(`UUID byte range ${a}:${a+15} is out of buffer bounds`)}else i=new Uint8Array(16),a=0;t??(t=Date.now()),r??(r=0),n??(n=16383&(e[8]<<8|e[9])),s??(s=e.slice(10,16));const o=(1e4*(268435455&(t+=122192928e5))+r)%4294967296;i[a++]=o>>>24&255,i[a++]=o>>>16&255,i[a++]=o>>>8&255,i[a++]=255&o;const c=t/4294967296*1e4&268435455;i[a++]=c>>>8&255,i[a++]=255&c,i[a++]=c>>>24&15|16,i[a++]=c>>>16&255,i[a++]=n>>>8|128,i[a++]=255&n;for(let d=0;d<6;++d)i[a++]=s[d];return i}t.updateV1State=a,t.default=function(e,t,r){var c;let d;const u=(null==e?void 0:e._v6)??!1;if(e){const t=Object.keys(e);1===t.length&&"_v6"===t[0]&&(e=void 0)}if(e)d=o(e.random??(null==(c=e.rng)?void 0:c.call(e))??(0,n.default)(),e.msecs,e.nsecs,e.clockseq,e.node,t,r);else{const e=Date.now(),s=(0,n.default)();a(i,e,s),d=o(s,i.msecs,i.nsecs,u?void 0:i.clockseq,u?void 0:i.node,t,r)}return t??(0,s.unsafeStringify)(d)}},1765:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.clone=function(e){return void 0===e?void 0:Number.isNaN(e)?NaN:"function"==typeof structuredClone?structuredClone(e):JSON.parse(JSON.stringify(e))},t.generateRandomNumber=function(){return Math.round(1e7*Math.random())},t.deepFreeze=function e(t){const r=Reflect.ownKeys(t);for(const n of r){const r=t[n];(r&&"object"==typeof r||"function"==typeof r)&&e(r)}return Object.freeze(t)}},1767:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Firefox60=void 0;const s=n(7363),i=n(2994),a=n(4893),o=n(1765),c=n(8046),d=n(5544),u=n(5938),l=n(521),p=n(1305),h=n(3303),m=new i.Logger("Firefox60"),f={OS:16,MIS:2048};class g extends l.HandlerInterface{constructor(){super(),r(this,"_closed",!1),r(this,"_direction"),r(this,"_remoteSdp"),r(this,"_sendingRtpParametersByKind"),r(this,"_sendingRemoteRtpParametersByKind"),r(this,"_pc"),r(this,"_mapMidTransceiver",new Map),r(this,"_sendStream",new MediaStream),r(this,"_hasDataChannelMediaSection",!1),r(this,"_nextSendSctpStreamId",0),r(this,"_transportReady",!1)}static createFactory(){return()=>new g}get name(){return"Firefox60"}close(){if(m.debug("close()"),!this._closed){if(this._closed=!0,this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}}async getNativeRtpCapabilities(){m.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),t=document.createElement("canvas");t.getContext("2d");const r=t.captureStream().getVideoTracks()[0];try{e.addTransceiver("audio",{direction:"sendrecv"});const i=e.addTransceiver(r,{direction:"sendrecv"}),a=i.sender.getParameters(),o=[{rid:"r0",maxBitrate:1e5},{rid:"r1",maxBitrate:5e5}];a.encodings=o,await i.sender.setParameters(a);const c=await e.createOffer();try{t.remove()}catch(n){}try{r.stop()}catch(n){}try{e.close()}catch(n){}const u=s.parse(c.sdp);return d.extractRtpCapabilities({sdpObject:u})}catch(i){try{t.remove()}catch(n){}try{r.stop()}catch(n){}try{e.close()}catch(n){}throw i}}async getNativeSctpCapabilities(){return m.debug("getNativeSctpCapabilities()"),{numStreams:f}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:s,iceServers:i,iceTransportPolicy:a,additionalSettings:o,proprietaryConstraints:d,extendedRtpCapabilities:u}){this.assertNotClosed(),m.debug("run()"),this._direction=e,this._remoteSdp=new p.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:s}),this._sendingRtpParametersByKind={audio:c.getSendingRtpParameters("audio",u),video:c.getSendingRtpParameters("video",u)},this._sendingRemoteRtpParametersByKind={audio:c.getSendingRemoteRtpParameters("audio",u),video:c.getSendingRemoteRtpParameters("video",u)},this._pc=new RTCPeerConnection({iceServers:i??[],iceTransportPolicy:a??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...o},d),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",e=>{this.emit("@icecandidateerror",e)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(m.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})}async updateIceServers(e){throw this.assertNotClosed(),new a.UnsupportedError("not supported")}async restartIce(e){if(this.assertNotClosed(),m.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady)if("send"===this._direction){const e=await this._pc.createOffer({iceRestart:!0});m.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();m.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:n}){this.assertNotClosed(),this.assertSendDirection(),m.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),t&&((t=o.clone(t)).forEach((e,t)=>{e.rid=`r${t}`}),t.reverse());const i=o.clone(this._sendingRtpParametersByKind[e.kind]);i.codecs=c.reduceCodecs(i.codecs,n);const a=o.clone(this._sendingRemoteRtpParametersByKind[e.kind]);a.codecs=c.reduceCodecs(a.codecs,n);const l=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream]});if(t){const e=l.sender.getParameters();e.encodings=t,await l.sender.setParameters(e)}const p=await this._pc.createOffer();let f=s.parse(p.sdp);f.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed(),this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:f});const g=(0,h.parse)((t??[{}])[0].scalabilityMode);m.debug("send() | calling pc.setLocalDescription() [offer:%o]",p),await this._pc.setLocalDescription(p);const v=l.mid;i.mid=v,f=s.parse(this._pc.localDescription.sdp);const _=f.media[f.media.length-1];if(i.rtcp.cname=d.getCname({offerMediaObject:_}),t)if(1===t.length){const e=u.getRtpEncodings({offerMediaObject:_});Object.assign(e[0],t[0]),i.encodings=e}else i.encodings=t.reverse();else i.encodings=u.getRtpEncodings({offerMediaObject:_});if(i.encodings.length>1&&("video/vp8"===i.codecs[0].mimeType.toLowerCase()||"video/h264"===i.codecs[0].mimeType.toLowerCase()))for(const s of i.encodings)s.scalabilityMode?s.scalabilityMode=`L1T${g.temporalLayers}`:s.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:_,offerRtpParameters:i,answerRtpParameters:a,codecOptions:r});const y={type:"answer",sdp:this._remoteSdp.getSdp()};return m.debug("send() | calling pc.setRemoteDescription() [answer:%o]",y),await this._pc.setRemoteDescription(y),this._mapMidTransceiver.set(v,l),{localId:v,rtpParameters:i,rtpSender:l.sender}}async stopSending(e){if(this.assertSendDirection(),m.debug("stopSending() [localId:%s]",e),this._closed)return;const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated transceiver not found");t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.disableMediaSection(t.mid);const r=await this._pc.createOffer();m.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const n={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n),this._mapMidTransceiver.delete(e)}async pauseSending(e){this.assertNotClosed(),this.assertSendDirection(),m.debug("pauseSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive",this._remoteSdp.pauseMediaSection(e);const r=await this._pc.createOffer();m.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const n={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n)}async resumeSending(e){this.assertNotClosed(),this.assertSendDirection(),m.debug("resumeSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="sendonly",this._remoteSdp.resumeSendingMediaSection(e);const r=await this._pc.createOffer();m.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const n={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n)}async replaceTrack(e,t){this.assertNotClosed(),this.assertSendDirection(),t?m.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):m.debug("replaceTrack() [localId:%s, no track]",e);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");await r.sender.replaceTrack(t)}async setMaxSpatialLayer(e,t){this.assertNotClosed(),this.assertSendDirection(),m.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated transceiver not found");const n=r.sender.getParameters();t=n.encodings.length-1-t,n.encodings.forEach((e,r)=>{e.active=r>=t}),await r.sender.setParameters(n),this._remoteSdp.muxMediaSectionSimulcast(e,n.encodings);const s=await this._pc.createOffer();m.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);const i={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async setRtpEncodingParameters(e,t){this.assertNotClosed(),this.assertSendDirection(),m.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const n=r.sender.getParameters();n.encodings.forEach((e,r)=>{n.encodings[r]={...e,...t}}),await r.sender.setParameters(n),this._remoteSdp.muxMediaSectionSimulcast(e,n.encodings);const s=await this._pc.createOffer();m.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);const i={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async getSenderStats(e){this.assertNotClosed(),this.assertSendDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:n,protocol:i}){this.assertNotClosed(),this.assertSendDirection();const a={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:r,protocol:i};m.debug("sendDataChannel() [options:%o]",a);const o=this._pc.createDataChannel(n,a);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%f.MIS,!this._hasDataChannelMediaSection){const e=await this._pc.createOffer(),t=s.parse(e.sdp),r=t.media.find(e=>"application"===e.type);this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:t}),m.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:r});const n={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n),this._hasDataChannelMediaSection=!0}return{dataChannel:o,sctpStreamParameters:{streamId:a.id,ordered:a.ordered,maxPacketLifeTime:a.maxPacketLifeTime,maxRetransmits:a.maxRetransmits}}}async receive(e){this.assertNotClosed(),this.assertRecvDirection();const t=[],r=new Map;for(const s of e){const{trackId:e,kind:t,rtpParameters:n,streamId:i}=s;m.debug("receive() [trackId:%s, kind:%s]",e,t);const a=n.mid??String(this._mapMidTransceiver.size);r.set(e,a),this._remoteSdp.receive({mid:a,kind:t,offerRtpParameters:n,streamId:i??n.rtcp.cname,trackId:e})}const n={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",n),await this._pc.setRemoteDescription(n);let i=await this._pc.createAnswer();const a=s.parse(i.sdp);for(const o of e){const{trackId:e,rtpParameters:t}=o,n=r.get(e),c=a.media.find(e=>String(e.mid)===n);d.applyCodecParameters({offerRtpParameters:t,answerMediaObject:c}),i={type:"answer",sdp:s.write(a)}}this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:a}),m.debug("receive() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i);for(const s of e){const{trackId:e}=s,n=r.get(e),i=this._pc.getTransceivers().find(e=>e.mid===n);if(!i)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(n,i),t.push({localId:n,track:i.receiver.track,rtpReceiver:i.receiver})}return t}async stopReceiving(e){if(this.assertRecvDirection(),this._closed)return;for(const n of e){m.debug("stopReceiving() [localId:%s]",n);const e=this._mapMidTransceiver.get(n);if(!e)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(e.mid)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const r=await this._pc.createAnswer();m.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r);for(const n of e)this._mapMidTransceiver.delete(n)}async pauseReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(const n of e){m.debug("pauseReceiving() [localId:%s]",n);const e=this._mapMidTransceiver.get(n);if(!e)throw new Error("associated RTCRtpTransceiver not found");e.direction="inactive",this._remoteSdp.pauseMediaSection(n)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const r=await this._pc.createAnswer();m.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r)}async resumeReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(const n of e){m.debug("resumeReceiving() [localId:%s]",n);const e=this._mapMidTransceiver.get(n);if(!e)throw new Error("associated RTCRtpTransceiver not found");e.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(n)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const r=await this._pc.createAnswer();m.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r)}async getReceiverStats(e){this.assertRecvDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:n,ordered:i,maxPacketLifeTime:a,maxRetransmits:o}=e,c={negotiated:!0,id:n,ordered:i,maxPacketLifeTime:a,maxRetransmits:o,protocol:r};m.debug("receiveDataChannel() [options:%o]",c);const d=this._pc.createDataChannel(t,c);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const e={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();if(!this._transportReady){const e=s.parse(t.sdp);await this.setupTransport({localDtlsRole:"client",localSdpObject:e})}m.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setLocalDescription(t),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=s.parse(this._pc.localDescription.sdp));const r=d.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await new Promise((e,t)=>{this.safeEmit("@connect",{dtlsParameters:r},e,t)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new a.InvalidStateError("method called in a closed handler")}assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}t.Firefox60=g},1791:(e,t,r)=>{var n=r(5172),s=r(5546);e.exports=function e(t,r){function i(e,s,a,o){try{var c=t[e](s),d=c.value;return d instanceof n?r.resolve(d.v).then(function(e){i("next",e,a,o)},function(e){i("throw",e,a,o)}):r.resolve(d).then(function(e){c.value=e,a(c)},function(e){return i("throw",e,a,o)})}catch(u){o(u)}}var a;this.next||(s(e.prototype),s(e.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",function(){return this})),s(this,"_invoke",function(e,t,n){function s(){return new r(function(t,r){i(e,n,t,r)})}return a=a?a.then(s,s):s()},!0)},e.exports.__esModule=!0,e.exports.default=e.exports},1797:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=r(9746);t.default=function(e){if(!(0,n.default)(e))throw TypeError("Invalid UUID");let t;return Uint8Array.of((t=parseInt(e.slice(0,8),16))>>>24,t>>>16&255,t>>>8&255,255&t,(t=parseInt(e.slice(9,13),16))>>>8,255&t,(t=parseInt(e.slice(14,18),16))>>>8,255&t,(t=parseInt(e.slice(19,23),16))>>>8,255&t,(t=parseInt(e.slice(24,36),16))/1099511627776&255,t/4294967296&255,t>>>24&255,t>>>16&255,t>>>8&255,255&t)}},1803:(e,t,r)=>{r.d(t,{ed:()=>y,sg:()=>b,v7:()=>_});var n=r(4467),s=r(296),i=r(9027);function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}var o={},c={},d={};for(var u in i.$.videoProfiles)"oneSixNine"==i.$.videoProfiles[u].aspectRatio&&(o[u]=i.$.videoProfiles[u],o[u].encoding={maxBitrate:o[u].bitRate,maxFramerate:o[u].frameRate}),"fourThree"==i.$.videoProfiles[u].aspectRatio&&(c[u]=i.$.videoProfiles[u],c[u].encoding={maxBitrate:c[u].bitRate,maxFramerate:c[u].frameRate});for(var u in i.$.screenShareProfiles)d[u]=i.$.screenShareProfiles[u],d[u].encoding={maxBitrate:d[u].bitRate,maxFramerate:d[u].frameRate};var l=Object.values(o),p=Object.values(c),h=Object.values(d),m=[o.h180p_w320p,o.h360p_w640p],f=[c.h180p_w240p,c.h360p_w480p],g=function(e){return[{scaleResolutionDownBy:2,fps:3}].map(function(t){var r;return{width:Math.floor(e.width/t.scaleResolutionDownBy),height:Math.floor(e.height/t.scaleResolutionDownBy),encodings:{maxBitrate:Math.max(15e4,Math.floor(e.encoding.maxBitrate/(Math.pow(t.scaleResolutionDownBy,2)*((null!==(r=e.encoding.maxFramerate)&&void 0!==r?r:30)/t.fps)))),maxFramerate:t.fps}}})},v=["q","h","f"];function _(e,t,r,i,o){var c=i&&i.videoEncoding;e&&(c=i&&i.screenShareEncoding);var d=null==i?void 0:i.simulcast;if(c||(c=function(e,t,r){for(var n=function(e,t,r){if(e)return h;var n=t>r?t/r:r/t;return Math.abs(n-16/9)<Math.abs(n-4/3)?l:p}(e,t,r),s=n[0].encoding,i=Math.max(t,r),a=0;a<n.length;a+=1){var o=n[a];if(s=o.encoding,o.width>=i)break}return s}(e,t,r)),!d)return[c];var u,_,y={width:t,height:r,encoding:{maxBitrate:c.maxBitrate,maxFramerate:c.maxFramerate}},b=(_=function(e,t){e&&g(t);var r=t.width,n=t.height,s=r>n?r/n:n/r;return Math.abs(s-16/9)<Math.abs(s-4/3)?m:f}(e,y))[0];if(_.length>1){var w=_;u=(0,s.A)(w,2)[1]}var S=Math.max(t,r);return function(e,t,r,s){var i=[];return r.forEach(function(r,o){if(!(o>=v.length)){var c=s?null:{maxFramerate:r.encoding.maxFramerate},d=Math.min(e,t),u=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach(function(t){(0,n.A)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({rid:v[o],scaleResolutionDownBy:d/Math.min(r.width,r.height),maxBitrate:r.encoding.maxBitrate},c);i.push(u)}}),i}(t,r,S>=960&&u?[b,u,y]:S>=480?[b,y]:[y],o)}function y(e,t,r){if(!e)return{};var n=e.id,s=e.appData,i=s.width,a=s.height,o=s.encodings;try{var c=function(e){var t=[];if(e&&0!=e.length){if(1===e.length){for(var r=0;r<3;r++)t.push(Math.pow(2,3-r-1));return t}var n=!1;return e.forEach(function(e){void 0!==e.scaleResolutionDownBy?(n=!0,t.push(Math.max(1,e.scaleResolutionDownBy))):t.push(1)}),n||e.forEach(function(r,n){t[n]=Math.pow(2,e.length-n-1)}),t}}(o);if(!c)return{};var d=c.map(function(e){return{width:i/e,height:a/e}}).sort(function(e,t){return e.width-t.width}),u=d.findIndex(function(e){return e.width>=t&&e.height>=r});-1===u&&(u=d.length-1);var l=e.temporalLayers?e.temporalLayers:2;if(0===u&&l>0){var p=i/c[0],h=a/c[0];t<.5*p&&r<.5*h&&(l-=1),l>0&&t<.25*p&&r<.25*h&&(l-=1)}return{consumerId:n,newPreferredSpatialLayer:Math.max(0,u),newPreferredTemporalLayer:Math.max(0,l)}}catch(m){return{}}}function b(e,t){var r;return function(){for(var n=this,s=arguments.length,i=new Array(s),a=0;a<s;a++)i[a]=arguments[a];clearTimeout(r),r=setTimeout(function(){return e.apply(n,i)},t)}}},1806:(e,t,r)=>{r.d(t,{$Q:()=>n,T4:()=>s,Ts:()=>a,ue:()=>i});var n="vk_e2ee",s={sharedKey:!1,ratchetSalt:"VideoSDKEncryptionRatchetSalt",ratchetWindowSize:0,failureTolerance:10,keyringSize:16,discardFrameWhenCryptorNotReady:!1},i=["vp8","vp9","h264","av1"],a=["opus"]},1919:(e,t,r)=>{r.r(t),r.d(t,{default:()=>Dr});var n={};r.r(n),r.d(n,{Decoder:()=>Te,Encoder:()=>ke,PacketType:()=>Se,protocol:()=>we});var s=r(296),i=r(5458),a=r(2284),o=r(467),c=r(3029),d=r(2901),u=r(4467),l=r(4756),p=r.n(l);const h=Object.create(null);h.open="0",h.close="1",h.ping="2",h.pong="3",h.message="4",h.upgrade="5",h.noop="6";const m=Object.create(null);Object.keys(h).forEach(e=>{m[h[e]]=e});const f={type:"error",data:"parser error"},g="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),v="function"==typeof ArrayBuffer,_=e=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer,y=({type:e,data:t},r,n)=>g&&t instanceof Blob?r?n(t):b(t,n):v&&(t instanceof ArrayBuffer||_(t))?r?n(t):b(new Blob([t]),n):n(h[e]+(t||"")),b=(e,t)=>{const r=new FileReader;return r.onload=function(){const e=r.result.split(",")[1];t("b"+(e||""))},r.readAsDataURL(e)};function w(e){return e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}let S;const R="undefined"==typeof Uint8Array?[]:new Uint8Array(256);for(let Mr=0;Mr<64;Mr++)R["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charCodeAt(Mr)]=Mr;const k="function"==typeof ArrayBuffer,E=(e,t)=>{if("string"!=typeof e)return{type:"message",data:C(e,t)};const r=e.charAt(0);return"b"===r?{type:"message",data:T(e.substring(1),t)}:m[r]?e.length>1?{type:m[r],data:e.substring(1)}:{type:m[r]}:f},T=(e,t)=>{if(k){const r=(e=>{let t,r,n,s,i,a=.75*e.length,o=e.length,c=0;"="===e[e.length-1]&&(a--,"="===e[e.length-2]&&a--);const d=new ArrayBuffer(a),u=new Uint8Array(d);for(t=0;t<o;t+=4)r=R[e.charCodeAt(t)],n=R[e.charCodeAt(t+1)],s=R[e.charCodeAt(t+2)],i=R[e.charCodeAt(t+3)],u[c++]=r<<2|n>>4,u[c++]=(15&n)<<4|s>>2,u[c++]=(3&s)<<6|63&i;return d})(e);return C(r,t)}return{base64:!0,data:e}},C=(e,t)=>"blob"===t?e instanceof Blob?e:new Blob([e]):e instanceof ArrayBuffer?e:e.buffer,P=String.fromCharCode(30);let O;function x(e){return e.reduce((e,t)=>e+t.length,0)}function D(e,t){if(e[0].length===t)return e.shift();const r=new Uint8Array(t);let n=0;for(let s=0;s<t;s++)r[s]=e[0][n++],n===e[0].length&&(e.shift(),n=0);return e.length&&n<e[0].length&&(e[0]=e[0].slice(n)),r}function I(e){if(e)return function(e){for(var t in I.prototype)e[t]=I.prototype[t];return e}(e)}I.prototype.on=I.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},I.prototype.once=function(e,t){function r(){this.off(e,r),t.apply(this,arguments)}return r.fn=t,this.on(e,r),this},I.prototype.off=I.prototype.removeListener=I.prototype.removeAllListeners=I.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var r,n=this._callbacks["$"+e];if(!n)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var s=0;s<n.length;s++)if((r=n[s])===t||r.fn===t){n.splice(s,1);break}return 0===n.length&&delete this._callbacks["$"+e],this},I.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),r=this._callbacks["$"+e],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(r){n=0;for(var s=(r=r.slice(0)).length;n<s;++n)r[n].apply(this,t)}return this},I.prototype.emitReserved=I.prototype.emit,I.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},I.prototype.hasListeners=function(e){return!!this.listeners(e).length};const A="function"==typeof Promise&&"function"==typeof Promise.resolve?e=>Promise.resolve().then(e):(e,t)=>t(e,0),M="undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")();function L(e,...t){return t.reduce((t,r)=>(e.hasOwnProperty(r)&&(t[r]=e[r]),t),{})}const N=M.setTimeout,j=M.clearTimeout;function B(e,t){t.useNativeTimers?(e.setTimeoutFn=N.bind(M),e.clearTimeoutFn=j.bind(M)):(e.setTimeoutFn=M.setTimeout.bind(M),e.clearTimeoutFn=M.clearTimeout.bind(M))}function U(e){return"string"==typeof e?function(e){let t=0,r=0;for(let n=0,s=e.length;n<s;n++)t=e.charCodeAt(n),t<128?r+=1:t<2048?r+=2:t<55296||t>=57344?r+=3:(n++,r+=4);return r}(e):Math.ceil(1.33*(e.byteLength||e.size))}function F(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}class q extends Error{constructor(e,t,r){super(e),this.description=t,this.context=r,this.type="TransportError"}}class W extends I{constructor(e){super(),this.writable=!1,B(this,e),this.opts=e,this.query=e.query,this.socket=e.socket,this.supportsBinary=!e.forceBase64}onError(e,t,r){return super.emitReserved("error",new q(e,t,r)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}send(e){"open"===this.readyState&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=E(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,t={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){const e=this.opts.hostname;return-1===e.indexOf(":")?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&Number(443!==this.opts.port)||!this.opts.secure&&80!==Number(this.opts.port))?":"+this.opts.port:""}_query(e){const t=function(e){let t="";for(let r in e)e.hasOwnProperty(r)&&(t.length&&(t+="&"),t+=encodeURIComponent(r)+"="+encodeURIComponent(e[r]));return t}(e);return t.length?"?"+t:""}}class V extends W{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this._polling||!this.writable){let e=0;this._polling&&(e++,this.once("pollComplete",function(){--e||t()})),this.writable||(e++,this.once("drain",function(){--e||t()}))}else t()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){((e,t)=>{const r=e.split(P),n=[];for(let s=0;s<r.length;s++){const e=E(r[s],t);if(n.push(e),"error"===e.type)break}return n})(e,this.socket.binaryType).forEach(e=>{if("opening"===this.readyState&&"open"===e.type&&this.onOpen(),"close"===e.type)return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(e)}),"closed"!==this.readyState&&(this._polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this._poll())}doClose(){const e=()=>{this.write([{type:"close"}])};"open"===this.readyState?e():this.once("open",e)}write(e){this.writable=!1,((e,t)=>{const r=e.length,n=new Array(r);let s=0;e.forEach((e,i)=>{y(e,!1,e=>{n[i]=e,++s===r&&t(n.join(P))})})})(e,e=>{this.doWrite(e,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const e=this.opts.secure?"https":"http",t=this.query||{};return!1!==this.opts.timestampRequests&&(t[this.opts.timestampParam]=F()),this.supportsBinary||t.sid||(t.b64=1),this.createUri(e,t)}}let H=!1;try{H="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(Re){}const z=H;function K(){}class G extends V{constructor(e){if(super(e),"undefined"!=typeof location){const t="https:"===location.protocol;let r=location.port;r||(r=t?"443":"80"),this.xd="undefined"!=typeof location&&e.hostname!==location.hostname||r!==e.port}}doWrite(e,t){const r=this.request({method:"POST",data:e});r.on("success",t),r.on("error",(e,t)=>{this.onError("xhr post error",e,t)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(e,t)=>{this.onError("xhr poll error",e,t)}),this.pollXhr=e}}class $ extends I{constructor(e,t,r){super(),this.createRequest=e,B(this,r),this._opts=r,this._method=r.method||"GET",this._uri=t,this._data=void 0!==r.data?r.data:null,this._create()}_create(){var e;const t=L(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this._opts.xd;const r=this._xhr=this.createRequest(t);try{r.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){r.setDisableHeaderCheck&&r.setDisableHeaderCheck(!0);for(let e in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(e)&&r.setRequestHeader(e,this._opts.extraHeaders[e])}}catch(n){}if("POST"===this._method)try{r.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(n){}try{r.setRequestHeader("Accept","*/*")}catch(n){}null===(e=this._opts.cookieJar)||void 0===e||e.addCookies(r),"withCredentials"in r&&(r.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(r.timeout=this._opts.requestTimeout),r.onreadystatechange=()=>{var e;3===r.readyState&&(null===(e=this._opts.cookieJar)||void 0===e||e.parseCookies(r.getResponseHeader("set-cookie"))),4===r.readyState&&(200===r.status||1223===r.status?this._onLoad():this.setTimeoutFn(()=>{this._onError("number"==typeof r.status?r.status:0)},0))},r.send(this._data)}catch(n){return void this.setTimeoutFn(()=>{this._onError(n)},0)}"undefined"!=typeof document&&(this._index=$.requestsCount++,$.requests[this._index]=this)}_onError(e){this.emitReserved("error",e,this._xhr),this._cleanup(!0)}_cleanup(e){if(void 0!==this._xhr&&null!==this._xhr){if(this._xhr.onreadystatechange=K,e)try{this._xhr.abort()}catch(t){}"undefined"!=typeof document&&delete $.requests[this._index],this._xhr=null}}_onLoad(){const e=this._xhr.responseText;null!==e&&(this.emitReserved("data",e),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}function J(){for(let e in $.requests)$.requests.hasOwnProperty(e)&&$.requests[e].abort()}$.requestsCount=0,$.requests={},"undefined"!=typeof document&&("function"==typeof attachEvent?attachEvent("onunload",J):"function"==typeof addEventListener&&addEventListener("onpagehide"in M?"pagehide":"unload",J,!1));const Q=function(){const e=Y({xdomain:!1});return e&&null!==e.responseType}();function Y(e){const t=e.xdomain;try{if("undefined"!=typeof XMLHttpRequest&&(!t||z))return new XMLHttpRequest}catch(r){}if(!t)try{return new(M[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(r){}}const X="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase();class Z extends W{get name(){return"websocket"}doOpen(){const e=this.uri(),t=this.opts.protocols,r=X?{}:L(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(r.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(e,t,r)}catch(n){return this.emitReserved("error",n)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const r=e[t],n=t===e.length-1;y(r,this.supportsBinary,e=>{try{this.doWrite(r,e)}catch(t){}n&&A(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){void 0!==this.ws&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=F()),this.supportsBinary||(t.b64=1),this.createUri(e,t)}}const ee=M.WebSocket||M.MozWebSocket,te={websocket:class extends Z{createSocket(e,t,r){return X?new ee(e,t,r):t?new ee(e,t):new ee(e)}doWrite(e,t){this.ws.send(t)}},webtransport:class extends W{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(Re){return this.emitReserved("error",Re)}this._transport.closed.then(()=>{this.onClose()}).catch(e=>{this.onError("webtransport error",e)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(e=>{const t=function(e,t){O||(O=new TextDecoder);const r=[];let n=0,s=-1,i=!1;return new TransformStream({transform(a,o){for(r.push(a);;){if(0===n){if(x(r)<1)break;const e=D(r,1);i=!(128&~e[0]),s=127&e[0],n=s<126?3:126===s?1:2}else if(1===n){if(x(r)<2)break;const e=D(r,2);s=new DataView(e.buffer,e.byteOffset,e.length).getUint16(0),n=3}else if(2===n){if(x(r)<8)break;const e=D(r,8),t=new DataView(e.buffer,e.byteOffset,e.length),i=t.getUint32(0);if(i>Math.pow(2,21)-1){o.enqueue(f);break}s=i*Math.pow(2,32)+t.getUint32(4),n=3}else{if(x(r)<s)break;const e=D(r,s);o.enqueue(E(i?e:O.decode(e),t)),n=0}if(0===s||s>e){o.enqueue(f);break}}}})}(Number.MAX_SAFE_INTEGER,this.socket.binaryType),r=e.readable.pipeThrough(t).getReader(),n=new TransformStream({transform(e,t){var r,n;r=e,n=r=>{const n=r.length;let s;if(n<126)s=new Uint8Array(1),new DataView(s.buffer).setUint8(0,n);else if(n<65536){s=new Uint8Array(3);const e=new DataView(s.buffer);e.setUint8(0,126),e.setUint16(1,n)}else{s=new Uint8Array(9);const e=new DataView(s.buffer);e.setUint8(0,127),e.setBigUint64(1,BigInt(n))}e.data&&"string"!=typeof e.data&&(s[0]|=128),t.enqueue(s),t.enqueue(r)},g&&r.data instanceof Blob?r.data.arrayBuffer().then(w).then(n):v&&(r.data instanceof ArrayBuffer||_(r.data))?n(w(r.data)):y(r,!1,e=>{S||(S=new TextEncoder),n(S.encode(e))})}});n.readable.pipeTo(e.writable),this._writer=n.writable.getWriter();const s=()=>{r.read().then(({done:e,value:t})=>{e||(this.onPacket(t),s())}).catch(e=>{})};s();const i={type:"open"};this.query.sid&&(i.data=`{"sid":"${this.query.sid}"}`),this._writer.write(i).then(()=>this.onOpen())})})}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const r=e[t],n=t===e.length-1;this._writer.write(r).then(()=>{n&&A(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var e;null===(e=this._transport)||void 0===e||e.close()}},polling:class extends G{constructor(e){super(e);const t=e&&e.forceBase64;this.supportsBinary=Q&&!t}request(e={}){return Object.assign(e,{xd:this.xd},this.opts),new $(Y,this.uri(),e)}}},re=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,ne=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function se(e){if(e.length>8e3)throw"URI too long";const t=e,r=e.indexOf("["),n=e.indexOf("]");-1!=r&&-1!=n&&(e=e.substring(0,r)+e.substring(r,n).replace(/:/g,";")+e.substring(n,e.length));let s=re.exec(e||""),i={},a=14;for(;a--;)i[ne[a]]=s[a]||"";return-1!=r&&-1!=n&&(i.source=t,i.host=i.host.substring(1,i.host.length-1).replace(/;/g,":"),i.authority=i.authority.replace("[","").replace("]","").replace(/;/g,":"),i.ipv6uri=!0),i.pathNames=function(e,t){const r=t.replace(/\/{2,9}/g,"/").split("/");return"/"!=t.slice(0,1)&&0!==t.length||r.splice(0,1),"/"==t.slice(-1)&&r.splice(r.length-1,1),r}(0,i.path),i.queryKey=function(e,t){const r={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(e,t,n){t&&(r[t]=n)}),r}(0,i.query),i}const ie="function"==typeof addEventListener&&"function"==typeof removeEventListener,ae=[];ie&&addEventListener("offline",()=>{ae.forEach(e=>e())},!1);class oe extends I{constructor(e,t){if(super(),this.binaryType="arraybuffer",this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,e&&"object"==typeof e&&(t=e,e=null),e){const r=se(e);t.hostname=r.host,t.secure="https"===r.protocol||"wss"===r.protocol,t.port=r.port,r.query&&(t.query=r.query)}else t.host&&(t.hostname=se(t.host).host);B(this,t),this.secure=null!=t.secure?t.secure:"undefined"!=typeof location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=t.port||("undefined"!=typeof location&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},t.transports.forEach(e=>{const t=e.prototype.name;this.transports.push(t),this._transportsByName[t]=e}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),"string"==typeof this.opts.query&&(this.opts.query=function(e){let t={},r=e.split("&");for(let n=0,s=r.length;n<s;n++){let e=r[n].split("=");t[decodeURIComponent(e[0])]=decodeURIComponent(e[1])}return t}(this.opts.query)),ie&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),"localhost"!==this.hostname&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},ae.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=4,t.transport=e,this.id&&(t.sid=this.id);const r=Object.assign({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new this._transportsByName[e](r)}_open(){if(0===this.transports.length)return void this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);const e=this.opts.rememberUpgrade&&oe.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket")?"websocket":this.transports[0];this.readyState="opening";const t=this.createTransport(e);t.open(),this.setTransport(t)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",e=>this._onClose("transport close",e))}onOpen(){this.readyState="open",oe.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush()}_onPacket(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const t=new Error("server error");t.code=e.data,this._onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data)}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this._pingInterval=e.pingInterval,this._pingTimeout=e.pingTimeout,this._maxPayload=e.maxPayload,this.onOpen(),"closed"!==this.readyState&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const e=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+e,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},e),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this._getWritablePackets();this.transport.send(e),this._prevBufferLen=e.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;let e=1;for(let t=0;t<this.writeBuffer.length;t++){const r=this.writeBuffer[t].data;if(r&&(e+=U(r)),t>0&&e>this._maxPayload)return this.writeBuffer.slice(0,t);e+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const e=Date.now()>this._pingTimeoutTime;return e&&(this._pingTimeoutTime=0,A(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),e}write(e,t,r){return this._sendPacket("message",e,t,r),this}send(e,t,r){return this._sendPacket("message",e,t,r),this}_sendPacket(e,t,r,n){if("function"==typeof t&&(n=t,t=void 0),"function"==typeof r&&(n=r,r=null),"closing"===this.readyState||"closed"===this.readyState)return;(r=r||{}).compress=!1!==r.compress;const s={type:e,data:t,options:r};this.emitReserved("packetCreate",s),this.writeBuffer.push(s),n&&this.once("flush",n),this.flush()}close(){const e=()=>{this._onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},r=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?r():e()}):this.upgrading?r():e()),this}_onError(e){if(oe.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&"opening"===this.readyState)return this.transports.shift(),this._open();this.emitReserved("error",e),this._onClose("transport error",e)}_onClose(e,t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),ie&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const e=ae.indexOf(this._offlineEventListener);-1!==e&&ae.splice(e,1)}this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this._prevBufferLen=0}}}oe.protocol=4;class ce extends oe{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),"open"===this.readyState&&this.opts.upgrade)for(let e=0;e<this._upgrades.length;e++)this._probe(this._upgrades[e])}_probe(e){let t=this.createTransport(e),r=!1;oe.priorWebsocketSuccess=!1;const n=()=>{r||(t.send([{type:"ping",data:"probe"}]),t.once("packet",e=>{if(!r)if("pong"===e.type&&"probe"===e.data){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;oe.priorWebsocketSuccess="websocket"===t.name,this.transport.pause(()=>{r||"closed"!==this.readyState&&(d(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())})}else{const e=new Error("probe error");e.transport=t.name,this.emitReserved("upgradeError",e)}}))};function s(){r||(r=!0,d(),t.close(),t=null)}const i=e=>{const r=new Error("probe error: "+e);r.transport=t.name,s(),this.emitReserved("upgradeError",r)};function a(){i("transport closed")}function o(){i("socket closed")}function c(e){t&&e.name!==t.name&&s()}const d=()=>{t.removeListener("open",n),t.removeListener("error",i),t.removeListener("close",a),this.off("close",o),this.off("upgrading",c)};t.once("open",n),t.once("error",i),t.once("close",a),this.once("close",o),this.once("upgrading",c),-1!==this._upgrades.indexOf("webtransport")&&"webtransport"!==e?this.setTimeoutFn(()=>{r||t.open()},200):t.open()}onHandshake(e){this._upgrades=this._filterUpgrades(e.upgrades),super.onHandshake(e)}_filterUpgrades(e){const t=[];for(let r=0;r<e.length;r++)~this.transports.indexOf(e[r])&&t.push(e[r]);return t}}class de extends ce{constructor(e,t={}){const r="object"==typeof e?e:t;(!r.transports||r.transports&&"string"==typeof r.transports[0])&&(r.transports=(r.transports||["polling","websocket","webtransport"]).map(e=>te[e]).filter(e=>!!e)),super(e,r)}}const ue="function"==typeof ArrayBuffer,le=Object.prototype.toString,pe="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===le.call(Blob),he="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===le.call(File);function me(e){return ue&&(e instanceof ArrayBuffer||(t=e,"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(t):t.buffer instanceof ArrayBuffer))||pe&&e instanceof Blob||he&&e instanceof File;var t}function fe(e,t){if(!e||"object"!=typeof e)return!1;if(Array.isArray(e)){for(let t=0,r=e.length;t<r;t++)if(fe(e[t]))return!0;return!1}if(me(e))return!0;if(e.toJSON&&"function"==typeof e.toJSON&&1===arguments.length)return fe(e.toJSON(),!0);for(const r in e)if(Object.prototype.hasOwnProperty.call(e,r)&&fe(e[r]))return!0;return!1}function ge(e){const t=[],r=e.data,n=e;return n.data=ve(r,t),n.attachments=t.length,{packet:n,buffers:t}}function ve(e,t){if(!e)return e;if(me(e)){const r={_placeholder:!0,num:t.length};return t.push(e),r}if(Array.isArray(e)){const r=new Array(e.length);for(let n=0;n<e.length;n++)r[n]=ve(e[n],t);return r}if("object"==typeof e&&!(e instanceof Date)){const r={};for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=ve(e[n],t));return r}return e}function _e(e,t){return e.data=ye(e.data,t),delete e.attachments,e}function ye(e,t){if(!e)return e;if(e&&!0===e._placeholder){if("number"==typeof e.num&&e.num>=0&&e.num<t.length)return t[e.num];throw new Error("illegal attachments")}if(Array.isArray(e))for(let r=0;r<e.length;r++)e[r]=ye(e[r],t);else if("object"==typeof e)for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&(e[r]=ye(e[r],t));return e}const be=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],we=5;var Se,Re;(Re=Se||(Se={}))[Re.CONNECT=0]="CONNECT",Re[Re.DISCONNECT=1]="DISCONNECT",Re[Re.EVENT=2]="EVENT",Re[Re.ACK=3]="ACK",Re[Re.CONNECT_ERROR=4]="CONNECT_ERROR",Re[Re.BINARY_EVENT=5]="BINARY_EVENT",Re[Re.BINARY_ACK=6]="BINARY_ACK";class ke{constructor(e){this.replacer=e}encode(e){return e.type!==Se.EVENT&&e.type!==Se.ACK||!fe(e)?[this.encodeAsString(e)]:this.encodeAsBinary({type:e.type===Se.EVENT?Se.BINARY_EVENT:Se.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id})}encodeAsString(e){let t=""+e.type;return e.type!==Se.BINARY_EVENT&&e.type!==Se.BINARY_ACK||(t+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(t+=e.nsp+","),null!=e.id&&(t+=e.id),null!=e.data&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){const t=ge(e),r=this.encodeAsString(t.packet),n=t.buffers;return n.unshift(r),n}}function Ee(e){return"[object Object]"===Object.prototype.toString.call(e)}class Te extends I{constructor(e){super(),this.reviver=e}add(e){let t;if("string"==typeof e){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);const r=t.type===Se.BINARY_EVENT;r||t.type===Se.BINARY_ACK?(t.type=r?Se.EVENT:Se.ACK,this.reconstructor=new Ce(t),0===t.attachments&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else{if(!me(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t))}}decodeString(e){let t=0;const r={type:Number(e.charAt(0))};if(void 0===Se[r.type])throw new Error("unknown packet type "+r.type);if(r.type===Se.BINARY_EVENT||r.type===Se.BINARY_ACK){const n=t+1;for(;"-"!==e.charAt(++t)&&t!=e.length;);const s=e.substring(n,t);if(s!=Number(s)||"-"!==e.charAt(t))throw new Error("Illegal attachments");r.attachments=Number(s)}if("/"===e.charAt(t+1)){const n=t+1;for(;++t&&","!==e.charAt(t)&&t!==e.length;);r.nsp=e.substring(n,t)}else r.nsp="/";const n=e.charAt(t+1);if(""!==n&&Number(n)==n){const n=t+1;for(;++t;){const r=e.charAt(t);if(null==r||Number(r)!=r){--t;break}if(t===e.length)break}r.id=Number(e.substring(n,t+1))}if(e.charAt(++t)){const n=this.tryParse(e.substr(t));if(!Te.isPayloadValid(r.type,n))throw new Error("invalid payload");r.data=n}return r}tryParse(e){try{return JSON.parse(e,this.reviver)}catch(t){return!1}}static isPayloadValid(e,t){switch(e){case Se.CONNECT:return Ee(t);case Se.DISCONNECT:return void 0===t;case Se.CONNECT_ERROR:return"string"==typeof t||Ee(t);case Se.EVENT:case Se.BINARY_EVENT:return Array.isArray(t)&&("number"==typeof t[0]||"string"==typeof t[0]&&-1===be.indexOf(t[0]));case Se.ACK:case Se.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class Ce{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const e=_e(this.reconPack,this.buffers);return this.finishedReconstruction(),e}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}function Pe(e,t,r){return e.on(t,r),function(){e.off(t,r)}}const Oe=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class xe extends I{constructor(e,t,r){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,r&&r.auth&&(this.auth=r.auth),this._opts=Object.assign({},r),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[Pe(e,"open",this.onopen.bind(this)),Pe(e,"packet",this.onpacket.bind(this)),Pe(e,"error",this.onerror.bind(this)),Pe(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){var r,n,s;if(Oe.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;const i={type:Se.EVENT,data:t,options:{}};if(i.options.compress=!1!==this.flags.compress,"function"==typeof t[t.length-1]){const e=this.ids++,r=t.pop();this._registerAckCallback(e,r),i.id=e}const a=null===(n=null===(r=this.io.engine)||void 0===r?void 0:r.transport)||void 0===n?void 0:n.writable,o=this.connected&&!(null===(s=this.io.engine)||void 0===s?void 0:s._hasPingExpired());return this.flags.volatile&&!a||(o?(this.notifyOutgoingListeners(i),this.packet(i)):this.sendBuffer.push(i)),this.flags={},this}_registerAckCallback(e,t){var r;const n=null!==(r=this.flags.timeout)&&void 0!==r?r:this._opts.ackTimeout;if(void 0===n)return void(this.acks[e]=t);const s=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let t=0;t<this.sendBuffer.length;t++)this.sendBuffer[t].id===e&&this.sendBuffer.splice(t,1);t.call(this,new Error("operation has timed out"))},n),i=(...e)=>{this.io.clearTimeoutFn(s),t.apply(this,e)};i.withError=!0,this.acks[e]=i}emitWithAck(e,...t){return new Promise((r,n)=>{const s=(e,t)=>e?n(e):r(t);s.withError=!0,t.push(s),this.emit(e,...t)})}_addToQueue(e){let t;"function"==typeof e[e.length-1]&&(t=e.pop());const r={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((e,...n)=>{if(r===this._queue[0])return null!==e?r.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(e)):(this._queue.shift(),t&&t(null,...n)),r.pending=!1,this._drainQueue()}),this._queue.push(r),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||0===this._queue.length)return;const t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){"function"==typeof this.auth?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:Se.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(e=>{if(!this.sendBuffer.some(t=>String(t.id)===e)){const t=this.acks[e];delete this.acks[e],t.withError&&t.call(this,new Error("socket has been disconnected"))}})}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case Se.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case Se.EVENT:case Se.BINARY_EVENT:this.onevent(e);break;case Se.ACK:case Se.BINARY_ACK:this.onack(e);break;case Se.DISCONNECT:this.ondisconnect();break;case Se.CONNECT_ERROR:this.destroy();const t=new Error(e.data.message);t.data=e.data.data,this.emitReserved("connect_error",t)}}onevent(e){const t=e.data||[];null!=e.id&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const r of t)r.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&"string"==typeof e[e.length-1]&&(this._lastOffset=e[e.length-1])}ack(e){const t=this;let r=!1;return function(...n){r||(r=!0,t.packet({type:Se.ACK,id:e,data:n}))}}onack(e){const t=this.acks[e.id];"function"==typeof t&&(delete this.acks[e.id],t.withError&&e.data.unshift(null),t.apply(this,e.data))}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:Se.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const r of t)r.apply(this,e.data)}}}function De(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}De.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),r=Math.floor(t*this.jitter*e);e=1&Math.floor(10*t)?e+r:e-r}return 0|Math.min(e,this.max)},De.prototype.reset=function(){this.attempts=0},De.prototype.setMin=function(e){this.ms=e},De.prototype.setMax=function(e){this.max=e},De.prototype.setJitter=function(e){this.jitter=e};class Ie extends I{constructor(e,t){var r;super(),this.nsps={},this.subs=[],e&&"object"==typeof e&&(t=e,e=void 0),(t=t||{}).path=t.path||"/socket.io",this.opts=t,B(this,t),this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(null!==(r=t.randomizationFactor)&&void 0!==r?r:.5),this.backoff=new De({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this._readyState="closed",this.uri=e;const s=t.parser||n;this.encoder=new s.Encoder,this.decoder=new s.Decoder,this._autoConnect=!1!==t.autoConnect,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,e||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(e){return void 0===e?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return void 0===e?this._reconnectionDelay:(this._reconnectionDelay=e,null===(t=this.backoff)||void 0===t||t.setMin(e),this)}randomizationFactor(e){var t;return void 0===e?this._randomizationFactor:(this._randomizationFactor=e,null===(t=this.backoff)||void 0===t||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return void 0===e?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,null===(t=this.backoff)||void 0===t||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new de(this.uri,this.opts);const t=this.engine,r=this;this._readyState="opening",this.skipReconnect=!1;const n=Pe(t,"open",function(){r.onopen(),e&&e()}),s=t=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",t),e?e(t):this.maybeReconnectOnOpen()},i=Pe(t,"error",s);if(!1!==this._timeout){const e=this._timeout,r=this.setTimeoutFn(()=>{n(),s(new Error("timeout")),t.close()},e);this.opts.autoUnref&&r.unref(),this.subs.push(()=>{this.clearTimeoutFn(r)})}return this.subs.push(n),this.subs.push(i),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(Pe(e,"ping",this.onping.bind(this)),Pe(e,"data",this.ondata.bind(this)),Pe(e,"error",this.onerror.bind(this)),Pe(e,"close",this.onclose.bind(this)),Pe(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(t){this.onclose("parse error",t)}}ondecoded(e){A(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let r=this.nsps[e];return r?this._autoConnect&&!r.active&&r.connect():(r=new xe(this,e,t),this.nsps[e]=r),r}_destroy(e){const t=Object.keys(this.nsps);for(const r of t)if(this.nsps[r].active)return;this._close()}_packet(e){const t=this.encoder.encode(e);for(let r=0;r<t.length;r++)this.engine.write(t[r],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(e,t){var r;this.cleanup(),null===(r=this.engine)||void 0===r||r.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const r=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),e.skipReconnect||e.open(t=>{t?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",t)):e.onreconnect()}))},t);this.opts.autoUnref&&r.unref(),this.subs.push(()=>{this.clearTimeoutFn(r)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const Ae={};function Me(e,t){"object"==typeof e&&(t=e,e=void 0);const r=function(e,t="",r){let n=e;r=r||"undefined"!=typeof location&&location,null==e&&(e=r.protocol+"//"+r.host),"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?r.protocol+e:r.host+e),/^(https?|wss?):\/\//.test(e)||(e=void 0!==r?r.protocol+"//"+e:"https://"+e),n=se(e)),n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";const s=-1!==n.host.indexOf(":")?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+s+":"+n.port+t,n.href=n.protocol+"://"+s+(r&&r.port===n.port?"":":"+n.port),n}(e,(t=t||{}).path||"/socket.io"),n=r.source,s=r.id,i=r.path,a=Ae[s]&&i in Ae[s].nsps;let o;return t.forceNew||t["force new connection"]||!1===t.multiplex||a?o=new Ie(n,t):(Ae[s]||(Ae[s]=new Ie(n,t)),o=Ae[s]),r.query&&!t.query&&(t.query=r.queryKey),o.socket(r.path,t)}Object.assign(Me,{Manager:Ie,Socket:xe,io:Me,connect:Me});var Le=r(76),Ne=r(7833),je=r.n(Ne),Be="mediasoup-demo",Ue=(0,d.A)(function e(t){(0,c.A)(this,e),t?(this._debug=je()("".concat(Be,":").concat(t)),this._warn=je()("".concat(Be,":WARN:").concat(t)),this._error=je()("".concat(Be,":ERROR:").concat(t))):(this._debug=je()(Be),this._warn=je()("".concat(Be,":WARN")),this._error=je()("".concat(Be,":ERROR"))),je().disable(),this._debug.log=function(){}.bind(),this._warn.log=function(){}.bind(),this._error.log=function(){}.bind()},[{key:"debug",get:function(){return this._debug}},{key:"warn",get:function(){return this._warn}},{key:"error",get:function(){return this._error}}]);function Fe(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function qe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Fe(Object(r),!0).forEach(function(t){(0,u.A)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Fe(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var We=r(1396),Ve=We.enc.Latin1.parse("6gf9Oz5Y(6fOWPP@3XPv0Mwp51yfJ0HiZW^0*!9NdUuZ*VdKmRC@f))&^!Iriw)q"),He=We.enc.Latin1.parse("BHrabik^$W^y*HL@A*$4YKj(");function ze(e){return Ke.apply(this,arguments)}function Ke(){return Ke=(0,o.A)(p().mark(function e(t){var r,n,s,i,a,c,d,u,l,h,m,f,g,v,_,y,b;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.roomId,n=t.secret,s=t.signalingBaseUrl,i="call-api.videosdk.live",a=[],c=null,d={},u={},l={},h=null,m=null,f=null,e.next=1,fetch("https://".concat(s,"/infra/v1/meetings/init-config"),{method:"POST",headers:{Authorization:n,"Content-Type":"application/json"},body:JSON.stringify({roomId:r})}).then(function(){var e=(0,o.A)(p().mark(function e(t){var r;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,t.json();case 1:return r=e.sent,e.abrupt("return",qe({success:200==t.status},r));case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()).catch(function(e){return{success:!1}});case 1:if(g=e.sent,v=g.data,_=g.success,y=g.error,_){e.next=2;break}throw Error(null!=y?y:"Error getting server configurations");case 2:return v&&(i=v.baseUrl,b=v.observability,a=Ge(v.iceServers),c=b.jwt,d=b.traces,u=b.logs,l=b.metaData,h=v.signalingUrl,f=v.socketPath,m=v.socketUrl),e.abrupt("return",{baseUrl:i,iceServers:a,observabilityJwt:c,traces:d,logs:u,metaData:l,signalingUrl:h,socketPath:f,socketUrl:m});case 3:case"end":return e.stop()}},e)})),Ke.apply(this,arguments)}function Ge(e){try{var t=We.AES.decrypt(e,Ve,{iv:He,mode:We.mode.CBC,padding:We.pad.ZeroPadding}).toString(We.enc.Utf8);return JSON.parse(t)}catch(r){return[]}}var $e=r(2215),Je=r.n($e);function Qe(e){var t=e.displayName;Je().set("mediasoup-demo.user",{displayName:t})}function Ye(){return Je().getJSON("mediasoup-demo.devices")}var Xe=r(2211),Ze=r.n(Xe),et=function(e){return{type:"SET_ROOM_STATE",payload:{state:e}}},tt=function(e){return{type:"SET_ROOM_ACTIVE_SPEAKER",payload:{peerId:e}}},rt=function(e){return{type:"SET_ROOM_STATS_PEER_ID",payload:{peerId:e}}},nt=function(e){return{type:"SET_MEDIA_CAPABILITIES",payload:{canSendMic:e.canSendMic,canSendWebcam:e.canSendWebcam}}},st=function(e){return{type:"SET_CAN_CHANGE_WEBCAM",payload:e}},it=function(e){return{type:"SET_DISPLAY_NAME",payload:{displayName:e}}},at=function(e){return{type:"SET_AUDIO_ONLY_STATE",payload:{enabled:e}}},ot=function(e){return{type:"SET_AUDIO_ONLY_IN_PROGRESS",payload:{flag:e}}},ct=function(e){return{type:"SET_AUDIO_MUTED_STATE",payload:{enabled:e}}},dt=function(e){return{type:"SET_RESTART_ICE_IN_PROGRESS",payload:{flag:e}}},ut=function(e){return{type:"ADD_PRODUCER",payload:{producer:e}}},lt=function(e){return{type:"REMOVE_PRODUCER",payload:{producerId:e}}},pt=function(e){return{type:"SET_PRODUCER_PAUSED",payload:{producerId:e}}},ht=function(e){return{type:"SET_PRODUCER_RESUMED",payload:{producerId:e}}},mt=function(e,t){return{type:"SET_PRODUCER_TRACK",payload:{producerId:e,track:t}}},ft=function(e,t){return{type:"SET_PRODUCER_SCORE",payload:{producerId:e,score:t}}},gt=function(e){return{type:"ADD_DATA_PRODUCER",payload:{dataProducer:e}}},vt=function(e){return{type:"SET_WEBCAM_IN_PROGRESS",payload:{flag:e}}},_t=function(e){return{type:"SET_SHARE_IN_PROGRESS",payload:{flag:e}}},yt=function(e){return{type:"ADD_PEER",payload:{peer:e}}},bt=function(e){return{type:"REMOVE_PEER",payload:{peerId:e}}},wt=function(e,t){return{type:"SET_PEER_DISPLAY_NAME",payload:{displayName:e,peerId:t}}},St=function(e,t){return{type:"ADD_CONSUMER",payload:{consumer:e,peerId:t}}},Rt=function(e,t){return{type:"REMOVE_CONSUMER",payload:{consumerId:e,peerId:t}}},kt=function(e,t){return{type:"SET_CONSUMER_PAUSED",payload:{consumerId:e,originator:t}}},Et=function(e,t){return{type:"SET_CONSUMER_RESUMED",payload:{consumerId:e,originator:t}}},Tt=function(e,t,r){return{type:"SET_CONSUMER_CURRENT_LAYERS",payload:{consumerId:e,spatialLayer:t,temporalLayer:r}}},Ct=function(e,t,r){return{type:"SET_CONSUMER_PREFERRED_LAYERS",payload:{consumerId:e,spatialLayer:t,temporalLayer:r}}},Pt=function(e,t){return{type:"SET_CONSUMER_PRIORITY",payload:{consumerId:e,priority:t}}},Ot=function(e,t){return{type:"SET_CONSUMER_SCORE",payload:{consumerId:e,score:t}}},xt=function(e,t){return{type:"ADD_DATA_CONSUMER",payload:{dataConsumer:e,peerId:t}}},Dt=function(e,t){return{type:"REMOVE_DATA_CONSUMER",payload:{dataConsumerId:e,peerId:t}}},It=function(){return{type:"REMOVE_ALL_NOTIFICATIONS"}},At=function(e){var t=e.type,r=void 0===t?"info":t,n=e.text,s=e.title,i=e.timeout;if(!i)switch(r){case"info":i=3e3;break;case"error":i=5e3}var a={id:Ze()({length:6}).toLowerCase(),type:r,title:s,text:n,timeout:i};return function(e){e(function(e){return{type:"ADD_NOTIFICATION",payload:{notification:e}}}(a)),setTimeout(function(){e({type:"REMOVE_NOTIFICATION",payload:{notificationId:a.id}})},i)}},Mt=r(7007),Lt=r(1803),Nt=r(9027),jt=r(7080),Bt="CONNECTED",Ut=r(5414),Ft=r(2107),qt=r(5071),Wt=Array(32);function Vt(){for(var e=0;e<16;e++)Wt[e]=Math.floor(16*Math.random())+48,Wt[e]>=58&&(Wt[e]+=39);return String.fromCharCode.apply(null,Wt.slice(0,16))}function Ht(){var e=(1e6*(new Date).getTime()).toString().padEnd(19,"0");return Number(e)}function zt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function Kt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?zt(Object(r),!0).forEach(function(t){(0,u.A)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):zt(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var Gt=(0,d.A)(function e(t){var r=this,n=t.roomId,s=t.peerId,i=t.sdkName,a=t.observabilityJwt,o=t.metaData,d=t.traces;(0,c.A)(this,e),this._traceId=function(){for(var e=0;e<32;e++)Wt[e]=Math.floor(16*Math.random())+48,Wt[e]>=58&&(Wt[e]+=39);return String.fromCharCode.apply(null,Wt.slice(0,32))}(),this._rootSpanId=Vt(),this._observabilityJwt=a,this._tracesEnabled=d.enabled,this._tracesEndpoint=d.endPoint;var u=function(){for(var e="",t=8;t>0;t--)e+="0123456789abcdefghijklmnopqrstuvwxyz"[Math.floor(36*Math.random())];return e}();this._spans=[],this._traceJSON={resourceSpans:[{resource:{attributes:[{key:"service.name",value:{stringValue:"videosdk-otel"}},{key:"telemetry.sdk.language",value:{stringValue:"webjs"}},{key:"telemetry.sdk.name",value:{stringValue:"opentelemetry"}},{key:"telemetry.sdk.version",value:{stringValue:"1.14.0"}},{key:"sdk-version",value:{stringValue:"0.2.14"}}],droppedAttributesCount:0},scopeSpans:[{scope:{name:u},spans:[]}]}]},this._tracesEnabled&&(this.addRootSpan(n,s,i,o),setInterval(function(){r.processQueue()},4e3))},[{key:"addRootSpan",value:function(e,t,r,n){var s={traceId:this._traceId,spanId:this._rootSpanId,name:"room_".concat(e,"_peer_").concat(t,"_sdk_").concat(r),kind:1,startTimeUnixNano:Ht(),endTimeUnixNano:Ht(),attributes:[{key:"roomId",value:{stringValue:e}},{key:"peerId",value:{stringValue:t}},{key:"sdkName",value:{stringValue:r}},{key:"userId",value:{stringValue:n.userId}},{key:"email",value:{stringValue:n.email}}],droppedAttributesCount:0,events:[],droppedEventsCount:0,status:{code:0},links:[],droppedLinksCount:0};this._spans.push(s)}},{key:"addSpanToTrace",value:function(e){this._spans.push(e)}},{key:"trace",value:function(e){var t=e.spanName,r=e.attributes,n=void 0===r?{}:r,i=e.span,a=void 0===i?void 0:i;if(this._tracesEnabled){var o=Vt(),c=Ht(),d={traceId:this._traceId,spanId:o,parentSpanId:a||this._rootSpanId,name:t,kind:1,startTimeUnixNano:c,droppedAttributesCount:0,events:[],droppedEventsCount:0,links:[],droppedLinksCount:0};return Object.keys(n).length>0&&(d.attributes=Object.entries(n).map(function(e){var t=(0,s.A)(e,2);return{key:t[0],value:{stringValue:t[1]}}})),this.addSpanToTrace(d),o}}},{key:"traceAutoComplete",value:function(e){var t=e.spanName,r=e.attributes,n=void 0===r?{}:r,i=e.status,a=void 0===i?1:i,o=e.span,c=void 0===o?void 0:o,d=e.message,u=void 0===d?"SUCCESS":d;if(this._tracesEnabled){var l=Vt(),p=Ht(),h=Ht(),m={traceId:this._traceId,spanId:l,parentSpanId:c||this._rootSpanId,name:t,kind:1,startTimeUnixNano:p,endTimeUnixNano:h,droppedAttributesCount:0,events:[],droppedEventsCount:0,links:[],droppedLinksCount:0,status:{code:a,message:u}};Object.keys(n).length>0&&(m.attributes=Object.entries(n).map(function(e){var t=(0,s.A)(e,2);return{key:t[0],value:{stringValue:t[1]}}})),this.addSpanToTrace(m)}}},{key:"completeSpan",value:function(e){var t=e.span,r=e.status,n=e.message,a=e.attributes,o=void 0===a?{}:a;if(this._tracesEnabled){var c=Ht();this._spans=this._spans.map(function(e){if(e.spanId!==t)return e;var a=Object.entries(o).map(function(e){var t=(0,s.A)(e,2);return{key:t[0],value:{stringValue:t[1]}}});return e.attributes=e.attributes?[].concat((0,i.A)(e.attributes),(0,i.A)(a)):a,Kt(Kt({},e),{},{status:{code:r,message:n},endTimeUnixNano:c})})}}},{key:"processQueue",value:function(){var e,t=this;if(this._spans.length>0){this._traceJSON.resourceSpans[0].scopeSpans[0].spans=this._spans,this._spans=[];var r={method:"POST",headers:{Authorization:this._observabilityJwt,"Content-Type":"application/json"},body:JSON.stringify(this._traceJSON)};fetch(this._tracesEndpoint,r).then((e=(0,o.A)(p().mark(function e(r){return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t._traceJSON.resourceSpans[0].scopeSpans[0].spans=[],e.next=1,r.text();case 1:return e.abrupt("return",e.sent);case 2:case"end":return e.stop()}},e)})),function(t){return e.apply(this,arguments)})).then(function(e){}).catch(function(e){t._spans=t._traceJSON.resourceSpans[0].scopeSpans[0].spans})}}}]);function $t(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function Jt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?$t(Object(r),!0).forEach(function(t){(0,u.A)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$t(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var Qt=function(){return(0,d.A)(function e(t){var r=t.roomId,n=t.peerId,s=t.logs,i=t.observabilityJwt,a=t.deviceInfo,o=t.sessionId,d=t.debugMode;(0,c.A)(this,e);var u=a.browserUserAgent,l=a.deviceUserAgent,p=a.platform;this._peerId=n,this._roomId=r,this._logs=s,this._observabilityJwt=i,this._deviceInfo=a,this._sessionId=o,this._debugMode=d,this.browserOrDeviceInfo=u?{browserName:u.browser.name,browserVersion:u.browser.version,osName:u.os.name,osVersion:u.os.version,platform:p}:l?Jt({platform:p},l):null},[{key:"pushLogs",value:(e=(0,o.A)(p().mark(function e(t){var r,n,s,i,a,o,c,d;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.logType,n=t.logText,s=t.attributes,i=t.dashboardLog,a=void 0!==i&&i,o=this._logs,c=o.enabled,d=o.endPoint,!c){e.next=2;break}return e.next=1,fetch(d,{method:"POST",headers:{Authorization:this._observabilityJwt,"Content-Type":"application/json"},body:JSON.stringify({logType:r,logText:n,attributes:Jt(Jt({},s),{},{roomId:this._roomId,peerId:this._peerId,SDK:"".concat(this._deviceInfo.sdkType,"-sdk"),SDK_VERSION:this._deviceInfo.sdkVersion,sessionId:this._sessionId},this.browserOrDeviceInfo),debugMode:this._debugMode,dashboardLog:a})}).then(function(e){return e.json()}).catch(function(e){return{}});case 1:return e.abrupt("return",e.sent);case 2:return e.abrupt("return",null);case 3:case"end":return e.stop()}},e,this)})),function(t){return e.apply(this,arguments)})}]);var e}(),Yt=r(4973),Xt=r(388),Zt=r(3954),er=r(5501),tr=r(3662);function rr(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(rr=function(){return!!e})()}function nr(e){var t="function"==typeof Map?new Map:void 0;return nr=function(e){if(null===e||!function(e){try{return-1!==Function.toString.call(e).indexOf("[native code]")}catch(t){return"function"==typeof e}}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return function(e,t,r){if(rr())return Reflect.construct.apply(null,arguments);var n=[null];n.push.apply(n,t);var s=new(e.bind.apply(e,n));return r&&(0,tr.A)(s,r.prototype),s}(e,arguments,(0,Zt.A)(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),(0,tr.A)(r,e)},nr(e)}function sr(e,t,r){return t=(0,Zt.A)(t),(0,Xt.A)(e,ir()?Reflect.construct(t,r||[],(0,Zt.A)(e).constructor):t.apply(e,r))}function ir(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(ir=function(){return!!e})()}var ar,or=function(e){function t(e,r){var n;return(0,c.A)(this,t),n=sr(this,t,[r||"an error has occured"]),(0,u.A)(n,"code",void 0),n.name="VideoSdkError",n.code=e,n}return(0,er.A)(t,e),(0,d.A)(t)}(nr(Error));!function(e){e[e.InvalidKey=0]="InvalidKey",e[e.MissingKey=1]="MissingKey",e[e.InternalError=2]="InternalError"}(ar||(ar={}));var cr=function(e){function t(e){var r;return(0,c.A)(this,t),(r=sr(this,t,[21,null!=e?e:"device is unsupported"])).name="DeviceUnsupportedError",r}return(0,er.A)(t,e),(0,d.A)(t)}(or),dr=r(1806),ur=r(6746),lr=r(8278);function pr(e,t){return e?"audio"==t?"shareAudio":"share":t}function hr(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function mr(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(mr=function(){return!!e})()}var fr=function(e){function t(e){var r,n,s;return(0,c.A)(this,t),n=this,s=t,s=(0,Zt.A)(s),(r=(0,Xt.A)(n,mr()?Reflect.construct(s,[],(0,Zt.A)(n).constructor):s.apply(n,void 0))).onWorkerMessage=function(e){var t,n=e.data,s=n.kind,i=n.data;switch(s){case"error":r.emit(ur.KS.EncryptionError,i.error);break;case"initAck":i.enabled&&r.keyProvider.getKeys().forEach(function(e){r.postKey(e)});break;case"enable":if(i.enabled&&r.keyProvider.getKeys().forEach(function(e){r.postKey(e)}),r.encryptionEnabled!==i.enabled&&i.participantIdentity===r.room._peerId)r.emit(ur.KS.ParticipantEncryptionStatusChanged,i.enabled,r.room.localParticipant),r.encryptionEnabled=i.enabled;else if(i.participantIdentity){var a=null===(t=r.room)||void 0===t?void 0:t.getParticipantByIdentity(i.participantIdentity);if(!a)throw TypeError("couldn't set encryption status, participant not found".concat(i.participantIdentity));r.emit(ur.KS.ParticipantEncryptionStatusChanged,i.enabled,a)}break;case"ratchetKey":r.keyProvider.emit(ur.fo.KeyRatcheted,i.material,i.keyIndex);break;case"e2eeStateChange":r.emit(ur.KS.E2EEStateChange,i)}},r.onWorkerError=function(e){},r.keyProvider=e.keyProvider,r.worker=e.worker,r.encryptionEnabled=!1,r}return(0,er.A)(t,e),(0,d.A)(t,[{key:"setup",value:function(e){if(!(0,lr.Ag)())throw new cr("tried to setup end-to-end encryption on an unsupported browser");if(e!==this.room){this.room=e,this.setupEventListeners(e,this.keyProvider),this.handleE2EEManagerEvents();var t={kind:"init",data:{keyProviderOptions:this.keyProvider.getOptions()}};this.worker&&(this.worker.onmessage=this.onWorkerMessage,this.worker.onerror=this.onWorkerError,this.worker.postMessage(t))}}},{key:"setParticipantCryptorEnabled",value:function(e,t){this.postEnable(e,t)}},{key:"setSifTrailer",value:function(e){e&&0!==e.length&&this.postSifTrailer(e)}},{key:"setupEventListeners",value:function(e,t){var r=this;t.on(ur.fo.SetKey,function(e){r.postKey(e)}).on(ur.fo.RatchetRequest,function(e,t){return r.postRatchetRequest(e,t)})}},{key:"postRatchetRequest",value:function(e,t){if(!this.worker)throw Error("could not ratchet key, worker is missing");var r={kind:"ratchetRequest",data:{participantIdentity:e,keyIndex:t}};this.worker.postMessage(r)}},{key:"postKey",value:function(e){var t=e.key,r=e.participantIdentity,n=e.keyIndex;if(!this.worker)throw Error("could not set key, worker is missing");var s={kind:"setKey",data:{participantIdentity:r,isPublisher:r===this.room._peerId,key:t,keyIndex:n}};this.worker.postMessage(s)}},{key:"postEnable",value:function(e,t){if(!this.worker)throw new ReferenceError("failed to enable e2ee, worker is not ready");var r={kind:"enable",data:{enabled:e,participantIdentity:t}};this.worker.postMessage(r)}},{key:"postRTPMap",value:function(e){var t;if(!this.worker)throw TypeError("could not post rtp map, worker is missing");if(!(null===(t=this.room)||void 0===t?void 0:t._peerId))throw TypeError("could not post rtp map, local participant identity is missing");var r={kind:"setRTPMap",data:{map:e,participantIdentity:this.room._peerId}};this.worker.postMessage(r)}},{key:"postSifTrailer",value:function(e){if(!this.worker)throw Error("could not post SIF trailer, worker is missing");var t={kind:"setSifTrailer",data:{trailer:e}};this.worker.postMessage(t)}},{key:"setupE2EEReceiver",value:function(e,t){var r;this.handleReceiver(e,e.rtpReceiver,e.track.id,t,this.extractCodec(e.rtpParameters.codecs),pr(null===(r=e.appData)||void 0===r?void 0:r.share,e.kind))}},{key:"setupE2EESender",value:function(e){var t;e&&this.handleSender(e.rtpSender,e.track.id,this.extractCodec(e.rtpParameters.codecs),pr(null===(t=e.appData)||void 0===t?void 0:t.share,e.kind),this.room._peerId)}},{key:"handleReceiver",value:(r=(0,o.A)(p().mark(function e(t,r,n,s,i,a){var o,c,d,u,l,h;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.worker){e.next=1;break}return e.abrupt("return");case 1:if(!(0,lr.Wm)()){e.next=2;break}o={kind:"decode",participantIdentity:s,trackId:t.track.id,codec:i},r.transform=new RTCRtpScriptTransform(this.worker,o),e.next=5;break;case 2:if(!(dr.$Q in r)||!i){e.next=3;break}return d={kind:"updateCodec",data:{trackId:n,codec:i,participantIdentity:s}},this.worker.postMessage(d),e.abrupt("return");case 3:if(u=r.writableStream,l=r.readableStream,u&&l){e.next=4;break}return e.abrupt("return");case 4:h={kind:"decode",data:{readableStream:l,writableStream:u,trackId:n,codec:i,participantIdentity:s,mediaKind:a,peerId:null===(c=t.appData)||void 0===c?void 0:c.peerId}},this.worker.postMessage(h,[l,u]);case 5:r[dr.$Q]=!0;case 6:case"end":return e.stop()}},e,this)})),function(e,t,n,s,i,a){return r.apply(this,arguments)})},{key:"handleSender",value:function(e,t,r,n,s){var i;if(!(dr.$Q in e)&&this.worker){if(!(null===(i=this.room)||void 0===i?void 0:i._peerId)||""===this.room._peerId)throw TypeError("local identity needs to be known in order to set up encrypted sender");if((0,lr.Wm)()){var a={kind:"encode",participantIdentity:this.room._peerId,trackId:t,codec:r,mediaKind:n,peerId:s};e.transform=new RTCRtpScriptTransform(this.worker,a)}else try{var o=e.senderStreams;if(o){var c={kind:"encode",data:{readableStream:o.readable,writableStream:o.writable,codec:r,trackId:t,participantIdentity:this.room._peerId,mediaKind:n,peerId:s}};this.worker.postMessage(c,[o.readable,o.writable])}}catch(d){}e[dr.$Q]=!0}}},{key:"handleE2EEManagerEvents",value:function(){var e=this;this.on("NEW_CONSUMER",function(t){var r=t.consumer,n=t.peerId;e.setupE2EEReceiver(r,n)}),this.on("NEW_PRODUCER",function(t){e.setupE2EESender(t)})}},{key:"extractCodec",value:function(e){var t,r=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return hr(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?hr(e,t):void 0}}(e))||t){r&&(e=r);var n=0,s=function(){};return{s:s,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,o=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){o=!0,i=e},f:function(){try{a||null==r.return||r.return()}finally{if(o)throw i}}}}(e);try{for(r.s();!(t=r.n()).done;){var n=t.value,s=n.mimeType.split("/")[1].toLowerCase();if("audio"===this.kind){if(dr.Ts.includes(s)){n=s;break}}else if(dr.ue.includes(s)){n=s;break}}}catch(i){r.e(i)}finally{r.f()}return""}}]);var r}(Mt.EventEmitter);function gr(){return vr.apply(this,arguments)}function vr(){return(vr=(0,o.A)(p().mark(function e(){var t,r,n,s;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,fetch("https://cdn.videosdk.live/e2ee/0.0.1/bundle.js");case 1:if((t=e.sent).ok){e.next=2;break}throw new Error("Failed to load worker script: ".concat(t.statusText));case 2:return e.next=3,t.text();case 3:return r=e.sent,n=new Blob([r],{type:"application/javascript"}),s=URL.createObjectURL(n),e.abrupt("return",new Worker(s));case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}var _r=r(9633);function yr(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function br(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?yr(Object(r),!0).forEach(function(t){(0,u.A)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):yr(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function wr(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return Sr(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Sr(e,t):void 0}}(e))||t){r&&(e=r);var n=0,s=function(){};return{s:s,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,o=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){o=!0,i=e},f:function(){try{a||null==r.return||r.return()}finally{if(o)throw i}}}}function Sr(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var Rr,kr={sd:{low:{s:0,t:2},med:{s:0,t:2},high:{s:1,t:2},s0t0:{s:0,t:0},s0t1:{s:0,t:1},s0t2:{s:0,t:2},s1t0:{s:1,t:0},s1t1:{s:1,t:1},s1t2:{s:1,t:2},s2t0:{s:2,t:0},s2t1:{s:2,t:1},s2t2:{s:2,t:2}},hd:{low:{s:0,t:2},med:{s:1,t:2},high:{s:2,t:2},s0t0:{s:0,t:0},s0t1:{s:0,t:1},s0t2:{s:0,t:2},s1t0:{s:1,t:0},s1t1:{s:1,t:1},s1t2:{s:1,t:2},s2t0:{s:2,t:0},s2t1:{s:2,t:1},s2t2:{s:2,t:2}}},Er={qvga:{width:{ideal:320},height:{ideal:240}},vga:{width:{ideal:640},height:{ideal:480}},sd:{width:{ideal:1280},height:{ideal:720},frameRate:{ideal:24}},hd:{width:{ideal:1280},height:{ideal:720},frameRate:{ideal:24}}},Tr={sd:[{scaleResolutionDownBy:6},{scaleResolutionDownBy:4},{scaleResolutionDownBy:2}],hd:[{scaleResolutionDownBy:4},{scaleResolutionDownBy:2},{scaleResolutionDownBy:1}]},Cr=[{scalabilityMode:"S3T3_KEY"}],Pr=[{dtx:!0,maxFramerate:30}],Or=new Ue("RoomClient"),xr=new WeakSet,Dr=function(){return(0,d.A)(function e(t){var r,n,s=t.roomId,i=t.peerId,a=t.secret,o=t.displayName,d=t.device,l=t.handlerName,p=t.useSimulcast,h=t.forceTcp,m=t.mode,f=t.forceH264,g=t.forceVP9,v=t.svc,_=t.datachannel,y=t.externalVideo,b=t.micEnabled,w=t.webcamEnabled,S=t.maxResolution,R=t.useSpartialLayerAnalytics,k=t._deviceInfo,E=t.customCameraVideoTrack,T=t.customMicrophoneAudioTrack,C=t.autoConsume,P=t.preferredProtocol,O=t.signalingBaseUrl,x=t.metaData,D=t.defaultCameraIndex,I=t.debugMode,A=t.keyProvider;switch((0,c.A)(this,e),function(e,t){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.add(e)}(this,xr),(0,u.A)(this,"e2eeManager",null),Or.debug('constructor() [roomId:"%s", peerId:"%s", displayName:"%s", device:%s]',s,i,o,d.flag),this.useSpartialLayerAnalytics=R||!1,this._deviceInfo=k,this._eventEmitter=new Mt.EventEmitter,this._closed=!1,this._displayName=o,this._device=d,this._forceTcp=h,this._preferredProtocol=P,m){case Ft.nI.CONFERENCE:case Ft.nI.SEND_AND_RECV:r=!0,n=!0;break;case Ft.nI.RECV_ONLY:r=!1,n=!0;break;default:r=!1,n=!1}if(this._mode=m,this._produce=r,this._consume=n,this._useDataChannel=_,this._forceH264=Boolean(f),this._forceVP9=Boolean(g),this._micEnabled=Boolean(b),this._webcamEnabled=Boolean(w),this._externalVideo=null,this._externalVideoStream=null,this._nextDataChannelTestNumber=0,y&&(this._externalVideo=document.createElement("video"),this._externalVideo.controls=!0,this._externalVideo.loop=!0,this._externalVideo.setAttribute("playsinline",""),this._externalVideo.src=y,this._externalVideo.play().catch(function(e){return Or.warn("externalVideo.play() failed:%o",e)})),this._handlerName=l,this._useSimulcast=p,this._socketUrl="",this._secret=a,this._peerId=i,this._roomId=s,this._baseUrl="",this._webSocket=null,this._mediasoupDevice=null,this._sendTransport=null,this._recvTransport=null,this._micProducer=null,this._webcamProducer=null,this._shareProducer=null,this._shareAudioProducer=null,this._chatDataProducer=null,this._botDataProducer=null,this._consumers=new Map,this._dataConsumers=new Map,this._mics=new Map,this._mic={device:null},this._webcams=new Map,this._webcam={device:null,resolution:S||"hd"},this._pinnedParticipants=new Map,v&&(Cr[0].scalabilityMode="".concat(v,"_KEY")),this.customCameraVideoTrack=E,this.customMicrophoneAudioTrack=T,this._autoConsume=C,this._iceServers=[],this._metrics=new Ut.VideoSDKMetrics({refreshEvery:1e3,startAfter:1e3,verbose:!1}),this._stats={},this._latestStats={},this._isWebsocketAlive=!1,this._pingWebsocketInterval=null,this._pingInternetInterval=null,this._pingWebsocketFailedCounter=0,this._pongInternetCounter=0,this._transportState="",this._openTelemetry=null,this._videosdkLogs=null,this._signalingBaseUrl=O||"api.videosdk.live",this._metaData=x,this._defaultCameraIndex=D,this._debugMode=Boolean(I),this._meetingConnectionState=null,this._sendTransportInternal=null,A){if(!(A instanceof _r.l))throw new Error("keyProvider should be an instance of ExternalE2EEKeyProvider");(function(e,t,r){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:r;throw new TypeError("Private element is not present on this object")})(xr,this,Ir).call(this,A)}},[{key:"on",value:function(e,t){this._eventEmitter.on(e,t)}},{key:"softClose",value:function(){var e,t=null===(e=this._openTelemetry)||void 0===e?void 0:e.trace({name:"softClose() Start "});try{var r,n,s;this._eventEmitter.emit("REMOVE_PARTICIPANTS_FOR_SWITCH_MEETING");var i,a=null===(r=this._openTelemetry)||void 0===r?void 0:r.trace({name:"Consumer Cleanup",parentSpan:t,attributes:{"videosdk.consumers.count":this._consumers.size||0}}),o=wr(this._consumers.values());try{for(o.s();!(i=o.n()).done;)i.value.close()}catch(d){o.e(d)}finally{o.f()}null===(n=this._openTelemetry)||void 0===n||n.completeSpan({span:a,status:1,message:"Closed ".concat(this._consumers.size," consumers successfully")}),null===(s=this._openTelemetry)||void 0===s||s.completeSpan({span:t,status:1,message:"Soft close completed successfully"})}catch(d){var c;null===(c=this._openTelemetry)||void 0===c||c.completeSpan({span:t,status:2,message:"Soft close failed: ".concat(d.message)})}}},{key:"close",value:function(e){var t,r,n,s,i,a,o,c=e.sendLeft,d=void 0===c||c;if(d&&(null===(a=this._openTelemetry)||void 0===a||a.traceAutoComplete({spanName:"Meeting is in CLOSING State",status:1}),null===(o=this._videosdkLogs)||void 0===o||o.pushLogs({logText:"Meeting is in CLOSING State",logType:"INFO"})),!this._closed){this._closed=!0,this._pingWebsocketInterval&&clearInterval(this._pingWebsocketInterval),this._pingWebsocketInterval=null,this._pingInternetInterval&&clearInterval(this._pingInternetInterval),this._pingInternetInterval=null,this._sendTransportInternal&&clearInterval(this._sendTransportInternal),this._sendTransportInternal=null,this._webSocket.close(),this._metrics.running&&this._metrics.stopAllProbes(),Or.debug("close()");var u=null===(t=this._openTelemetry)||void 0===t?void 0:t.trace({spanName:"Closing Trasnport"});this._sendTransport&&this._sendTransport.close(),this._recvTransport&&this._recvTransport.close(),null===(r=this._openTelemetry)||void 0===r||r.completeSpan({span:u,status:1,message:"Closed Trasnport"}),Rr.dispatch(et("closed")),d&&this.emitMeetingStateChange("DISCONNECTED"),null===(n=this._openTelemetry)||void 0===n||n.traceAutoComplete({spanName:"Meeting is in CLOSED State",status:1}),null===(s=this._videosdkLogs)||void 0===s||s.pushLogs({logText:"Meeting is in CLOSED State",logType:"INFO"}),d&&this._eventEmitter.emit("MEETING_LEFT"),null===(i=this._openTelemetry)||void 0===i||i.traceAutoComplete({spanName:"Emitted MEETING_LEFT Event",status:1})}}},{key:"join",value:(pr=(0,o.A)(p().mark(function e(){var t,r,n,s,i,a,c,d,l,h,m,f,g,v,_,y=this;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=1,ze({roomId:this._roomId,secret:this._secret,signalingBaseUrl:this._signalingBaseUrl});case 1:s=e.sent,i=s.baseUrl,a=s.iceServers,c=s.logs,d=s.observabilityJwt,l=s.traces,h=s.metaData,m=s.signalingUrl,f=s.socketPath,g=s.socketUrl,this._baseUrl=i,this._socketUrl="wss://".concat(g||this._baseUrl,"/?roomId=").concat(this._roomId,"&peerId=").concat(this._peerId,"&secret=").concat(this._secret,"&mode=").concat(this._mode,"&lib=socket"),this._iceServers=a,this._tracesEnabled=l.enabled,this._openTelemetry=new Gt((0,u.A)({roomId:this._roomId,peerId:this._peerId,sdkName:"".concat(this._deviceInfo.sdkType,"-sdk"),traces:l,logs:c,observabilityJwt:d,metaData:h},"traces",l)),this._joinSpan=null===(t=this._openTelemetry)||void 0===t?void 0:t.trace({spanName:"Join() Calling",attributes:{DeviceInfo:JSON.stringify(this._deviceInfo),mode:this._mode,displayName:this._displayName,multiStream:this._useSimulcast,micEnabled:this._micEnabled,webcamEnabled:this._webcamEnabled,CustomVideoTrack:!!this.customCameraVideoTrack,CustomMicTrack:!!this.customMicrophoneAudioTrack,signalingUrl:m||"signalingUrl not specify"}}),this._webSocket=Me(this._socketUrl,{transports:["websocket"],reconnectionAttempts:10,reconnectionDelay:5e3,reconnection:!0,path:"".concat(null!=f?f:"","/socket.io")}),this.emitMeetingStateChange("CONNECTING"),Rr.dispatch(et("connecting")),null===(r=this._openTelemetry)||void 0===r||r.traceAutoComplete({spanName:"Meeting is in CONNECTING State",span:this._joinSpan,status:1}),null===(n=this._videosdkLogs)||void 0===n||n.pushLogs({logText:"Meeting is in CONNECTING State",logType:"INFO"}),this._webSocket.on("connect",function(){}),this._webSocket.on("connectionSuccess",function(){var e,t;y._isWebsocketAlive=!0,y._closed=!1,y._mode===(Ft.nI.RECV_ONLY||Ft.nI.SIGNALLING_ONLY)&&y.emitMeetingStateChange(Bt),null===(e=y._openTelemetry)||void 0===e||e.traceAutoComplete({spanName:"Meeting is in CONNECTED State",span:y._joinSpan,status:1}),null===(t=y._videosdkLogs)||void 0===t||t.pushLogs({logText:"Meeting is in CONNECTED State",logType:"INFO"}),y.requestEntry()}),this._webSocket.on("disconnect",function(e){var t,r,n,s,i;null===(t=y._videosdkLogs)||void 0===t||t.pushLogs({logText:"Meeting is in Websocket Disconnect State",logType:"INFO",attributes:{reason:e},dashboardLog:!0}),("transport close"===e||"transport error"===e)&&(y.customMicrophoneAudioTrack&&(null===(r=y.customMicrophoneAudioTrack)||void 0===r||r.getTracks().forEach(function(e){e.stop()}),y.customMicrophoneAudioTrack=null),y.customCameraVideoTrack&&(null===(n=y.customCameraVideoTrack)||void 0===n||n.getTracks().forEach(function(e){e.stop()}),y.customCameraVideoTrack=null),y._sendTransport&&(null===(s=y._sendTransport)||void 0===s||s.close(),y._sendTransport=null),y._recvTransport&&(null===(i=y._recvTransport)||void 0===i||i.close(),y._recvTransport=null))}),this._webSocket.io.on("reconnect_failed",function(){y._closed||y.close({sendLeft:!0})}),this._webSocket.on("connect_error",function(e){var t,r,n,s,i,a;y._webSocket.active&&y._webSocket.io._reconnecting&&(null===(t=y._openTelemetry)||void 0===t||t.traceAutoComplete({spanName:"Meeting is in RECONNECTING State",span:y._joinSpan,status:1}),null===(r=y._videosdkLogs)||void 0===r||r.pushLogs({logText:"Meeting is in RECONNECTING State",logType:"INFO",attributes:{error:e.message}}),Rr.dispatch(At({type:"error",text:"WebSocket Reconnecting"})),y.emitMeetingStateChange("RECONNECTING"),y._sendTransport&&(null===(i=y._sendTransport)||void 0===i||i.close(),y._sendTransport=null),y._recvTransport&&(null===(a=y._recvTransport)||void 0===a||a.close(),y._recvTransport=null),null===(n=y.customMicrophoneAudioTrack)||void 0===n||n.getTracks().forEach(function(e){e.stop()}),y.customMicrophoneAudioTrack=null,null===(s=y.customCameraVideoTrack)||void 0===s||s.getTracks().forEach(function(e){e.stop()}),y.customCameraVideoTrack=null)}),this._webSocket.on("close",function(){y._closed||y.close({sendLeft:!0})}),this._webSocket.on("newConsumer",function(){var e=(0,o.A)(p().mark(function e(t,r){var n,s,i,a,o,c,d,u,l,h,m,f,g,v,_,b,w,S,R,k,E,T,C,P,O,x,D;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=null===(n=y._openTelemetry)||void 0===n?void 0:n.trace({spanName:"Websocket REQ: newConsumer",attributes:{request:JSON.stringify(t)}}),y._consume){e.next=1;break}return r({errorCode:403,message:"I do not want to consume",method:"newConsumer"}),null===(a=y._openTelemetry)||void 0===a||a.completeSpan({span:i,status:2,message:"I do not want to consume"}),e.abrupt("return");case 1:return o=t.peerId,c=t.producerId,d=t.id,u=t.kind,l=t.rtpParameters,h=t.type,m=t.appData,f=t.producerPaused,g=null===(s=y._openTelemetry)||void 0===s?void 0:s.trace({spanName:"Creating Consumer",span:i}),e.prev=2,e.next=3,y._recvTransport.consume({id:d,producerId:c,kind:u,rtpParameters:l,appData:br(br({},m),{},{peerId:o}),onRtpReceiver:function(e){if(y.e2eeManager){var t=e.writableStream,r=e.readableStream;if(!t||!r){var n=e.createEncodedStreams();e.writableStream=n.writable,t=n.writable,e.readableStream=n.readable,r=n.readable}}}});case 3:S=e.sent,R=Le.s$(S.rtpParameters.encodings[0].scalabilityMode),k=R.spatialLayers,E=R.temporalLayers,S.spatialLayers=k,S.temporalLayers=E,S.currentSpatialLayers=k-1,S.currentTemporalLayers=E-1,y._consumers.set(S.id,S),S.on("transportclose",function(){y._consumers.delete(S.id);var e=Rt(S.id,o);Rr.dispatch(e),y._eventEmitter.emit(e.type,e.payload)}),null===(v=y._openTelemetry)||void 0===v||v.completeSpan({span:g,status:1,message:"Consumer Created"}),g=null===(_=y._openTelemetry)||void 0===_?void 0:_.trace({spanName:"Sending Stream Enabled Event",span:i}),T=St({id:S.id,type:h,locallyPaused:!1,remotelyPaused:f,rtpParameters:S.rtpParameters,spatialLayers:k,temporalLayers:E,currentSpatialLayer:k-1,currentTemporalLayer:E-1,preferredSpatialLayer:k-1,preferredTemporalLayer:E-1,priority:1,codec:S.rtpParameters.codecs[0].mimeType.split("/")[1],track:S.track,appData:m,instance:S},o),Rr.dispatch(T),y._eventEmitter.emit(T.type,T.payload),r(),"video"===S.kind&&Rr.getState().me.audioOnly&&y._pauseConsumer(S),null===(b=y._openTelemetry)||void 0===b||b.completeSpan({span:g,status:1,message:"Event Send Successfully"}),null===(w=y._openTelemetry)||void 0===w||w.completeSpan({span:i,status:1,message:"New Consumer Created Successfully",attributes:{"consumer.consumerId":S.id}}),"video"==S.kind&&S.appData.share&&(null===(C=y._openTelemetry)||void 0===C||C.traceAutoComplete({spanName:"Presenter Changed",span:i,attributes:{"peer.id":o}})),y.e2eeManager&&y.e2eeManager.emit("NEW_CONSUMER",{consumer:S,peerId:y._peerId}),e.next=5;break;case 4:throw e.prev=4,D=e.catch(2),null===(P=y._openTelemetry)||void 0===P||P.completeSpan({span:g,status:2,message:"Error creating a Consumer: ".concat(D)}),null===(O=y._openTelemetry)||void 0===O||O.completeSpan({span:i,status:2,message:"Error creating a Consumer: ".concat(D)}),Rr.dispatch(At({type:"error",text:"Error creating a Consumer: ".concat(D)})),null===(x=y._videosdkLogs)||void 0===x||x.pushLogs({logText:"Error creating a Consumer",logType:"ERROR",attributes:{error:D.message}}),D;case 5:case"end":return e.stop()}},e,null,[[2,4]])}));return function(t,r){return e.apply(this,arguments)}}()),this._webSocket.on("newDataConsumer",function(){var e=(0,o.A)(p().mark(function e(t,r){var n,s,i,a,o,c,d,u,l;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(y._consume){e.next=1;break}return r({errorCode:403,message:"I do not want to data consume",method:"newConsumer"}),e.abrupt("return");case 1:if(y._useDataChannel){e.next=2;break}return r({errorCode:403,message:"I do not want DataChannels",method:"newConsumer"}),e.abrupt("return");case 2:return n=t.peerId,s=t.dataProducerId,i=t.id,a=t.sctpStreamParameters,o=t.label,c=t.protocol,d=t.appData,e.prev=3,e.next=4,y._recvTransport.consumeData({id:i,dataProducerId:s,sctpStreamParameters:a,label:o,protocol:c,appData:br(br({},d),{},{peerId:n})});case 4:u=e.sent,y._dataConsumers.set(u.id,u),u.on("transportclose",function(){y._dataConsumers.delete(u.id)}),u.on("open",function(){Or.debug('DataConsumer "open" event')}),u.on("close",function(){Or.warn('DataConsumer "close" event'),y._dataConsumers.delete(u.id),Rr.dispatch(At({type:"error",text:"DataConsumer closed"}))}),u.on("error",function(e){Or.error('DataConsumer "error" event:%o',e),Rr.dispatch(At({type:"error",text:"DataConsumer error: ".concat(e)}))}),u.on("message",function(e){if(Or.debug('DataConsumer "message" event [streamId:%d]',u.sctpStreamParameters.streamId),e instanceof ArrayBuffer){var t=new DataView(e).getUint32();return t==Math.pow(2,32)-1?(Or.warn("dataChannelTest finished!"),void(y._nextDataChannelTestNumber=0)):(t>y._nextDataChannelTestNumber&&Or.warn("dataChannelTest: %s packets missing",t-y._nextDataChannelTestNumber),void(y._nextDataChannelTestNumber=t+1))}if("string"==typeof e)switch(u.label){case"chat":var r=Rr.getState().peers,n=Object.keys(r).map(function(e){return r[e]}).find(function(e){return e.dataConsumers.includes(u.id)});if(!n){Or.warn('DataConsumer "message" from unknown peer');break}Rr.dispatch(At({title:"".concat(n.displayName," says:"),text:e,timeout:5e3})),y._eventEmitter.emit("CHAT_MESSAGE",{text:e,senderId:n.id,timestamp:(new Date).getTime()});break;case"bot":Rr.dispatch(At({title:"Message from Bot:",text:e,timeout:5e3}))}else Or.warn('ignoring DataConsumer "message" (not a string)')}),Rr.dispatch(xt({id:u.id,sctpStreamParameters:u.sctpStreamParameters,label:u.label,protocol:u.protocol},n)),r(),e.next=6;break;case 5:e.prev=5,l=e.catch(3),Or.error('"newDataConsumer" request failed:%o',l),Rr.dispatch(At({type:"error",text:"Error creating a DataConsumer: ".concat(l)}));case 6:case"end":return e.stop()}},e,null,[[3,5]])}));return function(t,r){return e.apply(this,arguments)}}()),this._webSocket.on("enableMic",function(){var e=(0,o.A)(p().mark(function e(t,r){var n,s,i;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:try{s=t.peerId,null===(n=y._openTelemetry)||void 0===n||n.traceAutoComplete({spanName:"Emitting MIC_REQUESTED & Websocket REQ: enableMic for ".concat(s),status:1}),y._eventEmitter.emit("MIC_REQUESTED",{peerId:s}),r()}catch(a){Or.error('"enableMic" request failed:%o',a),null===(i=y._videosdkLogs)||void 0===i||i.pushLogs({logText:"Error enableMic request failed",logType:"ERROR",attributes:{error:a.message}}),y._emitError({code:3027,message:a.message})}case 1:case"end":return e.stop()}},e)}));return function(t,r){return e.apply(this,arguments)}}()),this._webSocket.on("disableMic",function(){var e=(0,o.A)(p().mark(function e(t,r){var n,s,i,a,o,c;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=null===(s=y._openTelemetry)||void 0===s?void 0:s.trace({spanName:"Websocket REQ: disableMic"}),e.next=1,y.disableMic(!1,n);case 1:null===(i=y._openTelemetry)||void 0===i||i.completeSpan({span:n,status:1,message:"Request Completed"}),r(),e.next=3;break;case 2:e.prev=2,c=e.catch(0),null===(a=y._openTelemetry)||void 0===a||a.completeSpan({span:n,status:2,message:"disableMic request failed ".concat(c)}),null===(o=y._videosdkLogs)||void 0===o||o.pushLogs({logText:"Error disableMic request failed",logType:"ERROR",attributes:{error:c.message}}),y._emitError({code:3028,message:c.message});case 3:case"end":return e.stop()}},e,null,[[0,2]])}));return function(t,r){return e.apply(this,arguments)}}()),this._webSocket.on("enableWebcam",function(){var e=(0,o.A)(p().mark(function e(t,r){var n,s,i;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:try{s=t.peerId,null===(n=y._openTelemetry)||void 0===n||n.traceAutoComplete({spanName:"Emitting WEBCAM_REQUESTED & Websocket REQ: enableWebcam for ".concat(s),status:1}),y._eventEmitter.emit("WEBCAM_REQUESTED",{peerId:s}),r()}catch(a){Or.error('"enableWebcam" request failed:%o',a),null===(i=y._videosdkLogs)||void 0===i||i.pushLogs({logText:"Error enableWebcam request failed",logType:"ERROR",attributes:{error:a.message}}),y._emitError({code:3029,message:a.message})}case 1:case"end":return e.stop()}},e)}));return function(t,r){return e.apply(this,arguments)}}()),this._webSocket.on("disableWebcam",function(){var e=(0,o.A)(p().mark(function e(t,r){var n,s,i,a,o,c;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=null===(s=y._openTelemetry)||void 0===s?void 0:s.trace({spanName:"Websocket REQ: disableWebcam"}),e.next=1,y.disableWebcam(n);case 1:null===(i=y._openTelemetry)||void 0===i||i.completeSpan({span:n,status:1,message:"Request Completed"}),r(),e.next=3;break;case 2:e.prev=2,c=e.catch(0),null===(a=y._openTelemetry)||void 0===a||a.completeSpan({span:n,status:2,message:"disableWebcam request failed ".concat(c)}),null===(o=y._videosdkLogs)||void 0===o||o.pushLogs({logText:"Error disableWebcam request failed",logType:"ERROR",attributes:{error:c.message}}),y._emitError({code:3030,message:c.message});case 3:case"end":return e.stop()}},e,null,[[0,2]])}));return function(t,r){return e.apply(this,arguments)}}()),this._webSocket.on("pinStateChanged",function(){var e=(0,o.A)(p().mark(function e(t,r){var n,s,i,a,o,c,d,u,l,h;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,a=t.peerId,o=t.state,c=t.pinnedBy,n=null===(s=y._openTelemetry)||void 0===s?void 0:s.trace({spanName:"Websocket REQ: pinStateChanged",attributes:{requestData:JSON.stringify({peerId:a,state:o,pinnedBy:c})}}),y._pinnedParticipants.has(a)||y._pinnedParticipants.set(a,{cam:!1,share:!1}),d=y._pinnedParticipants.get(a),null!=o.cam&&(d.cam=o.cam),null!=o.share&&(d.share=o.share),y._pinnedParticipants.set(a,d),y._eventEmitter.emit("PIN_STATE_CHANGED",{peerId:a,state:o,pinnedBy:c}),0==d.share&&0==d.cam&&y._pinnedParticipants.delete(a),null===(i=y._openTelemetry)||void 0===i||i.completeSpan({span:n,status:1,message:"Request Completed",attributes:{_pinnedParticipants:JSON.stringify(y._pinnedParticipants)}}),r(),e.next=2;break;case 1:throw e.prev=1,h=e.catch(0),null===(u=y._openTelemetry)||void 0===u||u.completeSpan({span:n,status:2,message:"pinStateChanged request failed"}),null===(l=y._videosdkLogs)||void 0===l||l.pushLogs({logText:"Error pinStateChanged request failed",logType:"ERROR",attributes:{error:h.message}}),h;case 2:case"end":return e.stop()}},e,null,[[0,1]])}));return function(t,r){return e.apply(this,arguments)}}()),this._webSocket.on("switchRoom",function(){var e=(0,o.A)(p().mark(function e(t,r){return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:y._eventEmitter.emit("SWITCH_ROOM",t),r();case 1:case"end":return e.stop()}},e)}));return function(t,r){return e.apply(this,arguments)}}()),this._webSocket.on("statsData",function(){var e=(0,o.A)(p().mark(function e(t,r){return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r({peerId:y._peerId,statsData:y._stats}),y._stats={};case 1:case"end":return e.stop()}},e)}));return function(t,r){return e.apply(this,arguments)}}()),this._webSocket.on("notification",function(){var e=(0,o.A)(p().mark(function e(t){var r,n,s,i,a,o,u,l,h,m,f,g,v,_,b,w,S,R,k,E,T,C,P,O,x,D,I,A,M,L,N,j,B,U,F,q,W,V,H,z,K,G,$,J,Q,Y,X,Z,ee,te,re,ne,se,ie,ae,oe,ce,de,ue,le,pe,he,me,fe,ge,ve,_e,ye,be,we,Se,Re,ke,Ee,Te,Ce,Pe,Oe,xe,De,Ie,Ae,Me,Le,Ne,je,Be,Ue,Fe,qe;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=t,Or.debug('proto "notification" event [method:%s, data:%o]',t.method,r),qe=t.method,e.next="error"===qe?1:"participantMediaStateChanged"===qe?2:"producerScore"===qe?3:"entryRequested"===qe?4:"entryResponded"===qe?5:"newPeer"===qe?8:"peerClosed"===qe?9:"peerDisplayNameChanged"===qe?10:"consumerClosed"===qe?11:"consumerPaused"===qe?13:"consumerResumed"===qe?15:"consumerLayersChanged"===qe?17:"consumerScore"===qe?19:"dataConsumerClosed"===qe?20:"activeSpeaker"===qe?22:"consumerResumedSubManager"===qe?23:"consumerPausedSubManager"===qe?24:"transcriptionStateChanged"===qe?25:"transcriptionText"===qe?26:"recordingStateChanged"===qe?27:"recordingStarted"===qe?28:"recordingStopped"===qe?29:"livestreamStateChanged"===qe?30:"livestreamStarted"===qe?31:"livestreamStopped"===qe?32:"hlsStateChanged"===qe?33:"hlsPlayableStateChanged"===qe?34:"hlsStarted"===qe?35:"hlsStopped"===qe?36:"whiteboardStarted"===qe?37:"whiteboardStopped"===qe?38:"addCharacter"===qe?39:"removeCharacter"===qe?40:"characterStateChanged"===qe?41:"characterMessage"===qe?42:"userMessage"===qe?43:"characterData"===qe?44:"characterError"===qe?45:"videoStatusChanged"===qe?46:"videoSeeked"===qe?47:"connectionOpen"===qe?48:"connectionClose"===qe?49:"connectionChatMessage"===qe?50:"connectionParticipantJoined"===qe?51:"connectionParticipantLeft"===qe?52:"pubsubMessage"===qe?53:"peerModeChanged"===qe?54:"restartIce"===qe?55:"mediaRelayStarted"===qe?56:"mediaRelayStopped"===qe?57:"mediaRelayError"===qe?58:"mediaRelayRequestResponse"===qe?59:"mediaRelayRequestReceived"===qe?60:61;break;case 1:return i=r,y._eventEmitter.emit("ERROR",i),null===(n=y._videosdkLogs)||void 0===n||n.pushLogs({logText:"Error in Meeting Session",logType:"ERROR",attributes:{error:i.message}}),null===(s=y._openTelemetry)||void 0===s||s.traceAutoComplete({spanName:"Emitted `ERROR` Event",attributes:{error:i.message},status:2}),e.abrupt("continue",62);case 2:try{a=r.peerId,o=r.kind,u=r.newState,y._eventEmitter.emit("PARTICIPANT_MEDIA_STATE_CHANGED",{peerId:a,kind:o,newState:u}),"video"==o&&(null===(l=y._openTelemetry)||void 0===l||l.traceAutoComplete({spanName:"".concat(a," has ").concat(u?"enable":"disable"," ").concat(o),status:1}))}catch(p){Or.error('"newProducer" request failed:%o',p),null===(h=y._videosdkLogs)||void 0===h||h.pushLogs({logText:"Error newProducer request failed",logType:"ERROR",attributes:{error:p.message}})}case 3:return m=r.producerId,f=r.score,Rr.dispatch(ft(m,f)),e.abrupt("continue",62);case 4:return v=r.id,_=r.name,b=null===(g=y._openTelemetry)||void 0===g?void 0:g.trace({spanName:"Websocket Noti: entryRequested",span:y._joinSpan,attributes:{data:JSON.stringify({id:v,name:_})}}),v!==y._peerId?(y._eventEmitter.emit("ENTRY_REQUESTED",{id:v,name:_}),null===(w=y._openTelemetry)||void 0===w||w.completeSpan({span:b,status:1,message:"EntryResponded Recieved"})):null===(S=y._openTelemetry)||void 0===S||S.completeSpan({span:b,status:2,message:"Entry Request Failed"}),e.abrupt("continue",62);case 5:if(E=r.id,T=r.decision,C=r.sessionId,P=r.switchingRoomId,O=null===(R=y._openTelemetry)||void 0===R?void 0:R.trace({name:"Entry Response Handling",attributes:{"peer.id":E,"entry.decision":T,switching_room:!!P}}),E===y._peerId&&"allowed"===T){e.next=6;break}return null===(x=y._openTelemetry)||void 0===x||x.completeSpan({span:y._joinSpan,status:2,message:"Join Request Denied"}),null===(D=y._openTelemetry)||void 0===D||D.completeSpan({span:O,status:2,message:"Entry denied for peer"}),e.abrupt("continue",62);case 6:if(y._eventEmitter.emit("ENTRY_RESPONDED",{id:E,decision:T}),!P){e.next=7;break}return null===(I=y._openTelemetry)||void 0===I||I.completeSpan({span:O,status:1,message:"Switching room initiated"}),y.softClose(),y.switchingRoom(P),e.abrupt("continue",62);case 7:return y._videosdkLogs=new Qt({roomId:y._roomId,peerId:y._peerId,logs:c,observabilityJwt:d,deviceInfo:y._deviceInfo,sessionId:C,debugMode:y._debugMode}),y.joinRoom(),null===(k=y._openTelemetry)||void 0===k||k.completeSpan({span:O,status:1,message:"Entry response handled successfully"}),e.abrupt("continue",62);case 8:M=yt(br(br({},A=r),{},{consumers:[],dataConsumers:[]})),Rr.dispatch(M),y._eventEmitter.emit(M.type,M.payload),Rr.dispatch(At({text:"".concat(A.displayName," has joined the room")}));try{null===(L=y._openTelemetry)||void 0===L||L.traceAutoComplete({spanName:"Websocket Noti: newPeer ".concat(A.displayName),attributes:{peerData:JSON.stringify(A)}})}catch(p){null===(N=y._videosdkLogs)||void 0===N||N.pushLogs({logText:"Error Websocket Noti: newPeer",logType:"ERROR",attributes:{error:p.message}})}return e.abrupt("continue",62);case 9:return B=r.peerId,U=bt(B),Rr.dispatch(U),y._eventEmitter.emit(U.type,U.payload),null===(j=y._openTelemetry)||void 0===j||j.traceAutoComplete({spanName:"Websocket Noti: peerClosed for ".concat(B)}),e.abrupt("continue",62);case 10:return F=r.peerId,q=r.displayName,W=r.oldDisplayName,Rr.dispatch(wt(q,F)),Rr.dispatch(At({text:"".concat(W," is now ").concat(q)})),e.abrupt("continue",62);case 11:if(H=r.consumerId,z=y._consumers.get(H)){e.next=12;break}return e.abrupt("continue",62);case 12:return z.close(),y._consumers.delete(H),K=z.appData.peerId,G=Rt(H,K),y._eventEmitter.emit("STREAM_STATE_CHANGED",{state:"ended",peerId:K,streamId:z._track.id}),Rr.dispatch(G),y._eventEmitter.emit(G.type,G.payload),null===(V=y._openTelemetry)||void 0===V||V.traceAutoComplete({spanName:"Websocket Noti: consumerClosed for id ".concat(H),attributes:{consumerData:JSON.stringify(z)}}),e.abrupt("continue",62);case 13:if($=r.consumerId,J=y._consumers.get($)){e.next=14;break}return e.abrupt("continue",62);case 14:return J.pause(),Rr.dispatch(kt($,"remote")),y._eventEmitter.emit("CONSUMER_PAUSED",{consumerId:$,peerId:J.appData.peerId}),e.abrupt("continue",62);case 15:if(Q=r.consumerId,Y=y._consumers.get(Q),y._eventEmitter.emit("STREAM_STATE_CHANGED",{state:"active",peerId:Y.appData.peerId,streamId:Y._track.id}),Y){e.next=16;break}return e.abrupt("continue",62);case 16:return Y.resume(),Rr.dispatch(Et(Q,"remote")),y._eventEmitter.emit("CONSUMER_RESUMED",{consumerId:Q,peerId:Y.appData.peerId}),e.abrupt("continue",62);case 17:if(Z=r.consumerId,ee=r.spatialLayer,te=r.temporalLayer,(re=y._consumers.get(Z)).currentSpatialLayer=ee,re.currentTemporalLayer=te,re){e.next=18;break}return e.abrupt("continue",62);case 18:return(null===(X=re.appData)||void 0===X||null===(X=X.encodings)||void 0===X?void 0:X.length)>1&&y._eventEmitter.emit("VIDEO_QUALITY_CHANGED",{peerId:re.appData.peerId,prevQuality:re.spatialLayers-1-re.currentSpatialLayer==0?"HIGH":re.spatialLayers-1-re.currentSpatialLayer==1?"MEDIUM":"LOW",currentQuality:re.spatialLayers-1-ee==0?"HIGH":re.spatialLayers-1-ee==1?"MEDIUM":"LOW"}),re.currentSpatialLayer=ee,re.currentTemporalLayer=te,Rr.dispatch(Tt(Z,ee,te)),e.abrupt("continue",62);case 19:return ne=r.consumerId,se=r.score,Rr.dispatch(Ot(ne,se)),e.abrupt("continue",62);case 20:if(ie=r.dataConsumerId,ae=y._dataConsumers.get(ie)){e.next=21;break}return e.abrupt("continue",62);case 21:return ae.close(),y._dataConsumers.delete(ie),oe=ae.appData.peerId,Rr.dispatch(Dt(ie,oe)),e.abrupt("continue",62);case 22:return ce=r.peerId,de=tt(ce),Rr.dispatch(de),y._eventEmitter.emit(de.type,de.payload),e.abrupt("continue",62);case 23:return y._eventEmitter.emit("SUB_MANAGER_RESUMED",r),e.abrupt("continue",62);case 24:return y._eventEmitter.emit("SUB_MANAGER_PAUSED",r),e.abrupt("continue",62);case 25:return y._eventEmitter.emit("TRANSCRIPTION_STATE_CHANGED",r),null===(ue=y._openTelemetry)||void 0===ue||ue.traceAutoComplete({spanName:"Emitted TRANSCRIPTION_STATE_CHANGED, status : ".concat(r.status),attributes:{data:JSON.stringify(r)},status:1}),e.abrupt("continue",62);case 26:return y._eventEmitter.emit("TRANSCRIPTION_TEXT",r),e.abrupt("continue",62);case 27:return y._eventEmitter.emit("RECORDING_STATE_CHANGED",r),null===(le=y._openTelemetry)||void 0===le||le.traceAutoComplete({spanName:"Emitted RECORDING_STATE_CHANGED, status : ".concat(r.status),attributes:{data:JSON.stringify(r)},status:1}),e.abrupt("continue",62);case 28:return y._eventEmitter.emit("RECORDING_STARTED",{}),e.abrupt("continue",62);case 29:return y._eventEmitter.emit("RECORDING_STOPPED",{}),e.abrupt("continue",62);case 30:return y._eventEmitter.emit("LIVESTREAM_STATE_CHANGED",r),null===(pe=y._openTelemetry)||void 0===pe||pe.traceAutoComplete({spanName:"Emitted LIVESTREAM_STATE_CHANGED, status : ".concat(r.status),attributes:{data:JSON.stringify(r)},status:1}),e.abrupt("continue",62);case 31:return y._eventEmitter.emit("LIVESTREAM_STARTED",{}),e.abrupt("continue",62);case 32:return y._eventEmitter.emit("LIVESTREAM_STOPPED",{}),e.abrupt("continue",62);case 33:return y._eventEmitter.emit("HLS_STATE_CHANGED",r),null===(he=y._openTelemetry)||void 0===he||he.traceAutoComplete({spanName:"Emitted HLS_STATE_CHANGED, status : ".concat(r.status),attributes:{data:JSON.stringify(r)},status:1}),e.abrupt("continue",62);case 34:return r.isPlayable&&(y._eventEmitter.emit("HLS_STATE_CHANGED",br(br({},r),{},{status:qt.V.HLS_PLAYABLE})),null===(me=y._openTelemetry)||void 0===me||me.traceAutoComplete({spanName:"Websocket Noti: hlsPlayableStateChanged",status:1})),e.abrupt("continue",62);case 35:return fe=r.downstreamUrl,y._eventEmitter.emit("HLS_STARTED",fe),e.abrupt("continue",62);case 36:return y._eventEmitter.emit("HLS_STOPPED",{}),e.abrupt("continue",62);case 37:return ge=r.state,ve=r.url,ge?y._eventEmitter.emit("WHITEBOARD_STARTED",{state:ge}):ve&&y._eventEmitter.emit("WHITEBOARD_STARTED",{url:ve}),e.abrupt("continue",62);case 38:return y._eventEmitter.emit("WHITEBOARD_STOPPED",{}),e.abrupt("continue",62);case 39:return ye=yt(br(br({},r),{},{consumers:[],dataConsumers:[]})),Rr.dispatch(ye),y._eventEmitter.emit("ADD_CHARACTER",r),null===(_e=y._openTelemetry)||void 0===_e||_e.traceAutoComplete({spanName:"Emitted ADD_CHARACTER : ".concat(r),attributes:{data:JSON.stringify(r)},status:1}),e.abrupt("continue",62);case 40:return we=r.id,Se=bt(we),Rr.dispatch(Se),y._eventEmitter.emit("REMOVE_CHARACTER",r),null===(be=y._openTelemetry)||void 0===be||be.traceAutoComplete({spanName:"Emitted REMOVE_CHARACTER : ".concat(r),attributes:{data:JSON.stringify(r)},status:1}),e.abrupt("continue",62);case 41:return y._eventEmitter.emit("CHARACTER_STATE_CHANGED",r),null===(Re=y._openTelemetry)||void 0===Re||Re.traceAutoComplete({spanName:"Emitted CHARACTER_STATE_CHANGED, status : ".concat(r.status),attributes:{data:JSON.stringify(r)},status:1}),e.abrupt("continue",62);case 42:return y._eventEmitter.emit("CHARACTER_MESSAGE",r),e.abrupt("continue",62);case 43:return y._eventEmitter.emit("USER_MESSAGE",r),e.abrupt("continue",62);case 44:return y._eventEmitter.emit("CHARACTER_DATA",r),e.abrupt("continue",62);case 45:return y._eventEmitter.emit("CHARACTER_ERROR",r),e.abrupt("continue",62);case 46:return y._eventEmitter.emit("VIDEO_STATE_CHANGED",r),e.abrupt("continue",62);case 47:return ke=r.currentTime,y._eventEmitter.emit("VIDEO_SEEKED",{currentTime:ke}),e.abrupt("continue",62);case 48:return y._eventEmitter.emit("CONNECTION_OPEN",r),e.abrupt("continue",62);case 49:return y._eventEmitter.emit("CONNECTION_CLOSE",r),e.abrupt("continue",62);case 50:return y._eventEmitter.emit("CONNECTION_CHAT_MESSAGE",r),e.abrupt("continue",62);case 51:return y._eventEmitter.emit("CONNECTION_PARTICIPANT_JOIN",r),e.abrupt("continue",62);case 52:return y._eventEmitter.emit("CONNECTION_PARTICIPANT_LEFT",r),e.abrupt("continue",62);case 53:return y._eventEmitter.emit("PUBSUB_MESSAGE",r),e.abrupt("continue",62);case 54:return y._eventEmitter.emit("PEER_MODE_CHANGED",r),null===(Ee=y._openTelemetry)||void 0===Ee||Ee.traceAutoComplete({spanName:"Emitted PEER_MODE_CHANGED",attributes:{data:JSON.stringify(r)},status:1}),e.abrupt("continue",62);case 55:return Ce=r.transportId,Pe=r.iceParameters,Oe=null===(Te=y._openTelemetry)||void 0===Te?void 0:Te.trace({spanName:"Websocket Noti: restartIce for transportId :".concat(Ce),attributes:{iceParameters:JSON.stringify(Pe)}}),y.handleRemoteRestartIce({transportId:Ce,iceParameters:Pe,internalSpan:Oe}),e.abrupt("continue",62);case 56:return xe=t.meetingId,y._eventEmitter.emit("MEDIA_RELAY_STARTED",{meetingId:xe}),e.abrupt("continue",62);case 57:return De=t.meetingId,Ie=t.reason,y._eventEmitter.emit("MEDIA_RELAY_STOPPED",{meetingId:De,reason:Ie}),e.abrupt("continue",62);case 58:return Ae=t.meetingId,Me=t.reason,y._eventEmitter.emit("MEDIA_RELAY_ERROR",{meetingId:Ae,reason:Me}),e.abrupt("continue",62);case 59:return Le=t.decision,Ne=t.decidedBy,je=t.meetingId,y._eventEmitter.emit("MEDIA_RELAY_REQUEST_RESPONSE",{decision:Le,decidedBy:Ne,meetingId:je}),e.abrupt("continue",62);case 60:return Be=t.peerId,Ue=t.meetingId,Fe=t.displayName,y._eventEmitter.emit("MEDIA_RELAY_REQUEST_RECEIVED",{peerId:Be,meetingId:Ue,displayName:Fe}),e.abrupt("continue",62);case 61:Or.error('unknown Websocket notification.method "%s"',t.method);case 62:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),e.next=3;break;case 2:e.prev=2,_=e.catch(0),null===(v=this._videosdkLogs)||void 0===v||v.pushLogs({logText:"Error initializing the meeting :: ".concat(_),logType:"ERROR",attributes:{error:_}}),this.emitMeetingStateChange("FAILED");case 3:case"end":return e.stop()}},e,this,[[0,2]])})),function(){return pr.apply(this,arguments)})},{key:"requestEntry",value:(lr=(0,o.A)(p().mark(function e(){var t,r,n;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=null===(t=this._openTelemetry)||void 0===t?void 0:t.trace({spanName:"Requesting Entry",span:this._joinSpan}),e.next=1,this._socketRequest("requestEntry",{name:this._displayName});case 1:null===(r=this._openTelemetry)||void 0===r||r.completeSpan({span:n,status:1,message:"Entry Requested Successfully"});case 2:case"end":return e.stop()}},e,this)})),function(){return lr.apply(this,arguments)})},{key:"respondEntry",value:(ur=(0,o.A)(p().mark(function e(t,r){var n,s,i;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=null===(n=this._openTelemetry)||void 0===n?void 0:n.trace({spanName:"Responding Entry",attributes:{peerId:t,decision:r},span:this._joinSpan}),e.next=1,this._socketRequest("respondEntry",{id:t,decision:r});case 1:null===(s=this._openTelemetry)||void 0===s||s.completeSpan({message:"Entry Responded Successfully",span:i,status:1});case 2:case"end":return e.stop()}},e,this)})),function(e,t){return ur.apply(this,arguments)})},{key:"startTranscription",value:(dr=(0,o.A)(p().mark(function e(t){var r,n,s,i,a,o;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return Or.debug("startTranscription()"),s=null===(r=this._openTelemetry)||void 0===r?void 0:r.trace({spanName:"startTranscription() Start",attributes:{config:t?JSON.stringify(t):"config Not Specify"}}),e.prev=1,e.next=2,this._socketRequest("startTranscription",{config:t});case 2:e.next=4;break;case 3:e.prev=3,o=e.catch(1),Or.error("startTranscription() | failed:%o",o),null===(i=this._openTelemetry)||void 0===i||i.completeSpan({span:s,status:2,message:"startTranscription() failed"}),null===(a=this._videosdkLogs)||void 0===a||a.pushLogs({logText:"Error startTranscription() failed",logType:"ERROR",attributes:{error:o.message}}),this._emitError({code:4031,message:o.message});case 4:null===(n=this._openTelemetry)||void 0===n||n.completeSpan({span:s,status:1,message:"startTranscription() End"});case 5:case"end":return e.stop()}},e,this,[[1,3]])})),function(e){return dr.apply(this,arguments)})},{key:"stopTranscription",value:(cr=(0,o.A)(p().mark(function e(){var t,r,n,s,i,a;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return Or.debug("stopTranscription()"),n=null===(t=this._openTelemetry)||void 0===t?void 0:t.trace({spanName:"stopTranscription() Start"}),e.prev=1,e.next=2,this._socketRequest("stopTranscription",{});case 2:e.next=4;break;case 3:e.prev=3,a=e.catch(1),null===(s=this._openTelemetry)||void 0===s||s.completeSpan({span:n,status:2,message:"stopTranscription() failed"}),null===(i=this._videosdkLogs)||void 0===i||i.pushLogs({logText:"Error stopTranscription() failed",logType:"ERROR",attributes:{error:a.message}}),this._emitError({code:4032,message:a.message});case 4:null===(r=this._openTelemetry)||void 0===r||r.completeSpan({span:n,status:1,message:"stopTranscription() End"});case 5:case"end":return e.stop()}},e,this,[[1,3]])})),function(){return cr.apply(this,arguments)})},{key:"pauseAllConsumers",value:(or=(0,o.A)(p().mark(function e(t){var r,n,s,i,a,o,c,d,u,l,h;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s=null===(r=this._openTelemetry)||void 0===r?void 0:r.trace({spanName:"pauseAllConsumers() Start",attributes:{kind:t||"Kind not specified"}}),e.prev=1,e.next=2,this._socketRequest("pauseAllConsumers",{kind:void 0===t?"all":t});case 2:if(a=e.sent,o=!1,!((null==a||null===(i=a.consumersWithIssues)||void 0===i?void 0:i.length)>0)){e.next=4;break}return e.next=3,this._socketRequest("pauseAllConsumers",{kind:void 0===t?"all":t});case 3:0===(null==(d=e.sent)||null===(c=d.consumersWithIssues)||void 0===c?void 0:c.length)&&(o=!0),e.next=5;break;case 4:o=!0;case 5:o&&this._eventEmitter.emit("ALL_CONSUMERS_PAUSED",{kind:t}),e.next=7;break;case 6:e.prev=6,h=e.catch(1),Or.error("pauseAllConsumers() | failed:%o",h),null===(u=this._openTelemetry)||void 0===u||u.completeSpan({span:s,status:2,message:"pauseAllConsumers() failed"}),null===(l=this._videosdkLogs)||void 0===l||l.pushLogs({logText:"Error pauseAllConsumers() failed",logType:"ERROR",attributes:{error:h.message}});case 7:null===(n=this._openTelemetry)||void 0===n||n.completeSpan({span:s,status:1,message:"pauseAllConsumers() End"});case 8:case"end":return e.stop()}},e,this,[[1,6]])})),function(e){return or.apply(this,arguments)})},{key:"resumeAllConsumers",value:(ar=(0,o.A)(p().mark(function e(t){var r,n,s,i,a,o,c,d,u,l,h;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s=null===(r=this._openTelemetry)||void 0===r?void 0:r.trace({spanName:"resumeAllConsumers() Start",attributes:{kind:t||"Kind not specified"}}),e.prev=1,e.next=2,this._socketRequest("resumeAllConsumers",{kind:void 0===t?"all":t});case 2:if(a=e.sent,o=!1,!((null==a||null===(i=a.consumersWithIssues)||void 0===i?void 0:i.length)>0)){e.next=4;break}return e.next=3,this._socketRequest("resumeAllConsumers",{kind:void 0===t?"all":t});case 3:0===(null==(d=e.sent)||null===(c=d.consumersWithIssues)||void 0===c?void 0:c.length)&&(o=!0),e.next=5;break;case 4:o=!0;case 5:o&&this._eventEmitter.emit("ALL_CONSUMERS_RESUMED",{kind:t}),e.next=7;break;case 6:e.prev=6,h=e.catch(1),Or.error("resumeAllConsumers() | failed:%o",h),null===(u=this._openTelemetry)||void 0===u||u.completeSpan({span:s,status:2,message:"resumeAllConsumers() failed"}),null===(l=this._videosdkLogs)||void 0===l||l.pushLogs({logText:"Error resumeAllConsumers() failed",logType:"ERROR",attributes:{error:h.message}});case 7:null===(n=this._openTelemetry)||void 0===n||n.completeSpan({span:s,status:1,message:"resumeAllConsumers() End"});case 8:case"end":return e.stop()}},e,this,[[1,6]])})),function(e){return ar.apply(this,arguments)})},{key:"startRecording",value:(ir=(0,o.A)(p().mark(function e(t,r,n,s){var i,a,o,c,d,u;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return Or.debug("startRecording()"),o=null===(i=this._openTelemetry)||void 0===i?void 0:i.trace({spanName:"startRecording() Start",attributes:{webhookUrl:t||"webhookUrl Not Specify",awsDirPath:r||"awsDirPath Not Specify",config:n?JSON.stringify(n):"config Not Specify",transcription:s?JSON.stringify(s):"transcription Not Specify"}}),e.prev=1,e.next=2,this._socketRequest("startRecording",{webhookUrl:t,awsDirPath:r,config:n,transcription:s});case 2:e.next=4;break;case 3:e.prev=3,u=e.catch(1),Or.error("startRecording() | failed:%o",u),null===(c=this._openTelemetry)||void 0===c||c.completeSpan({span:o,status:2,message:"startRecording() failed"}),null===(d=this._videosdkLogs)||void 0===d||d.pushLogs({logText:"Error startRecording() failed",logType:"ERROR",attributes:{error:u.message}}),this._emitError({code:4011,message:u.message});case 4:null===(a=this._openTelemetry)||void 0===a||a.completeSpan({span:o,status:1,message:"startRecording() End"});case 5:case"end":return e.stop()}},e,this,[[1,3]])})),function(e,t,r,n){return ir.apply(this,arguments)})},{key:"stopRecording",value:(sr=(0,o.A)(p().mark(function e(){var t,r,n,s,i,a;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._closed){e.next=1;break}return e.abrupt("return");case 1:return Or.debug("stopRecording()"),n=null===(t=this._openTelemetry)||void 0===t?void 0:t.trace({spanName:"stopRecording() Start"}),e.prev=2,e.next=3,this._socketRequest("stopRecording",{});case 3:e.next=5;break;case 4:e.prev=4,a=e.catch(2),null===(s=this._openTelemetry)||void 0===s||s.completeSpan({span:n,status:2,message:"stopRecording() failed"}),null===(i=this._videosdkLogs)||void 0===i||i.pushLogs({logText:"Error stopRecording() failed",logType:"ERROR",attributes:{error:a.message}}),this._emitError({code:4012,message:a.message});case 5:null===(r=this._openTelemetry)||void 0===r||r.completeSpan({span:n,status:1,message:"stopRecording() End"});case 6:case"end":return e.stop()}},e,this,[[2,4]])})),function(){return sr.apply(this,arguments)})},{key:"startLivestream",value:(nr=(0,o.A)(p().mark(function e(t,r){var n,s,i,a,o,c;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return Or.debug("startLivestream()"),i=null===(n=this._openTelemetry)||void 0===n?void 0:n.trace({spanName:"startLivestream() Start",attributes:{outputs:t?JSON.stringify(t):"outputs Not Specify",config:r?JSON.stringify(r):"config Not Specify"}}),e.prev=1,e.next=2,this._socketRequest("startLivestream",{outputs:t,config:r});case 2:e.next=4;break;case 3:e.prev=3,c=e.catch(1),null===(a=this._openTelemetry)||void 0===a||a.completeSpan({span:i,status:1,message:"startLivestream() End"}),null===(o=this._videosdkLogs)||void 0===o||o.pushLogs({logText:"Error startLivestream() failed",logType:"ERROR",attributes:{error:c.message}}),this._emitError({code:4013,message:c.message});case 4:null===(s=this._openTelemetry)||void 0===s||s.completeSpan({span:i,status:1,message:"startLivestream() End"});case 5:case"end":return e.stop()}},e,this,[[1,3]])})),function(e,t){return nr.apply(this,arguments)})},{key:"stopLivestream",value:(rr=(0,o.A)(p().mark(function e(){var t,r,n,s,i,a;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return Or.debug("stopLivestream()"),n=null===(t=this._openTelemetry)||void 0===t?void 0:t.trace({spanName:"stopLivestream() Start"}),e.prev=1,e.next=2,this._socketRequest("stopLivestream",{});case 2:e.next=4;break;case 3:e.prev=3,a=e.catch(1),null===(s=this._videosdkLogs)||void 0===s||s.pushLogs({logText:"Error stopLivestream() failed",logType:"ERROR",attributes:{error:a.message}}),null===(i=this._openTelemetry)||void 0===i||i.completeSpan({span:n,status:2,message:"Error stopLivestream() failed"}),this._emitError({code:4014,message:a.message});case 4:null===(r=this._openTelemetry)||void 0===r||r.completeSpan({span:n,status:1,message:"stopLivestream() End"});case 5:case"end":return e.stop()}},e,this,[[1,3]])})),function(){return rr.apply(this,arguments)})},{key:"startHls",value:(tr=(0,o.A)(p().mark(function e(t,r){var n,s,i,a,o,c;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=t||{},r=r||{},Or.debug("startHls()"),i=null===(n=this._openTelemetry)||void 0===n?void 0:n.trace({spanName:"startHls() Start",attributes:{config:t?JSON.stringify(t):"config Not Specify",transcription:r?JSON.stringify(r):"transcription Not Specify"}}),e.prev=1,e.next=2,this._socketRequest("startHls",{config:t,transcription:r});case 2:e.next=4;break;case 3:e.prev=3,c=e.catch(1),null===(a=this._videosdkLogs)||void 0===a||a.pushLogs({logText:"Error startHls() failed",logType:"ERROR",attributes:{error:c.message}}),null===(o=this._openTelemetry)||void 0===o||o.completeSpan({span:i,status:2,message:"Error startHls() failed"}),this._emitError({code:4016,message:c.message}),Or.error("startHls() | failed:%o",c);case 4:null===(s=this._openTelemetry)||void 0===s||s.completeSpan({span:i,status:1,message:"startHlsSpan() End"});case 5:case"end":return e.stop()}},e,this,[[1,3]])})),function(e,t){return tr.apply(this,arguments)})},{key:"stopHls",value:(er=(0,o.A)(p().mark(function e(){var t,r,n,s,i,a;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return Or.debug("stopHls()"),n=null===(t=this._openTelemetry)||void 0===t?void 0:t.trace({spanName:"stopHls() Start"}),e.prev=1,e.next=2,this._socketRequest("stopHls",{});case 2:e.next=4;break;case 3:e.prev=3,a=e.catch(1),null===(s=this._videosdkLogs)||void 0===s||s.pushLogs({logText:"Error stopHls() failed",logType:"ERROR",attributes:{error:a.message}}),null===(i=this._openTelemetry)||void 0===i||i.completeSpan({span:n,status:2,message:"Error stopHls() failed"}),this._emitError({code:4017,message:a.message});case 4:null===(r=this._openTelemetry)||void 0===r||r.completeSpan({span:n,status:1,message:"stopHls() End"});case 5:case"end":return e.stop()}},e,this,[[1,3]])})),function(){return er.apply(this,arguments)})},{key:"startWhiteboard",value:(Zt=(0,o.A)(p().mark(function e(){var t,r,n,s,i;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return Or.debug("startWhiteboard()"),n=null===(t=this._openTelemetry)||void 0===t?void 0:t.trace({spanName:"startWhiteboard() Start"}),e.prev=1,e.next=2,this._socketRequest("startWhiteboard",{version:"v2"});case 2:e.next=4;break;case 3:e.prev=3,i=e.catch(1),Or.error("startWhiteboard() | failed:%o",i),null===(s=this._openTelemetry)||void 0===s||s.completeSpan({span:n,status:2,message:"Error startWhiteboard() failed"}),this._emitError({code:3021,message:i.message});case 4:null===(r=this._openTelemetry)||void 0===r||r.completeSpan({span:n,status:1,message:"startWhiteboard() End"});case 5:case"end":return e.stop()}},e,this,[[1,3]])})),function(){return Zt.apply(this,arguments)})},{key:"stopWhiteboard",value:(Xt=(0,o.A)(p().mark(function e(){var t,r,n,s,i;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return Or.debug("stopWhiteboard()"),n=null===(t=this._openTelemetry)||void 0===t?void 0:t.trace({spanName:"stopWhiteboard() Start"}),e.prev=1,e.next=2,this._socketRequest("stopWhiteboard",{});case 2:e.next=4;break;case 3:e.prev=3,i=e.catch(1),Or.error("stopWhiteboard() | failed:%o",i),null===(s=this._openTelemetry)||void 0===s||s.completeSpan({span:n,status:2,message:"Error stopWhiteboard() failed"}),this._emitError({code:3022,message:i.message});case 4:null===(r=this._openTelemetry)||void 0===r||r.completeSpan({span:n,status:1,message:"stopWhiteboard() End"});case 5:case"end":return e.stop()}},e,this,[[1,3]])})),function(){return Xt.apply(this,arguments)})},{key:"joinCharacter",value:(Jt=(0,o.A)(p().mark(function e(t){var r,n,s,i,a,o;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return Or.debug("joinCharacter()"),s=null===(r=this._openTelemetry)||void 0===r?void 0:r.trace({spanName:"joinCharacter() Start",attributes:{config:t?JSON.stringify(t):"config Not Specify"}}),e.prev=1,e.next=2,this._socketRequest("joinCharacter",{config:t});case 2:return e.abrupt("return",e.sent);case 3:return e.prev=3,o=e.catch(1),Or.error("joinCharacter() | failed:%o",o),null===(i=this._openTelemetry)||void 0===i||i.completeSpan({span:s,status:2,message:"joinCharacter() failed"}),null===(a=this._videosdkLogs)||void 0===a||a.pushLogs({logText:"Error joinCharacter() failed",logType:"ERROR",attributes:{error:o.message}}),this._emitError({code:4033,message:o.message}),null===(n=this._openTelemetry)||void 0===n||n.completeSpan({span:s,status:1,message:"joinCharacter() End"}),e.abrupt("return",!1);case 4:case"end":return e.stop()}},e,this,[[1,3]])})),function(e){return Jt.apply(this,arguments)})},{key:"switchTo",value:($t=(0,o.A)(p().mark(function e(t){var r,n,s,i,a,o,c,d,u;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.meetingId,s=t.participantId,i=t.token,a=null===(r=this._openTelemetry)||void 0===r?void 0:r.trace({spanName:"switchTo() Start",attributes:{"peer.id":s,meetingId:n}}),e.prev=1,e.next=2,this._socketRequest("switchToMeeting",{meetingId:n,participantId:s,secret:i||this._secret});case 2:null===(o=this._openTelemetry)||void 0===o||o.completeSpan({span:a,status:1,message:"switchTo() Success"}),e.next=4;break;case 3:e.prev=3,u=e.catch(1),null===(c=this._openTelemetry)||void 0===c||c.completeSpan({span:a,status:2,message:"switchTo() failed"}),null===(d=this._videosdkLogs)||void 0===d||d.pushLogs({logText:"Error switchTo() failed",logType:"ERROR",attributes:{error:u.message}});case 4:case"end":return e.stop()}},e,this,[[1,3]])})),function(e){return $t.apply(this,arguments)})},{key:"removeCharacter",value:(Kt=(0,o.A)(p().mark(function e(t){var r,n,s,i,a,o;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return Or.debug("removeCharacter()"),s=null===(r=this._openTelemetry)||void 0===r?void 0:r.trace({spanName:"removeCharacter() Start"}),e.prev=1,e.next=2,this._socketRequest("leaveCharacter",{config:t});case 2:e.next=4;break;case 3:return e.prev=3,o=e.catch(1),Or.error("removeCharacter() | failed:%o",o),null===(i=this._openTelemetry)||void 0===i||i.completeSpan({span:s,status:2,message:"removeCharacter() failed"}),null===(a=this._videosdkLogs)||void 0===a||a.pushLogs({logText:"Error removeCharacter() failed",logType:"ERROR",attributes:{error:o.message}}),this._emitError({code:4034,message:o.message}),e.abrupt("return",!1);case 4:return null===(n=this._openTelemetry)||void 0===n||n.completeSpan({span:s,status:1,message:"removeCharacter() End"}),e.abrupt("return",!0);case 5:case"end":return e.stop()}},e,this,[[1,3]])})),function(e){return Kt.apply(this,arguments)})},{key:"sendCharacterMessage",value:(zt=(0,o.A)(p().mark(function e(t){var r,n,s;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.interactionId,n=t.text,Or.debug("sendCharacterMessage()"),e.prev=1,e.next=2,this._socketRequest("sendCharacterMessage",{interactionId:r,text:n});case 2:e.next=4;break;case 3:e.prev=3,s=e.catch(1),Or.error("sendCharacterMessage() | failed:%o",s),this._emitError({code:4035,message:s.message});case 4:case"end":return e.stop()}},e,this,[[1,3]])})),function(e){return zt.apply(this,arguments)})},{key:"interruptCharacter",value:(Ht=(0,o.A)(p().mark(function e(t){var r,n;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.interactionId,Or.debug("interruptCharacter()"),e.prev=1,e.next=2,this._socketRequest("interruptCharacter",{interactionId:r});case 2:e.next=4;break;case 3:e.prev=3,n=e.catch(1),Or.error("interruptCharacter() | failed:%o",n),this._emitError({code:4036,message:n.message});case 4:case"end":return e.stop()}},e,this,[[1,3]])})),function(e){return Ht.apply(this,arguments)})},{key:"pinStateChange",value:(Vt=(0,o.A)(p().mark(function e(t){var r,n,s,i,a;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.peerId,s=t.state,null===(r=this._openTelemetry)||void 0===r||r.traceAutoComplete({spanName:"Pin state Change for ".concat(n),attributes:{state:s?JSON.stringify(s):null},status:1}),e.prev=1,e.next=2,this._socketRequest("pinStateChanged",{peerId:n,state:s});case 2:e.next=4;break;case 3:e.prev=3,a=e.catch(1),null===(i=this._videosdkLogs)||void 0===i||i.pushLogs({logText:"Error pinStateChange() failed",logType:"ERROR",attributes:{error:a.message}}),Or.error("pinStateChange() | failed");case 4:case"end":return e.stop()}},e,this,[[1,3]])})),function(e){return Vt.apply(this,arguments)})},{key:"startVideo",value:(Wt=(0,o.A)(p().mark(function e(t){var r,n,s,i;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.link,Or.debug("startVideo()"),null===(r=this._videosdkLogs)||void 0===r||r.pushLogs({logText:"startVideo() Calling",logType:"INFO"}),e.prev=1,e.next=2,this._socketRequest("startVideo",{link:n});case 2:e.next=4;break;case 3:e.prev=3,i=e.catch(1),null===(s=this._videosdkLogs)||void 0===s||s.pushLogs({logText:"Error startVideo() failed",logType:"ERROR",attributes:{error:i.message}}),Or.error("startVideo() | failed:%o",i),this._emitError({code:3023,message:i.message});case 4:case"end":return e.stop()}},e,this,[[1,3]])})),function(e){return Wt.apply(this,arguments)})},{key:"stopVideo",value:(Ze=(0,o.A)(p().mark(function e(){var t,r,n;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return Or.debug("stopVideo()"),null===(t=this._videosdkLogs)||void 0===t||t.pushLogs({logText:"stopVideo() Calling",logType:"INFO"}),e.prev=1,e.next=2,this._socketRequest("stopVideo",{});case 2:e.next=4;break;case 3:e.prev=3,n=e.catch(1),null===(r=this._videosdkLogs)||void 0===r||r.pushLogs({logText:"Error stopVideo() failed",logType:"ERROR",attributes:{error:n.message}}),Or.error("stopVideo() | failed:%o",n),this._emitError({code:3024,message:n.message});case 4:case"end":return e.stop()}},e,this,[[1,3]])})),function(){return Ze.apply(this,arguments)})},{key:"pauseVideo",value:(Xe=(0,o.A)(p().mark(function e(t){var r;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return Or.debug("pauseVideo()"),e.prev=1,e.next=2,this._socketRequest("pauseVideo",{currentTime:t});case 2:e.next=4;break;case 3:e.prev=3,r=e.catch(1),Or.error("pauseVideo() | failed:%o",r),this._emitError({code:3025,message:r.message});case 4:case"end":return e.stop()}},e,this,[[1,3]])})),function(e){return Xe.apply(this,arguments)})},{key:"resumeVideo",value:(Je=(0,o.A)(p().mark(function e(){var t;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return Or.debug("resumeVideo()"),e.prev=1,e.next=2,this._socketRequest("resumeVideo",{});case 2:e.next=4;break;case 3:e.prev=3,t=e.catch(1),Or.error("resumeVideo() | failed:%o",t),this._emitError({code:3026,message:t.message});case 4:case"end":return e.stop()}},e,this,[[1,3]])})),function(){return Je.apply(this,arguments)})},{key:"seekVideo",value:($e=(0,o.A)(p().mark(function e(t){var r;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return Or.debug("seekVideo()"),e.prev=1,e.next=2,this._socketRequest("seekVideo",{currentTime:t});case 2:e.next=4;break;case 3:e.prev=3,r=e.catch(1),Or.error("seekVideo() | failed:%o",r),this._emitError({code:3031,message:r.message});case 4:case"end":return e.stop()}},e,this,[[1,3]])})),function(e){return $e.apply(this,arguments)})},{key:"enablePeerMic",value:(Ge=(0,o.A)(p().mark(function e(t){var r,n,s;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return null===(r=this._openTelemetry)||void 0===r||r.traceAutoComplete({spanName:"Enabling peer ".concat(t," Mic"),status:1}),Or.debug("enablePeerMic()"),e.prev=1,e.next=2,this._socketRequest("enablePeerMic",{peerId:t});case 2:e.next=4;break;case 3:e.prev=3,s=e.catch(1),null===(n=this._videosdkLogs)||void 0===n||n.pushLogs({logText:"Error enablePeerMic() failed",logType:"ERROR",attributes:{error:s.message}}),Or.error("enablePeerMic() | failed:%o",s);case 4:case"end":return e.stop()}},e,this,[[1,3]])})),function(e){return Ge.apply(this,arguments)})},{key:"requestMediaRelay",value:(Ke=(0,o.A)(p().mark(function e(t,r,n){var s,i;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=1,this._socketRequest("mediaRelayRequestSent",{meetingId:t,secret:null!=r?r:this._secret,kinds:null!=n?n:["audio","video","share","share_audio"]});case 1:e.next=3;break;case 2:e.prev=2,i=e.catch(0),null===(s=this._videosdkLogs)||void 0===s||s.pushLogs({logText:"Error relayRequest() failed",logType:"ERROR",attributes:{error:i.message}});case 3:case"end":return e.stop()}},e,this,[[0,2]])})),function(e,t,r){return Ke.apply(this,arguments)})},{key:"handleRelayRequestResponse",value:(He=(0,o.A)(p().mark(function e(t){var r,n,s,i,a;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.decision,n=t.peerId,s=t.meetingId,e.prev=1,e.next=2,this._socketRequest("respondToMediaRelayRequest",{decision:r,decidedBy:this._peerId,peerId:n,meetingId:s});case 2:e.next=4;break;case 3:e.prev=3,a=e.catch(1),null===(i=this._videosdkLogs)||void 0===i||i.pushLogs({logText:"Error respondToMediaRelayRequest() failed",logType:"ERROR",attributes:{error:a.message}});case 4:case"end":return e.stop()}},e,this,[[1,3]])})),function(e){return He.apply(this,arguments)})},{key:"stopMediaRelay",value:(Ve=(0,o.A)(p().mark(function e(t){var r,n;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=1,this._socketRequest("mediaRelayRequestStop",{meetingId:t});case 1:e.next=3;break;case 2:e.prev=2,n=e.catch(0),null===(r=this._videosdkLogs)||void 0===r||r.pushLogs({logText:"Error stopMediaRelay() failed",logType:"ERROR",attributes:{error:n.message}});case 3:case"end":return e.stop()}},e,this,[[0,2]])})),function(e){return Ve.apply(this,arguments)})},{key:"enableRelayMedia",value:(We=(0,o.A)(p().mark(function e(t,r){var n,s;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=1,this._socketRequest("enableRelayMedia",{meetingId:t,kind:r});case 1:e.next=3;break;case 2:e.prev=2,s=e.catch(0),null===(n=this._videosdkLogs)||void 0===n||n.pushLogs({logText:"Error enableRelayMedia() failed",logType:"ERROR",attributes:{error:s.message}});case 3:case"end":return e.stop()}},e,this,[[0,2]])})),function(e,t){return We.apply(this,arguments)})},{key:"disableRelayMedia",value:(qe=(0,o.A)(p().mark(function e(t,r){var n,s;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=1,this._socketRequest("disableRelayMedia",{meetingId:t,kind:r});case 1:e.next=3;break;case 2:e.prev=2,s=e.catch(0),null===(n=this._videosdkLogs)||void 0===n||n.pushLogs({logText:"Error disableRelayMedia() failed",logType:"ERROR",attributes:{error:s.message}});case 3:case"end":return e.stop()}},e,this,[[0,2]])})),function(e,t){return qe.apply(this,arguments)})},{key:"enableAdaptiveSubscription",value:(Fe=(0,o.A)(p().mark(function e(){var t,r;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=1,this._socketRequest("enableAdaptiveSubscription");case 1:e.next=3;break;case 2:e.prev=2,r=e.catch(0),null===(t=this._videosdkLogs)||void 0===t||t.pushLogs({logText:"Error enableAdaptiveSubscription() failed",logType:"ERROR",attributes:{error:r.message}});case 3:case"end":return e.stop()}},e,this,[[0,2]])})),function(){return Fe.apply(this,arguments)})},{key:"disableAdaptiveSubscription",value:(Ue=(0,o.A)(p().mark(function e(){var t,r;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=1,this._socketRequest("disableAdaptiveSubscription");case 1:e.next=3;break;case 2:e.prev=2,r=e.catch(0),null===(t=this._videosdkLogs)||void 0===t||t.pushLogs({logText:"Error disableAdaptiveSubscription() failed",logType:"ERROR",attributes:{error:r.message}});case 3:case"end":return e.stop()}},e,this,[[0,2]])})),function(){return Ue.apply(this,arguments)})},{key:"disablePeerMic",value:(Be=(0,o.A)(p().mark(function e(t){var r,n,s;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return null===(r=this._openTelemetry)||void 0===r||r.traceAutoComplete({spanName:"Disabling peer ".concat(t," Mic"),status:1}),Or.debug("disablePeerMic()"),e.prev=1,e.next=2,this._socketRequest("disablePeerMic",{peerId:t});case 2:e.next=4;break;case 3:e.prev=3,s=e.catch(1),null===(n=this._videosdkLogs)||void 0===n||n.pushLogs({logText:"Error disablePeerMic() failed",logType:"ERROR",attributes:{error:s.message}}),Or.error("disablePeerMic() | failed:%o",s);case 4:case"end":return e.stop()}},e,this,[[1,3]])})),function(e){return Be.apply(this,arguments)})},{key:"consumeWebcamStreams",value:(je=(0,o.A)(p().mark(function e(t){var r,n,s;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._closed){e.next=1;break}return e.abrupt("return");case 1:return Or.debug("consumeWebcamStreams()"),null===(r=this._videosdkLogs)||void 0===r||r.pushLogs({logText:"consumeWebcamStreams() Calling",logType:"INFO",attributes:{peerId:t}}),e.prev=2,e.next=3,this._socketRequest("consumeVideoStreams",{peerId:t});case 3:e.next=5;break;case 4:e.prev=4,s=e.catch(2),null===(n=this._videosdkLogs)||void 0===n||n.pushLogs({logText:"Error consumeWebcamStreams() failed",logType:"ERROR",attributes:{error:s.message}}),Or.error("consumeWebcamStreams() | failed:%o",s);case 5:case"end":return e.stop()}},e,this,[[2,4]])})),function(e){return je.apply(this,arguments)})},{key:"consumeMicStreams",value:(Ne=(0,o.A)(p().mark(function e(t){var r,n,s;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return Or.debug("consumeMicStreams()"),null===(r=this._videosdkLogs)||void 0===r||r.pushLogs({logText:"consumeMicStreams() Calling",logType:"INFO",attributes:{peerId:t}}),e.prev=1,e.next=2,this._socketRequest("consumeAudioStreams",{peerId:t});case 2:e.next=4;break;case 3:e.prev=3,s=e.catch(1),null===(n=this._videosdkLogs)||void 0===n||n.pushLogs({logText:"Error consumeMicStreams() failed",logType:"ERROR",attributes:{error:s.message}}),Or.error("consumeMicStreams() | failed:%o",s);case 4:case"end":return e.stop()}},e,this,[[1,3]])})),function(e){return Ne.apply(this,arguments)})},{key:"stopConsumingMicStreams",value:(Ae=(0,o.A)(p().mark(function e(t){var r,n,s;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._closed){e.next=1;break}return e.abrupt("return");case 1:return Or.debug("stopConsumingAudioStreams()"),e.prev=2,e.next=3,this._socketRequest("stopConsumingAudioStreams",{peerId:t});case 3:null===(r=this._videosdkLogs)||void 0===r||r.pushLogs({logText:"stopConsumingAudioStreams() Calling",logType:"INFO",attributes:{peerId:t}}),e.next=5;break;case 4:e.prev=4,s=e.catch(2),null===(n=this._videosdkLogs)||void 0===n||n.pushLogs({logText:"Error stopConsumingMicStreams() failed",logType:"ERROR",attributes:{error:s.message}}),Or.error("stopConsumingMicStreams() | failed:%o",s);case 5:case"end":return e.stop()}},e,this,[[2,4]])})),function(e){return Ae.apply(this,arguments)})},{key:"stopConsumingWebcamStreams",value:(Ie=(0,o.A)(p().mark(function e(t){var r,n,s;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return Or.debug("stopConsumingWebcamStreams()"),null===(r=this._videosdkLogs)||void 0===r||r.pushLogs({logText:"stopConsumingWebcamStreams() Calling",logType:"INFO",attributes:{peerId:t}}),e.prev=1,e.next=2,this._socketRequest("stopConsumingVideoStreams",{peerId:t});case 2:e.next=4;break;case 3:e.prev=3,s=e.catch(1),null===(n=this._videosdkLogs)||void 0===n||n.pushLogs({logText:"Error stopConsumingWebcamStreams() failed",logType:"ERROR",attributes:{error:s.message}}),Or.error("stopConsumingWebcamStreams() | failed:%o",s);case 4:case"end":return e.stop()}},e,this,[[1,3]])})),function(e){return Ie.apply(this,arguments)})},{key:"changeMode",value:(De=(0,o.A)(p().mark(function e(t){var r,n,s,i,a,c,d,u,l,h,m,f,g,v,_,y,b,w,S=this;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=null===(r=this._openTelemetry)||void 0===r?void 0:r.trace({spanName:"changeMode() Calling with mode: ".concat(t)}),s=this._mode,e.prev=1,s!==t){e.next=2;break}throw null===(i=this._openTelemetry)||void 0===i||i.completeSpan({span:n,status:2,message:"changeMode() Ending"}),null===(a=this._videosdkLogs)||void 0===a||a.pushLogs({logText:"You are already in ".concat(t," mode"),logType:"INFO"}),new Error("You are already in ".concat(t," mode"));case 2:if(c=function(){var e=(0,o.A)(p().mark(function e(t,r){return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,S._socketRequest("createWebRtcTransport",{preferredProtocol:S._preferredProtocol,producing:t,consuming:r,sctpCapabilities:S._useDataChannel?S._mediasoupDevice.sctpCapabilities:void 0});case 1:return e.abrupt("return",e.sent);case 2:case"end":return e.stop()}},e)}));return function(t,r){return e.apply(this,arguments)}}(),!(0,Ft.kR)(t)){e.next=10;break}return this._consume=!0,this._produce=!0,this._mode=t,this._mediasoupDevice=new Le.pF({handlerName:this._handlerName}),e.next=3,this._socketRequest("getRouterRtpCapabilities");case 3:return u=e.sent,"react-native"!==this._deviceInfo.sdkType&&navigator.userAgent.includes("Firefox")&&(u.headerExtensions=null===(l=u.headerExtensions)||void 0===l?void 0:l.filter(function(e){return"urn:3gpp:video-orientation"!=e.uri})),e.next=4,this._mediasoupDevice.load({routerRtpCapabilities:u});case 4:if(!this._produce){e.next=6;break}return e.next=5,c(!0,!1);case 5:h=e.sent,this.createProducerTransport(h,n);case 6:if(s===Ft.nI.RECV_ONLY||!this._consume){e.next=8;break}return e.next=7,c(!1,!0);case 7:m=e.sent,this.createConsumerTransport(m,n);case 8:return null===(d=this._openTelemetry)||void 0===d||d.traceAutoComplete({spanName:"Sending changeMode request to server",span:n,status:1}),e.next=9,this._socketRequest("changeMode",{mode:t});case 9:this._produce&&(Rr.dispatch(nt({canSendMic:this._mediasoupDevice.canProduce("audio"),canSendWebcam:this._mediasoupDevice.canProduce("video")})),this._micEnabled&&this.enableMic(this.customMicrophoneAudioTrack),this._webcamEnabled&&this.enableWebcam(this.customCameraVideoTrack,n)),window.SHOW_INFO&&(f=Rr.getState(),g=f.me,Rr.dispatch(rt(g.id))),e.next=17;break;case 10:if(!(0,Ft.kR)(s)||t!==Ft.nI.RECV_ONLY){e.next=12;break}return this._produce=!1,this._mode=t,this._closeProducersAndTransport(),e.next=11,this._socketRequest("changeMode",{mode:t});case 11:e.next=17;break;case 12:if(!(0,Ft.wZ)(s)||t!==Ft.nI.RECV_ONLY){e.next=15;break}return this._consume=!0,this._mode=t,e.next=13,this._setupWebrtcTransport(n);case 13:return e.next=14,this._socketRequest("changeMode",{mode:t});case 14:window.SHOW_INFO&&(v=Rr.getState(),_=v.me,Rr.dispatch(rt(_.id))),e.next=17;break;case 15:if(!(0,Ft.wZ)(t)){e.next=17;break}return e.next=16,this._socketRequest("changeMode",{mode:t});case 16:this._consume=!1,this._produce=!1,this._mode=t,this._dataConsumers.clear(),this._closeTransports();case 17:e.next=19;break;case 18:e.prev=18,w=e.catch(1),null===(y=this._videosdkLogs)||void 0===y||y.pushLogs({logText:"Error changeMode(".concat(t,") | failed"),logType:"ERROR",attributes:{error:w.message}}),null===(b=this._openTelemetry)||void 0===b||b.completeSpan({span:n,status:2,message:"changeMode(".concat(t,") | failed")});case 19:case"end":return e.stop()}},e,this,[[1,18]])})),function(e){return De.apply(this,arguments)})},{key:"_closeProducersAndTransport",value:function(){var e;this._webcamProducer&&(this._webcamProducer.close(),this._webcamProducer=null),this._micProducer&&(this._micProducer.close(),this._micProducer=null),this._shareProducer&&(this._shareProducer.close(),this._shareProducer=null),this._shareAudioProducer&&(this._shareAudioProducer.close(),this._shareAudioProducer=null),null===(e=this._sendTransport)||void 0===e||e.close(),this._sendTransport=null}},{key:"_closeTransports",value:function(){var e,t;this._sendTransport&&(null===(e=this._sendTransport)||void 0===e||e.close(),this._sendTransport=null),this._recvTransport&&(null===(t=this._recvTransport)||void 0===t||t.close(),this._recvTransport=null)}},{key:"_setupWebrtcTransport",value:(xe=(0,o.A)(p().mark(function e(t){var r,n,s;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._mediasoupDevice=new Le.pF({handlerName:this._handlerName}),e.next=1,this._socketRequest("getRouterRtpCapabilities");case 1:return r=e.sent,"react-native"!==this._deviceInfo.sdkType&&navigator.userAgent.includes("Firefox")&&(r.headerExtensions=null===(n=r.headerExtensions)||void 0===n?void 0:n.filter(function(e){return"urn:3gpp:video-orientation"!=e.uri})),e.next=2,this._mediasoupDevice.load({routerRtpCapabilities:r});case 2:return e.next=3,this._socketRequest("createWebRtcTransport",{preferredProtocol:this._preferredProtocol,producing:!1,consuming:!0,sctpCapabilities:this._useDataChannel?this._mediasoupDevice.sctpCapabilities:void 0});case 3:s=e.sent,this.createConsumerTransport(s,t);case 4:case"end":return e.stop()}},e,this)})),function(e){return xe.apply(this,arguments)})},{key:"enablePeerWebcam",value:(Oe=(0,o.A)(p().mark(function e(t){var r,n,s;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return null===(r=this._openTelemetry)||void 0===r||r.traceAutoComplete({spanName:"Enabling peer ".concat(t," Webcam"),status:1}),Or.debug("enablePeerWebcam()"),e.prev=1,e.next=2,this._socketRequest("enablePeerWebcam",{peerId:t});case 2:e.next=4;break;case 3:e.prev=3,s=e.catch(1),null===(n=this._videosdkLogs)||void 0===n||n.pushLogs({logText:"Error enablePeerWebcam | failed",logType:"ERROR",attributes:{error:s.message}}),Or.error("enablePeerWebcam() | failed:%o",s);case 4:case"end":return e.stop()}},e,this,[[1,3]])})),function(e){return Oe.apply(this,arguments)})},{key:"disablePeerWebcam",value:(Pe=(0,o.A)(p().mark(function e(t){var r,n,s;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return null===(r=this._openTelemetry)||void 0===r||r.traceAutoComplete({spanName:"Disabling peer ".concat(t," Webcam"),status:1}),Or.debug("disablePeerWebcam()"),e.prev=1,e.next=2,this._socketRequest("disablePeerWebcam",{peerId:t});case 2:e.next=4;break;case 3:e.prev=3,s=e.catch(1),null===(n=this._videosdkLogs)||void 0===n||n.pushLogs({logText:"Error disablePeerWebcam | failed",logType:"ERROR",attributes:{error:s.message}});case 4:case"end":return e.stop()}},e,this,[[1,3]])})),function(e){return Pe.apply(this,arguments)})},{key:"getMicStats",value:function(e){var t=this;if(this._micProducer){var r=0;e.onStatsCollected=function(e){var n;t._stats.producerStats||(t._stats.producerStats={}),t._stats.producerStats.audio||(t._stats.producerStats.audio=[]),t._micProducer&&(t._latestStats[null===(n=t._micProducer)||void 0===n?void 0:n.id]=[]),e.audio.forEach(function(e){var r;t._micProducer&&t._latestStats[null===(r=t._micProducer)||void 0===r?void 0:r.id].push(e)}),r%5==0&&null!=t._micProducer&&t._stats.producerStats.audio.push(br({timestamp:new Date},t._latestStats[t._micProducer.id]?t._latestStats[t._micProducer.id][0]:{})),r++}}}},{key:"enableMic",value:(Ce=(0,o.A)(p().mark(function e(){var t,r,n,s,i,a,o,c,d,u,l,h,m,f,g,v,_,y,b,w,S,R,k,E,T,C,P,O,x,D,I,A,M,L,N,j,B,U,F,q,W,V,H,z,K,G,$,J,Q,Y,X,Z,ee,te,re,ne,se,ie,ae,oe,ce,de,ue,le,pe,he,me,fe,ge,ve,_e,ye,be,we,Se=this,Re=arguments;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=Re.length>0&&void 0!==Re[0]?Re[0]:void 0,o=Re.length>1&&void 0!==Re[1]?Re[1]:void 0,c=null===(t=this._openTelemetry)||void 0===t?void 0:t.trace({spanName:"enableMic() Calling ".concat(a?"With Custom Audio Track":"Without Custom Audio Track "),attributes:{customAudioConfig:a?JSON.stringify(a):"Not Specify Custom Track"},span:o||null}),Or.debug("enableMic()"),this._micEnabled=!0,!this._micProducer){e.next=4;break}if(l=null===(d=this._openTelemetry)||void 0===d?void 0:d.trace({spanName:"Mic Producer found",span:c}),a&&(null===(h=this._openTelemetry)||void 0===h||h.traceAutoComplete({spanName:"Stopping customAudioTrack",span:c,status:1}),a.getTracks().forEach(function(e){e.stop()})),null===(u=this._openTelemetry)||void 0===u||u.completeSpan({span:l,status:1,message:"Resuming Mic Producer"}),this._micProducer.resume(),m=this._micProducer,!this._sendTransport){e.next=2;break}return e.next=1,this._sendTransport.produce({track:this._micProducer.track,encodings:this._micProducer._appData.encodings,codecOptions:this._micProducer._appData.codecOptions,appData:{isEncrypted:this.isE2EEEnabled},onRtpSender:function(e){Se.e2eeManager&&(e.senderStreams=e.createEncodedStreams())}});case 1:this._micProducer=e.sent,this.e2eeManager&&this.e2eeManager.emit("NEW_PRODUCER",this._micProducer),this._micProducer?(g=ut({id:this._micProducer.id,paused:this._micProducer.paused,track:this._micProducer.track,rtpParameters:this._micProducer.rtpParameters,codec:this._micProducer.rtpParameters.codecs[0].mimeType.split("/")[1],encodings:m._appData.encodings,codecOptions:m._appData.codecOptions,instance:this._micProducer,rtpSender:this._micProducer.rtpSender}),this._micProducer.track.getConstraints().deviceId&&(this._mic.device=this._mics.get(this._micProducer.track.getConstraints().deviceId)),Rr.dispatch(g),this._eventEmitter.emit(g.type,g.payload),null===(f=this._openTelemetry)||void 0===f||f.completeSpan({span:c,status:1,message:"Enable Mic Successful"})):null===(v=this._openTelemetry)||void 0===v||v.completeSpan({span:c,status:2,message:"Error in enableMic() :: micProducer null"}),e.next=3;break;case 2:return null===(_=this._videosdkLogs)||void 0===_||_.pushLogs({logText:jt.q.ERROR_ACTION_PERFORMED_BEFORE_MEETING_JOINED.message,attributes:{error:"Error in enableMic() :: Transport is not setup"},logType:"ERROR",dashboardLog:!0}),this._emitError(jt.q.ERROR_ACTION_PERFORMED_BEFORE_MEETING_JOINED),e.abrupt("return");case 3:return y=this._metrics.addNewProbe(this._micProducer,{name:"mic_producer"}),this._micProducer.observer.on("pause",function(){null==y||y.stop(),Se._latestStats[Se._micProducer.id]=[],Se._metrics.removeExistingProbe(y)}),this._micProducer.observer.on("close",function(){null==y||y.stop(),Se._latestStats[Se._micProducer.id]=[],Se._metrics.removeExistingProbe(y)}),this.getMicStats(y),y.start(),e.abrupt("return");case 4:if(!this._mediasoupDevice){e.next=6;break}if(this._mediasoupDevice.canProduce("audio")){e.next=5;break}return S="react-native"==this._deviceInfo.sdkType?jt.q.ERROR_RN_MIC_ACCESS_UNAVAILABLE.message:jt.q.ERROR_MICROPHONE_ACCESS_UNAVAILABLE.message,null===(b=this._videosdkLogs)||void 0===b||b.pushLogs({logText:S,attributes:{error:"Error in enableMic() :: Microphone access unavailable"},logType:"ERROR",dashboardLog:!0}),Or.error("enableMic() | cannot produce audio"),null===(w=this._openTelemetry)||void 0===w||w.completeSpan({span:c,status:2,message:"Error in enableMic() :: ".concat(S)}),e.abrupt("return");case 5:e.next=7;break;case 6:return null===(R=this._videosdkLogs)||void 0===R||R.pushLogs({logText:"Oops! Something went wrong, and we're unable to enable the mic. Please try again.",logType:"ERROR",attributes:{error:"Error in enableMic(): Something went wrong."},dashboardLog:!0}),null===(k=this._openTelemetry)||void 0===k||k.completeSpan({span:c,status:2,message:"Error in enableMic() :: mediasoupDevice is undefined"}),e.abrupt("return");case 7:if(e.prev=7,this._externalVideo){e.next=24;break}return Or.debug("enableMic() | calling getUserMedia()"),e.next=8,this._updateMics(c);case 8:if(this._mic.device){e.next=9;break}throw new Error("Whoops! No Microphone Found: We couldn't find your microphone. Is it plugged in and turned on? If so, try restarting your computer or checking your device settings. Also, ensure you're on a secure website (https://).");case 9:try{a&&"ended"==(E=a.getAudioTracks()[0]).readyState&&(E=null,A=jt.q.ERROR_CUSTOM_AUDIO_TRACK_ENDED,null===(I=this._videosdkLogs)||void 0===I||I.pushLogs({logText:A.message,logType:"INFO",attributes:{error:"In enableMic() :: Invalid Custom Track Passed"},dashboardLog:!0}),this._emitError(A))}catch(p){L=jt.q.ERROR_INVALID_CUSTOM_AUDIO_TRACK,null===(M=this._videosdkLogs)||void 0===M||M.pushLogs({logText:L.message,logType:"INFO",attributes:{error:"In enableMic() :: Invalid Custom Track Passed"}}),this._emitError(L)}if(E){e.next=23;break}return B=null===(N=this._openTelemetry)||void 0===N?void 0:N.trace({spanName:"Creating Track",span:c}),e.prev=10,e.next=11,navigator.mediaDevices.getUserMedia({audio:{deviceId:{ideal:this._mic.device.deviceId},channelCount:1,noiseSuppression:!0,echoCancellation:!0,googEchoCancellation:!0,googEchoCancellation2:!0,googAutoGainControl:!0,googAutoGainControl2:!0,googNoiseSuppression:!0,googNoiseSuppression2:!0,googHighpassFilter:!0}});case 11:U=e.sent,e.next=22;break;case 12:if(e.prev=12,ye=e.catch(10),null===(F=this._openTelemetry)||void 0===F||F.completeSpan({message:"Error in enableMic() :: ".concat(ye.message),span:B,status:2}),"SecurityError"!==ye.name){e.next=13;break}V=jt.q.ERROR_RN_MIC_ACCESS_DENIED_OR_DISMISSED,H=V.message,this._emitError(V),null===(q=this._videosdkLogs)||void 0===q||q.pushLogs({logText:H,logType:"ERROR",attributes:{error:"Error in enableMic() :: Microphone Permission Denied or Dismissed"},dashboardLog:!0}),null===(W=this._openTelemetry)||void 0===W||W.completeSpan({message:"Error in enableMic() :: occurred in creating audio track, ".concat(H),span:c,status:2}),e.next=21;break;case 13:if("DOMException"!==ye.name){e.next=14;break}G=jt.q.ERROR_RN_MIC_NOT_FOUND,$=G.message,this._emitError(G),null===(z=this._videosdkLogs)||void 0===z||z.pushLogs({logText:$,logType:"ERROR",attributes:{error:"Error in enableMic() :: No Microphone Device Found"},dashboardLog:!0}),null===(K=this._openTelemetry)||void 0===K||K.completeSpan({message:"Error in enableMic() :: occurred in creating audio track, ".concat($),span:c,status:2}),e.next=21;break;case 14:if(!(ye instanceof DOMException)){e.next=20;break}be=ye.name,e.next="NotAllowedError"===be?15:"NotReadableError"===be?16:"NotFoundError"===be?17:18;break;case 15:return J=this.handleNotAllowedError(ye,this._openTelemetry,this._videosdkLogs,c,"audio"),this._emitError(J),e.abrupt("continue",19);case 16:return Q=this.handleNotReadableError(ye,this._openTelemetry,this._videosdkLogs,c,"audio"),this._emitError(Q),e.abrupt("continue",19);case 17:return Y=jt.q.ERROR_MICROPHONE_NOT_FOUND,navigator&&navigator.userAgent&&-1!=navigator.userAgent.indexOf("Firefox")&&(Y=jt.q.ERROR_MICROPHONE_PERMISSION_DENIED_BY_OS),X=Y.message,this._emitError(Y),null===(r=this._videosdkLogs)||void 0===r||r.pushLogs({logText:X,logType:"ERROR",attributes:{error:"Error in enableMic() :: No Microphone Device Found"},dashboardLog:!0}),null===(n=this._openTelemetry)||void 0===n||n.completeSpan({message:"Error in enableMic() :: occurred in creating audio track, ".concat(X),span:c,status:2}),e.abrupt("continue",19);case 18:return Z="An error occurred in creating audio track, ".concat(ye.message),null===(s=this._videosdkLogs)||void 0===s||s.pushLogs({logText:ye.message,logType:"ERROR",attributes:{error:"Error in enableMic() :: ".concat(Z)},dashboardLog:!0}),null===(i=this._openTelemetry)||void 0===i||i.completeSpan({message:"Error in enableMic() :: ".concat(Z),span:c,status:2}),e.abrupt("continue",19);case 19:e.next=21;break;case 20:re="An error occurred in creating audio track, ".concat(ye.message),null===(ee=this._videosdkLogs)||void 0===ee||ee.pushLogs({logText:ye.message,logType:"ERROR",attributes:{error:"Error in enableMic() :: ".concat(re)},dashboardLog:!0}),null===(te=this._openTelemetry)||void 0===te||te.completeSpan({message:"Error in enableMic() :: ".concat(re),span:c,status:2});case 21:return e.abrupt("return");case 22:E=U.getAudioTracks()[0],null===(j=this._openTelemetry)||void 0===j||j.completeSpan({message:"Audio Track Generated",span:B,status:1});case 23:e.next=26;break;case 24:return e.next=25,this._getExternalVideoStream();case 25:ne=e.sent,E=ne.getAudioTracks()[0].clone();case 26:if(T=null===(C=this._openTelemetry)||void 0===C?void 0:C.trace({spanName:"Generating Producer Configuration",span:c}),se={opusStereo:1,opusDtx:1},a&&(ie=a.encoderConfig?Nt.$.audioProfiles[a.encoderConfig]:Nt.$.audioProfiles.speech_standard,se={opusStereo:ie.stereo?1:0,opusFec:ie.fec?1:0,opusDtx:ie.dtx?1:0,opusMaxPlaybackRate:ie.maxPlaybackRate,opusPtime:ie.packetTime}),oe={encodings:ae=[{networkPriority:"high"}],codecOptions:se},null===(P=this._openTelemetry)||void 0===P||P.traceAutoComplete({spanName:"Generated AppData",span:T,attributes:{appData:JSON.stringify(oe)},status:1}),null===(O=this._openTelemetry)||void 0===O||O.completeSpan({span:T,status:1,message:"Producer Configuration Generated"}),T=null===(x=this._openTelemetry)||void 0===x?void 0:x.trace({spanName:"Creating Mic Producer",span:c}),null===(D=E)||void 0===D||D.addEventListener("ended",function(){try{var e,t,r="react-native"==Se._deviceInfo.sdkType?jt.q.ERROR_RN_MIC_TRACK_ENDED:jt.q.ERROR_MICROPHONE_TRACK_ENDED;null===(e=Se._videosdkLogs)||void 0===e||e.pushLogs({logText:r.message,logType:"ERROR",attributes:{error:"Error Track Ended :: ".concat(r.message)},dashboardLog:!0}),null===(t=Se._openTelemetry)||void 0===t||t.traceAutoComplete({spanName:"this._micProducer trackended or Microphone disconnected!",span:c,message:r.message,status:2}),Rr.dispatch(At({type:"error",text:"Microphone disconnected!"})),Se.disableMic(!0,c).catch(function(){})}catch(n){}}),!this._sendTransport){e.next=28;break}return e.next=27,this._sendTransport.produce({track:E,encodings:ae,codecOptions:se,appData:br(br({},oe),{},{isEncrypted:this.isE2EEEnabled}),onRtpSender:function(e){Se.e2eeManager&&(e.senderStreams=e.createEncodedStreams())}});case 27:this._micProducer=e.sent,this.e2eeManager&&this.e2eeManager.emit("NEW_PRODUCER",this._micProducer),e.next=29;break;case 28:return null===(ce=this._videosdkLogs)||void 0===ce||ce.pushLogs({logText:jt.q.ERROR_ACTION_PERFORMED_BEFORE_MEETING_JOINED.message,attributes:{error:"Error in enableMic() :: Transport is not setup"},logType:"ERROR",dashboardLog:!0}),this._emitError(jt.q.ERROR_ACTION_PERFORMED_BEFORE_MEETING_JOINED),e.abrupt("return");case 29:this._micProducer?(E.getConstraints().deviceId&&(this._mic.device=this._mics.get(E.getConstraints().deviceId)),le=ut({id:this._micProducer.id,paused:this._micProducer.paused,track:this._micProducer.track,rtpParameters:this._micProducer.rtpParameters,codec:this._micProducer.rtpParameters.codecs[0].mimeType.split("/")[1],encodings:ae,codecOptions:se,instance:this._micProducer,rtpSender:this._micProducer.rtpSender}),Rr.dispatch(le),this._eventEmitter.emit(le.type,le.payload),(pe=this._metrics.addNewProbe(this._micProducer,{name:"mic_producer"})).start(),this.getMicStats(pe),this._micProducer.on("transportclose",function(){var e,t=lt(Se._micProducer.id);Rr.dispatch(t),Se._eventEmitter.emit(t.type,t.payload),null===(e=Se._micProducer)||void 0===e||e.close(),Se._micProducer=null}),this._micProducer.observer.on("pause",function(){null==pe||pe.stop(),Se._latestStats[Se._micProducer.id]=[],Se._metrics.removeExistingProbe(pe)}),this._micProducer.observer.on("close",function(){null==pe||pe.stop(),Se._latestStats[Se._micProducer.id]=[],Se._metrics.removeExistingProbe(pe)}),this._micProducer.on("trackended",function(){var e,t,r="react-native"==Se._deviceInfo.sdkType?jt.q.ERROR_RN_MIC_TRACK_ENDED:jt.q.ERROR_MICROPHONE_TRACK_ENDED;null===(e=Se._videosdkLogs)||void 0===e||e.pushLogs({logText:r.message,logType:"ERROR",attributes:{error:"Error in enableMic() :: ".concat(r.message)},dashboardLog:!0}),null===(t=Se._openTelemetry)||void 0===t||t.traceAutoComplete({spanName:"this._micProducer trackended or Microphone disconnected!",span:c,message:r.message,status:2}),Rr.dispatch(At({type:"error",text:"Microphone disconnected!"})),Se.disableMic(!0,c).catch(function(){})}),null===(de=this._openTelemetry)||void 0===de||de.completeSpan({span:T,status:1,message:"Mic Producer Created"}),null===(ue=this._openTelemetry)||void 0===ue||ue.completeSpan({span:c,status:1,message:"Enable Mic Successful"})):(null===(he=this._videosdkLogs)||void 0===he||he.pushLogs({logText:"Oops! Something went wrong, and we're unable to enable the mic. Please try again.",logType:"ERROR",attributes:{error:"Error in enableMic(): Something went wrong."},dashboardLog:!0}),null===(me=this._openTelemetry)||void 0===me||me.completeSpan({span:T,status:2,message:"Error in enableMic() :: micProducer null"}),null===(fe=this._openTelemetry)||void 0===fe||fe.completeSpan({span:c,status:2,message:"Error in enableMic() :: micProducer null"})),e.next=32;break;case 30:return e.prev=30,we=e.catch(7),null===(ge=this._openTelemetry)||void 0===ge||ge.completeSpan({span:T,status:2,message:"Error in enableMic() :: occurred in creating mic producer, ".concat(we.message)}),null===(ve=this._openTelemetry)||void 0===ve||ve.completeSpan({span:c,status:2,message:"Error in enableMic :: ".concat(we.message)}),null===(_e=this._videosdkLogs)||void 0===_e||_e.pushLogs({logText:we.message,logType:"ERROR",attributes:{error:"Error in enableMic() :: ".concat(we.message)},dashboardLog:!0}),Or.error("enableMic() | failed:%o",we),Rr.dispatch(At({type:"error",text:"Error enabling microphone: ".concat(we)})),e.next=31,this._socketRequest("produceError",{mediaType:"audio",message:we.message});case 31:E&&E.stop();case 32:case"end":return e.stop()}},e,this,[[7,30],[10,12]])})),function(){return Ce.apply(this,arguments)})},{key:"disableMic",value:(Te=(0,o.A)(p().mark(function e(){var t,r,n,s,i,a,o,c,d,u,l,h,m,f,g,v,_,y,b,w,S,R,k,E,T,C,P,O=arguments;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=O.length>0&&void 0!==O[0]&&O[0],s=O.length>1&&void 0!==O[1]?O[1]:void 0,Or.debug("disableMic()"),i=null===(t=this._openTelemetry)||void 0===t?void 0:t.trace({spanName:"disableMic() Calling",status:1,span:s||null}),this._micProducer){e.next=1;break}return null===(a=this._openTelemetry)||void 0===a||a.completeSpan({span:i,status:2,message:"Error in disableMic() :: Mic Producer Not found"}),null===(o=this._videosdkLogs)||void 0===o||o.pushLogs({logText:"Attempted to call disableMic() multiple times",attributes:{error:"Error in disableMic() :: Microphone is already disabled"},logType:"ERROR",dashboardLog:!0}),e.abrupt("return");case 1:if(c=null===(r=this._openTelemetry)||void 0===r?void 0:r.trace({spanName:"Closing Mic Producer",span:i,status:1}),this._micEnabled=!1,!this._micProducer||n){e.next=6;break}return h=null===(d=this._openTelemetry)||void 0===d?void 0:d.trace({spanName:"Pausing Mic Producer",span:c,status:1}),this._micProducer.pause(),m=lt(this._micProducer.id),null===(u=this._openTelemetry)||void 0===u||u.completeSpan({span:h,status:1,message:"Pause Mic Successfully"}),Rr.dispatch(m),this._eventEmitter.emit(m.type,m.payload),e.prev=2,e.next=3,this._socketRequest("closeProducer",{producerId:this._micProducer.id});case 3:null===(f=this._openTelemetry)||void 0===f||f.completeSpan({span:c,status:1,message:"Requested Server to Close Producer"}),e.next=5;break;case 4:e.prev=4,C=e.catch(2),Rr.dispatch(At({type:"error",text:"Error closing server-side mic Producer: ".concat(C)})),y="Error in disableMic() :: Failed to close server-side microphone producer. closeProducer status: ".concat(n),null===(g=this._openTelemetry)||void 0===g||g.completeSpan({span:c,status:2,message:"Error in disableMic() :: ".concat(C.message)}),null===(v=this._openTelemetry)||void 0===v||v.completeSpan({span:i,status:2,message:y}),null===(_=this._videosdkLogs)||void 0===_||_.pushLogs({logText:y,logType:"ERROR",attributes:{error:C.message},dashboardLog:!0});case 5:return null===(l=this._openTelemetry)||void 0===l||l.completeSpan({span:i,status:1,message:"Mic Disabled Successfully"}),e.abrupt("return");case 6:return this._micProducer.close(),b=lt(this._micProducer.id),Rr.dispatch(b),this._eventEmitter.emit(b.type,b.payload),e.prev=7,e.next=8,this._socketRequest("closeProducer",{producerId:this._micProducer.id});case 8:null===(w=this._openTelemetry)||void 0===w||w.completeSpan({span:c,status:1,message:"Requested Server to Close Producer"}),null===(S=this._openTelemetry)||void 0===S||S.completeSpan({span:i,status:1,message:"Mic Disabled Successfully"}),e.next=10;break;case 9:e.prev=9,P=e.catch(7),Rr.dispatch(At({type:"error",text:"Error closing server-side mic Producer: ".concat(P)})),T="Error in disableMic() :: Failed to close server-side microphone producer. closeProducer status: ".concat(n),null===(R=this._openTelemetry)||void 0===R||R.completeSpan({span:c,status:2,message:"Error in disableMic() :: ".concat(P.message)}),null===(k=this._openTelemetry)||void 0===k||k.completeSpan({span:i,status:2,message:T}),null===(E=this._videosdkLogs)||void 0===E||E.pushLogs({logText:T,logType:"ERROR",attributes:{error:P.message},dashboardLog:!0});case 10:this._micProducer=null;case 11:case"end":return e.stop()}},e,this,[[2,4],[7,9]])})),function(){return Te.apply(this,arguments)})},{key:"muteMic",value:(Ee=(0,o.A)(p().mark(function e(){var t,r;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return Or.debug("muteMic()"),this._micEnabled=!1,this._micProducer.pause(),e.prev=1,e.next=2,this._socketRequest("pauseProducer",{producerId:this._micProducer.id});case 2:Rr.dispatch(pt(this._micProducer.id)),e.next=4;break;case 3:e.prev=3,r=e.catch(1),Or.error("muteMic() | failed: %o",r),null===(t=this._videosdkLogs)||void 0===t||t.pushLogs({logText:"Error pausing server-side mic Producer",logType:"ERROR",attributes:{error:r.message}}),Rr.dispatch(At({type:"error",text:"Error pausing server-side mic Producer: ".concat(r)}));case 4:case"end":return e.stop()}},e,this,[[1,3]])})),function(){return Ee.apply(this,arguments)})},{key:"unmuteMic",value:(ke=(0,o.A)(p().mark(function e(){var t,r;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return Or.debug("unmuteMic()"),this._micEnabled=!0,this._micProducer.resume(),e.prev=1,e.next=2,this._socketRequest("resumeProducer",{producerId:this._micProducer.id});case 2:Rr.dispatch(ht(this._micProducer.id)),e.next=4;break;case 3:e.prev=3,r=e.catch(1),Or.error("unmuteMic() | failed: %o",r),null===(t=this._videosdkLogs)||void 0===t||t.pushLogs({logText:"Error resuming server-side mic Producer",logType:"ERROR",attributes:{error:r.message}}),Rr.dispatch(At({type:"error",text:"Error resuming server-side mic Producer: ".concat(r)}));case 4:case"end":return e.stop()}},e,this,[[1,3]])})),function(){return ke.apply(this,arguments)})},{key:"enableWebcam",value:(Re=(0,o.A)(p().mark(function e(){var t,r,n,s,i,a,o,c,d,u,l,h,m,f,g,v,_,y,b,w,S,R,k,E,T,C,P,O,x,D,I,A,M,L,N,j,B,U,F,q,W,V,H,z,K,G,$,J,Q,Y,X,Z,ee,te,re,ne,se,ie,ae,oe,ce,de,ue,le,pe,he,me,fe,ge,ve,_e,ye,be,we=this,Se=arguments;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=Se.length>0&&void 0!==Se[0]?Se[0]:void 0,o=Se.length>1&&void 0!==Se[1]?Se[1]:void 0,c=null===(t=this._openTelemetry)||void 0===t?void 0:t.trace({spanName:"enableWebcam() Calling ".concat(a?"With Custom Video Track":"Without Custom Video Track "),attributes:{customVideoConfig:a?JSON.stringify(a):"Not Specify Custom Track"},span:o||null}),Or.debug("enableWebcam()"),this._webcamEnabled=!0,!this._webcamProducer){e.next=1;break}return null===(d=this._openTelemetry)||void 0===d||d.completeSpan({span:c,status:2,message:"Error in enableWebcam() :: Webcam Producer found"}),null===(u=this._videosdkLogs)||void 0===u||u.pushLogs({logText:"Attempted to call enableWebcam() multiple times",attributes:{error:"Error in enableWebcam() :: Webcam is already enabled"},logType:"ERROR",dashboardLog:!0}),e.abrupt("return");case 1:if(!this._mediasoupDevice){e.next=3;break}if(this._mediasoupDevice.canProduce("video")){e.next=2;break}return m="react-native"==this._deviceInfo.sdkType?jt.q.ERROR_RN_CAMERA_ACCESS_UNAVAILABLE.message:jt.q.ERROR_CAMERA_ACCESS_UNAVAILABLE.message,null===(l=this._openTelemetry)||void 0===l||l.completeSpan({span:c,status:2,message:"Error in enableWebcam() :: ".concat(m)}),null===(h=this._videosdkLogs)||void 0===h||h.pushLogs({logText:m,attributes:{error:"Error in enableWebcam() :: Camera access unavailable"},logType:"ERROR",dashboardLog:!0}),Or.error("enableWebcam() | cannot produce video"),e.abrupt("return");case 2:e.next=4;break;case 3:return null===(f=this._videosdkLogs)||void 0===f||f.pushLogs({logText:"Oops! Something went wrong, and we're unable to enable the webcam. Please try again.",logType:"ERROR",attributes:{error:"Error in enableWebcam(): Something went wrong."}}),null===(g=this._openTelemetry)||void 0===g||g.completeSpan({span:c,status:2,message:"Error in enableWebcam() :: mediasoupDevice is undefined"}),e.abrupt("return");case 4:if(Rr.dispatch(vt(!0)),y=this._webcam.resolution,e.prev=5,this._externalVideo){e.next=24;break}return e.next=6,this._updateWebcams(c);case 6:if(_=this._webcam.device){e.next=7;break}throw new Error("Whoops! No Webcam Found: We couldn't find your camera. Is it plugged in and turned on? If so, try restarting your computer or checking your device settings. If you need help, check out troubleshooter at https://test.8x8.vc/. Also, ensure you're on a secure website (https://).");case 7:Or.debug("enableWebcam() | calling getUserMedia()");try{a&&"ended"==(v=a.getVideoTracks()[0]).readyState&&(v=null,E=jt.q.ERROR_CUSTOM_VIDEO_TRACK_ENDED,null===(k=this._videosdkLogs)||void 0===k||k.pushLogs({logText:E.message,logType:"INFO",attributes:{error:"In enableWebcam() :: Invalid Custom Track Passed"},dashboardLog:!0}),this._emitError(E))}catch(p){C=jt.q.ERROR_INVALID_CUSTOM_VIDEO_TRACK,null===(T=this._videosdkLogs)||void 0===T||T.pushLogs({logText:C.message,logType:"INFO",attributes:{error:"In enableWebcam() :: Invalid Custom Track Passed"}}),this._emitError(C)}if(v){e.next=23;break}if(O=null===(P=this._openTelemetry)||void 0===P?void 0:P.trace({spanName:"Creating Track",span:c}),x=null,e.prev=8,"hd"!=this._webcam.resolution){e.next=10;break}return e.next=9,this.createCameraVideoTrack({cameraId:_.deviceId,encoderConfig:"h720p_w1280p",multiStream:this._useSimulcast,facingMode:_.facing});case 9:a=e.sent,x=JSON.stringify({encoderConfig:"h720p_w1280p",multiStream:this._useSimulcast}),e.next=12;break;case 10:return e.next=11,this.createCameraVideoTrack({cameraId:_.deviceId,encoderConfig:"h540p_w960p",multiStream:this._useSimulcast,facingMode:_.facing});case 11:a=e.sent,x=JSON.stringify({encoderConfig:"h540p_w960p",multiStream:this._useSimulcast});case 12:v=a.getVideoTracks()[0],null===(D=this._openTelemetry)||void 0===D||D.completeSpan({message:"Video Track Generated",span:O,attributes:{customVideoTrackConfig:x},status:1}),e.next=23;break;case 13:if(e.prev=13,_e=e.catch(8),null===(I=this._openTelemetry)||void 0===I||I.completeSpan({message:"Error in enableWebcam() :: ".concat(_e.message),span:O,status:2}),"SecurityError"!==_e.name){e.next=14;break}L=jt.q.ERROR_RN_CAMERA_ACCESS_DENIED_OR_DISMISSED,N=L.message,this._emitError(L),null===(A=this._videosdkLogs)||void 0===A||A.pushLogs({logText:N,logType:"ERROR",attributes:{error:"Error in enableWebcam() :: Camera Permission Denied or Dismissed"},dashboardLog:!0}),null===(M=this._openTelemetry)||void 0===M||M.completeSpan({message:"Error in enableWebcam() :: occurred in creating video track, ".concat(N),span:enableMicSpan,status:2}),e.next=22;break;case 14:if("DOMException"!==_e.name){e.next=15;break}U=jt.q.ERROR_RN_CAMERA_NOT_FOUND,F=U.message,this._emitError(U),null===(j=this._videosdkLogs)||void 0===j||j.pushLogs({logText:F,logType:"ERROR",attributes:{error:"Error in enableWebcam() :: No Camra Device Found"},dashboardLog:!0}),null===(B=this._openTelemetry)||void 0===B||B.completeSpan({message:"Error in enableWebcam() :: occurred in creating video track, ".concat(F),span:enableMicSpan,status:2}),e.next=22;break;case 15:if(!(_e instanceof DOMException)){e.next=21;break}ye=_e.name,e.next="NotAllowedError"===ye?16:"NotReadableError"===ye?17:"NotFoundError"===ye?18:19;break;case 16:return q=this.handleNotAllowedError(_e,this._openTelemetry,this._videosdkLogs,c,"video"),this._emitError(q),e.abrupt("continue",20);case 17:return W=this.handleNotReadableError(_e,this._openTelemetry,this._videosdkLogs,c,"video"),this._emitError(W),e.abrupt("continue",20);case 18:return V=jt.q.ERROR_CAMERA_NOT_FOUND,navigator&&navigator.userAgent&&-1!=navigator.userAgent.indexOf("Firefox")&&(V=jt.q.ERROR_CAMERA_PERMISSION_DENIED_BY_OS),H=V.message,this._emitError(V),null===(r=this._videosdkLogs)||void 0===r||r.pushLogs({logText:H,logType:"ERROR",attributes:{error:"Error in enableWebcam() :: No Webcam Device Found"},dashboardLog:!0}),null===(n=this._openTelemetry)||void 0===n||n.completeSpan({message:"Error in enableWebcam() :: occurred in creating video track, ".concat(H),span:c,status:2}),e.abrupt("continue",20);case 19:return z="An error occurred in creating video track, ".concat(_e.message),null===(s=this._videosdkLogs)||void 0===s||s.pushLogs({logText:_e.message,logType:"ERROR",attributes:{error:"Error in enableWebcam() :: ".concat(z)},dashboardLog:!0}),null===(i=this._openTelemetry)||void 0===i||i.completeSpan({message:"Error in enableWebcam() :: ".concat(z),span:c,status:2}),e.abrupt("continue",20);case 20:e.next=22;break;case 21:$="An error occurred in creating video track, ".concat(_e.message),null===(K=this._videosdkLogs)||void 0===K||K.pushLogs({logText:_e.message,logType:"ERROR",attributes:{error:"Error in enableWebcam() :: ".concat($)},dashboardLog:!0}),null===(G=this._openTelemetry)||void 0===G||G.completeSpan({message:"Error in enableWebcam() :: ".concat($),span:c,status:2});case 22:return e.abrupt("return");case 23:e.next=26;break;case 24:return _={label:"external video"},e.next=25,this._getExternalVideoStream();case 25:J=e.sent,v=J.getVideoTracks()[0].clone();case 26:if(Q=null===(b=this._openTelemetry)||void 0===b?void 0:b.trace({spanName:"Generating Producer Configuration",span:c}),Z={videoGoogleStartBitrate:1e3},!this._forceH264){e.next=28;break}if(X=this._mediasoupDevice.rtpCapabilities.codecs.find(function(e){return"video/h264"===e.mimeType.toLowerCase()})){e.next=27;break}throw new Error("The desired H.264 codec and configuration are not supported");case 27:e.next=29;break;case 28:if(!this._forceVP9){e.next=29;break}if(X=this._mediasoupDevice.rtpCapabilities.codecs.find(function(e){return"video/vp9"===e.mimeType.toLowerCase()})){e.next=29;break}throw new Error("The desired VP9 codec and configuration are not supported");case 29:v?(ee=v.getConstraints(),te="react-native"==this._deviceInfo.sdkType&&"ios"==this._deviceInfo.platform,Y=(0,Lt.v7)(!1,ee.width,ee.height,{simulcast:a.multiStream},te)):this._useSimulcast&&(re=this._mediasoupDevice.rtpCapabilities.codecs.find(function(e){return"video"===e.kind}),Y=this._forceVP9&&X||"video/vp9"===re.mimeType.toLowerCase()?Cr:Tr[this._webcam.resolution]),ne={};try{ne={encodings:Y,width:a?null===(se=v)||void 0===se?void 0:se.getConstraints().width:Er[y].width.ideal,height:a?null===(ie=v)||void 0===ie?void 0:ie.getConstraints().height:Er[y].height.ideal}}catch(p){null===(ae=this._videosdkLogs)||void 0===ae||ae.pushLogs({logText:p.message,logType:"INFO",attributes:{error:"In enableWebcam() :: ".concat(p.message)},dashboardLog:!0})}if(null===(w=this._openTelemetry)||void 0===w||w.traceAutoComplete({spanName:"Track Generated with height ".concat(ne.height," and width ").concat(ne.width," with multiStream ").concat(this._useSimulcast),attributes:{appData:JSON.stringify(ne)},span:c,status:1}),null===(S=this._openTelemetry)||void 0===S||S.completeSpan({span:Q,status:1,message:"Producer Configuration Generated"}),Q=null===(R=this._openTelemetry)||void 0===R?void 0:R.trace({spanName:"Creating Webcam Producer",span:c}),!this._sendTransport){e.next=31;break}return e.next=30,this._sendTransport.produce({track:v,encodings:Y,codecOptions:Z,codec:X,appData:br(br({},ne),{},{isEncrypted:this.isE2EEEnabled}),onRtpSender:function(e){we.e2eeManager&&(e.senderStreams=e.createEncodedStreams())}});case 30:this._webcamProducer=e.sent,this.e2eeManager&&this.e2eeManager.emit("NEW_PRODUCER",this._webcamProducer),e.next=32;break;case 31:return null===(oe=this._videosdkLogs)||void 0===oe||oe.pushLogs({logText:jt.q.ERROR_ACTION_PERFORMED_BEFORE_MEETING_JOINED.message,attributes:{error:"Error in enableWebcam() :: Transport is not setup"},logType:"ERROR",dashboardLog:!0}),this._emitError(jt.q.ERROR_ACTION_PERFORMED_BEFORE_MEETING_JOINED),e.abrupt("return");case 32:v.getConstraints().deviceId&&(this._webcam.device=this._webcams.get(v.getConstraints().deviceId)),this._webcamProducer?(ue=ut({id:this._webcamProducer.id,deviceLabel:_.label,type:this._getWebcamType(_),paused:this._webcamProducer.paused,track:this._webcamProducer.track,rtpParameters:this._webcamProducer.rtpParameters,codec:this._webcamProducer.rtpParameters.codecs[0].mimeType.split("/")[1],instance:this._webcamProducer,rtpSender:this._webcamProducer.rtpSender}),Rr.dispatch(ue),this._eventEmitter.emit(ue.type,ue.payload),le=0,(pe=this._metrics.addNewProbe(this._webcamProducer,"producer")).onStatsCollected=function(e){try{var t;we._stats.producerStats||(we._stats.producerStats={}),we._stats.producerStats.video||(we._stats.producerStats.video=[]),we._webcamProducer&&(we._latestStats[null===(t=we._webcamProducer)||void 0===t?void 0:t.id]=[]),e.video.forEach(function(e){var t;we._latestStats[null===(t=we._webcamProducer)||void 0===t?void 0:t.id].push(e)}),le%5==0&&null!=we._webcamProducer&&we._stats.producerStats.video.push({timestamp:new Date,stats:we._latestStats[we._webcamProducer.id]}),le++}catch(n){var r;null===(r=we._videosdkLogs)||void 0===r||r.pushLogs({logText:"Error PRODUCER Stats ERROR",logType:"ERROR",attributes:{error:n.message}})}},pe.start(),this._webcamProducer.observer.on("close",function(){pe.stop(),we._metrics.removeExistingProbe(pe)}),this._webcamProducer.on("transportclose",function(){var e,t=lt(we._webcamProducer.id);Rr.dispatch(t),we._eventEmitter.emit(t.type,t.payload),null===(e=we._webcamProducer)||void 0===e||e.close(),we._webcamProducer=null}),this._webcamProducer.on("trackended",function(){var e,t,r="react-native"==we._deviceInfo.sdkType?jt.q.ERROR_RN_CAMERA_TRACK_ENDED:jt.q.ERROR_WEBCAM_TRACK_ENDED;null===(e=we._videosdkLogs)||void 0===e||e.pushLogs({logText:r.message,logType:"ERROR",attributes:{error:"Error in enableWebcam() :: ".concat(r.message)},dashboardLog:!0}),null===(t=we._openTelemetry)||void 0===t||t.traceAutoComplete({spanName:"this._webcamProducer trackended or Webcam disconnected!",span:c,message:r.message,status:2}),Rr.dispatch(At({type:"error",text:"Webcam disconnected!"})),we.disableWebcam(c).catch(function(){})}),null===(ce=this._openTelemetry)||void 0===ce||ce.completeSpan({span:Q,status:1,message:"Webcam Producer Created"}),null===(de=this._openTelemetry)||void 0===de||de.completeSpan({span:c,status:1,message:"Enable Webcam Successful"})):(null===(he=this._videosdkLogs)||void 0===he||he.pushLogs({logText:"Oops! Something went wrong, and we're unable to enable the webcam. Please try again.",logType:"ERROR",attributes:{error:"Error in enableWebcam(): Something went wrong."},dashboardLog:!0}),null===(me=this._openTelemetry)||void 0===me||me.completeSpan({span:Q,status:2,message:"Error in enableWebcam() :: webcamProducer null"}),null===(fe=this._openTelemetry)||void 0===fe||fe.completeSpan({span:c,status:2,message:"Error in enableWebcam() :: webcamProducer null"})),e.next=35;break;case 33:return e.prev=33,be=e.catch(5),null===(ge=this._videosdkLogs)||void 0===ge||ge.pushLogs({logText:be.message,logType:"ERROR",attributes:{error:"Error in enableWebcam() :: ".concat(be.message)},dashboardLog:!0}),null===(ve=this._openTelemetry)||void 0===ve||ve.completeSpan({span:c,status:2,message:"Error in enableWebcam() :: ".concat(be.message)}),Rr.dispatch(At({type:"error",text:"Error enabling webcam: ".concat(be)})),e.next=34,this._socketRequest("produceError",{mediaType:"video",message:be.message});case 34:v&&v.stop();case 35:Rr.dispatch(vt(!1));case 36:case"end":return e.stop()}},e,this,[[5,33],[8,13]])})),function(){return Re.apply(this,arguments)})},{key:"handleNotAllowedError",value:function(e,t,r,n,s){var i;return i="Permission denied"===e.message||"Permission dismissed"===e.message?"video"===s?jt.q.ERROR_CAMERA_ACCESS_DENIED_OR_DISMISSED:jt.q.ERROR_MICROPHONE_ACCESS_DENIED_OR_DISMISSED:e.message.includes("The request is not allowed by the user agent")?"video"===s?jt.q.ERROR_CAMERA_PERMISSION_OR_AUTOPLAY_ISSUE:jt.q.ERROR_MICROPHONE_ACCESS_DENIED_OR_DISMISSED:"Permission denied by system"===e.message?"video"===s?jt.q.ERROR_CAMERA_PERMISSION_DENIED_BY_OS:jt.q.ERROR_MICROPHONE_PERMISSION_DENIED_BY_OS:"video"===s?jt.q.ERROR_GET_VIDEO_MEDIA_PERMISSION_DENIED:jt.q.ERROR_GET_AUDIO_MEDIA_PERMISSION_DENIED,r.pushLogs({logText:i.message,logType:"ERROR",attributes:{error:"Error in ".concat("video"===s?"enableWebcam()":"enableMic()"," :: ").concat(e.message)},dashboardLog:!0}),t.completeSpan({message:"video"===s?"Error in enableWebcam() :: occurred in creating video track, ".concat(i.message):"Error in enableMic() :: occurred in creating audio track, ".concat(i.message),span:n,status:2}),i}},{key:"handleNotReadableError",value:function(e,t,r,n,s){var i;return i="Device in use"===e.message?"video"===s?jt.q.ERROR_CAMERA_IN_USE:jt.q.ERROR_MICROPHONE_IN_USE:"video"===s?jt.q.ERROR_VIDEO_SOURCE_INITIATION_FAILED:jt.q.ERROR_MICROPHONE_IN_USE,r.pushLogs({logText:i.message,logType:"ERROR",attributes:{error:"Error in ".concat("video"===s?"enableWebcam()":"enableMic()"," :: ").concat(e.message)},dashboardLog:!0}),t.completeSpan({message:"video"===s?"Error in enableWebcam() :: occurred in creating video track, ".concat(i.message):"Error in enableMic() :: occurred in creating audio track, ".concat(i.message),span:n,status:2}),i}},{key:"createCameraVideoTrack",value:(Se=(0,o.A)(p().mark(function e(t){var r,n,s,i,a,o,c,d,u,l,h,m,f;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.cameraId,n=void 0===r?void 0:r,s=t.encoderConfig,i=void 0===s?void 0:s,a=t.facingMode,o=void 0===a?void 0:a,c=t.optimizationMode,d=void 0===c?void 0:c,u=t.multiStream,l=void 0===u||u,h=i?Nt.$.videoProfiles[i]:Nt.$.videoProfiles.h360p_w640p,m={video:{deviceId:n||void 0,facingMode:o||void 0,width:h.width,height:h.height,frameRate:h.frameRate}},e.next=1,(0,Yt.lp)(m);case 1:return f=e.sent,d&&(f.contentHint=d),f.encoderConfig=i||"h360p_w640p",f.contentHint=d||"",f.multiStream=l,f.cameraId=n,e.abrupt("return",f);case 2:case"end":return e.stop()}},e)})),function(e){return Se.apply(this,arguments)})},{key:"disableWebcam",value:(we=(0,o.A)(p().mark(function e(){var t,r,n,s,i,a,o,c,d,u,l,h,m,f,g=arguments;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=g.length>0&&void 0!==g[0]?g[0]:void 0,s=null===(t=this._openTelemetry)||void 0===t?void 0:t.trace({spanName:"disableWebcam() Calling",status:1,span:n||null}),Or.debug("disableWebcam()"),this._webcamEnabled=!1,this._webcamProducer){e.next=1;break}return null===(i=this._openTelemetry)||void 0===i||i.completeSpan({span:s,status:2,message:"Error in disableWebcam() :: Webcam Producer Not found"}),null===(a=this._videosdkLogs)||void 0===a||a.pushLogs({logText:"Attempted to call disableWebcam() multiple times",attributes:{error:"Error in disableWebcam() :: Webcam is already disabled"},logType:"ERROR",dashboardLog:!0}),e.abrupt("return");case 1:return o=null===(r=this._openTelemetry)||void 0===r?void 0:r.trace({spanName:"Closing Webcam Producer",span:s,status:1}),this._webcamProducer.close(),c=lt(this._webcamProducer.id),Rr.dispatch(c),this._eventEmitter.emit(c.type,c.payload),e.prev=2,e.next=3,this._socketRequest("closeProducer",{producerId:this._webcamProducer.id});case 3:null===(d=this._openTelemetry)||void 0===d||d.completeSpan({span:o,status:1,message:"Requested Server to Close Producer"}),this._webcamProducer=null,null===(u=this._openTelemetry)||void 0===u||u.completeSpan({span:s,status:1,message:"Webcam Disabled Successfully"}),e.next=5;break;case 4:e.prev=4,f=e.catch(2),null===(l=this._videosdkLogs)||void 0===l||l.pushLogs({logText:"Error in disableWebcam() :: Failed to close server-side webcam producer",logType:"ERROR",attributes:{error:f.message},dashboardLog:!0}),null===(h=this._openTelemetry)||void 0===h||h.completeSpan({span:o,status:2,message:"Error in disableWebcam() :: closing server-side webcam Producer: ".concat(f)}),null===(m=this._openTelemetry)||void 0===m||m.completeSpan({span:s,status:2,message:"Error in disableWebcam() :: closing server-side webcam Producer: ".concat(f)}),Rr.dispatch(At({type:"error",text:"Error closing server-side webcam Producer: ".concat(f)}));case 5:case"end":return e.stop()}},e,this,[[2,4]])})),function(){return we.apply(this,arguments)})},{key:"getMics",value:(be=(0,o.A)(p().mark(function e(){var t,r,n;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],e.prev=1,e.next=2,this._updateMics();case 2:this._mics.forEach(function(e,r){t.push({deviceId:r,label:e.label})}),e.next=4;break;case 3:e.prev=3,n=e.catch(1),Or.error("getMics() | Error",n),null===(r=this._videosdkLogs)||void 0===r||r.pushLogs({logText:n.message,logType:"ERROR",attributes:{error:"Error in getMics() :: Not able to get Mic List"},dashboardLog:!0});case 4:return e.abrupt("return",t);case 5:case"end":return e.stop()}},e,this,[[1,3]])})),function(){return be.apply(this,arguments)})},{key:"changeMic",value:(ye=(0,o.A)(p().mark(function e(t){var r,n,s,i,o,c,d,u,l,h,m,f,g,v,_;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=null===(r=this._openTelemetry)||void 0===r?void 0:r.trace({spanName:"changeMic() Calling"}),e.prev=1,"object"!=(0,a.A)(t)){e.next=4;break}return e.next=2,this.disableMic(!0,n);case 2:return e.next=3,this.enableMic(t,n);case 3:e.next=9;break;case 4:return c=t,e.next=5,this._updateMics();case 5:if(d=Array.from(this._mics.keys()),u=d.length,l=this._mic.device?this._mic.device.deviceId:void 0,null!=c&&null!=c?h=d.indexOf(c):(h=d.indexOf(l))<u-1?h++:h=0,this._mic.device=this._mics.get(d[h]),m=null===(s=this._openTelemetry)||void 0===s?void 0:s.trace({spanName:"Getting Selected Mic",span:n,attributes:{selectedWebcam:this._mic.device?JSON.stringify(this._mic.device):"No Mic devices"}}),this._mic.device){e.next=6;break}throw null===(f=this._videosdkLogs)||void 0===f||f.pushLogs({logText:"Error changeMic : No mic Found",logType:"ERROR"}),new Error("No mic Found");case 6:return e.next=7,this.disableMic(!0,n);case 7:return e.next=8,this.enableMic(void 0,n);case 8:null===(i=this._openTelemetry)||void 0===i||i.completeSpan({span:m,status:1,message:"Done"}),null===(o=this._openTelemetry)||void 0===o||o.completeSpan({span:n,status:1,message:"changeMic() Ending"});case 9:e.next=11;break;case 10:e.prev=10,_=e.catch(1),null===(g=this._openTelemetry)||void 0===g||g.completeSpan({span:n,status:2,message:"changeMic() | Error ".concat(_)}),null===(v=this._videosdkLogs)||void 0===v||v.pushLogs({logText:"Error changeMic() | Error",logType:"ERROR",attributes:{error:_.message}});case 11:case"end":return e.stop()}},e,this,[[1,10]])})),function(e){return ye.apply(this,arguments)})},{key:"getWebcams",value:(_e=(0,o.A)(p().mark(function e(){var t,r,n;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],e.prev=1,e.next=2,this._updateWebcams();case 2:this._webcams.forEach(function(e,r){t.push({deviceId:r,label:e.label,facingMode:e.facing||"environment"})}),e.next=4;break;case 3:e.prev=3,n=e.catch(1),Or.error("getWebcams() | failed %o",n),null===(r=this._videosdkLogs)||void 0===r||r.pushLogs({logText:n.message,logType:"ERROR",attributes:{error:"Error in getWebcams() :: Not able to get Webcam List"},dashboardLog:!0});case 4:return e.abrupt("return",t);case 5:case"end":return e.stop()}},e,this,[[1,3]])})),function(){return _e.apply(this,arguments)})},{key:"replaceWebcamStream",value:(ve=(0,o.A)(p().mark(function e(t){var r;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._webcamProducer){e.next=2;break}return r=t.getVideoTracks()[0],e.next=1,this._webcamProducer.replaceTrack({track:r});case 1:this._eventEmitter.emit("UPDATE_PRODUCER",{producer:this._webcamProducer}),e.next=4;break;case 2:return e.next=3,this.disableWebcam();case 3:return e.next=4,this.enableWebcam(t);case 4:case"end":return e.stop()}},e,this)})),function(e){return ve.apply(this,arguments)})},{key:"changeWebcam",value:(ge=(0,o.A)(p().mark(function e(t){var r,n,s,i,o,c,d,u,l,h,m,f,g,v,_,y;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=null===(r=this._openTelemetry)||void 0===r?void 0:r.trace({spanName:"changeWebcam() Calling"}),Rr.dispatch(vt(!0)),"object"!==(0,a.A)(t)){e.next=6;break}return e.prev=1,e.next=2,this.disableWebcam(n);case 2:return e.next=3,this.enableWebcam(t,n);case 3:e.next=5;break;case 4:e.prev=4,_=e.catch(1),Or.error("changeWebcam() | failed: %o",_),null===(s=this._videosdkLogs)||void 0===s||s.pushLogs({logText:"Error Could not change webcam",logType:"ERROR",attributes:{object:JSON.stringify(t),error:_.message}}),Rr.dispatch(At({type:"error",text:"Could not change webcam: ".concat(_)}));case 5:e.next=12;break;case 6:return e.prev=6,e.next=7,this._updateWebcams(n);case 7:if(d=Array.from(this._webcams.keys()),u=d.length,l=this._webcam.device?this._webcam.device.deviceId:void 0,null!=t&&null!=t?h=d.indexOf(t):(h=d.indexOf(l))<u-1?h++:h=0,this._webcam.device=this._webcams.get(d[h]),Or.debug("changeWebcam() | new selected webcam [device:%o]",this._webcam.device),this._webcam.resolution=this._webcam.resolution||"hd",m=null===(i=this._openTelemetry)||void 0===i?void 0:i.trace({spanName:"Getting Selected Webcam",span:n,attributes:{selectedWebcam:this._webcam.device?JSON.stringify(this._webcam.device):"No webcam devices"}}),this._webcam.device){e.next=8;break}throw null===(f=this._videosdkLogs)||void 0===f||f.pushLogs({logText:"Error changeWebcam : No webcam Found",logType:"ERROR"}),new Error("no webcam devices");case 8:return e.next=9,this.disableWebcam(n);case 9:return e.next=10,this.enableWebcam(void 0,n);case 10:return null===(o=this._openTelemetry)||void 0===o||o.completeSpan({span:m,status:1,message:"Done"}),null===(c=this._openTelemetry)||void 0===c||c.completeSpan({span:n,status:1,message:"changeWebcam() Ending"}),e.abrupt("return");case 11:e.prev=11,y=e.catch(6),Or.error("changeWebcam() | failed: %o",y),null===(g=this._videosdkLogs)||void 0===g||g.pushLogs({logText:"Error Could not change webcam",logType:"ERROR",attributes:{object:JSON.stringify(t),error:y.message}}),null===(v=this._openTelemetry)||void 0===v||v.completeSpan({span:n,status:2,message:"Could not change webcam ".concat(y)}),Rr.dispatch(At({type:"error",text:"Could not change webcam: ".concat(y)}));case 12:Rr.dispatch(vt(!1));case 13:case"end":return e.stop()}},e,this,[[1,4],[6,11]])})),function(e){return ge.apply(this,arguments)})},{key:"changeWebcamResolution",value:(fe=(0,o.A)(p().mark(function e(){var t,r,n,s,i,a,o;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:Or.debug("changeWebcamResolution()"),Rr.dispatch(vt(!0)),e.prev=1,i=this._webcam.resolution,e.next="qvga"===i?2:"vga"===i?3:"hd"===i?4:5;break;case 2:return this._webcam.resolution="vga",e.abrupt("continue",6);case 3:return this._webcam.resolution="hd",e.abrupt("continue",6);case 4:return this._webcam.resolution="qvga",e.abrupt("continue",6);case 5:this._webcam.resolution="hd";case 6:return Or.debug("changeWebcamResolution() | calling getUserMedia()"),e.prev=7,e.next=8,navigator.mediaDevices.getUserMedia({video:br({deviceId:{exact:this._webcam.device.deviceId}},Er[this._webcam.resolution])});case 8:t=e.sent,e.next=10;break;case 9:return e.prev=9,a=e.catch(7),null===(r=this._videosdkLogs)||void 0===r||r.pushLogs({logText:"Error in getUserMedia for changeWebcamResolution",logType:"ERROR",attributes:{error:JSON.stringify(a)}}),"Permission denied"===a.message||"NotAllowedError"===a.name?this._emitError(jt.q.ERROR_GET_VIDEO_MEDIA_PERMISSION_DENIED):this._emitError(jt.q.ERROR_GET_VIDEO_MEDIA),e.abrupt("return");case 10:return n=t.getVideoTracks()[0],e.next=11,this._webcamProducer.replaceTrack({track:n});case 11:Rr.dispatch(mt(this._webcamProducer.id,n)),e.next=13;break;case 12:e.prev=12,o=e.catch(1),Or.error("changeWebcamResolution() | failed: %o",o),null===(s=this._videosdkLogs)||void 0===s||s.pushLogs({logText:"Error Could not change webcam resolution",logType:"ERROR",attributes:{error:o.message}}),Rr.dispatch(At({type:"error",text:"Could not change webcam resolution: ".concat(o)}));case 13:Rr.dispatch(vt(!1));case 14:case"end":return e.stop()}},e,this,[[1,12],[7,9]])})),function(){return fe.apply(this,arguments)})},{key:"enableShare",value:(me=(0,o.A)(p().mark(function e(){var t,r,n,s,i,a,o,c,d,u,l,h,m,f,g,v,_,y,b,w,S,R,k,E,T,C,P,O,x,D,I,A,M,L,N,j,B,U,F,q,W,V,H,z,K,G=this,$=arguments;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=$.length>0&&void 0!==$[0]?$[0]:void 0,n=null===(t=this._openTelemetry)||void 0===t?void 0:t.trace({spanName:"enableShare() Calling ".concat(r?"With Custom Video Track":"Without Custom Video Track "),attributes:{customShareConfig:r?JSON.stringify(r):"Not Specify Custom Track"}}),Or.debug("enableShare()"),!this._shareProducer){e.next=1;break}return null===(s=this._openTelemetry)||void 0===s||s.completeSpan({span:n,status:2,message:"Screen Share Producer found"}),e.abrupt("return");case 1:if(this._mediasoupDevice.canProduce("video")){e.next=2;break}return null===(i=this._openTelemetry)||void 0===i||i.completeSpan({span:n,status:2,message:"enableShare() | cannot produce video"}),Or.error("enableShare() | cannot produce video"),e.abrupt("return");case 2:if(c=[],Rr.dispatch(_t(!0)),e.prev=3,Or.debug("enableShare() | calling getUserMedia()"),g=null===(d=this._openTelemetry)||void 0===d?void 0:d.trace({spanName:"Creating Track",span:n}),!r||!r.active){e.next=4;break}a=r.getVideoTracks()[0],o=r.getAudioTracks()[0],r.multiStream?(v=a.getConstraints(),_=v.height,y=v.frameRate,b=Nt.$.screenShareProfiles["h".concat(_,"p_").concat(y,"fps")],w=[{maxBitrate:b.bitrates.high,maxFramerate:y,scalabilityMode:"S3T3",dtx:!0},{maxBitrate:b.bitrates.medium,maxFramerate:y,scalabilityMode:"S2T3",dtx:!0},{maxBitrate:b.bitrates.low,maxFramerate:y,scalabilityMode:"S1T3",dtx:!0}],c=w):c=Pr,e.next=9;break;case 4:return e.prev=4,e.next=5,navigator.mediaDevices.getDisplayMedia({audio:!0,video:{width:{max:1920},height:{max:1080},frameRate:{max:10}}});case 5:R=e.sent,e.next=7;break;case 6:return e.prev=6,H=e.catch(4),null===(k=this._videosdkLogs)||void 0===k||k.pushLogs({logText:"Error in getDisplayMedia for screen share",logType:"ERROR",attributes:{error:JSON.stringify(H)}}),null===(E=this._openTelemetry)||void 0===E||E.completeSpan({span:n,status:2,message:"Error in getDisplayMedia for screen share ".concat(H)}),"Permission denied"===H.message||"NotAllowedError"===H.name?this._emitError(jt.q.ERROR_GET_DISPLAY_MEDIA_PERMISSION_DENIED):this._emitError(jt.q.ERROR_GET_DISPLAY_MEDIA),e.abrupt("return");case 7:if(R){e.next=8;break}return Rr.dispatch(_t(!0)),null===(T=this._openTelemetry)||void 0===T||T.completeSpan({span:n,status:2,message:"Stream not found"}),e.abrupt("return");case 8:a=R.getVideoTracks()[0],o=R.getAudioTracks()[0],c=Pr,null===(S=this._openTelemetry)||void 0===S||S.completeSpan({message:"Track Generated with height ".concat(a.getSettings().height," and width ").concat(a.getSettings().width),span:g,status:1});case 9:if(C=null===(u=this._openTelemetry)||void 0===u?void 0:u.trace({spanName:"Generating Producer Configuration",span:n}),O={videoGoogleStartBitrate:1e3},!this._forceH264){e.next=11;break}if(P=this._mediasoupDevice.rtpCapabilities.codecs.find(function(e){return"video/h264"===e.mimeType.toLowerCase()})){e.next=10;break}throw null===(x=this._videosdkLogs)||void 0===x||x.pushLogs({logText:"Error EnableShare : desired H264 codec+configuration is not supported",logType:"ERROR"}),new Error("desired H264 codec+configuration is not supported");case 10:e.next=12;break;case 11:if(!this._forceVP9){e.next=12;break}if(P=this._mediasoupDevice.rtpCapabilities.codecs.find(function(e){return"video/vp9"===e.mimeType.toLowerCase()})){e.next=12;break}throw null===(D=this._videosdkLogs)||void 0===D||D.pushLogs({logText:"Error EnableShare :desired VP9 codec+configuration is not supported",logType:"ERROR"}),new Error("desired VP9 codec+configuration is not supported");case 12:return null===(l=this._openTelemetry)||void 0===l||l.completeSpan({span:C,status:1,message:"Producer Configuration Generated"}),C=null===(h=this._openTelemetry)||void 0===h?void 0:h.trace({spanName:"Creating Share Producer",span:n}),e.next=13,this._sendTransport.produce({track:a,encodings:c.length>0?c:Pr,codecOptions:O,codec:P,appData:{share:!0,isEncrypted:this.isE2EEEnabled},onRtpSender:function(e){G.e2eeManager&&(e.senderStreams=e.createEncodedStreams())}});case 13:if(this._shareProducer=e.sent,this.e2eeManager&&this.e2eeManager.emit("NEW_PRODUCER",this._shareProducer),I=ut({id:this._shareProducer.id,type:"share",paused:this._shareProducer.paused,track:this._shareProducer.track,rtpParameters:this._shareProducer.rtpParameters,codec:this._shareProducer.rtpParameters.codecs[0].mimeType.split("/")[1],appData:{share:!0,isEncrypted:this.isE2EEEnabled},instance:this._shareProducer,rtpSender:this._shareProducer.rtpSender}),Rr.dispatch(I),this._eventEmitter.emit(I.type,I.payload),this._shareProducer.on("transportclose",function(){var e,t=lt(G._shareProducer.id);Rr.dispatch(t),G._eventEmitter.emit(t.type,t.payload),null===(e=G._shareProducer)||void 0===e||e.close(),G._shareProducer=null}),this._shareProducer.on("trackended",function(){var e;null===(e=G._openTelemetry)||void 0===e||e.traceAutoComplete({spanName:"this._shareProducer trackended or Share disconnected!",span:n,status:2}),Rr.dispatch(At({type:"error",text:"Share disconnected!"})),G.disableShare().catch(function(){})}),null===(m=this._openTelemetry)||void 0===m||m.completeSpan({span:C,status:1,message:"Share Producer Created"}),!o){e.next=18;break}return e.prev=14,L={opusStereo:1,opusDtx:1},C=null===(A=this._openTelemetry)||void 0===A?void 0:A.trace({spanName:"Creating Share Audio Producer",span:n}),e.next=15,this._sendTransport.produce({track:o,codecOptions:L,appData:{share:!0,isEncrypted:this.isE2EEEnabled},onRtpSender:function(e){G.e2eeManager&&(e.senderStreams=e.createEncodedStreams())}});case 15:this._shareAudioProducer=e.sent,N=ut({id:this._shareAudioProducer.id,type:"share",paused:this._shareAudioProducer.paused,track:this._shareAudioProducer.track,rtpParameters:this._shareAudioProducer.rtpParameters,codec:this._shareAudioProducer.rtpParameters.codecs[0].mimeType.split("/")[1],appData:{share:!0,isEncrypted:this.isE2EEEnabled},instance:this._shareAudioProducer,rtpSender:this._shareAudioProducer.rtpSender}),Rr.dispatch(N),this.e2eeManager&&this.e2eeManager.emit("NEW_PRODUCER",this._shareAudioProducer),this._eventEmitter.emit(N.type,N.payload),this._shareAudioProducer.on("transportclose",function(){var e,t=lt(G._shareAudioProducer.id);Rr.dispatch(t),G._eventEmitter.emit(t.type,t.payload),null===(e=G._shareAudioProducer)||void 0===e||e.close(),G._shareAudioProducer=null}),this._shareAudioProducer.on("trackended",function(){var e;null===(e=G._openTelemetry)||void 0===e||e.traceAutoComplete({spanName:"this._shareAudioProducer trackended",span:n,status:2}),Rr.dispatch(At({type:"error",text:"Share disconnected!"}))}),null===(M=this._openTelemetry)||void 0===M||M.completeSpan({span:C,status:1,message:"Share Audio Producer Created"}),e.next=18;break;case 16:return e.prev=16,z=e.catch(14),e.next=17,this._socketRequest("produceError",{mediaType:"shareAudio",message:z.message});case 17:null===(j=this._videosdkLogs)||void 0===j||j.pushLogs({logText:"Error in shareAudio produceError",logType:"ERROR",attributes:{error:z.message}});case 18:null===(f=this._openTelemetry)||void 0===f||f.completeSpan({span:n,status:1,message:"Enable Share Successful"}),e.next=21;break;case 19:return e.prev=19,K=e.catch(3),Or.error("enableShare() | failed:%o",K),null===(B=this._openTelemetry)||void 0===B||B.completeSpan({span:n,status:2,attributes:{error:K.message},message:"Error in enableShare video produceError"}),null===(U=this._videosdkLogs)||void 0===U||U.pushLogs({logText:"Error in enableShare video produceError",logType:"ERROR",attributes:{error:K.message}}),"NotAllowedError"!==K.name&&Rr.dispatch(At({type:"error",text:"Error sharing: ".concat(K)})),e.next=20,this._socketRequest("produceError",{mediaType:"share",message:K.message});case 20:a&&a.stop(),o&&o.stop();case 21:Rr.dispatch(_t(!1)),this._shareProducer&&(F=0,(q=this._metrics.addNewProbe(this._shareProducer,"share_producer")).onStatsCollected=function(e){try{var t;G._stats.producerStats||(G._stats.producerStats={}),G._stats.producerStats.share||(G._stats.producerStats.share=[]),G._shareProducer&&(G._latestStats[null===(t=G._shareProducer)||void 0===t?void 0:t.id]=[]),e.video.forEach(function(e){var t;G._shareProducer&&G._latestStats[null===(t=G._shareProducer)||void 0===t?void 0:t.id].push(e)}),F%5==0&&null!=G._shareProducer&&G._stats.producerStats.share.push({timestamp:new Date,stats:G._latestStats[G._shareProducer.id]}),F++}catch(n){var r;null===(r=G._videosdkLogs)||void 0===r||r.pushLogs({logText:"Error PRODUCER Stats ERROR",logType:"ERROR",attributes:{error:n.message}})}},q.start(),this._shareProducer.observer.on("close",function(){q.stop(),G._metrics.removeExistingProbe(q)})),this._shareAudioProducer&&(W=0,(V=this._metrics.addNewProbe(this._shareAudioProducer,"share_audio_producer")).onStatsCollected=function(e){try{var t;G._stats.producerStats||(G._stats.producerStats={}),G._stats.producerStats.shareAudio||(G._stats.producerStats.shareAudio=[]),G._shareAudioProducer&&(G._latestStats[null===(t=G._shareAudioProducer)||void 0===t?void 0:t.id]=[]),e.audio.forEach(function(e){var t;G._shareAudioProducer&&G._latestStats[null===(t=G._shareAudioProducer)||void 0===t?void 0:t.id].push(e)}),W%5==0&&null!=G._shareAudioProducer&&G._stats.producerStats.shareAudio.push(br({timestamp:new Date},G._latestStats[G._shareAudioProducer.id]?G._latestStats[G._shareAudioProducer.id][0]:{})),W++}catch(n){var r;null===(r=G._videosdkLogs)||void 0===r||r.pushLogs({logText:"Error PRODUCER Stats ERROR",logType:"ERROR",attributes:{error:n.message}})}},V.start(),this._shareAudioProducer.observer.on("close",function(){V.stop(),G._metrics.removeExistingProbe(V)}));case 22:case"end":return e.stop()}},e,this,[[3,19],[4,6],[14,16]])})),function(){return me.apply(this,arguments)})},{key:"disableShare",value:(he=(0,o.A)(p().mark(function e(){var t,r,n,s,i,a,o,c,d,u,l,h,m,f;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Or.debug("disableShare()"),s=null===(t=this._openTelemetry)||void 0===t?void 0:t.trace({spanName:"disableShare() Calling",status:1}),this._shareProducer){e.next=1;break}return null===(i=this._openTelemetry)||void 0===i||i.completeSpan({span:s,status:2,message:"Share Producer Not found"}),e.abrupt("return");case 1:return a=null===(r=this._openTelemetry)||void 0===r?void 0:r.trace({spanName:"Closing Share Producer",span:s,status:1}),this._shareProducer.close(),o=lt(this._shareProducer.id),Rr.dispatch(o),this._eventEmitter.emit(o.type,o.payload),this._shareAudioProducer&&(u=null===(c=this._openTelemetry)||void 0===c?void 0:c.trace({spanName:"Closing Share Audio Producer",span:s,status:1}),this._shareAudioProducer.close(),o=lt(this._shareAudioProducer.id),Rr.dispatch(o),this._eventEmitter.emit(o.type,o.payload),null===(d=this._openTelemetry)||void 0===d||d.completeSpan({span:u,status:1,message:"Closed Share Audio Producer"})),e.prev=2,e.next=3,this._socketRequest("closeProducer",{producerId:this._shareProducer.id});case 3:if(!this._shareAudioProducer){e.next=4;break}return e.next=4,this._socketRequest("closeProducer",{producerId:this._shareAudioProducer.id});case 4:null===(l=this._openTelemetry)||void 0===l||l.completeSpan({span:a,status:1,message:"Requested Server to Close Producer"}),e.next=6;break;case 5:e.prev=5,f=e.catch(2),Rr.dispatch(At({type:"error",text:"Error closing server-side share Producer: ".concat(f)})),null===(h=this._openTelemetry)||void 0===h||h.completeSpan({span:s,status:2,message:"Error closing server-side share Producer ".concat(f)}),null===(m=this._videosdkLogs)||void 0===m||m.pushLogs({logText:"Error closing server-side share Producer",logType:"ERROR",attributes:{error:f.message}});case 6:this._shareProducer=null,this._shareAudioProducer=null,null===(n=this._openTelemetry)||void 0===n||n.completeSpan({span:s,status:1,message:"Screen Share Disabled Successfully"});case 7:case"end":return e.stop()}},e,this,[[2,5]])})),function(){return he.apply(this,arguments)})},{key:"enableAudioOnly",value:(pe=(0,o.A)(p().mark(function e(){var t,r,n,s;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:Or.debug("enableAudioOnly()"),Rr.dispatch(ot(!0)),this.disableWebcam(),t=wr(this._consumers.values()),e.prev=1,t.s();case 2:if((r=t.n()).done){e.next=5;break}if("video"===(n=r.value).kind){e.next=3;break}return e.abrupt("continue",4);case 3:this._pauseConsumer(n);case 4:e.next=2;break;case 5:e.next=7;break;case 6:e.prev=6,s=e.catch(1),t.e(s);case 7:return e.prev=7,t.f(),e.finish(7);case 8:Rr.dispatch(at(!0)),Rr.dispatch(ot(!1));case 9:case"end":return e.stop()}},e,this,[[1,6,7,8]])})),function(){return pe.apply(this,arguments)})},{key:"disableAudioOnly",value:(le=(0,o.A)(p().mark(function e(){var t,r,n,s;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:Or.debug("disableAudioOnly()"),Rr.dispatch(ot(!0)),!this._webcamProducer&&this._produce&&(Ye()||{}).webcamEnabled&&this.enableWebcam(),t=wr(this._consumers.values()),e.prev=1,t.s();case 2:if((r=t.n()).done){e.next=5;break}if("video"===(n=r.value).kind){e.next=3;break}return e.abrupt("continue",4);case 3:this._resumeConsumer(n);case 4:e.next=2;break;case 5:e.next=7;break;case 6:e.prev=6,s=e.catch(1),t.e(s);case 7:return e.prev=7,t.f(),e.finish(7);case 8:Rr.dispatch(at(!1)),Rr.dispatch(ot(!1));case 9:case"end":return e.stop()}},e,this,[[1,6,7,8]])})),function(){return le.apply(this,arguments)})},{key:"muteAudio",value:(ue=(0,o.A)(p().mark(function e(){return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:Or.debug("muteAudio()"),Rr.dispatch(ct(!0));case 1:case"end":return e.stop()}},e)})),function(){return ue.apply(this,arguments)})},{key:"unmuteAudio",value:(de=(0,o.A)(p().mark(function e(){return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:Or.debug("unmuteAudio()"),Rr.dispatch(ct(!1));case 1:case"end":return e.stop()}},e)})),function(){return de.apply(this,arguments)})},{key:"handleRemoteRestartIce",value:(ce=(0,o.A)(p().mark(function e(t){var r,n,s,i,a,o,c,d,u;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s=t.iceParameters,i=t.transportId,a=t.internalSpan,i===(null===(r=this._sendTransport)||void 0===r?void 0:r.id)&&this._sendTransport.restartIce({iceParameters:s}),i===(null===(n=this._recvTransport)||void 0===n?void 0:n.id)&&this._recvTransport.restartIce({iceParameters:s}),e.prev=1,e.next=2,this._socketRequest("iceRestarted",{transportId:i});case 2:null===(o=this._openTelemetry)||void 0===o||o.completeSpan({span:a,status:1,message:"iceRestarted"}),e.next=4;break;case 3:e.prev=3,u=e.catch(1),null===(c=this._openTelemetry)||void 0===c||c.completeSpan({span:a,status:2,message:"handleRemoteRestartIce() ICE restart failed ".concat(u)}),null===(d=this._videosdkLogs)||void 0===d||d.pushLogs({logText:"Error handleRemoteRestartIce() ICE restart failed",logType:"ERROR",attributes:{error:u.message}}),Rr.dispatch(At({type:"error",text:"ICE restart failed: ".concat(u)}));case 4:case"end":return e.stop()}},e,this,[[1,3]])})),function(e){return ce.apply(this,arguments)})},{key:"restartIce",value:(oe=(0,o.A)(p().mark(function e(){var t,r,n,s;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Or.debug("restartIce()"),Rr.dispatch(dt(!0)),e.prev=1,!this._sendTransport){e.next=3;break}return e.next=2,this._socketRequest("restartIce",{transportId:this._sendTransport.id});case 2:return t=e.sent,e.next=3,this._sendTransport.restartIce({iceParameters:t});case 3:if(!this._recvTransport){e.next=5;break}return e.next=4,this._socketRequest("restartIce",{transportId:this._recvTransport.id});case 4:return r=e.sent,e.next=5,this._recvTransport.restartIce({iceParameters:r});case 5:Rr.dispatch(At({text:"ICE restarted"})),e.next=7;break;case 6:e.prev=6,s=e.catch(1),Or.error("restartIce() | failed:%o",s),Rr.dispatch(At({type:"error",text:"ICE restart failed: ".concat(s)})),null===(n=this._videosdkLogs)||void 0===n||n.pushLogs({logText:"Error restartIce() ICE restart failed",logType:"ERROR",attributes:{error:s.message}});case 7:Rr.dispatch(dt(!1));case 8:case"end":return e.stop()}},e,this,[[1,6]])})),function(){return oe.apply(this,arguments)})},{key:"_socketRequest",value:(ae=(0,o.A)(p().mark(function e(t){var r,n=this,s=arguments;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>1&&void 0!==s[1]?s[1]:{},e.abrupt("return",new Promise(function(e,s){n._webSocket.emit("request",{method:t,request:!0,data:r},function(t){null!=t&&t.error?s(new Error(t.error)):e(t.data)})}));case 1:case"end":return e.stop()}},e)})),function(e){return ae.apply(this,arguments)})},{key:"setMaxSendingSpatialLayer",value:(ie=(0,o.A)(p().mark(function e(t){var r,n;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Or.debug("setMaxSendingSpatialLayer() [spatialLayer:%s]",t),e.prev=1,!this._webcamProducer){e.next=3;break}return e.next=2,this._webcamProducer.setMaxSpatialLayer(t);case 2:e.next=4;break;case 3:if(!this._shareProducer){e.next=4;break}return e.next=4,this._shareProducer.setMaxSpatialLayer(t);case 4:e.next=6;break;case 5:e.prev=5,n=e.catch(1),Or.error("setMaxSendingSpatialLayer() | failed:%o",n),null===(r=this._videosdkLogs)||void 0===r||r.pushLogs({logText:"Error setting max sending video spatial layer",logType:"ERROR",attributes:{error:n.message}}),Rr.dispatch(At({type:"error",text:"Error setting max sending video spatial layer: ".concat(n)}));case 6:case"end":return e.stop()}},e,this,[[1,5]])})),function(e){return ie.apply(this,arguments)})},{key:"setWebcamQuality",value:(se=(0,o.A)(p().mark(function e(t){var r,n;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._webcamProducer){e.next=1;break}return e.abrupt("return");case 1:if(r=this._webcam.resolution,n=kr[r][t].s,this._webcamProducer.maxSpatialLayer!=n){e.next=2;break}return e.abrupt("return");case 2:return e.next=3,this._webcamProducer.setMaxSpatialLayer(n);case 3:case"end":return e.stop()}},e,this)})),function(e){return se.apply(this,arguments)})},{key:"setConsumerScreenShareQuality",value:(ne=(0,o.A)(p().mark(function e(t,r){var n,s,i,a,o,c;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=null===(n=this._openTelemetry)||void 0===n?void 0:n.trace({spanName:'Setting "'.concat(r,'" Quality for Screen Share')}),c=(o={high:{spatialLayer:2,temporalLayer:2},med:{spatialLayer:1,temporalLayer:2},low:{spatialLayer:0,temporalLayer:2}})[r]||o.high,null===(s=this._openTelemetry)||void 0===s||s.traceAutoComplete({spanName:"Getting spatial & temporal layers",span:a,attributes:{selectedQuality:c},status:1}),e.next=1,this.setConsumerPreferredLayers(t,c.spatialLayer,c.temporalLayer);case 1:null===(i=this._openTelemetry)||void 0===i||i.completeSpan({message:"Done",span:a,status:1});case 2:case"end":return e.stop()}},e,this)})),function(e,t){return ne.apply(this,arguments)})},{key:"setConsumerQuality",value:(re=(0,o.A)(p().mark(function e(t,r){var n,s,i,a,o,c,d;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=this._webcam.resolution,o=null===(n=this._openTelemetry)||void 0===n?void 0:n.trace({spanName:'Setting "'.concat(r,'" Quality')}),c=kr[a][r].s,d=kr[a][r].t,null===(s=this._openTelemetry)||void 0===s||s.traceAutoComplete({spanName:"Getting spatial & temporal layers",span:o,attributes:{spatialLayers:JSON.parse(c),temporalLayers:JSON.parse(d)},status:1}),e.next=1,this.setConsumerPreferredLayers(t,c,d);case 1:null===(i=this._openTelemetry)||void 0===i||i.completeSpan({message:"Done",span:o,status:1});case 2:case"end":return e.stop()}},e,this)})),function(e,t){return re.apply(this,arguments)})},{key:"setViewPort",value:(te=(0,o.A)(p().mark(function e(t,r,n){var s,i,a,o;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._consumers.get(t.id)){e.next=1;break}return e.abrupt("return");case 1:if(s=(0,Lt.ed)(this._consumers.get(t.id),r,n),i=s.consumerId,a=s.newPreferredSpatialLayer,o=s.newPreferredTemporalLayer,a!==t.preferredSpatialLayer||o!==t.preferredTemporalLayer){e.next=2;break}return e.abrupt("return");case 2:if(!i){e.next=3;break}return e.next=3,this.setConsumerPreferredLayers(i,a,o);case 3:case"end":return e.stop()}},e,this)})),function(e,t,r){return te.apply(this,arguments)})},{key:"setConsumerPreferredLayers",value:(ee=(0,o.A)(p().mark(function e(t,r,n){var s,i,a;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return Or.debug("setConsumerPreferredLayers() [consumerId:%s, spatialLayer:%s, temporalLayer:%s]",t,r,n),e.prev=1,(s=this._consumers.get(t)).spatialLayers>1&&(s.preferredSpatialLayer=r,s.preferredTemporalLayer=n),e.next=2,this._socketRequest("setConsumerPreferredLayers",{consumerId:t,spatialLayer:r,temporalLayer:n});case 2:Rr.dispatch(Ct(t,r,n)),e.next=4;break;case 3:e.prev=3,a=e.catch(1),Or.error("setConsumerPreferredLayers() | failed:%o",a),null===(i=this._videosdkLogs)||void 0===i||i.pushLogs({logText:"Error setting Consumer preferred layers:",logType:"ERROR",attributes:{error:a.message}}),Rr.dispatch(At({type:"error",text:"Error setting Consumer preferred layers: ".concat(a)}));case 4:case"end":return e.stop()}},e,this,[[1,3]])})),function(e,t,r){return ee.apply(this,arguments)})},{key:"setConsumerPriority",value:(Z=(0,o.A)(p().mark(function e(t,r){var n,s;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return Or.debug("setConsumerPriority() [consumerId:%s, priority:%d]",t,r),e.prev=1,e.next=2,this._socketRequest("setConsumerPriority",{consumerId:t,priority:r});case 2:Rr.dispatch(Pt(t,r)),e.next=4;break;case 3:e.prev=3,s=e.catch(1),Or.error("setConsumerPriority() | failed:%o",s),null===(n=this._videosdkLogs)||void 0===n||n.pushLogs({logText:"Error setting Consumer priority",logType:"ERROR",attributes:{error:s.message}}),Rr.dispatch(At({type:"error",text:"Error setting Consumer priority: ".concat(s)}));case 4:case"end":return e.stop()}},e,this,[[1,3]])})),function(e,t){return Z.apply(this,arguments)})},{key:"requestConsumerKeyFrame",value:(X=(0,o.A)(p().mark(function e(t){var r,n;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return Or.debug("requestConsumerKeyFrame() [consumerId:%s]",t),e.prev=1,e.next=2,this._socketRequest("requestConsumerKeyFrame",{consumerId:t});case 2:Rr.dispatch(At({text:"Keyframe requested for video consumer"})),e.next=4;break;case 3:e.prev=3,n=e.catch(1),Or.error("requestConsumerKeyFrame() | failed:%o",n),null===(r=this._videosdkLogs)||void 0===r||r.pushLogs({logText:"Error requesting key frame for Consumer",logType:"ERROR",attributes:{error:n.message}}),Rr.dispatch(At({type:"error",text:"Error requesting key frame for Consumer: ".concat(n)}));case 4:case"end":return e.stop()}},e,this,[[1,3]])})),function(e){return X.apply(this,arguments)})},{key:"enableChatDataProducer",value:(Y=(0,o.A)(p().mark(function e(){var t,r,n=this;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Or.debug("enableChatDataProducer()"),this._useDataChannel){e.next=1;break}return e.abrupt("return");case 1:return e.prev=1,e.next=2,this._sendTransport.produceData({ordered:!1,maxRetransmits:1,label:"chat",priority:"medium",appData:{info:"my-chat-DataProducer"}});case 2:this._chatDataProducer=e.sent,Rr.dispatch(gt({id:this._chatDataProducer.id,sctpStreamParameters:this._chatDataProducer.sctpStreamParameters,label:this._chatDataProducer.label,protocol:this._chatDataProducer.protocol})),this._chatDataProducer.on("transportclose",function(){n._chatDataProducer=null}),this._chatDataProducer.on("open",function(){Or.debug('chat DataProducer "open" event')}),this._chatDataProducer.on("close",function(){Or.error('chat DataProducer "close" event'),n._chatDataProducer=null,Rr.dispatch(At({type:"error",text:"Chat DataProducer closed"}))}),this._chatDataProducer.on("error",function(e){Or.error('chat DataProducer "error" event:%o',e),Rr.dispatch(At({type:"error",text:"Chat DataProducer error: ".concat(e)}))}),this._chatDataProducer.on("bufferedamountlow",function(){Or.debug('chat DataProducer "bufferedamountlow" event')}),e.next=4;break;case 3:throw e.prev=3,r=e.catch(1),Or.error("enableChatDataProducer() | failed:%o",r),null===(t=this._videosdkLogs)||void 0===t||t.pushLogs({logText:"Error enabling chat DataProducer",logType:"ERROR",attributes:{error:r.message}}),Rr.dispatch(At({type:"error",text:"Error enabling chat DataProducer: ".concat(r)})),r;case 4:case"end":return e.stop()}},e,this,[[1,3]])})),function(){return Y.apply(this,arguments)})},{key:"enableBotDataProducer",value:(Q=(0,o.A)(p().mark(function e(){var t,r,n=this;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Or.debug("enableBotDataProducer()"),this._useDataChannel){e.next=1;break}return e.abrupt("return");case 1:return e.prev=1,e.next=2,this._sendTransport.produceData({ordered:!1,maxPacketLifeTime:2e3,label:"bot",priority:"medium",appData:{info:"my-bot-DataProducer"}});case 2:this._botDataProducer=e.sent,Rr.dispatch(gt({id:this._botDataProducer.id,sctpStreamParameters:this._botDataProducer.sctpStreamParameters,label:this._botDataProducer.label,protocol:this._botDataProducer.protocol})),this._botDataProducer.on("transportclose",function(){n._botDataProducer=null}),this._botDataProducer.on("open",function(){Or.debug('bot DataProducer "open" event')}),this._botDataProducer.on("close",function(){Or.error('bot DataProducer "close" event'),n._botDataProducer=null,Rr.dispatch(At({type:"error",text:"Bot DataProducer closed"}))}),this._botDataProducer.on("error",function(e){Or.error('bot DataProducer "error" event:%o',e),Rr.dispatch(At({type:"error",text:"Bot DataProducer error: ".concat(e)}))}),this._botDataProducer.on("bufferedamountlow",function(){Or.debug('bot DataProducer "bufferedamountlow" event')}),e.next=4;break;case 3:throw e.prev=3,r=e.catch(1),Or.error("enableBotDataProducer() | failed:%o",r),null===(t=this._videosdkLogs)||void 0===t||t.pushLogs({logText:"Error enabling bot DataProducer",logType:"ERROR",attributes:{error:r.message}}),Rr.dispatch(At({type:"error",text:"Error enabling bot DataProducer: ".concat(r)})),r;case 4:case"end":return e.stop()}},e,this,[[1,3]])})),function(){return Q.apply(this,arguments)})},{key:"sendChatMessage",value:(J=(0,o.A)(p().mark(function e(t){return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Or.debug('sendChatMessage() [text:"%s]',t),this._chatDataProducer){e.next=1;break}return Rr.dispatch(At({type:"error",text:"No chat DataProducer"})),e.abrupt("return");case 1:try{this._chatDataProducer.send(t)}catch(r){Or.error("chat DataProducer.send() failed:%o",r),Rr.dispatch(At({type:"error",text:"chat DataProducer.send() failed: ".concat(r)}))}case 2:case"end":return e.stop()}},e,this)})),function(e){return J.apply(this,arguments)})},{key:"sendBotMessage",value:($=(0,o.A)(p().mark(function e(t){return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Or.debug('sendBotMessage() [text:"%s]',t),this._botDataProducer){e.next=1;break}return Rr.dispatch(At({type:"error",text:"No bot DataProducer"})),e.abrupt("return");case 1:try{this._botDataProducer.send(t)}catch(r){Or.error("bot DataProducer.send() failed:%o",r),Rr.dispatch(At({type:"error",text:"bot DataProducer.send() failed: ".concat(r)}))}case 2:case"end":return e.stop()}},e,this)})),function(e){return $.apply(this,arguments)})},{key:"changeDisplayName",value:(G=(0,o.A)(p().mark(function e(t){var r;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return Or.debug('changeDisplayName() [displayName:"%s"]',t),Qe({displayName:t}),e.prev=1,e.next=2,this._socketRequest("changeDisplayName",{displayName:t});case 2:this._displayName=t,Rr.dispatch(it(t)),Rr.dispatch(At({text:"Display name changed"})),e.next=4;break;case 3:e.prev=3,r=e.catch(1),Or.error("changeDisplayName() | failed: %o",r),Rr.dispatch(At({type:"error",text:"Could not change display name: ".concat(r)})),Rr.dispatch(it());case 4:case"end":return e.stop()}},e,this,[[1,3]])})),function(e){return G.apply(this,arguments)})},{key:"openConnection",value:(K=(0,o.A)(p().mark(function e(t){var r,n;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.roomId,n=t.payload,e.next=1,this._socketRequest("openConnection",{roomId:r,payload:n}).catch(function(e){throw new Error(e)});case 1:case"end":return e.stop()}},e,this)})),function(e){return K.apply(this,arguments)})},{key:"closeConnection",value:(z=(0,o.A)(p().mark(function e(t){return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,this._socketRequest("closeConnection",{roomId:t});case 1:case"end":return e.stop()}},e,this)})),function(e){return z.apply(this,arguments)})},{key:"switchPeerRoom",value:(H=(0,o.A)(p().mark(function e(t){var r,n,s,i;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.peerId,n=t.roomId,s=t.payload,i=t.token,e.next=1,this._socketRequest("switchPeerRoom",{roomId:n,peerId:r,payload:s,token:i});case 1:case"end":return e.stop()}},e,this)})),function(e){return H.apply(this,arguments)})},{key:"connectionSwitchPeerRoom",value:(V=(0,o.A)(p().mark(function e(t){var r,n,s,i,a;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.roomId,n=t.connectionRoomId,s=t.peerId,i=t.payload,a=t.token,e.next=1,this._socketRequest("connectionSwitchPeerRoom",{roomId:r,connectionRoomId:n,peerId:s,payload:i,token:a});case 1:case"end":return e.stop()}},e,this)})),function(e){return V.apply(this,arguments)})},{key:"connectionSendChatMessage",value:(W=(0,o.A)(p().mark(function e(t){var r,n;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.roomId,n=t.message,e.next=1,this._socketRequest("connectionSendChatMessage",{roomId:r,message:n});case 1:case"end":return e.stop()}},e,this)})),function(e){return W.apply(this,arguments)})},{key:"connectionEndMeeting",value:(q=(0,o.A)(p().mark(function e(t){var r;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.roomId,e.next=1,this._socketRequest("connectionCloseRoom",{roomId:r});case 1:case"end":return e.stop()}},e,this)})),function(e){return q.apply(this,arguments)})},{key:"pubsubPublish",value:(F=(0,o.A)(p().mark(function e(t,r,n,s){var i,a,o,c,d,u,l;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,null!=n&&n.sendOnly){if(i=n.sendOnly,a=[],i){o=wr(i);try{for(o.s();!(c=o.n()).done;)(d=c.value)&&a.push(d.toString())}catch(p){o.e(p)}finally{o.f()}}n.sendOnly=a}return e.next=1,this._socketRequest("pubsubPublish",{topic:t,message:r,options:n,payload:s});case 1:e.next=3;break;case 2:e.prev=2,l=e.catch(0),null===(u=this._videosdkLogs)||void 0===u||u.pushLogs({logText:"Error pubsubPublish() | failed",logType:"ERROR",attributes:{error:l.message}}),Or.error("pubsubPublish() | failed: %o",l);case 3:case"end":return e.stop()}},e,this,[[0,2]])})),function(e,t,r,n){return F.apply(this,arguments)})},{key:"pubsubSubscribe",value:(U=(0,o.A)(p().mark(function e(t){var r,n,s;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._closed){e.next=1;break}return e.abrupt("return");case 1:return e.prev=1,e.next=2,this._socketRequest("pubsubSubscribe",{topic:t});case 2:return r=e.sent,e.abrupt("return",r);case 3:e.prev=3,s=e.catch(1),null===(n=this._videosdkLogs)||void 0===n||n.pushLogs({logText:"Error pubsubSubscribe() | failed",logType:"ERROR",attributes:{error:s.message}}),Or.error("pubsubSubscribe() | failed: %o",s);case 4:case"end":return e.stop()}},e,this,[[1,3]])})),function(e){return U.apply(this,arguments)})},{key:"pubsubUnsubscribe",value:(B=(0,o.A)(p().mark(function e(t){var r,n,s;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._closed){e.next=1;break}return e.abrupt("return");case 1:return e.prev=1,e.next=2,this._socketRequest("pubsubUnsubscribe",{topic:t});case 2:null===(r=this._videosdkLogs)||void 0===r||r.pushLogs({logText:"Pubsub Unsubscribing Successfully for topic ".concat(t),logType:"INFO"}),e.next=4;break;case 3:e.prev=3,s=e.catch(1),null===(n=this._videosdkLogs)||void 0===n||n.pushLogs({logText:"Error pubsubUnsubscribe() | failed",logType:"ERROR",attributes:{error:s.message}}),Or.error("pubsubUnsubscribe() | failed: %o",s);case 4:case"end":return e.stop()}},e,this,[[1,3]])})),function(e){return B.apply(this,arguments)})},{key:"closeRoom",value:(j=(0,o.A)(p().mark(function e(){return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,this._socketRequest("closeRoom",{});case 1:case"end":return e.stop()}},e,this)})),function(){return j.apply(this,arguments)})},{key:"removePeer",value:(N=(0,o.A)(p().mark(function e(t){var r;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(r=this._openTelemetry)||void 0===r||r.traceAutoComplete({spanName:"Removing peer ".concat(t),status:1}),null!=t){e.next=1;break}return e.abrupt("return");case 1:return e.next=2,this._socketRequest("removePeer",{peerId:t});case 2:case"end":return e.stop()}},e,this)})),function(e){return N.apply(this,arguments)})},{key:"getSendTransportRemoteStats",value:(L=(0,o.A)(p().mark(function e(){return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Or.debug("getSendTransportRemoteStats()"),this._sendTransport){e.next=1;break}return e.abrupt("return");case 1:return e.abrupt("return",this._socketRequest("getTransportStats",{transportId:this._sendTransport.id}));case 2:case"end":return e.stop()}},e,this)})),function(){return L.apply(this,arguments)})},{key:"getRecvTransportRemoteStats",value:(M=(0,o.A)(p().mark(function e(){return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Or.debug("getRecvTransportRemoteStats()"),this._recvTransport){e.next=1;break}return e.abrupt("return");case 1:return e.abrupt("return",this._socketRequest("getTransportStats",{transportId:this._recvTransport.id}));case 2:case"end":return e.stop()}},e,this)})),function(){return M.apply(this,arguments)})},{key:"getAudioRemoteStats",value:(A=(0,o.A)(p().mark(function e(){var t;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Or.debug("getAudioRemoteStats()"),t=this._micProducer){e.next=1;break}return e.abrupt("return");case 1:return e.abrupt("return",this._latestStats[t.id]);case 2:case"end":return e.stop()}},e,this)})),function(){return A.apply(this,arguments)})},{key:"getVideoRemoteStats",value:(I=(0,o.A)(p().mark(function e(){var t;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Or.debug("getVideoRemoteStats()"),t=this._webcamProducer){e.next=1;break}return e.abrupt("return");case 1:return e.abrupt("return",this._latestStats[t.id]);case 2:case"end":return e.stop()}},e,this)})),function(){return I.apply(this,arguments)})},{key:"getShareRemoteStats",value:(D=(0,o.A)(p().mark(function e(){var t;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Or.debug("getVideoRemoteStats()"),t=this._shareProducer){e.next=1;break}return e.abrupt("return");case 1:return e.abrupt("return",this._latestStats[t.id]);case 2:case"end":return e.stop()}},e,this)})),function(){return D.apply(this,arguments)})},{key:"getShareAudioRemoteStats",value:(x=(0,o.A)(p().mark(function e(){var t;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this._shareAudioProducer){e.next=1;break}return e.abrupt("return");case 1:return e.abrupt("return",this._latestStats[t.id]);case 2:case"end":return e.stop()}},e,this)})),function(){return x.apply(this,arguments)})},{key:"getConsumerRemoteStats",value:(O=(0,o.A)(p().mark(function e(t){var r,n;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Or.debug("getConsumerRemoteStats()"),r=this._consumers.get(t)){e.next=1;break}return e.abrupt("return");case 1:return this._latestStats[t]&&(this._latestStats[t][0].currentSpatialLayer=r.currentSpatialLayer,this._latestStats[t][0].currentTemporalLayer=r.currentTemporalLayer,this._latestStats[t][0].preferredSpatialLayer=r.preferredSpatialLayer,this._latestStats[t][0].preferredTemporalLayer=r.preferredTemporalLayer),n=r.track.id.replace(/[{}]/g,""),e.abrupt("return",this._latestStats[n]);case 2:case"end":return e.stop()}},e,this)})),function(e){return O.apply(this,arguments)})},{key:"getChatDataProducerRemoteStats",value:(P=(0,o.A)(p().mark(function e(){var t;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Or.debug("getChatDataProducerRemoteStats()"),t=this._chatDataProducer){e.next=1;break}return e.abrupt("return");case 1:return e.abrupt("return",this._socketRequest("getDataProducerStats",{dataProducerId:t.id}));case 2:case"end":return e.stop()}},e,this)})),function(){return P.apply(this,arguments)})},{key:"getBotDataProducerRemoteStats",value:(C=(0,o.A)(p().mark(function e(){var t;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Or.debug("getBotDataProducerRemoteStats()"),t=this._botDataProducer){e.next=1;break}return e.abrupt("return");case 1:return e.abrupt("return",this._socketRequest("getDataProducerStats",{dataProducerId:t.id}));case 2:case"end":return e.stop()}},e,this)})),function(){return C.apply(this,arguments)})},{key:"getDataConsumerRemoteStats",value:(T=(0,o.A)(p().mark(function e(t){return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Or.debug("getDataConsumerRemoteStats()"),this._dataConsumers.get(t)){e.next=1;break}return e.abrupt("return");case 1:return e.abrupt("return",this._socketRequest("getDataConsumerStats",{dataConsumerId:t}));case 2:case"end":return e.stop()}},e,this)})),function(e){return T.apply(this,arguments)})},{key:"getSendTransportLocalStats",value:(E=(0,o.A)(p().mark(function e(){return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Or.debug("getSendTransportLocalStats()"),this._sendTransport){e.next=1;break}return e.abrupt("return");case 1:return e.abrupt("return",this._sendTransport.getStats());case 2:case"end":return e.stop()}},e,this)})),function(){return E.apply(this,arguments)})},{key:"getRecvTransportLocalStats",value:(k=(0,o.A)(p().mark(function e(){return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Or.debug("getRecvTransportLocalStats()"),this._recvTransport){e.next=1;break}return e.abrupt("return");case 1:return e.abrupt("return",this._recvTransport.getStats());case 2:case"end":return e.stop()}},e,this)})),function(){return k.apply(this,arguments)})},{key:"getAudioLocalStats",value:(R=(0,o.A)(p().mark(function e(){return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Or.debug("getAudioLocalStats()"),this._micProducer){e.next=1;break}return e.abrupt("return");case 1:return e.abrupt("return",this._micProducer.getStats());case 2:case"end":return e.stop()}},e,this)})),function(){return R.apply(this,arguments)})},{key:"getVideoLocalStats",value:(S=(0,o.A)(p().mark(function e(){var t;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Or.debug("getVideoLocalStats()"),t=this._webcamProducer||this._shareProducer){e.next=1;break}return e.abrupt("return");case 1:return e.abrupt("return",t.getStats());case 2:case"end":return e.stop()}},e,this)})),function(){return S.apply(this,arguments)})},{key:"getConsumerLocalStats",value:(w=(0,o.A)(p().mark(function e(t){var r;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this._consumers.get(t)){e.next=1;break}return e.abrupt("return");case 1:return e.abrupt("return",r.getStats());case 2:case"end":return e.stop()}},e,this)})),function(e){return w.apply(this,arguments)})},{key:"getTransportRemoteStats",value:(b=(0,o.A)(p().mark(function e(t){var r,n,s,i,a;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(s=t.participantId){e.next=1;break}return e.abrupt("return");case 1:return e.next=2,this._socketRequest("getTransportStats",{peerId:s});case 2:return i=e.sent,a={availableBitrate:null==i||null===(r=i.recv)||void 0===r?void 0:r.availableBitrate,targetBitrate:null==i||null===(n=i.recv)||void 0===n?void 0:n.targetBitrate},e.abrupt("return",a);case 3:case"end":return e.stop()}},e,this)})),function(e){return b.apply(this,arguments)})},{key:"applyNetworkThrottle",value:(y=(0,o.A)(p().mark(function e(t){var r,n,s,i,a;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.uplink,n=t.downlink,s=t.rtt,i=t.secret,Or.debug("applyNetworkThrottle() [uplink:%s, downlink:%s, rtt:%s]",r,n,s),e.prev=1,e.next=2,this._socketRequest("applyNetworkThrottle",{uplink:r,downlink:n,rtt:s,secret:i});case 2:e.next=4;break;case 3:e.prev=3,a=e.catch(1),Or.error("applyNetworkThrottle() | failed:%o",a),Rr.dispatch(At({type:"error",text:"Error applying network throttle: ".concat(a)}));case 4:case"end":return e.stop()}},e,this,[[1,3]])})),function(e){return y.apply(this,arguments)})},{key:"resetNetworkThrottle",value:(_=(0,o.A)(p().mark(function e(t){var r,n,s,i;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.silent,n=void 0!==r&&r,s=t.secret,Or.debug("resetNetworkThrottle()"),e.prev=1,e.next=2,this._socketRequest("resetNetworkThrottle",{secret:s});case 2:e.next=4;break;case 3:e.prev=3,i=e.catch(1),n||(Or.error("resetNetworkThrottle() | failed:%o",i),Rr.dispatch(At({type:"error",text:"Error resetting network throttle: ".concat(i)})));case 4:case"end":return e.stop()}},e,this,[[1,3]])})),function(e){return _.apply(this,arguments)})},{key:"createProducerTransport",value:(v=(0,o.A)(p().mark(function e(t,r){var n,a,c,d,u,l,h,m,f,g,v,_,y,b,w=this;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:c=t.id,d=t.iceParameters,u=t.iceCandidates,l=t.dtlsParameters,h=t.sctpParameters,m=null===(n=this._openTelemetry)||void 0===n?void 0:n.trace({spanName:"Creating Send Transport",span:r||null}),this._sendTransport=this._mediasoupDevice.createSendTransport({id:c,iceParameters:d,iceCandidates:u,dtlsParameters:l,sctpParameters:h,iceServers:this._iceServers}),f=new Map,g=new Map,_=!1,y=!1,b=!1,this._sendTransportInternal=setInterval((0,o.A)(p().mark(function e(){var t,r,n,s,a,o,c,d,u,l,h;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],e.prev=1,e.next=2,w._sendTransport.getStats();case 2:r=e.sent,e.next=4;break;case 3:return e.prev=3,e.catch(1),e.abrupt("return");case 4:try{r.forEach(function(e){try{if("outbound-rtp"===e.type){var r={qualityLimitationReason:e.qualityLimitationReason};f.set(e.id,r)}if("remote-inbound-rtp"===e.type&&e.totalRoundTripTime&&e.roundTripTimeMeasurements){var n=g.get(e.id);n||(n={totalRoundTripTime:0,roundTripTimeMeasurements:0},g.set(e.id,n));var s=e.roundTripTimeMeasurements-n.roundTripTimeMeasurements,i=e.totalRoundTripTime-n.totalRoundTripTime;if(s>0&&i>0){var a=i/s;n.totalRoundTripTime=e.totalRoundTripTime,n.roundTripTimeMeasurements=e.roundTripTimeMeasurements,t.push(1e3*a)}}}catch(o){}});try{n=t.reduce(function(e,t){return e+t},0)/t.length,Number.isNaN(n)||(v||(v=n),s=(0,i.A)(f.values()).some(function(e){return"bandwidth"===e.qualityLimitationReason}),a=(0,i.A)(f.values()).some(function(e){return"cpu"===e.qualityLimitationReason}),!_&&s&&n-v>50?(null===(o=w._videosdkLogs)||void 0===o||o.pushLogs({logType:"WARN",attributes:{avgRoundTripTimeInMs:n,ewmaRttInMs:v},logText:"Send Transport Congestion detected, the network is bandwidth limited and the round trip time is increasing (ewmaRtt: ".concat(v,", avgRoundTripTime: ").concat(n,")")}),_=!0,w._eventEmitter.emit("QUALITY_LIMITATION_INTERNAL",{type:"congestion",state:"detected",timestamp:(new Date).getTime()})):_&&n-v<30&&(null===(c=w._videosdkLogs)||void 0===c||c.pushLogs({logType:"INFO",attributes:{avgRoundTripTimeInMs:n,ewmaRttInMs:v},logText:"Send Transport  Congestion resolved, the round trip time is back to normal (ewmaRtt: ".concat(v,", avgRoundTripTime: ").concat(n,")")}),_=!1,w._eventEmitter.emit("QUALITY_LIMITATION_INTERNAL",{type:"congestion",state:"resolved",timestamp:(new Date).getTime()})),s&&!b?(null===(d=w._videosdkLogs)||void 0===d||d.pushLogs({logType:"WARN",logText:"Bandwidth Limitation detected"}),w._eventEmitter.emit("QUALITY_LIMITATION_INTERNAL",{type:"bandwidth",state:"detected",timestamp:(new Date).getTime()}),b=!0):!s&&b&&(null===(u=w._videosdkLogs)||void 0===u||u.pushLogs({logType:"INFO",logText:"Bandwidth Limitation resolved"}),w._eventEmitter.emit("QUALITY_LIMITATION_INTERNAL",{type:"bandwidth",state:"resolved",timestamp:(new Date).getTime()}),b=!1),v=.9*v+.1*n,!y&&a?(w._eventEmitter.emit("QUALITY_LIMITATION_INTERNAL",{type:"cpu",state:"detected",timestamp:(new Date).getTime()}),null===(l=w._videosdkLogs)||void 0===l||l.pushLogs({logType:"WARN",logText:"CPU Limitation detected"}),y=!0):y&&!a&&(w._eventEmitter.emit("QUALITY_LIMITATION_INTERNAL",{type:"cpu",state:"resolved",timestamp:(new Date).getTime()}),null===(h=w._videosdkLogs)||void 0===h||h.pushLogs({logType:"INFO",logText:"CPU Limitation resolved"}),y=!1))}catch(p){}}catch(p){}case 5:case"end":return e.stop()}},e,null,[[1,3]])})),1e3),this._sendTransport.on("connect",function(e,t,r){var n,s=e.dtlsParameters;null===(n=w._openTelemetry)||void 0===n||n.traceAutoComplete({spanName:"this._sendTransport `connect` Event : Transport is about to establish the ICE+DTLS connection",span:m,status:1}),w._socketRequest("connectWebRtcTransport",{transportId:w._sendTransport.id,dtlsParameters:s}).then(function(){t()}).catch(function(e){r(e)})}),this._sendTransport.on("produce",function(){var e=(0,o.A)(p().mark(function e(t,r,n){var s,i,a,o,c,d,u,l;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s=t.kind,i=t.rtpParameters,a=t.appData,e.prev=1,null===(o=w._openTelemetry)||void 0===o||o.traceAutoComplete({spanName:"this._sendTransport `produce` Event : Transmit information about a new producer ",span:m,status:1}),e.next=2,w._socketRequest("produce",{transportId:w._sendTransport.id,kind:s,rtpParameters:i,appData:a});case 2:c=e.sent,d=c.id,r({id:d}),e.next=4;break;case 3:e.prev=3,l=e.catch(1),null===(u=w._videosdkLogs)||void 0===u||u.pushLogs({logText:'Error this._sendTransport "produce" Event catch',logType:"ERROR",attributes:{error:l.message}}),n(l);case 4:case"end":return e.stop()}},e,null,[[1,3]])}));return function(t,r,n){return e.apply(this,arguments)}}()),this._sendTransport.on("producedata",function(){var e=(0,o.A)(p().mark(function e(t,r,n){var s,i,a,o,c,d,u,l;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s=t.sctpStreamParameters,i=t.label,a=t.protocol,o=t.appData,e.prev=1,e.next=2,w._socketRequest("produceData",{transportId:w._sendTransport.id,sctpStreamParameters:s,label:i,protocol:a,appData:o});case 2:c=e.sent,d=c.id,r({id:d}),e.next=4;break;case 3:e.prev=3,l=e.catch(1),null===(u=w._videosdkLogs)||void 0===u||u.pushLogs({logText:"Error producedata event catch",logType:"ERROR",attributes:{error:l.message}}),n(l);case 4:case"end":return e.stop()}},e,null,[[1,3]])}));return function(t,r,n){return e.apply(this,arguments)}}()),this._sendTransport.on("connectionstatechange",function(){var e=(0,o.A)(p().mark(function e(t){var r,n,i,a,o,c;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=Array,e.next=1,w._sendTransport.getStats();case 1:c=e.sent,(n=o.from.call(o,c).filter(function(e){var t=(0,s.A)(e,2)[1];return"local-candidate"===t.type||"remote-candidate"===t.type}).map(function(e){return(0,s.A)(e,2)[1]})).length>0&&(null===(i=w._videosdkLogs)||void 0===i||i.pushLogs({logText:'Send Trasnport State Change "'.concat(t,'" candidates'),logType:"INFO",attributes:{candidates:JSON.stringify(n)}})),"connected"===t&&w.emitMeetingStateChange(Bt),null===(r=w._openTelemetry)||void 0===r||r.traceAutoComplete({spanName:"_sendTransport Event connectionstatechange ".concat(t),span:m,status:1}),"failed"===t&&(null===(a=w._videosdkLogs)||void 0===a||a.pushLogs({logText:"ERROR_MEETING_MEDIA_CONNECTION_FAILED",logType:"ERROR",attributes:{error:"Unable to connect to the meeting or media. Please check your network connection, ensure your firewall or security settings are not blocking the application, or try connecting using a different network."},dashboardLog:!0}),w.restartIce()),w._transportState=t;case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),null===(a=this._openTelemetry)||void 0===a||a.completeSpan({span:m,status:1,message:"Send Transport Created Successfully"});case 1:case"end":return e.stop()}},e,this)})),function(e,t){return v.apply(this,arguments)})},{key:"createConsumerTransport",value:(g=(0,o.A)(p().mark(function e(t,r){var n,i,a,c,d,u,l,h,m,f,g,v,_,y,b=this;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a=t.id,c=t.iceParameters,d=t.iceCandidates,u=t.dtlsParameters,l=t.sctpParameters,h=null===(n=this._openTelemetry)||void 0===n?void 0:n.trace({spanName:"Creating Recieve Transport",span:r||null}),this._recvTransport=this._mediasoupDevice.createRecvTransport({id:a,iceParameters:c,iceCandidates:d,dtlsParameters:u,sctpParameters:l,iceServers:this._iceServers}),this._recvTransport.on("connect",function(e,t,r){var n,s=e.dtlsParameters;null===(n=b._openTelemetry)||void 0===n||n.traceAutoComplete({spanName:"this._recvTransport `connect` Event : Recieve Transport is about to establish the ICE+DTLS connection",span:h,status:1}),b._socketRequest("connectWebRtcTransport",{transportId:b._recvTransport.id,dtlsParameters:s}).then(function(){t()}).catch(function(e){r(e)})}),this._recvTransport.on("connectionstatechange",function(){var e=(0,o.A)(p().mark(function e(t){var r,n,i,a,o;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=Array,e.next=1,b._recvTransport.getStats();case 1:o=e.sent,(n=a.from.call(a,o).filter(function(e){var t=(0,s.A)(e,2)[1];return"local-candidate"===t.type||"remote-candidate"===t.type}).map(function(e){return(0,s.A)(e,2)[1]})).length>0&&(null===(i=b._videosdkLogs)||void 0===i||i.pushLogs({logText:'Recv Trasnport State Change "'.concat(t,'" candidates'),logType:"INFO",attributes:{candidates:JSON.stringify(n)}})),null===(r=b._openTelemetry)||void 0===r||r.traceAutoComplete({spanName:"_recvTransport Event connectionstatechange ".concat(t),span:h,status:1}),"failed"===t&&b.restartIce(),b._transportState=t;case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),m=0,f=this._metrics.addNewProbe(this._recvTransport,"transport"),g=new Map,v=new Map,_=new Map,y=new Set,f.onStatsCollected=function(e){try{var t=function(e,t,r){b._stats.consumerStats||(b._stats.consumerStats={});var n=t.appData.peerId;b._stats.consumerStats[n]||(b._stats.consumerStats[n]={}),b._stats.consumerStats[n][r]||(b._stats.consumerStats[n][r]=[]),b._latestStats[t.track.id.replace(/[{}]/g,"")]=[e],m%5==0&&b._stats.consumerStats[n][r].push(e)},r=function(r){e[r].forEach(function(e){var r,n=wr(b._consumers);try{for(n.s();!(r=n.n()).done;){var i=(0,s.A)(r.value,2),a=(i[0],i[1]),o=a.track.id.replace(/[{}]/g,"");if(o===e.trackId){var c=a.appData.share?"audio"===a.kind?"shareAudio":"share":a.kind;if(t(e,a,c),"audio"===c||"shareAudio"===c)return;if(e.bitrate>0)g.has(o)&&g.delete(o);else{var d=g.get(o);d?d.detected+5e3<Date.now()&&b._eventEmitter.emit("STREAM_STATE_CHANGED",{state:"stuck",peerId:a.appData.peerId,streamId:o}):g.set(o,{detected:Date.now()})}var u=e.trackId,l=e.freezeCount;if(!u||void 0===l)return;var p=v.get(u);if(void 0===p)return void v.set(u,l);if(l>p)b._eventEmitter.emit("STREAM_STATE_CHANGED",{state:"freeze-detected",peerId:a.appData.peerId,streamId:o}),_.set(u,Date.now()),y.delete(u);else{var h=_.get(u);h&&!y.has(u)&&Date.now()-h>5e3&&(b._eventEmitter.emit("STREAM_STATE_CHANGED",{state:"freeze-resolved",peerId:a.appData.peerId,streamId:o}),y.add(u))}v.set(u,l)}}}catch(m){n.e(m)}finally{n.f()}})};r("audio"),r("video"),m++}catch(i){var n;null===(n=b._videosdkLogs)||void 0===n||n.pushLogs({logText:"Error CONSUMER Stats ERROR",logType:"ERROR",attributes:{error:i.message}})}},f.start(),this._recvTransport.observer.on("close",function(){f.stop(),b._metrics.removeExistingProbe(f)}),null===(i=this._openTelemetry)||void 0===i||i.completeSpan({span:h,status:1,message:"Recieve Transport Created Successfully"});case 1:case"end":return e.stop()}},e,this)})),function(e,t){return g.apply(this,arguments)})},{key:"emitMeetingStateChange",value:function(e){this._eventEmitter.emit("MEETING_STATE_CHANGED",{state:e}),this._meetingConnectionState=e}},{key:"joinRoom",value:(f=(0,o.A)(p().mark(function e(){var t,r,n,s,i,a,o,c,d,u,l,h,m,f,g,v,_,y,b,w,S,R,k,E,T,C,P,O;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return Or.debug("joinRoom()"),e.prev=1,o=null===(t=this._openTelemetry)||void 0===t?void 0:t.trace({spanName:"Loading Router Capabilities",span:this._joinSpan}),this._mediasoupDevice=new Le.pF({handlerName:this._handlerName}),e.next=2,this._socketRequest("getRouterRtpCapabilities");case 2:return c=e.sent,"react-native"!=this._deviceInfo.sdkType?navigator.userAgent.indexOf("Firefox")&&(c.headerExtensions=null===(d=c.headerExtensions)||void 0===d?void 0:d.filter(function(e){return"urn:3gpp:video-orientation"!=e.uri})):c.headerExtensions=null===(u=c.headerExtensions)||void 0===u?void 0:u.filter(function(e){return"urn:3gpp:video-orientation"!=e.uri}),e.next=3,this._mediasoupDevice.load({routerRtpCapabilities:c});case 3:if(null===(r=this._openTelemetry)||void 0===r||r.completeSpan({span:o,status:1,attributes:{routerRtpCapabilities:JSON.stringify(c).toString()},message:"Router Capabilities Loaded"}),!this._produce){e.next=5;break}return e.next=4,this._socketRequest("createWebRtcTransport",{preferredProtocol:this._preferredProtocol,producing:!0,consuming:!1,sctpCapabilities:this._useDataChannel?this._mediasoupDevice.sctpCapabilities:void 0});case 4:l=e.sent,this.createProducerTransport(l,this._joinSpan);case 5:if(!this._consume){e.next=7;break}return e.next=6,this._socketRequest("createWebRtcTransport",{preferredProtocol:this._preferredProtocol,producing:!1,consuming:!0,sctpCapabilities:this._useDataChannel?this._mediasoupDevice.sctpCapabilities:void 0});case 6:h=e.sent,this.createConsumerTransport(h,this._joinSpan);case 7:return e.next=8,this._socketRequest("join",{displayName:this._displayName,device:this._device,secret:this._secret,rtpCapabilities:null===(n=this._mediasoupDevice)||void 0===n?void 0:n.rtpCapabilities,sctpCapabilities:null===(s=this._mediasoupDevice)||void 0===s?void 0:s.sctpCapabilities,deviceInfo:this._deviceInfo,debugMode:this._debugMode,autoConsume:this._autoConsume,metaData:this._metaData});case 8:m=e.sent,f=m.peers,g=m.poll,v=m.messages,Rr.dispatch(et("connected")),null===(i=this._openTelemetry)||void 0===i||i.traceAutoComplete({spanName:"Emitted `MEETING_JOINED` Event",span:this._joinSpan,status:1}),this._eventEmitter.emit("MEETING_JOINED",{peers:f,poll:g,messages:v,baseUrl:this._baseUrl}),Rr.dispatch(It()),Rr.dispatch(At({text:"You are in the room!",timeout:3e3})),_=wr(f);try{for(_.s();!(y=_.n()).done;)b=y.value,w=yt(br(br({},b),{},{consumers:[],dataConsumers:[]})),Rr.dispatch(w),this._eventEmitter.emit(w.type,w.payload)}catch(p){_.e(p)}finally{_.f()}this._produce&&(Rr.dispatch(nt({canSendMic:this._mediasoupDevice.canProduce("audio"),canSendWebcam:this._mediasoupDevice.canProduce("video")})),this._micEnabled?this.enableMic(this.customMicrophoneAudioTrack,this._joinSpan):this.customMicrophoneAudioTrack&&(null===(S=this._openTelemetry)||void 0===S||S.traceAutoComplete({spanName:"Disposing Audio Track",span:this._joinSpan,status:2}),this.customMicrophoneAudioTrack.getTracks().forEach(function(e){e.stop()})),R=Ye(),this._webcamEnabled&&(!R||R.webcamEnabled||this._externalVideo)?this.enableWebcam(this.customCameraVideoTrack,this._joinSpan):this.customCameraVideoTrack&&(null===(k=this._openTelemetry)||void 0===k||k.traceAutoComplete({spanName:"Disposing Video Track",span:this._joinSpan,status:2}),this.customCameraVideoTrack.getTracks().forEach(function(e){e.stop()}))),window.SHOW_INFO&&(E=Rr.getState(),T=E.me,Rr.dispatch(rt(T.id))),null===(a=this._openTelemetry)||void 0===a||a.completeSpan({span:this._joinSpan,status:1,message:"Room Joined"}),e.next=10;break;case 9:e.prev=9,O=e.catch(1),Or.error("joinRoom() failed:%o",O),null===(C=this._videosdkLogs)||void 0===C||C.pushLogs({logText:"Error Could not join the room",logType:"ERROR",attributes:{error:O.message}}),null===(P=this._openTelemetry)||void 0===P||P.completeSpan({span:this._joinSpan,status:2,message:"Could not join the room ".concat(O)}),Rr.dispatch(At({type:"error",text:"Could not join the room: ".concat(O)})),this.close({sendLeft:!0});case 10:case"end":return e.stop()}},e,this,[[1,9]])})),function(){return f.apply(this,arguments)})},{key:"switchingRoom",value:(m=(0,o.A)(p().mark(function e(t){var r,n,s,i,a,o,c,d,u,l,h,m,f,g,v,_,y,b,w;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=null===(r=this._openTelemetry)||void 0===r?void 0:r.trace({name:"switchingRoom() start",attributes:{"room.id":t,"peer.id":this._peerId,display_name:this._displayName}}),e.prev=1,d=null===(s=this._openTelemetry)||void 0===s?void 0:s.trace({name:"switch room join request",parentSpan:n}),e.next=2,this._socketRequest("join",{displayName:this._displayName,device:this._device,secret:this._secret,rtpCapabilities:null===(i=this._mediasoupDevice)||void 0===i?void 0:i.rtpCapabilities,sctpCapabilities:null===(a=this._mediasoupDevice)||void 0===a?void 0:a.sctpCapabilities,deviceInfo:this._deviceInfo,debugMode:this._debugMode,autoConsume:this._autoConsume,metaData:this._metaData,switchingRoom:!0});case 2:u=e.sent,l=u.peers,h=u.poll,m=u.messages,null===(o=this._openTelemetry)||void 0===o||o.completeSpan({span:d,status:1,message:"Join request successful in switched room"}),Rr.dispatch(et("connected")),this._eventEmitter.emit("MEETING_JOINED",{switchRoomId:t,peers:l,poll:h,messages:m,baseUrl:this._baseUrl}),Rr.dispatch(It()),Rr.dispatch(At({text:"You are in the room!",timeout:3e3})),f=wr(l);try{for(f.s();!(g=f.n()).done;)v=g.value,_=yt(br(br({},v),{},{consumers:[],dataConsumers:[]})),Rr.dispatch(_),this._eventEmitter.emit(_.type,_.payload)}catch(p){f.e(p)}finally{f.f()}null===(c=this._openTelemetry)||void 0===c||c.completeSpan({span:n,status:1,message:"Room switch completed successfully"}),e.next=4;break;case 3:e.prev=3,w=e.catch(1),Or.error("joinRoom() failed:%o",w),null===(y=this._videosdkLogs)||void 0===y||y.pushLogs({logText:"Error Could not join the switched room",logType:"ERROR",attributes:{error:w.message}}),null===(b=this._openTelemetry)||void 0===b||b.completeSpan({span:n,status:2,message:"Room switch failed: ".concat(w.message)}),Rr.dispatch(At({type:"error",text:"Could not join the switched room: ".concat(w)})),this.close({sendLeft:!0});case 4:case"end":return e.stop()}},e,this,[[1,3]])})),function(e){return m.apply(this,arguments)})},{key:"_updateMics",value:(h=(0,o.A)(p().mark(function e(){var t,r,n,s,i,a,o,c,d,u,l,h,m,f,g,v,_=arguments;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=_.length>0&&void 0!==_[0]?_[0]:void 0,this._mics=new Map,Or.debug("_updateMics() |"),n=null===(t=this._openTelemetry)||void 0===t?void 0:t.trace({spanName:"_updateMics() Calling for Getting System Mic list",span:r||null}),e.prev=1,e.next=2,navigator.mediaDevices.enumerateDevices();case 2:a=e.sent,null===(s=this._openTelemetry)||void 0===s||s.traceAutoComplete({spanName:"Getting System Mic list",span:n,status:1,attributes:{systemDevice:a?JSON.stringify(a):"Device not found"}}),o=wr(a);try{for(o.s();!(c=o.n()).done;)"audioinput"==(d=c.value).kind&&this._mics.set(d.deviceId,d)}catch(p){o.e(p)}finally{o.f()}u=Array.from(this._mics.values()),l=u.length,h=this._mic.device?this._mic.device.deviceId:void 0,0===l?this._mic.device=null:this._mics.has(h)||(this._mic.device=u[0]),null===(i=this._openTelemetry)||void 0===i||i.completeSpan({span:n,status:1,message:"Update Mic"}),e.next=5;break;case 3:if(e.prev=3,!((v=e.catch(1))instanceof TypeError)){e.next=5;break}if("TypeError"!==v.name){e.next=4;break}throw f=jt.q.ERROR_MICROPHONE_ACCESS_UNAVAILABLE,this._emitError(f),null===(m=this._openTelemetry)||void 0===m||m.completeSpan({span:n,status:2,message:"Error in updateMics() :: ".concat(f.message)}),new Error(f.message);case 4:throw null===(g=this._openTelemetry)||void 0===g||g.completeSpan({span:n,status:2,message:"Error in updateMics() :: ".concat(v.message)}),new Error(v.message);case 5:case"end":return e.stop()}},e,this,[[1,3]])})),function(){return h.apply(this,arguments)})},{key:"_updateWebcams",value:(l=(0,o.A)(p().mark(function e(){var t,r,n,s,i,a,o,c,d,u,l,h,m,f,g,v,_,y=arguments;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=y.length>0&&void 0!==y[0]?y[0]:void 0,Or.debug("_updateWebcams()"),this._webcams=new Map,Or.debug("_updateWebcams() | calling enumerateDevices()"),n=null===(t=this._openTelemetry)||void 0===t?void 0:t.trace({spanName:"_updateWebcams() Calling for Getting System Webcam list",span:r||null}),e.prev=1,e.next=2,navigator.mediaDevices.enumerateDevices();case 2:a=e.sent,null===(s=this._openTelemetry)||void 0===s||s.traceAutoComplete({spanName:"Getting System Webcam list",span:n,status:1,attributes:{systemDevice:a?JSON.stringify(a):"Device not found"}}),o=wr(a),e.prev=3,o.s();case 4:if((c=o.n()).done){e.next=7;break}if("videoinput"===(d=c.value).kind){e.next=5;break}return e.abrupt("continue",6);case 5:this._webcams.set(d.deviceId,d);case 6:e.next=4;break;case 7:e.next=9;break;case 8:e.prev=8,v=e.catch(3),o.e(v);case 9:return e.prev=9,o.f(),e.finish(9);case 10:u=Array.from(this._webcams.values()),l=u.length,(h=this._webcam.device?this._webcam.device.deviceId:void 0)&&(this._defaultCameraIndex=h),Or.debug("_updateWebcams() [webcams:%o]",u),0===l?this._webcam.device=null:this._webcams.has(h)||(this._webcam.device=u[0]),null===(i=this._openTelemetry)||void 0===i||i.completeSpan({span:n,status:1,message:"Update Webcam"}),Rr.dispatch(st(this._webcams.size>1)),e.next=13;break;case 11:if(e.prev=11,!((_=e.catch(1))instanceof TypeError)){e.next=13;break}if("TypeError"!==_.name){e.next=12;break}throw f=jt.q.ERROR_CAMERA_ACCESS_UNAVAILABLE,this._emitError(f),null===(m=this._openTelemetry)||void 0===m||m.completeSpan({span:n,status:2,message:"Error in updateWebcams() :: ".concat(f.message)}),new Error(f.message);case 12:throw null===(g=this._openTelemetry)||void 0===g||g.completeSpan({span:n,status:2,message:"Error in updateWebcams() :: ".concat(_.message)}),new Error(_.message);case 13:case"end":return e.stop()}},e,this,[[1,11],[3,8,9,10]])})),function(){return l.apply(this,arguments)})},{key:"_getWebcamType",value:function(e){return/(back|rear)/i.test(e.label)?(Or.debug("_getWebcamType() | it seems to be a back camera"),"back"):(Or.debug("_getWebcamType() | it seems to be a front camera"),"front")}},{key:"_pauseConsumer",value:(n=(0,o.A)(p().mark(function e(t){var r,n;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.paused){e.next=1;break}return e.abrupt("return");case 1:return e.prev=1,e.next=2,this._socketRequest("pauseConsumer",{consumerId:t.id});case 2:t.pause(),Rr.dispatch(kt(t.id,"local")),e.next=4;break;case 3:e.prev=3,n=e.catch(1),Or.error("_pauseConsumer() | failed:%o",n),null===(r=this._videosdkLogs)||void 0===r||r.pushLogs({logText:"Error pausing Consumer",logType:"ERROR",attributes:{error:n.message}}),Rr.dispatch(At({type:"error",text:"Error pausing Consumer: ".concat(n)}));case 4:case"end":return e.stop()}},e,this,[[1,3]])})),function(e){return n.apply(this,arguments)})},{key:"_resumeConsumer",value:(r=(0,o.A)(p().mark(function e(t){var r,n;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.paused){e.next=1;break}return e.abrupt("return");case 1:return e.prev=1,e.next=2,this._socketRequest("resumeConsumer",{consumerId:t.id});case 2:t.resume(),Rr.dispatch(Et(t.id,"local")),e.next=4;break;case 3:e.prev=3,n=e.catch(1),Or.error("_resumeConsumer() | failed:%o",n),null===(r=this._videosdkLogs)||void 0===r||r.pushLogs({logText:"Error resuming Consumer",logType:"ERROR",attributes:{error:n.message}}),Rr.dispatch(At({type:"error",text:"Error resuming Consumer: ".concat(n)}));case 4:case"end":return e.stop()}},e,this,[[1,3]])})),function(e){return r.apply(this,arguments)})},{key:"_getExternalVideoStream",value:(t=(0,o.A)(p().mark(function e(){var t=this;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._externalVideoStream){e.next=1;break}return e.abrupt("return",this._externalVideoStream);case 1:if(!(this._externalVideo.readyState<3)){e.next=2;break}return e.next=2,new Promise(function(e){return t._externalVideo.addEventListener("canplay",e)});case 2:if(!this._externalVideo.captureStream){e.next=3;break}this._externalVideoStream=this._externalVideo.captureStream(),e.next=5;break;case 3:if(!this._externalVideo.mozCaptureStream){e.next=4;break}this._externalVideoStream=this._externalVideo.mozCaptureStream(),e.next=5;break;case 4:throw new Error("video.captureStream() not supported");case 5:return e.abrupt("return",this._externalVideoStream);case 6:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})},{key:"toggleE2EEEnabled",value:(e=(0,o.A)(p().mark(function e(t){return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.e2eeManager){e.next=1;break}this._peerId&&this.e2eeManager.setParticipantCryptorEnabled(t,this._peerId),this.isE2EEEnabled=t,e.next=2;break;case 1:throw Error("e2ee not configured, please set e2ee settings within the room options");case 2:case"end":return e.stop()}},e,this)})),function(t){return e.apply(this,arguments)})},{key:"_emitError",value:function(e){this._eventEmitter.emit("ERROR",e)}}],[{key:"init",value:function(e){Rr=e.store}}]);var e,t,r,n,l,h,m,f,g,v,_,y,b,w,S,R,k,E,T,C,P,O,x,D,I,A,M,L,N,j,B,U,F,q,W,V,H,z,K,G,$,J,Q,Y,X,Z,ee,te,re,ne,se,ie,ae,oe,ce,de,ue,le,pe,he,me,fe,ge,ve,_e,ye,be,we,Se,Re,ke,Ee,Te,Ce,Pe,Oe,xe,De,Ie,Ae,Ne,je,Be,Ue,Fe,qe,We,Ve,He,Ke,Ge,$e,Je,Xe,Ze,Wt,Vt,Ht,zt,Kt,$t,Jt,Xt,Zt,er,tr,rr,nr,sr,ir,ar,or,cr,dr,ur,lr,pr}();function Ir(e){return Ar.apply(this,arguments)}function Ar(){return(Ar=(0,o.A)(p().mark(function e(t){var r,n,s,i,a,o,c=this;return p().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.e2eeManager){e.next=2;break}return n=fr,s=t,e.next=1,gr();case 1:i=e.sent,a={keyProvider:s,worker:i},this.e2eeManager=new n(a),this.e2eeManager.on(ur.KS.ParticipantEncryptionStatusChanged,function(e){c.isE2EEEnabled=e}),this.e2eeManager.on(ur.KS.E2EEStateChange,function(e){c._eventEmitter.emit("E2EE_STATE_CHANGE",e)}),null===(r=this.e2eeManager)||void 0===r||r.setup(this),this.toggleE2EEEnabled(!0);case 2:e.next=4;break;case 3:throw e.prev=3,o=e.catch(0),new Error("Error setting up E2EE: "+o.message);case 4:case"end":return e.stop()}},e,this,[[0,3]])}))).apply(this,arguments)}},2073:function(e,t,r){var n;e.exports=(n=r(9021),r(7165),n.pad.AnsiX923={pad:function(e,t){var r=e.sigBytes,n=4*t,s=n-r%n,i=r+s-1;e.clamp(),e.words[i>>>2]|=s<<24-i%4*8,e.sigBytes+=s},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},n.pad.Ansix923)},2107:(e,t,r)=>{r.d(t,{kR:()=>s,nI:()=>n,wZ:()=>i});var n={CONFERENCE:"CONFERENCE",VIEWER:"VIEWER",SEND_AND_RECV:"SEND_AND_RECV",SIGNALLING_ONLY:"SIGNALLING_ONLY",RECV_ONLY:"RECV_ONLY"};function s(e){return e===n.CONFERENCE||e===n.SEND_AND_RECV}function i(e){return e===n.VIEWER||e===n.SIGNALLING_ONLY}},2109:function(e,t,r){var n;!function(s,i){var a,o="user-agent",c="",d="function",u="undefined",l="object",p="string",h="browser",m="cpu",f="device",g="engine",v="os",_="result",y="name",b="type",w="vendor",S="version",R="architecture",k="major",E="model",T="console",C="mobile",P="tablet",O="smarttv",x="wearable",D="xr",I="embedded",A="inapp",M="brands",L="formFactors",N="fullVersionList",j="platform",B="platformVersion",U="bitness",F="sec-ch-ua",q=F+"-full-version-list",W=F+"-arch",V=F+"-"+U,H=F+"-form-factors",z=F+"-"+C,K=F+"-"+E,G=F+"-"+j,$=G+"-version",J=[M,N,C,E,j,B,R,L,U],Q="Amazon",Y="Apple",X="ASUS",Z="BlackBerry",ee="Google",te="Huawei",re="Lenovo",ne="Honor",se="LG",ie="Microsoft",ae="Motorola",oe="Nvidia",ce="OnePlus",de="OPPO",ue="Samsung",le="Sharp",pe="Sony",he="Xiaomi",me="Zebra",fe="Chrome",ge="Chromium",ve="Chromecast",_e="Edge",ye="Firefox",be="Opera",we="Facebook",Se="Sogou",Re="Mobile ",ke=" Browser",Ee="Windows",Te=typeof s!==u,Ce=Te&&s.navigator?s.navigator:i,Pe=Ce&&Ce.userAgentData?Ce.userAgentData:i,Oe=function(e){for(var t={},r=0;r<e.length;r++)t[e[r].toUpperCase()]=e[r];return t},xe=function(e,t){if(typeof e===l&&e.length>0){for(var r in e)if(Me(t)==Me(e[r]))return!0;return!1}return!!Ie(e)&&Me(t)==Me(e)},De=function(e,t){for(var r in e)return/^(browser|cpu|device|engine|os)$/.test(r)||!!t&&De(e[r])},Ie=function(e){return typeof e===p},Ae=function(e){if(!e)return i;for(var t=[],r=je(/\\?\"/g,e).split(","),n=0;n<r.length;n++)if(r[n].indexOf(";")>-1){var s=Ue(r[n]).split(";v=");t[n]={brand:s[0],version:s[1]}}else t[n]=Ue(r[n]);return t},Me=function(e){return Ie(e)?e.toLowerCase():e},Le=function(e){return Ie(e)?je(/[^\d\.]/g,e).split(".")[0]:i},Ne=function(e){for(var t in e){var r=e[t];typeof r==l&&2==r.length?this[r[0]]=r[1]:this[r]=i}return this},je=function(e,t){return Ie(t)?t.replace(e,c):t},Be=function(e){return je(/\\?\"/g,e)},Ue=function(e,t){if(Ie(e))return e=je(/^\s\s*/,e),typeof t===u?e:e.substring(0,500)},Fe=function(e,t){if(e&&t)for(var r,n,s,a,o,c,u=0;u<t.length&&!o;){var p=t[u],h=t[u+1];for(r=n=0;r<p.length&&!o&&p[r];)if(o=p[r++].exec(e))for(s=0;s<h.length;s++)c=o[++n],typeof(a=h[s])===l&&a.length>0?2===a.length?typeof a[1]==d?this[a[0]]=a[1].call(this,c):this[a[0]]=a[1]:a.length>=3&&(typeof a[1]!==d||a[1].exec&&a[1].test?3==a.length?this[a[0]]=c?c.replace(a[1],a[2]):i:4==a.length?this[a[0]]=c?a[3].call(this,c.replace(a[1],a[2])):i:a.length>4&&(this[a[0]]=c?a[3].apply(this,[c.replace(a[1],a[2])].concat(a.slice(4))):i):a.length>3?this[a[0]]=c?a[1].apply(this,a.slice(2)):i:this[a[0]]=c?a[1].call(this,c,a[2]):i):this[a]=c||i;u+=2}},qe=function(e,t){for(var r in t)if(typeof t[r]===l&&t[r].length>0){for(var n=0;n<t[r].length;n++)if(xe(t[r][n],e))return"?"===r?i:r}else if(xe(t[r],e))return"?"===r?i:r;return t.hasOwnProperty("*")?t["*"]:e},We={ME:"4.90","NT 3.51":"3.51","NT 4.0":"4.0",2e3:["5.0","5.01"],XP:["5.1","5.2"],Vista:"6.0",7:"6.1",8:"6.2",8.1:"6.3",10:["6.4","10.0"],NT:""},Ve={embedded:"Automotive",mobile:"Mobile",tablet:["Tablet","EInk"],smarttv:"TV",wearable:"Watch",xr:["VR","XR"],"?":["Desktop","Unknown"],"*":i},He={Chrome:"Google Chrome",Edge:"Microsoft Edge","Edge WebView2":"Microsoft Edge WebView2","Chrome WebView":"Android WebView","Chrome Headless":"HeadlessChrome","Huawei Browser":"HuaweiBrowser","MIUI Browser":"Miui Browser","Opera Mobi":"OperaMobile",Yandex:"YaBrowser"},ze={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[S,[y,Re+"Chrome"]],[/webview.+edge\/([\w\.]+)/i],[S,[y,_e+" WebView"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[S,[y,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[y,S],[/opios[\/ ]+([\w\.]+)/i],[S,[y,be+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[S,[y,be+" GX"]],[/\bopr\/([\w\.]+)/i],[S,[y,be]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[S,[y,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[S,[y,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon|otter|dooble|(?:lg |qute)browser)\/([-\w\.]+)/i,/(heytap|ovi|115|surf)browser\/([\d\.]+)/i,/(ecosia|weibo)(?:__| \w+@)([\d\.]+)/i],[y,S],[/quark(?:pc)?\/([-\w\.]+)/i],[S,[y,"Quark"]],[/\bddg\/([\w\.]+)/i],[S,[y,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[S,[y,"UCBrowser"]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[S,[y,"WeChat"]],[/konqueror\/([\w\.]+)/i],[S,[y,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[S,[y,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[S,[y,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[S,[y,"Smart "+re+ke]],[/(avast|avg)\/([\w\.]+)/i],[[y,/(.+)/,"$1 Secure"+ke],S],[/\bfocus\/([\w\.]+)/i],[S,[y,ye+" Focus"]],[/\bopt\/([\w\.]+)/i],[S,[y,be+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[S,[y,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[S,[y,"Dolphin"]],[/coast\/([\w\.]+)/i],[S,[y,be+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[S,[y,"MIUI"+ke]],[/fxios\/([\w\.-]+)/i],[S,[y,Re+ye]],[/\bqihoobrowser\/?([\w\.]*)/i],[S,[y,"360"]],[/\b(qq)\/([\w\.]+)/i],[[y,/(.+)/,"$1Browser"],S],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[y,/(.+)/,"$1"+ke],S],[/samsungbrowser\/([\w\.]+)/i],[S,[y,ue+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[S,[y,Se+" Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[y,Se+" Mobile"],S],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[y,S],[/(lbbrowser|rekonq)/i],[y],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[S,y],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[y,we],S,[b,A]],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/(daum)apps[\/ ]([\w\.]+)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(instagram|snapchat|klarna)[\/ ]([-\w\.]+)/i],[y,S,[b,A]],[/\bgsa\/([\w\.]+) .*safari\//i],[S,[y,"GSA"],[b,A]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[S,[y,"TikTok"],[b,A]],[/\[(linkedin)app\]/i],[y,[b,A]],[/(chromium)[\/ ]([-\w\.]+)/i],[y,S],[/headlesschrome(?:\/([\w\.]+)| )/i],[S,[y,fe+" Headless"]],[/wv\).+chrome\/([\w\.]+).+edgw\//i],[S,[y,_e+" WebView2"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[y,fe+" WebView"],S],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[S,[y,"Android"+ke]],[/chrome\/([\w\.]+) mobile/i],[S,[y,Re+"Chrome"]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[y,S],[/version\/([\w\.\,]+) .*mobile(?:\/\w+ | ?)safari/i],[S,[y,Re+"Safari"]],[/iphone .*mobile(?:\/\w+ | ?)safari/i],[[y,Re+"Safari"]],[/version\/([\w\.\,]+) .*(safari)/i],[S,y],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[y,[S,"1"]],[/(webkit|khtml)\/([\w\.]+)/i],[y,S],[/(?:mobile|tablet);.*(firefox)\/([\w\.-]+)/i],[[y,Re+ye],S],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[y,"Netscape"],S],[/(wolvic|librewolf)\/([\w\.]+)/i],[y,S],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[S,[y,ye+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(amaya|dillo|doris|icab|ladybird|lynx|mosaic|netsurf|obigo|polaris|w3m|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/\b(links) \(([\w\.]+)/i],[y,[S,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[y,[S,/[^\d\.]+./,c]]],cpu:[[/\b((amd|x|x86[-_]?|wow|win)64)\b/i],[[R,"amd64"]],[/(ia32(?=;))/i,/\b((i[346]|x)86)(pc)?\b/i],[[R,"ia32"]],[/\b(aarch64|arm(v?[89]e?l?|_?64))\b/i],[[R,"arm64"]],[/\b(arm(v[67])?ht?n?[fl]p?)\b/i],[[R,"armhf"]],[/( (ce|mobile); ppc;|\/[\w\.]+arm\b)/i],[[R,"arm"]],[/((ppc|powerpc)(64)?)( mac|;|\))/i],[[R,/ower/,c,Me]],[/ sun4\w[;\)]/i],[[R,"sparc"]],[/\b(avr32|ia64(?=;)|68k(?=\))|\barm(?=v([1-7]|[5-7]1)l?|;|eabi)|(irix|mips|sparc)(64)?\b|pa-risc)/i],[[R,Me]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[E,[w,ue],[b,P]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr]|browser)[-\w]+)/i,/sec-(sgh\w+)/i],[E,[w,ue],[b,C]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[E,[w,Y],[b,C]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[E,[w,Y],[b,P]],[/(macintosh);/i],[E,[w,Y]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[E,[w,le],[b,C]],[/\b((?:brt|eln|hey2?|gdi|jdn)-a?[lnw]09|(?:ag[rm]3?|jdn2|kob2)-a?[lw]0[09]hn)(?: bui|\)|;)/i],[E,[w,ne],[b,P]],[/honor([-\w ]+)[;\)]/i],[E,[w,ne],[b,C]],[/\b((?:ag[rs][2356]?k?|bah[234]?|bg[2o]|bt[kv]|cmr|cpn|db[ry]2?|jdn2|got|kob2?k?|mon|pce|scm|sht?|[tw]gr|vrd)-[ad]?[lw][0125][09]b?|605hw|bg2-u03|(?:gem|fdr|m2|ple|t1)-[7a]0[1-4][lu]|t1-a2[13][lw]|mediapad[\w\. ]*(?= bui|\)))\b(?!.+d\/s)/i],[E,[w,te],[b,P]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[E,[w,te],[b,C]],[/oid[^\)]+; (2[\dbc]{4}(182|283|rp\w{2})[cgl]|m2105k81a?c)(?: bui|\))/i,/\b((?:red)?mi[-_ ]?pad[\w- ]*)(?: bui|\))/i],[[E,/_/g," "],[w,he],[b,P]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i,/ ([\w ]+) miui\/v?\d/i],[[E,/_/g," "],[w,he],[b,C]],[/droid.+; (cph2[3-6]\d[13579]|((gm|hd)19|(ac|be|in|kb)20|(d[en]|eb|le|mt)21|ne22)[0-2]\d|p[g-k]\w[1m]10)\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[E,[w,ce],[b,C]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[E,[w,de],[b,C]],[/\b(opd2(\d{3}a?))(?: bui|\))/i],[E,[w,qe,{OnePlus:["203","304","403","404","413","415"],"*":de}],[b,P]],[/(vivo (5r?|6|8l?|go|one|s|x[il]?[2-4]?)[\w\+ ]*)(?: bui|\))/i],[E,[w,"BLU"],[b,C]],[/; vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[E,[w,"Vivo"],[b,C]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[E,[w,"Realme"],[b,C]],[/(ideatab[-\w ]+|602lv|d-42a|a101lv|a2109a|a3500-hv|s[56]000|pb-6505[my]|tb-?x?\d{3,4}(?:f[cu]|xu|[av])|yt\d?-[jx]?\d+[lfmx])( bui|;|\)|\/)/i,/lenovo ?(b[68]0[08]0-?[hf]?|tab(?:[\w- ]+?)|tb[\w-]{6,7})( bui|;|\)|\/)/i],[E,[w,re],[b,P]],[/lenovo[-_ ]?([-\w ]+?)(?: bui|\)|\/)/i],[E,[w,re],[b,C]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ]([\w\s]+)(\)| bui)/i,/((?:moto(?! 360)[-\w\(\) ]+|xt\d{3,4}[cgkosw\+]?[-\d]*|nexus 6)(?= bui|\)))/i],[E,[w,ae],[b,C]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[E,[w,ae],[b,P]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[E,[w,se],[b,P]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+(?!.*(?:browser|netcast|android tv|watch|webos))(\w+)/i,/\blg-?([\d\w]+) bui/i],[E,[w,se],[b,C]],[/(nokia) (t[12][01])/i],[w,E,[b,P]],[/(?:maemo|nokia).*(n900|lumia \d+|rm-\d+)/i,/nokia[-_ ]?(([-\w\. ]*))/i],[[E,/_/g," "],[b,C],[w,"Nokia"]],[/(pixel (c|tablet))\b/i],[E,[w,ee],[b,P]],[/droid.+;(?: google)? (g(01[13]a|020[aem]|025[jn]|1b60|1f8f|2ybb|4s1m|576d|5nz6|8hhn|8vou|a02099|c15s|d1yq|e2ae|ec77|gh2x|kv4x|p4bc|pj41|r83y|tt9q|ur25|wvk6)|pixel[\d ]*a?( pro)?( xl)?( fold)?( \(5g\))?)( bui|\))/i],[E,[w,ee],[b,C]],[/(google) (pixelbook( go)?)/i],[w,E],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-\w\w\d\d)(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[E,[w,pe],[b,C]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[E,"Xperia Tablet"],[w,pe],[b,P]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[E,[w,Q],[b,P]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[E,/(.+)/g,"Fire Phone $1"],[w,Q],[b,C]],[/(playbook);[-\w\),; ]+(rim)/i],[E,w,[b,P]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[E,[w,Z],[b,C]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[E,[w,X],[b,P]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[E,[w,X],[b,C]],[/(nexus 9)/i],[E,[w,"HTC"],[b,P]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[w,[E,/_/g," "],[b,C]],[/tcl (xess p17aa)/i,/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])(_\w(\w|\w\w))?(\)| bui)/i],[E,[w,"TCL"],[b,P]],[/droid [\w\.]+; (418(?:7d|8v)|5087z|5102l|61(?:02[dh]|25[adfh]|27[ai]|56[dh]|59k|65[ah])|a509dl|t(?:43(?:0w|1[adepqu])|50(?:6d|7[adju])|6(?:09dl|10k|12b|71[efho]|76[hjk])|7(?:66[ahju]|67[hw]|7[045][bh]|71[hk]|73o|76[ho]|79w|81[hks]?|82h|90[bhsy]|99b)|810[hs]))(_\w(\w|\w\w))?(\)| bui)/i],[E,[w,"TCL"],[b,C]],[/(itel) ((\w+))/i],[[w,Me],E,[b,qe,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[E,[w,"Acer"],[b,P]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[E,[w,"Meizu"],[b,C]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[E,[w,"Ulefone"],[b,C]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[E,[w,"Energizer"],[b,C]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[E,[w,"Cat"],[b,C]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[E,[w,"Smartfren"],[b,C]],[/droid.+; (a(in)?(0(15|59|6[35])|142)p?)/i],[E,[w,"Nothing"],[b,C]],[/; (x67 5g|tikeasy \w+|ac[1789]\d\w+)( b|\))/i,/archos ?(5|gamepad2?|([\w ]*[t1789]|hello) ?\d+[\w ]*)( b|\))/i],[E,[w,"Archos"],[b,P]],[/archos ([\w ]+)( b|\))/i,/; (ac[3-6]\d\w{2,8})( b|\))/i],[E,[w,"Archos"],[b,C]],[/; (n159v)/i],[E,[w,"HMD"],[b,C]],[/(imo) (tab \w+)/i,/(infinix|tecno) (x1101b?|p904|dp(7c|8d|10a)( pro)?|p70[1-3]a?|p904|t1101)/i],[w,E,[b,P]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus(?! zenw)|dell|jolla|meizu|motorola|polytron|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (blu|hmd|imo|infinix|lava|oneplus|tcl)[_ ]([\w\+ ]+?)(?: bui|\)|; r)/i,/(hp) ([\w ]+\w)/i,/(microsoft); (lumia[\w ]+)/i,/(oppo) ?([\w ]+) bui/i],[w,E,[b,C]],[/(kobo)\s(ereader|touch)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i],[w,E,[b,P]],[/(surface duo)/i],[E,[w,ie],[b,P]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[E,[w,"Fairphone"],[b,C]],[/((?:tegranote|shield t(?!.+d tv))[\w- ]*?)(?: b|\))/i],[E,[w,oe],[b,P]],[/(sprint) (\w+)/i],[w,E,[b,C]],[/(kin\.[onetw]{3})/i],[[E,/\./g," "],[w,ie],[b,C]],[/droid.+; ([c6]+|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[E,[w,me],[b,P]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[E,[w,me],[b,C]],[/smart-tv.+(samsung)/i],[w,[b,O]],[/hbbtv.+maple;(\d+)/i],[[E,/^/,"SmartTV"],[w,ue],[b,O]],[/(vizio)(?: |.+model\/)(\w+-\w+)/i,/tcast.+(lg)e?. ([-\w]+)/i],[w,E,[b,O]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[w,se],[b,O]],[/(apple) ?tv/i],[w,[E,Y+" TV"],[b,O]],[/crkey.*devicetype\/chromecast/i],[[E,ve+" Third Generation"],[w,ee],[b,O]],[/crkey.*devicetype\/([^/]*)/i],[[E,/^/,"Chromecast "],[w,ee],[b,O]],[/fuchsia.*crkey/i],[[E,ve+" Nest Hub"],[w,ee],[b,O]],[/crkey/i],[[E,ve],[w,ee],[b,O]],[/(portaltv)/i],[E,[w,we],[b,O]],[/droid.+aft(\w+)( bui|\))/i],[E,[w,Q],[b,O]],[/(shield \w+ tv)/i],[E,[w,oe],[b,O]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[E,[w,le],[b,O]],[/(bravia[\w ]+)( bui|\))/i],[E,[w,pe],[b,O]],[/(mi(tv|box)-?\w+) bui/i],[E,[w,he],[b,O]],[/Hbbtv.*(technisat) (.*);/i],[w,E,[b,O]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[w,/.+\/(\w+)/,"$1",qe,{LG:"lge"}],[E,Ue],[b,O]],[/droid.+; ([\w- ]+) (?:android tv|smart[- ]?tv)/i],[E,[b,O]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:|large screen[\w ]+safari)\b/i],[[b,O]],[/(playstation \w+)/i],[E,[w,pe],[b,T]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[E,[w,ie],[b,T]],[/(ouya)/i,/(nintendo) (\w+)/i,/(retroid) (pocket ([^\)]+))/i],[w,E,[b,T]],[/droid.+; (shield)( bui|\))/i],[E,[w,oe],[b,T]],[/\b(sm-[lr]\d\d[0156][fnuw]?s?|gear live)\b/i],[E,[w,ue],[b,x]],[/((pebble))app/i,/(asus|google|lg|oppo) ((pixel |zen)?watch[\w ]*)( bui|\))/i],[w,E,[b,x]],[/(ow(?:19|20)?we?[1-3]{1,3})/i],[E,[w,de],[b,x]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[E,[w,Y],[b,x]],[/(opwwe\d{3})/i],[E,[w,ce],[b,x]],[/(moto 360)/i],[E,[w,ae],[b,x]],[/(smartwatch 3)/i],[E,[w,pe],[b,x]],[/(g watch r)/i],[E,[w,se],[b,x]],[/droid.+; (wt63?0{2,3})\)/i],[E,[w,me],[b,x]],[/droid.+; (glass) \d/i],[E,[w,ee],[b,D]],[/(pico) (4|neo3(?: link|pro)?)/i],[w,E,[b,D]],[/(quest( \d| pro)?s?).+vr/i],[E,[w,we],[b,D]],[/mobile vr; rv.+firefox/i],[[b,D]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[w,[b,I]],[/(aeobc)\b/i],[E,[w,Q],[b,I]],[/(homepod).+mac os/i],[E,[w,Y],[b,I]],[/windows iot/i],[[b,I]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+?(mobile|vr|\d) safari/i],[E,[b,qe,{mobile:"Mobile",xr:"VR","*":P}]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[b,P]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[b,C]],[/droid .+?; ([\w\. -]+)( bui|\))/i],[E,[w,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[S,[y,_e+"HTML"]],[/(arkweb)\/([\w\.]+)/i],[y,S],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[S,[y,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[y,S],[/ladybird\//i],[[y,"LibWeb"]],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[S,y]],os:[[/(windows nt) (6\.[23]); arm/i],[[y,/N/,"R"],[S,qe,We]],[/(windows (?:phone|mobile|iot))(?: os)?[\/ ]?([\d\.]*( se)?)/i,/(windows)[\/ ](1[01]|2000|3\.1|7|8(\.1)?|9[58]|me|server 20\d\d( r2)?|vista|xp)/i],[y,S],[/windows nt ?([\d\.\)]*)(?!.+xbox)/i,/\bwin(?=3| ?9|n)(?:nt| 9x )?([\d\.;]*)/i],[[S,/(;|\))/g,"",qe,We],[y,Ee]],[/(windows ce)\/?([\d\.]*)/i],[y,S],[/[adehimnop]{4,7}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[S,/_/g,"."],[y,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+(haiku|morphos))/i],[[y,"macOS"],[S,/_/g,"."]],[/android ([\d\.]+).*crkey/i],[S,[y,ve+" Android"]],[/fuchsia.*crkey\/([\d\.]+)/i],[S,[y,ve+" Fuchsia"]],[/crkey\/([\d\.]+).*devicetype\/smartspeaker/i],[S,[y,ve+" SmartSpeaker"]],[/linux.*crkey\/([\d\.]+)/i],[S,[y,ve+" Linux"]],[/crkey\/([\d\.]+)/i],[S,[y,ve]],[/droid ([\w\.]+)\b.+(android[- ]x86)/i],[S,y],[/(ubuntu) ([\w\.]+) like android/i],[[y,/(.+)/,"$1 Touch"],S],[/(harmonyos)[\/ ]?([\d\.]*)/i,/(android|bada|blackberry|kaios|maemo|meego|openharmony|qnx|rim tablet os|sailfish|series40|symbian|tizen)\w*[-\/\.; ]?([\d\.]*)/i],[y,S],[/\(bb(10);/i],[S,[y,Z]],[/(?:symbian ?os|symbos|s60(?=;)|series ?60)[-\/ ]?([\w\.]*)/i],[S,[y,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[S,[y,ye+" OS"]],[/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i,/webos(?:[ \/]?|\.tv-20(?=2[2-9]))(\d[\d\.]*)/i],[S,[y,"webOS"]],[/web0s;.+?(?:chr[o0]me|safari)\/(\d+)/i],[[S,qe,{25:"120",24:"108",23:"94",22:"87",6:"79",5:"68",4:"53",3:"38",2:"538",1:"537","*":"TV"}],[y,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[S,[y,"watchOS"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[y,"Chrome OS"],S],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) (\w+)/i,/(xbox); +xbox ([^\);]+)/i,/(pico) .+os([\w\.]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/linux.+(mint)[\/\(\) ]?([\w\.]*)/i,/(mageia|vectorlinux|fuchsia|arcaos|arch(?= ?linux))[;l ]([\d\.]*)/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire|knoppix)(?: gnu[\/ ]linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/\b(aix)[; ]([1-9\.]{0,4})/i,/(hurd|linux|morphos)(?: (?:arm|x86|ppc)\w*| ?)([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) ?(r\d)?/i],[y,S],[/(sunos) ?([\d\.]*)/i],[[y,"Solaris"],S],[/\b(beos|os\/2|amigaos|openvms|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[y,S]]},Ke=(Ne.call((a={init:{},isIgnore:{},isIgnoreRgx:{},toString:{}}).init,[[h,[y,S,k,b]],[m,[R]],[f,[b,E,w]],[g,[y,S]],[v,[y,S]]]),Ne.call(a.isIgnore,[[h,[S,k]],[g,[S]],[v,[S]]]),Ne.call(a.isIgnoreRgx,[[h,/ ?browser$/i],[v,/ ?os$/i]]),Ne.call(a.toString,[[h,[y,S]],[m,[R]],[f,[w,E]],[g,[y,S]],[v,[y,S]]]),a),Ge=function(e,t){var r=Ke.init[t],n=Ke.isIgnore[t]||0,s=Ke.isIgnoreRgx[t]||0,i=Ke.toString[t]||0;function a(){Ne.call(this,r)}return a.prototype.getItem=function(){return e},a.prototype.withClientHints=function(){return Pe?Pe.getHighEntropyValues(J).then(function(t){return e.setCH(new $e(t,!1)).parseCH().get()}):e.parseCH().get()},a.prototype.withFeatureCheck=function(){return e.detectFeature().get()},t!=_&&(a.prototype.is=function(e){var t=!1;for(var r in this)if(this.hasOwnProperty(r)&&!xe(n,r)&&Me(s?je(s,this[r]):this[r])==Me(s?je(s,e):e)){if(t=!0,e!=u)break}else if(e==u&&t){t=!t;break}return t},a.prototype.toString=function(){var e=c;for(var t in i)typeof this[i[t]]!==u&&(e+=(e?" ":c)+this[i[t]]);return e||u}),Pe||(a.prototype.then=function(e){var t=this,r=function(){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e])};r.prototype={is:a.prototype.is,toString:a.prototype.toString};var n=new r;return e(n),n}),new a};function $e(e,t){if(e=e||{},Ne.call(this,J),t)Ne.call(this,[[M,Ae(e[F])],[N,Ae(e[q])],[C,/\?1/.test(e[z])],[E,Be(e[K])],[j,Be(e[G])],[B,Be(e[$])],[R,Be(e[W])],[L,Ae(e[H])],[U,Be(e[V])]]);else for(var r in e)this.hasOwnProperty(r)&&typeof e[r]!==u&&(this[r]=e[r])}function Je(e,t,r,n){return this.get=function(e){return e?this.data.hasOwnProperty(e)?this.data[e]:i:this.data},this.set=function(e,t){return this.data[e]=t,this},this.setCH=function(e){return this.uaCH=e,this},this.detectFeature=function(){if(Ce&&Ce.userAgent==this.ua)switch(this.itemType){case h:Ce.brave&&typeof Ce.brave.isBrave==d&&this.set(y,"Brave");break;case f:!this.get(b)&&Pe&&Pe[C]&&this.set(b,C),"Macintosh"==this.get(E)&&Ce&&typeof Ce.standalone!==u&&Ce.maxTouchPoints&&Ce.maxTouchPoints>2&&this.set(E,"iPad").set(b,P);break;case v:!this.get(y)&&Pe&&Pe[j]&&this.set(y,Pe[j]);break;case _:var e=this.data,t=function(t){return e[t].getItem().detectFeature().get()};this.set(h,t(h)).set(m,t(m)).set(f,t(f)).set(g,t(g)).set(v,t(v))}return this},this.parseUA=function(){return this.itemType!=_&&Fe.call(this.data,this.ua,this.rgxMap),this.itemType==h&&this.set(k,Le(this.get(S))),this},this.parseCH=function(){var e=this.uaCH,t=this.rgxMap;switch(this.itemType){case h:case g:var r,n=e[N]||e[M];if(n)for(var s in n){var a=n[s].brand||n[s],o=n[s].version;this.itemType==h&&!/not.a.brand/i.test(a)&&(!r||/Chrom/.test(r)&&a!=ge||r==_e&&/WebView2/.test(a))&&(a=qe(a,He),(r=this.get(y))&&!/Chrom/.test(r)&&/Chrom/.test(a)||this.set(y,a).set(S,o).set(k,Le(o)),r=a),this.itemType==g&&a==ge&&this.set(S,o)}break;case m:var c=e[R];c&&(c&&"64"==e[U]&&(c+="64"),Fe.call(this.data,c+";",t));break;case f:if(e[C]&&this.set(b,C),e[E]&&(this.set(E,e[E]),!this.get(b)||!this.get(w))){var d={};Fe.call(d,"droid 9; "+e[E]+")",t),!this.get(b)&&d.type&&this.set(b,d.type),!this.get(w)&&d.vendor&&this.set(w,d.vendor)}if(e[L]){var u;if("string"!=typeof e[L])for(var l=0;!u&&l<e[L].length;)u=qe(e[L][l++],Ve);else u=qe(e[L],Ve);this.set(b,u)}break;case v:var p=e[j];if(p){var T=e[B];p==Ee&&(T=parseInt(Le(T),10)>=13?"11":"10"),this.set(y,p).set(S,T)}this.get(y)==Ee&&"Xbox"==e[E]&&this.set(y,"Xbox").set(S,i);break;case _:var P=this.data,O=function(t){return P[t].getItem().setCH(e).parseCH().get()};this.set(h,O(h)).set(m,O(m)).set(f,O(f)).set(g,O(g)).set(v,O(v))}return this},Ne.call(this,[["itemType",e],["ua",t],["uaCH",n],["rgxMap",r],["data",Ge(this,e)]]),this}function Qe(e,t,r){if(typeof e===l?(De(e,!0)?(typeof t===l&&(r=t),t=e):(r=e,t=i),e=i):typeof e!==p||De(t,!0)||(r=t,t=i),r&&typeof r.append===d){var n={};r.forEach(function(e,t){n[t]=e}),r=n}if(!(this instanceof Qe))return new Qe(e,t,r).getResult();var s=typeof e===p?e:r&&r[o]?r[o]:Ce&&Ce.userAgent?Ce.userAgent:c,a=new $e(r,!0),u=t?function(e,t){var r={},n=t;if(!De(t))for(var s in n={},t)for(var i in t[s])n[i]=t[s][i].concat(n[i]?n[i]:[]);for(var a in e)r[a]=n[a]&&n[a].length%2==0?n[a].concat(e[a]):e[a];return r}(ze,t):ze,y=function(e){return e==_?function(){return new Je(e,s,u,a).set("ua",s).set(h,this.getBrowser()).set(m,this.getCPU()).set(f,this.getDevice()).set(g,this.getEngine()).set(v,this.getOS()).get()}:function(){return new Je(e,s,u[e],a).parseUA().get()}};return Ne.call(this,[["getBrowser",y(h)],["getCPU",y(m)],["getDevice",y(f)],["getEngine",y(g)],["getOS",y(v)],["getResult",y(_)],["getUA",function(){return s}],["setUA",function(e){return Ie(e)&&(s=e.length>500?Ue(e,500):e),this}]]).setUA(s),this}Qe.VERSION="2.0.4",Qe.BROWSER=Oe([y,S,k,b]),Qe.CPU=Oe([R]),Qe.DEVICE=Oe([E,w,b,T,C,O,P,x,I]),Qe.ENGINE=Qe.OS=Oe([y,S]),typeof t!==u?(e.exports&&(t=e.exports=Qe),t.UAParser=Qe):r.amdO?(n=function(){return Qe}.call(t,r,t,e))===i||(e.exports=n):Te&&(s.UAParser=Qe);var Ye=Te&&(s.jQuery||s.Zepto);if(Ye&&!Ye.ua){var Xe=new Qe;Ye.ua=Xe.getResult(),Ye.ua.get=function(){return Xe.getUA()},Ye.ua.set=function(e){Xe.setUA(e);var t=Xe.getResult();for(var r in t)Ye.ua[r]=t[r]}}}("object"==typeof window?window:this)},2155:function(e,t,r){var n;e.exports=(n=r(9021),r(7165),n.pad.ZeroPadding={pad:function(e,t){var r=4*t;e.clamp(),e.sigBytes+=r-(e.sigBytes%r||r)},unpad:function(e){var t=e.words,r=e.sigBytes-1;for(r=e.sigBytes-1;r>=0;r--)if(t[r>>>2]>>>24-r%4*8&255){e.sigBytes=r+1;break}}},n.pad.ZeroPadding)},2169:function(e,t,r){var n;e.exports=(n=r(9021),r(7165),n.mode.CFB=function(){var e=n.lib.BlockCipherMode.extend();function t(e,t,r,n){var s,i=this._iv;i?(s=i.slice(0),this._iv=void 0):s=this._prevBlock,n.encryptBlock(s,0);for(var a=0;a<r;a++)e[t+a]^=s[a]}return e.Encryptor=e.extend({processBlock:function(e,r){var n=this._cipher,s=n.blockSize;t.call(this,e,r,s,n),this._prevBlock=e.slice(r,r+s)}}),e.Decryptor=e.extend({processBlock:function(e,r){var n=this._cipher,s=n.blockSize,i=e.slice(r,r+s);t.call(this,e,r,s,n),this._prevBlock=i}}),e}(),n.mode.CFB)},2183:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Chrome111=void 0;const s=n(7363),i=n(2994),a=n(1765),o=n(8046),c=n(5544),d=n(5938),u=n(4256),l=n(4893),p=n(521),h=n(1305),m=n(3303),f=new i.Logger("Chrome111"),g={OS:1024,MIS:1024};class v extends p.HandlerInterface{constructor(){super(),r(this,"_closed",!1),r(this,"_direction"),r(this,"_remoteSdp"),r(this,"_sendingRtpParametersByKind"),r(this,"_sendingRemoteRtpParametersByKind"),r(this,"_forcedLocalDtlsRole"),r(this,"_pc"),r(this,"_mapMidTransceiver",new Map),r(this,"_sendStream",new MediaStream),r(this,"_hasDataChannelMediaSection",!1),r(this,"_nextSendSctpStreamId",0),r(this,"_transportReady",!1)}static createFactory(){return()=>new v}get name(){return"Chrome111"}close(){if(f.debug("close()"),!this._closed){if(this._closed=!0,this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}}async getNativeRtpCapabilities(){f.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{e.addTransceiver("audio"),e.addTransceiver("video");const r=await e.createOffer();try{e.close()}catch(t){}const n=s.parse(r.sdp),i=c.extractRtpCapabilities({sdpObject:n});return u.addNackSupportForOpus(i),i}catch(r){try{e.close()}catch(t){}throw r}}async getNativeSctpCapabilities(){return f.debug("getNativeSctpCapabilities()"),{numStreams:g}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:s,iceServers:i,iceTransportPolicy:a,additionalSettings:c,proprietaryConstraints:d,extendedRtpCapabilities:u}){this.assertNotClosed(),f.debug("run()"),this._direction=e,this._remoteSdp=new h.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:s}),this._sendingRtpParametersByKind={audio:o.getSendingRtpParameters("audio",u),video:o.getSendingRtpParameters("video",u)},this._sendingRemoteRtpParametersByKind={audio:o.getSendingRemoteRtpParameters("audio",u),video:o.getSendingRemoteRtpParameters("video",u)},n.role&&"auto"!==n.role&&(this._forcedLocalDtlsRole="server"===n.role?"client":"server"),this._pc=new RTCPeerConnection({iceServers:i??[],iceTransportPolicy:a??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan",...c},d),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",e=>{this.emit("@icecandidateerror",e)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):(f.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}))}async updateIceServers(e){this.assertNotClosed(),f.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(this.assertNotClosed(),f.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady)if("send"===this._direction){const e=await this._pc.createOffer({iceRestart:!0});f.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();f.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:n,onRtpSender:i}){if(this.assertNotClosed(),this.assertSendDirection(),f.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),t&&t.length>1){let e=1;for(const r of t){const t=r.scalabilityMode?(0,m.parse)(r.scalabilityMode).temporalLayers:3;t>e&&(e=t)}t.forEach((t,r)=>{t.rid=`r${r}`,t.scalabilityMode=`L1T${e}`})}const u=a.clone(this._sendingRtpParametersByKind[e.kind]);u.codecs=o.reduceCodecs(u.codecs,n);const l=a.clone(this._sendingRemoteRtpParametersByKind[e.kind]);l.codecs=o.reduceCodecs(l.codecs,n);const p=this._remoteSdp.getNextMediaSectionIdx(),h=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream],sendEncodings:t});i&&i(h.sender);const g=await this._pc.createOffer();let v=s.parse(g.sdp);v.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed(),this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:v}),f.debug("send() | calling pc.setLocalDescription() [offer:%o]",g),await this._pc.setLocalDescription(g);const _=h.mid;u.mid=_,v=s.parse(this._pc.localDescription.sdp);const y=v.media[p.idx];if(u.rtcp.cname=c.getCname({offerMediaObject:y}),t)if(1===t.length){const e=d.getRtpEncodings({offerMediaObject:y});Object.assign(e[0],t[0]),u.encodings=e}else u.encodings=t;else u.encodings=d.getRtpEncodings({offerMediaObject:y});this._remoteSdp.send({offerMediaObject:y,reuseMid:p.reuseMid,offerRtpParameters:u,answerRtpParameters:l,codecOptions:r});const b={type:"answer",sdp:this._remoteSdp.getSdp()};return f.debug("send() | calling pc.setRemoteDescription() [answer:%o]",b),await this._pc.setRemoteDescription(b),this._mapMidTransceiver.set(_,h),{localId:_,rtpParameters:u,rtpSender:h.sender}}async stopSending(e){if(this.assertSendDirection(),f.debug("stopSending() [localId:%s]",e),this._closed)return;const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");if(t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.closeMediaSection(t.mid))try{t.stop()}catch(s){}const r=await this._pc.createOffer();f.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const n={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n),this._mapMidTransceiver.delete(e)}async pauseSending(e){this.assertNotClosed(),this.assertSendDirection(),f.debug("pauseSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive",this._remoteSdp.pauseMediaSection(e);const r=await this._pc.createOffer();f.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const n={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n)}async resumeSending(e){this.assertNotClosed(),this.assertSendDirection(),f.debug("resumeSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(this._remoteSdp.resumeSendingMediaSection(e),!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="sendonly";const r=await this._pc.createOffer();f.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const n={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n)}async replaceTrack(e,t){this.assertNotClosed(),this.assertSendDirection(),t?f.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):f.debug("replaceTrack() [localId:%s, no track]",e);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");await r.sender.replaceTrack(t)}async setMaxSpatialLayer(e,t){this.assertNotClosed(),this.assertSendDirection(),f.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const n=r.sender.getParameters();n.encodings.forEach((e,r)=>{e.active=r<=t}),await r.sender.setParameters(n),this._remoteSdp.muxMediaSectionSimulcast(e,n.encodings);const s=await this._pc.createOffer();f.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);const i={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async setRtpEncodingParameters(e,t){this.assertNotClosed(),this.assertSendDirection(),f.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const n=r.sender.getParameters();n.encodings.forEach((e,r)=>{n.encodings[r]={...e,...t}}),await r.sender.setParameters(n),this._remoteSdp.muxMediaSectionSimulcast(e,n.encodings);const s=await this._pc.createOffer();f.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);const i={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async getSenderStats(e){this.assertNotClosed(),this.assertSendDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:n,protocol:i}){this.assertNotClosed(),this.assertSendDirection();const a={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:r,protocol:i};f.debug("sendDataChannel() [options:%o]",a);const o=this._pc.createDataChannel(n,a);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%g.MIS,!this._hasDataChannelMediaSection){const e=await this._pc.createOffer(),t=s.parse(e.sdp),r=t.media.find(e=>"application"===e.type);this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:t}),f.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:r});const n={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n),this._hasDataChannelMediaSection=!0}return{dataChannel:o,sctpStreamParameters:{streamId:a.id,ordered:a.ordered,maxPacketLifeTime:a.maxPacketLifeTime,maxRetransmits:a.maxRetransmits}}}async receive(e){this.assertNotClosed(),this.assertRecvDirection();const t=[],r=new Map;for(const s of e){const{trackId:e,kind:t,rtpParameters:n,streamId:i}=s;f.debug("receive() [trackId:%s, kind:%s]",e,t);const a=n.mid??String(this._mapMidTransceiver.size);r.set(e,a),this._remoteSdp.receive({mid:a,kind:t,offerRtpParameters:n,streamId:i??n.rtcp.cname,trackId:e})}const n={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",n),await this._pc.setRemoteDescription(n);for(const s of e){const{trackId:e,onRtpReceiver:t}=s;if(t){const n=r.get(e),s=this._pc.getTransceivers().find(e=>e.mid===n);if(!s)throw new Error("transceiver not found");t(s.receiver)}}let i=await this._pc.createAnswer();const a=s.parse(i.sdp);for(const s of e){const{trackId:e,rtpParameters:t}=s,n=r.get(e),i=a.media.find(e=>String(e.mid)===n);c.applyCodecParameters({offerRtpParameters:t,answerMediaObject:i})}i={type:"answer",sdp:s.write(a)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:a}),f.debug("receive() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i);for(const s of e){const{trackId:e}=s,n=r.get(e),i=this._pc.getTransceivers().find(e=>e.mid===n);if(!i)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(n,i),t.push({localId:n,track:i.receiver.track,rtpReceiver:i.receiver})}return t}async stopReceiving(e){if(this.assertRecvDirection(),this._closed)return;for(const n of e){f.debug("stopReceiving() [localId:%s]",n);const e=this._mapMidTransceiver.get(n);if(!e)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(e.mid)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const r=await this._pc.createAnswer();f.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r);for(const n of e)this._mapMidTransceiver.delete(n)}async pauseReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(const n of e){f.debug("pauseReceiving() [localId:%s]",n);const e=this._mapMidTransceiver.get(n);if(!e)throw new Error("associated RTCRtpTransceiver not found");e.direction="inactive",this._remoteSdp.pauseMediaSection(n)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const r=await this._pc.createAnswer();f.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r)}async resumeReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(const n of e){f.debug("resumeReceiving() [localId:%s]",n);const e=this._mapMidTransceiver.get(n);if(!e)throw new Error("associated RTCRtpTransceiver not found");e.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(n)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const r=await this._pc.createAnswer();f.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r)}async getReceiverStats(e){this.assertNotClosed(),this.assertRecvDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:n,ordered:i,maxPacketLifeTime:a,maxRetransmits:o}=e,c={negotiated:!0,id:n,ordered:i,maxPacketLifeTime:a,maxRetransmits:o,protocol:r};f.debug("receiveDataChannel() [options:%o]",c);const d=this._pc.createDataChannel(t,c);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const e={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();if(!this._transportReady){const e=s.parse(t.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:e})}f.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setLocalDescription(t),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=s.parse(this._pc.localDescription.sdp));const r=c.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await new Promise((e,t)=>{this.safeEmit("@connect",{dtlsParameters:r},e,t)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new l.InvalidStateError("method called in a closed handler")}assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}t.Chrome111=v},2196:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default="ffffffff-ffff-ffff-ffff-ffffffffffff"},2211:e=>{e.exports=function(e){var t,r,n,s="",i=(n=e,n||(n={}),e={length:n.length||8,numeric:"boolean"!=typeof n.numeric||n.numeric,letters:"boolean"!=typeof n.letters||n.letters,special:"boolean"==typeof n.special&&n.special,exclude:Array.isArray(n.exclude)?n.exclude:[]}).length,a=(e.exclude,function(e){var t="";e.numeric&&(t+="0123456789"),e.letters&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"),e.special&&(t+="!$%^&*()_+|~-=`{}[]:;<>?,./");for(var r=0;r<=e.exclude.length;r++)t=t.replace(e.exclude[r],"");return t}(e));for(t=1;t<=i;t++)s+=a.substring(r=Math.floor(Math.random()*a.length),r+1);return s}},2215:(e,t,r)=>{var n,s,i;i=function(){function e(){for(var e=0,t={};e<arguments.length;e++){var r=arguments[e];for(var n in r)t[n]=r[n]}return t}function t(e){return e.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}return function r(n){function s(){}function i(t,r,i){if("undefined"!=typeof document){"number"==typeof(i=e({path:"/"},s.defaults,i)).expires&&(i.expires=new Date(1*new Date+864e5*i.expires)),i.expires=i.expires?i.expires.toUTCString():"";try{var a=JSON.stringify(r);/^[\{\[]/.test(a)&&(r=a)}catch(d){}r=n.write?n.write(r,t):encodeURIComponent(String(r)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=encodeURIComponent(String(t)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var o="";for(var c in i)i[c]&&(o+="; "+c,!0!==i[c]&&(o+="="+i[c].split(";")[0]));return document.cookie=t+"="+r+o}}function a(e,r){if("undefined"!=typeof document){for(var s={},i=document.cookie?document.cookie.split("; "):[],a=0;a<i.length;a++){var o=i[a].split("="),c=o.slice(1).join("=");r||'"'!==c.charAt(0)||(c=c.slice(1,-1));try{var d=t(o[0]);if(c=(n.read||n)(c,d)||t(c),r)try{c=JSON.parse(c)}catch(u){}if(s[d]=c,e===d)break}catch(u){}}return e?s[e]:s}}return s.set=i,s.get=function(e){return a(e,!1)},s.getJSON=function(e){return a(e,!0)},s.remove=function(t,r){i(t,"",e(r,{expires:-1}))},s.defaults={},s.withConverter=r,s}(function(){})},void 0===(s="function"==typeof(n=i)?n.call(t,r,t,e):n)||(e.exports=s),e.exports=i()},2284:(e,t,r)=>{function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}r.d(t,{A:()=>n})},2291:(e,t)=>{let r;Object.defineProperty(t,"__esModule",{value:!0});const n=new Uint8Array(16);t.default=function(){if(!r){if("undefined"==typeof crypto||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");r=crypto.getRandomValues.bind(crypto)}return r(n)}},2292:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Firefox120=void 0;const s=n(7363),i=n(2994),a=n(4893),o=n(1765),c=n(8046),d=n(5544),u=n(5938),l=n(521),p=n(1305),h=n(3303),m=new i.Logger("Firefox120"),f={OS:16,MIS:2048};class g extends l.HandlerInterface{constructor(){super(),r(this,"_closed",!1),r(this,"_direction"),r(this,"_remoteSdp"),r(this,"_sendingRtpParametersByKind"),r(this,"_sendingRemoteRtpParametersByKind"),r(this,"_pc"),r(this,"_mapMidTransceiver",new Map),r(this,"_sendStream",new MediaStream),r(this,"_hasDataChannelMediaSection",!1),r(this,"_nextSendSctpStreamId",0),r(this,"_transportReady",!1)}static createFactory(){return()=>new g}get name(){return"Firefox120"}close(){if(m.debug("close()"),!this._closed){if(this._closed=!0,this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}}async getNativeRtpCapabilities(){m.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),t=document.createElement("canvas");t.getContext("2d");const r=t.captureStream().getVideoTracks()[0];try{e.addTransceiver("audio",{direction:"sendrecv"}),e.addTransceiver(r,{direction:"sendrecv",sendEncodings:[{rid:"r0",maxBitrate:1e5},{rid:"r1",maxBitrate:5e5}]});const i=await e.createOffer();try{t.remove()}catch(n){}try{r.stop()}catch(n){}try{e.close()}catch(n){}const a=s.parse(i.sdp);return d.extractRtpCapabilities({sdpObject:a})}catch(i){try{t.remove()}catch(n){}try{r.stop()}catch(n){}try{e.close()}catch(n){}throw i}}async getNativeSctpCapabilities(){return m.debug("getNativeSctpCapabilities()"),{numStreams:f}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:s,iceServers:i,iceTransportPolicy:a,additionalSettings:o,proprietaryConstraints:d,extendedRtpCapabilities:u}){this.assertNotClosed(),m.debug("run()"),this._direction=e,this._remoteSdp=new p.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:s}),this._sendingRtpParametersByKind={audio:c.getSendingRtpParameters("audio",u),video:c.getSendingRtpParameters("video",u)},this._sendingRemoteRtpParametersByKind={audio:c.getSendingRemoteRtpParameters("audio",u),video:c.getSendingRemoteRtpParameters("video",u)},this._pc=new RTCPeerConnection({iceServers:i??[],iceTransportPolicy:a??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...o},d),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",e=>{this.emit("@icecandidateerror",e)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(m.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})}async updateIceServers(e){throw this.assertNotClosed(),new a.UnsupportedError("not supported")}async restartIce(e){if(this.assertNotClosed(),m.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady)if("send"===this._direction){const e=await this._pc.createOffer({iceRestart:!0});m.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();m.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:n,onRtpSender:i}){this.assertNotClosed(),this.assertSendDirection(),m.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),t&&t.length>1&&t.forEach((e,t)=>{e.rid=`r${t}`});const a=o.clone(this._sendingRtpParametersByKind[e.kind]);a.codecs=c.reduceCodecs(a.codecs,n);const l=o.clone(this._sendingRemoteRtpParametersByKind[e.kind]);l.codecs=c.reduceCodecs(l.codecs,n);const p=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream],sendEncodings:t});i&&i(p.sender);const f=await this._pc.createOffer();let g=s.parse(f.sdp);g.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed(),this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:g});const v=(0,h.parse)((t??[{}])[0].scalabilityMode);m.debug("send() | calling pc.setLocalDescription() [offer:%o]",f),await this._pc.setLocalDescription(f);const _=p.mid;a.mid=_,g=s.parse(this._pc.localDescription.sdp);const y=g.media[g.media.length-1];if(a.rtcp.cname=d.getCname({offerMediaObject:y}),t)if(1===t.length){const e=u.getRtpEncodings({offerMediaObject:y});Object.assign(e[0],t[0]),a.encodings=e}else a.encodings=t;else a.encodings=u.getRtpEncodings({offerMediaObject:y});if(a.encodings.length>1&&("video/vp8"===a.codecs[0].mimeType.toLowerCase()||"video/h264"===a.codecs[0].mimeType.toLowerCase()))for(const s of a.encodings)s.scalabilityMode?s.scalabilityMode=`L1T${v.temporalLayers}`:s.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:y,offerRtpParameters:a,answerRtpParameters:l,codecOptions:r});const b={type:"answer",sdp:this._remoteSdp.getSdp()};return m.debug("send() | calling pc.setRemoteDescription() [answer:%o]",b),await this._pc.setRemoteDescription(b),this._mapMidTransceiver.set(_,p),{localId:_,rtpParameters:a,rtpSender:p.sender}}async stopSending(e){if(this.assertSendDirection(),m.debug("stopSending() [localId:%s]",e),this._closed)return;const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated transceiver not found");t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.disableMediaSection(t.mid);const r=await this._pc.createOffer();m.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const n={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n),this._mapMidTransceiver.delete(e)}async pauseSending(e){this.assertNotClosed(),this.assertSendDirection(),m.debug("pauseSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive",this._remoteSdp.pauseMediaSection(e);const r=await this._pc.createOffer();m.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const n={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n)}async resumeSending(e){this.assertNotClosed(),this.assertSendDirection(),m.debug("resumeSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="sendonly",this._remoteSdp.resumeSendingMediaSection(e);const r=await this._pc.createOffer();m.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const n={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n)}async replaceTrack(e,t){this.assertNotClosed(),this.assertSendDirection(),t?m.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):m.debug("replaceTrack() [localId:%s, no track]",e);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");await r.sender.replaceTrack(t)}async setMaxSpatialLayer(e,t){this.assertNotClosed(),this.assertSendDirection(),m.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated transceiver not found");const n=r.sender.getParameters();n.encodings.forEach((e,r)=>{e.active=r<=t}),await r.sender.setParameters(n),this._remoteSdp.muxMediaSectionSimulcast(e,n.encodings);const s=await this._pc.createOffer();m.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);const i={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async setRtpEncodingParameters(e,t){this.assertNotClosed(),this.assertSendDirection(),m.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const n=r.sender.getParameters();n.encodings.forEach((e,r)=>{n.encodings[r]={...e,...t}}),await r.sender.setParameters(n),this._remoteSdp.muxMediaSectionSimulcast(e,n.encodings);const s=await this._pc.createOffer();m.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);const i={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async getSenderStats(e){this.assertNotClosed(),this.assertSendDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:n,protocol:i}){this.assertNotClosed(),this.assertSendDirection();const a={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:r,protocol:i};m.debug("sendDataChannel() [options:%o]",a);const o=this._pc.createDataChannel(n,a);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%f.MIS,!this._hasDataChannelMediaSection){const e=await this._pc.createOffer(),t=s.parse(e.sdp),r=t.media.find(e=>"application"===e.type);this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:t}),m.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:r});const n={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n),this._hasDataChannelMediaSection=!0}return{dataChannel:o,sctpStreamParameters:{streamId:a.id,ordered:a.ordered,maxPacketLifeTime:a.maxPacketLifeTime,maxRetransmits:a.maxRetransmits}}}async receive(e){this.assertNotClosed(),this.assertRecvDirection();const t=[],r=new Map;for(const s of e){const{trackId:e,kind:t,rtpParameters:n,streamId:i}=s;m.debug("receive() [trackId:%s, kind:%s]",e,t);const a=n.mid??String(this._mapMidTransceiver.size);r.set(e,a),this._remoteSdp.receive({mid:a,kind:t,offerRtpParameters:n,streamId:i??n.rtcp.cname,trackId:e})}const n={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",n),await this._pc.setRemoteDescription(n);for(const s of e){const{trackId:e,onRtpReceiver:t}=s;if(t){const n=r.get(e),s=this._pc.getTransceivers().find(e=>e.mid===n);if(!s)throw new Error("transceiver not found");t(s.receiver)}}let i=await this._pc.createAnswer();const a=s.parse(i.sdp);for(const o of e){const{trackId:e,rtpParameters:t}=o,n=r.get(e),c=a.media.find(e=>String(e.mid)===n);d.applyCodecParameters({offerRtpParameters:t,answerMediaObject:c}),i={type:"answer",sdp:s.write(a)}}this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:a}),m.debug("receive() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i);for(const s of e){const{trackId:e}=s,n=r.get(e),i=this._pc.getTransceivers().find(e=>e.mid===n);if(!i)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(n,i),t.push({localId:n,track:i.receiver.track,rtpReceiver:i.receiver})}return t}async stopReceiving(e){if(this.assertRecvDirection(),this._closed)return;for(const n of e){m.debug("stopReceiving() [localId:%s]",n);const e=this._mapMidTransceiver.get(n);if(!e)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(e.mid)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const r=await this._pc.createAnswer();m.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r);for(const n of e)this._mapMidTransceiver.delete(n)}async pauseReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(const n of e){m.debug("pauseReceiving() [localId:%s]",n);const e=this._mapMidTransceiver.get(n);if(!e)throw new Error("associated RTCRtpTransceiver not found");e.direction="inactive",this._remoteSdp.pauseMediaSection(n)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const r=await this._pc.createAnswer();m.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r)}async resumeReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(const n of e){m.debug("resumeReceiving() [localId:%s]",n);const e=this._mapMidTransceiver.get(n);if(!e)throw new Error("associated RTCRtpTransceiver not found");e.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(n)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const r=await this._pc.createAnswer();m.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r)}async getReceiverStats(e){this.assertRecvDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:n,ordered:i,maxPacketLifeTime:a,maxRetransmits:o}=e,c={negotiated:!0,id:n,ordered:i,maxPacketLifeTime:a,maxRetransmits:o,protocol:r};m.debug("receiveDataChannel() [options:%o]",c);const d=this._pc.createDataChannel(t,c);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const e={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();if(!this._transportReady){const e=s.parse(t.sdp);await this.setupTransport({localDtlsRole:"client",localSdpObject:e})}m.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setLocalDescription(t),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=s.parse(this._pc.localDescription.sdp));const r=d.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await new Promise((e,t)=>{this.safeEmit("@connect",{dtlsParameters:r},e,t)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new a.InvalidStateError("method called in a closed handler")}assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}t.Firefox120=g},2696:function(e,t,r){var n;e.exports=(n=r(9021),r(754),r(4636),r(9506),r(7165),function(){var e=n,t=e.lib.StreamCipher,r=e.algo,s=[],i=[],a=[],o=r.RabbitLegacy=t.extend({_doReset:function(){var e=this._key.words,t=this.cfg.iv,r=this._X=[e[0],e[3]<<16|e[2]>>>16,e[1],e[0]<<16|e[3]>>>16,e[2],e[1]<<16|e[0]>>>16,e[3],e[2]<<16|e[1]>>>16],n=this._C=[e[2]<<16|e[2]>>>16,4294901760&e[0]|65535&e[1],e[3]<<16|e[3]>>>16,4294901760&e[1]|65535&e[2],e[0]<<16|e[0]>>>16,4294901760&e[2]|65535&e[3],e[1]<<16|e[1]>>>16,4294901760&e[3]|65535&e[0]];this._b=0;for(var s=0;s<4;s++)c.call(this);for(s=0;s<8;s++)n[s]^=r[s+4&7];if(t){var i=t.words,a=i[0],o=i[1],d=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),u=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),l=d>>>16|4294901760&u,p=u<<16|65535&d;for(n[0]^=d,n[1]^=l,n[2]^=u,n[3]^=p,n[4]^=d,n[5]^=l,n[6]^=u,n[7]^=p,s=0;s<4;s++)c.call(this)}},_doProcessBlock:function(e,t){var r=this._X;c.call(this),s[0]=r[0]^r[5]>>>16^r[3]<<16,s[1]=r[2]^r[7]>>>16^r[5]<<16,s[2]=r[4]^r[1]>>>16^r[7]<<16,s[3]=r[6]^r[3]>>>16^r[1]<<16;for(var n=0;n<4;n++)s[n]=16711935&(s[n]<<8|s[n]>>>24)|4278255360&(s[n]<<24|s[n]>>>8),e[t+n]^=s[n]},blockSize:4,ivSize:2});function c(){for(var e=this._X,t=this._C,r=0;r<8;r++)i[r]=t[r];for(t[0]=t[0]+1295307597+this._b|0,t[1]=t[1]+3545052371+(t[0]>>>0<i[0]>>>0?1:0)|0,t[2]=t[2]+886263092+(t[1]>>>0<i[1]>>>0?1:0)|0,t[3]=t[3]+1295307597+(t[2]>>>0<i[2]>>>0?1:0)|0,t[4]=t[4]+3545052371+(t[3]>>>0<i[3]>>>0?1:0)|0,t[5]=t[5]+886263092+(t[4]>>>0<i[4]>>>0?1:0)|0,t[6]=t[6]+1295307597+(t[5]>>>0<i[5]>>>0?1:0)|0,t[7]=t[7]+3545052371+(t[6]>>>0<i[6]>>>0?1:0)|0,this._b=t[7]>>>0<i[7]>>>0?1:0,r=0;r<8;r++){var n=e[r]+t[r],s=65535&n,o=n>>>16,c=((s*s>>>17)+s*o>>>15)+o*o,d=((4294901760&n)*n|0)+((65535&n)*n|0);a[r]=c^d}e[0]=a[0]+(a[7]<<16|a[7]>>>16)+(a[6]<<16|a[6]>>>16)|0,e[1]=a[1]+(a[0]<<8|a[0]>>>24)+a[7]|0,e[2]=a[2]+(a[1]<<16|a[1]>>>16)+(a[0]<<16|a[0]>>>16)|0,e[3]=a[3]+(a[2]<<8|a[2]>>>24)+a[1]|0,e[4]=a[4]+(a[3]<<16|a[3]>>>16)+(a[2]<<16|a[2]>>>16)|0,e[5]=a[5]+(a[4]<<8|a[4]>>>24)+a[3]|0,e[6]=a[6]+(a[5]<<16|a[5]>>>16)+(a[4]<<16|a[4]>>>16)|0,e[7]=a[7]+(a[6]<<8|a[6]>>>24)+a[5]|0}e.RabbitLegacy=t._createHelper(o)}(),n.RabbitLegacy)},2731:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FakeHandler=void 0;const s=n(5328),i=n(3953),a=n(2994),o=n(1765),c=n(8046),d=n(4893),u=n(521),l=new a.Logger("FakeHandler");class p extends i.EnhancedEventEmitter{constructor({id:e,ordered:t,maxPacketLifeTime:n,maxRetransmits:s,label:i,protocol:a}){super(),r(this,"id"),r(this,"ordered"),r(this,"maxPacketLifeTime"),r(this,"maxRetransmits"),r(this,"label"),r(this,"protocol"),this.id=e,this.ordered=t,this.maxPacketLifeTime=n,this.maxRetransmits=s,this.label=i,this.protocol=a}close(){this.safeEmit("close"),this.emit("@close")}send(e){this.safeEmit("message",e)}addEventListener(e,t){this.on(e,t)}}class h extends u.HandlerInterface{constructor(e){super(),r(this,"_closed",!1),r(this,"fakeParameters"),r(this,"_rtpParametersByKind"),r(this,"_cname",`CNAME-${o.generateRandomNumber()}`),r(this,"_transportReady",!1),r(this,"_nextLocalId",1),r(this,"_tracks",new Map),r(this,"_nextSctpStreamId",0),this.fakeParameters=e}static createFactory(e){return()=>new h(e)}get name(){return"FakeHandler"}close(){l.debug("close()"),this._closed||(this._closed=!0)}setIceGatheringState(e){this.emit("@icegatheringstatechange",e)}setConnectionState(e){this.emit("@connectionstatechange",e)}async getNativeRtpCapabilities(){return l.debug("getNativeRtpCapabilities()"),this.fakeParameters.generateNativeRtpCapabilities()}async getNativeSctpCapabilities(){return l.debug("getNativeSctpCapabilities()"),this.fakeParameters.generateNativeSctpCapabilities()}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:s,iceServers:i,iceTransportPolicy:a,proprietaryConstraints:o,extendedRtpCapabilities:d}){this.assertNotClosed(),l.debug("run()"),this._rtpParametersByKind={audio:c.getSendingRtpParameters("audio",d),video:c.getSendingRtpParameters("video",d)}}async updateIceServers(e){this.assertNotClosed(),l.debug("updateIceServers()")}async restartIce(e){this.assertNotClosed(),l.debug("restartIce()")}async getTransportStats(){return this.assertNotClosed(),new Map}async send({track:e,encodings:t,codecOptions:r,codec:n}){this.assertNotClosed(),l.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),this._transportReady||await this.setupTransport({localDtlsRole:"server"});const s=o.clone(this._rtpParametersByKind[e.kind]),i=s.codecs.some(e=>/.+\/rtx$/i.test(e.mimeType));s.mid=`mid-${o.generateRandomNumber()}`,t||(t=[{}]);for(const c of t)c.ssrc=o.generateRandomNumber(),i&&(c.rtx={ssrc:o.generateRandomNumber()});s.encodings=t,s.rtcp={cname:this._cname,reducedSize:!0,mux:!0};const a=this._nextLocalId++;return this._tracks.set(a,e),{localId:String(a),rtpParameters:s}}async stopSending(e){if(l.debug("stopSending() [localId:%s]",e),!this._closed){if(!this._tracks.has(Number(e)))throw new Error("local track not found");this._tracks.delete(Number(e))}}async pauseSending(e){this.assertNotClosed()}async resumeSending(e){this.assertNotClosed()}async replaceTrack(e,t){this.assertNotClosed(),t?l.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):l.debug("replaceTrack() [localId:%s, no track]",e),this._tracks.delete(Number(e)),this._tracks.set(Number(e),t)}async setMaxSpatialLayer(e,t){this.assertNotClosed(),l.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t)}async setRtpEncodingParameters(e,t){this.assertNotClosed(),l.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t)}async getSenderStats(e){return this.assertNotClosed(),new Map}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:n,protocol:s}){return this.assertNotClosed(),this._transportReady||await this.setupTransport({localDtlsRole:"server"}),l.debug("sendDataChannel()"),{dataChannel:new p({id:this._nextSctpStreamId++,ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:n,protocol:s}),sctpStreamParameters:{streamId:this._nextSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:r}}}async receive(e){this.assertNotClosed();const t=[];for(const r of e){const{trackId:e,kind:n}=r;this._transportReady||await this.setupTransport({localDtlsRole:"client"}),l.debug("receive() [trackId:%s, kind:%s]",e,n);const i=this._nextLocalId++,a=new s.FakeMediaStreamTrack({kind:n});this._tracks.set(i,a),t.push({localId:String(i),track:a})}return t}async stopReceiving(e){if(!this._closed)for(const t of e)l.debug("stopReceiving() [localId:%s]",t),this._tracks.delete(Number(t))}async pauseReceiving(e){this.assertNotClosed()}async resumeReceiving(e){this.assertNotClosed()}async getReceiverStats(e){return this.assertNotClosed(),new Map}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){return this.assertNotClosed(),this._transportReady||await this.setupTransport({localDtlsRole:"client"}),l.debug("receiveDataChannel()"),{dataChannel:new p({id:e.streamId,ordered:e.ordered,maxPacketLifeTime:e.maxPacketLifeTime,maxRetransmits:e.maxRetransmits,label:t,protocol:r})}}async setupTransport({localDtlsRole:e,localSdpObject:t}){const r=o.clone(this.fakeParameters.generateLocalDtlsParameters());e&&(r.role=e),this.emit("@connectionstatechange","connecting"),await new Promise((e,t)=>this.emit("@connect",{dtlsParameters:r},e,t)),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new d.InvalidStateError("method called in a closed handler")}}t.FakeHandler=h},2770:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=r(9746);t.default=function(e){if(!(0,n.default)(e))throw TypeError("Invalid UUID");return parseInt(e.slice(14,15),16)}},2829:(e,t)=>{function r(e,t,r,n){switch(e){case 0:return t&r^~t&n;case 1:case 3:return t^r^n;case 2:return t&r^t&n^r&n}}function n(e,t){return e<<t|e>>>32-t}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=[1518500249,1859775393,2400959708,3395469782],s=[1732584193,4023233417,2562383102,271733878,3285377520],i=new Uint8Array(e.length+1);i.set(e),i[e.length]=128;const a=(e=i).length/4+2,o=Math.ceil(a/16),c=new Array(o);for(let r=0;r<o;++r){const t=new Uint32Array(16);for(let n=0;n<16;++n)t[n]=e[64*r+4*n]<<24|e[64*r+4*n+1]<<16|e[64*r+4*n+2]<<8|e[64*r+4*n+3];c[r]=t}c[o-1][14]=8*(e.length-1)/Math.pow(2,32),c[o-1][14]=Math.floor(c[o-1][14]),c[o-1][15]=8*(e.length-1)&4294967295;for(let d=0;d<o;++d){const e=new Uint32Array(80);for(let t=0;t<16;++t)e[t]=c[d][t];for(let t=16;t<80;++t)e[t]=n(e[t-3]^e[t-8]^e[t-14]^e[t-16],1);let i=s[0],a=s[1],o=s[2],u=s[3],l=s[4];for(let s=0;s<80;++s){const c=Math.floor(s/20),d=n(i,5)+r(c,a,o,u)+l+t[c]+e[s]>>>0;l=u,u=o,o=n(a,30)>>>0,a=i,i=d}s[0]=s[0]+i>>>0,s[1]=s[1]+a>>>0,s[2]=s[2]+o>>>0,s[3]=s[3]+u>>>0,s[4]=s[4]+l>>>0}return Uint8Array.of(s[0]>>24,s[0]>>16,s[0]>>8,s[0],s[1]>>24,s[1]>>16,s[1]>>8,s[1],s[2]>>24,s[2]>>16,s[2]>>8,s[2],s[3]>>24,s[3]>>16,s[3]>>8,s[3],s[4]>>24,s[4]>>16,s[4]>>8,s[4])}},2901:(e,t,r)=>{r.d(t,{A:()=>i});var n=r(816);function s(e,t){for(var r=0;r<t.length;r++){var s=t[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,(0,n.A)(s.key),s)}}function i(e,t,r){return t&&s(e.prototype,t),r&&s(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}},2988:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.URL=t.DNS=t.stringToBytes=void 0;const n=r(1797),s=r(6011);function i(e){e=unescape(encodeURIComponent(e));const t=new Uint8Array(e.length);for(let r=0;r<e.length;++r)t[r]=e.charCodeAt(r);return t}t.stringToBytes=i,t.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",t.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",t.default=function(e,t,r,a,o,c){const d="string"==typeof r?i(r):r,u="string"==typeof a?(0,n.default)(a):a;if("string"==typeof a&&(a=(0,n.default)(a)),16!==(null==a?void 0:a.length))throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let l=new Uint8Array(16+d.length);if(l.set(u),l.set(d,u.length),l=t(l),l[6]=15&l[6]|e,l[8]=63&l[8]|128,o){c=c||0;for(let e=0;e<16;++e)o[c+e]=l[e];return o}return(0,s.unsafeStringify)(l)}},2994:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Logger=void 0;const s=n(7833),i="mediasoup-client";t.Logger=class{constructor(e){r(this,"_debug"),r(this,"_warn"),r(this,"_error"),e?(this._debug=(0,s.default)(`${i}:${e}`),this._warn=(0,s.default)(`${i}:WARN:${e}`),this._error=(0,s.default)(`${i}:ERROR:${e}`)):(this._debug=(0,s.default)(i),this._warn=(0,s.default)(`${i}:WARN`),this._error=(0,s.default)(`${i}:ERROR`)),this._debug.log=function(){}.bind(),this._warn.log=function(){}.bind(),this._error.log=function(){}.bind()}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}}},3009:function(e,t,r){var n;e.exports=(n=r(9021),function(e){var t=n,r=t.lib,s=r.WordArray,i=r.Hasher,a=t.algo,o=[],c=[];!function(){function t(t){for(var r=e.sqrt(t),n=2;n<=r;n++)if(!(t%n))return!1;return!0}function r(e){return 4294967296*(e-(0|e))|0}for(var n=2,s=0;s<64;)t(n)&&(s<8&&(o[s]=r(e.pow(n,.5))),c[s]=r(e.pow(n,1/3)),s++),n++}();var d=[],u=a.SHA256=i.extend({_doReset:function(){this._hash=new s.init(o.slice(0))},_doProcessBlock:function(e,t){for(var r=this._hash.words,n=r[0],s=r[1],i=r[2],a=r[3],o=r[4],u=r[5],l=r[6],p=r[7],h=0;h<64;h++){if(h<16)d[h]=0|e[t+h];else{var m=d[h-15],f=(m<<25|m>>>7)^(m<<14|m>>>18)^m>>>3,g=d[h-2],v=(g<<15|g>>>17)^(g<<13|g>>>19)^g>>>10;d[h]=f+d[h-7]+v+d[h-16]}var _=n&s^n&i^s&i,y=(n<<30|n>>>2)^(n<<19|n>>>13)^(n<<10|n>>>22),b=p+((o<<26|o>>>6)^(o<<21|o>>>11)^(o<<7|o>>>25))+(o&u^~o&l)+c[h]+d[h];p=l,l=u,u=o,o=a+b|0,a=i,i=s,s=n,n=b+(y+_)|0}r[0]=r[0]+n|0,r[1]=r[1]+s|0,r[2]=r[2]+i|0,r[3]=r[3]+a|0,r[4]=r[4]+o|0,r[5]=r[5]+u|0,r[6]=r[6]+l|0,r[7]=r[7]+p|0},_doFinalize:function(){var t=this._data,r=t.words,n=8*this._nDataBytes,s=8*t.sigBytes;return r[s>>>5]|=128<<24-s%32,r[14+(s+64>>>9<<4)]=e.floor(n/4294967296),r[15+(s+64>>>9<<4)]=n,t.sigBytes=4*r.length,this._process(),this._hash},clone:function(){var e=i.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA256=i._createHelper(u),t.HmacSHA256=i._createHmacHelper(u)}(Math),n.SHA256)},3029:(e,t,r)=>{function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}r.d(t,{A:()=>n})},3128:function(e,t,r){var n;e.exports=(n=r(9021),r(754),r(4636),r(9506),r(7165),function(){var e=n,t=e.lib.BlockCipher,r=e.algo;const s=16,i=[608135816,2242054355,320440878,57701188,2752067618,698298832,137296536,3964562569,1160258022,953160567,3193202383,887688300,3232508343,3380367581,1065670069,3041331479,2450970073,2306472731],a=[[3509652390,2564797868,805139163,3491422135,3101798381,1780907670,3128725573,4046225305,614570311,3012652279,134345442,2240740374,1667834072,1901547113,2757295779,4103290238,227898511,1921955416,1904987480,2182433518,2069144605,3260701109,2620446009,720527379,3318853667,677414384,3393288472,3101374703,2390351024,1614419982,1822297739,2954791486,3608508353,3174124327,2024746970,1432378464,3864339955,2857741204,1464375394,1676153920,1439316330,715854006,3033291828,289532110,2706671279,2087905683,3018724369,1668267050,732546397,1947742710,3462151702,2609353502,2950085171,1814351708,2050118529,680887927,999245976,1800124847,3300911131,1713906067,1641548236,4213287313,1216130144,1575780402,4018429277,3917837745,3693486850,3949271944,596196993,3549867205,258830323,2213823033,772490370,2760122372,1774776394,2652871518,566650946,4142492826,1728879713,2882767088,1783734482,3629395816,2517608232,2874225571,1861159788,326777828,3124490320,2130389656,2716951837,967770486,1724537150,2185432712,2364442137,1164943284,2105845187,998989502,3765401048,2244026483,1075463327,1455516326,1322494562,910128902,469688178,1117454909,936433444,3490320968,3675253459,1240580251,122909385,2157517691,634681816,4142456567,3825094682,3061402683,2540495037,79693498,3249098678,1084186820,1583128258,426386531,1761308591,1047286709,322548459,995290223,1845252383,2603652396,3431023940,2942221577,3202600964,3727903485,1712269319,422464435,3234572375,1170764815,3523960633,3117677531,1434042557,442511882,3600875718,1076654713,1738483198,4213154764,2393238008,3677496056,1014306527,4251020053,793779912,2902807211,842905082,4246964064,1395751752,1040244610,2656851899,3396308128,445077038,3742853595,3577915638,679411651,2892444358,2354009459,1767581616,3150600392,3791627101,3102740896,284835224,4246832056,1258075500,768725851,2589189241,3069724005,3532540348,1274779536,3789419226,2764799539,1660621633,3471099624,4011903706,913787905,3497959166,737222580,2514213453,2928710040,3937242737,1804850592,3499020752,2949064160,2386320175,2390070455,2415321851,4061277028,2290661394,2416832540,1336762016,1754252060,3520065937,3014181293,791618072,3188594551,3933548030,2332172193,3852520463,3043980520,413987798,3465142937,3030929376,4245938359,2093235073,3534596313,375366246,2157278981,2479649556,555357303,3870105701,2008414854,3344188149,4221384143,3956125452,2067696032,3594591187,2921233993,2428461,544322398,577241275,1471733935,610547355,4027169054,1432588573,1507829418,2025931657,3646575487,545086370,48609733,2200306550,1653985193,298326376,1316178497,3007786442,2064951626,458293330,2589141269,3591329599,3164325604,727753846,2179363840,146436021,1461446943,4069977195,705550613,3059967265,3887724982,4281599278,3313849956,1404054877,2845806497,146425753,1854211946],[1266315497,3048417604,3681880366,3289982499,290971e4,1235738493,2632868024,2414719590,3970600049,1771706367,1449415276,3266420449,422970021,1963543593,2690192192,3826793022,1062508698,1531092325,1804592342,2583117782,2714934279,4024971509,1294809318,4028980673,1289560198,2221992742,1669523910,35572830,157838143,1052438473,1016535060,1802137761,1753167236,1386275462,3080475397,2857371447,1040679964,2145300060,2390574316,1461121720,2956646967,4031777805,4028374788,33600511,2920084762,1018524850,629373528,3691585981,3515945977,2091462646,2486323059,586499841,988145025,935516892,3367335476,2599673255,2839830854,265290510,3972581182,2759138881,3795373465,1005194799,847297441,406762289,1314163512,1332590856,1866599683,4127851711,750260880,613907577,1450815602,3165620655,3734664991,3650291728,3012275730,3704569646,1427272223,778793252,1343938022,2676280711,2052605720,1946737175,3164576444,3914038668,3967478842,3682934266,1661551462,3294938066,4011595847,840292616,3712170807,616741398,312560963,711312465,1351876610,322626781,1910503582,271666773,2175563734,1594956187,70604529,3617834859,1007753275,1495573769,4069517037,2549218298,2663038764,504708206,2263041392,3941167025,2249088522,1514023603,1998579484,1312622330,694541497,2582060303,2151582166,1382467621,776784248,2618340202,3323268794,2497899128,2784771155,503983604,4076293799,907881277,423175695,432175456,1378068232,4145222326,3954048622,3938656102,3820766613,2793130115,2977904593,26017576,3274890735,3194772133,1700274565,1756076034,4006520079,3677328699,720338349,1533947780,354530856,688349552,3973924725,1637815568,332179504,3949051286,53804574,2852348879,3044236432,1282449977,3583942155,3416972820,4006381244,1617046695,2628476075,3002303598,1686838959,431878346,2686675385,1700445008,1080580658,1009431731,832498133,3223435511,2605976345,2271191193,2516031870,1648197032,4164389018,2548247927,300782431,375919233,238389289,3353747414,2531188641,2019080857,1475708069,455242339,2609103871,448939670,3451063019,1395535956,2413381860,1841049896,1491858159,885456874,4264095073,4001119347,1565136089,3898914787,1108368660,540939232,1173283510,2745871338,3681308437,4207628240,3343053890,4016749493,1699691293,1103962373,3625875870,2256883143,3830138730,1031889488,3479347698,1535977030,4236805024,3251091107,2132092099,1774941330,1199868427,1452454533,157007616,2904115357,342012276,595725824,1480756522,206960106,497939518,591360097,863170706,2375253569,3596610801,1814182875,2094937945,3421402208,1082520231,3463918190,2785509508,435703966,3908032597,1641649973,2842273706,3305899714,1510255612,2148256476,2655287854,3276092548,4258621189,236887753,3681803219,274041037,1734335097,3815195456,3317970021,1899903192,1026095262,4050517792,356393447,2410691914,3873677099,3682840055],[3913112168,2491498743,4132185628,2489919796,1091903735,1979897079,3170134830,3567386728,3557303409,857797738,1136121015,1342202287,507115054,2535736646,337727348,3213592640,1301675037,2528481711,1895095763,1721773893,3216771564,62756741,2142006736,835421444,2531993523,1442658625,3659876326,2882144922,676362277,1392781812,170690266,3921047035,1759253602,3611846912,1745797284,664899054,1329594018,3901205900,3045908486,2062866102,2865634940,3543621612,3464012697,1080764994,553557557,3656615353,3996768171,991055499,499776247,1265440854,648242737,3940784050,980351604,3713745714,1749149687,3396870395,4211799374,3640570775,1161844396,3125318951,1431517754,545492359,4268468663,3499529547,1437099964,2702547544,3433638243,2581715763,2787789398,1060185593,1593081372,2418618748,4260947970,69676912,2159744348,86519011,2512459080,3838209314,1220612927,3339683548,133810670,1090789135,1078426020,1569222167,845107691,3583754449,4072456591,1091646820,628848692,1613405280,3757631651,526609435,236106946,48312990,2942717905,3402727701,1797494240,859738849,992217954,4005476642,2243076622,3870952857,3732016268,765654824,3490871365,2511836413,1685915746,3888969200,1414112111,2273134842,3281911079,4080962846,172450625,2569994100,980381355,4109958455,2819808352,2716589560,2568741196,3681446669,3329971472,1835478071,660984891,3704678404,4045999559,3422617507,3040415634,1762651403,1719377915,3470491036,2693910283,3642056355,3138596744,1364962596,2073328063,1983633131,926494387,3423689081,2150032023,4096667949,1749200295,3328846651,309677260,2016342300,1779581495,3079819751,111262694,1274766160,443224088,298511866,1025883608,3806446537,1145181785,168956806,3641502830,3584813610,1689216846,3666258015,3200248200,1692713982,2646376535,4042768518,1618508792,1610833997,3523052358,4130873264,2001055236,3610705100,2202168115,4028541809,2961195399,1006657119,2006996926,3186142756,1430667929,3210227297,1314452623,4074634658,4101304120,2273951170,1399257539,3367210612,3027628629,1190975929,2062231137,2333990788,2221543033,2438960610,1181637006,548689776,2362791313,3372408396,3104550113,3145860560,296247880,1970579870,3078560182,3769228297,1714227617,3291629107,3898220290,166772364,1251581989,493813264,448347421,195405023,2709975567,677966185,3703036547,1463355134,2715995803,1338867538,1343315457,2802222074,2684532164,233230375,2599980071,2000651841,3277868038,1638401717,4028070440,3237316320,6314154,819756386,300326615,590932579,1405279636,3267499572,3150704214,2428286686,3959192993,3461946742,1862657033,1266418056,963775037,2089974820,2263052895,1917689273,448879540,3550394620,3981727096,150775221,3627908307,1303187396,508620638,2975983352,2726630617,1817252668,1876281319,1457606340,908771278,3720792119,3617206836,2455994898,1729034894,1080033504],[976866871,3556439503,2881648439,1522871579,1555064734,1336096578,3548522304,2579274686,3574697629,3205460757,3593280638,3338716283,3079412587,564236357,2993598910,1781952180,1464380207,3163844217,3332601554,1699332808,1393555694,1183702653,3581086237,1288719814,691649499,2847557200,2895455976,3193889540,2717570544,1781354906,1676643554,2592534050,3230253752,1126444790,2770207658,2633158820,2210423226,2615765581,2414155088,3127139286,673620729,2805611233,1269405062,4015350505,3341807571,4149409754,1057255273,2012875353,2162469141,2276492801,2601117357,993977747,3918593370,2654263191,753973209,36408145,2530585658,25011837,3520020182,2088578344,530523599,2918365339,1524020338,1518925132,3760827505,3759777254,1202760957,3985898139,3906192525,674977740,4174734889,2031300136,2019492241,3983892565,4153806404,3822280332,352677332,2297720250,60907813,90501309,3286998549,1016092578,2535922412,2839152426,457141659,509813237,4120667899,652014361,1966332200,2975202805,55981186,2327461051,676427537,3255491064,2882294119,3433927263,1307055953,942726286,933058658,2468411793,3933900994,4215176142,1361170020,2001714738,2830558078,3274259782,1222529897,1679025792,2729314320,3714953764,1770335741,151462246,3013232138,1682292957,1483529935,471910574,1539241949,458788160,3436315007,1807016891,3718408830,978976581,1043663428,3165965781,1927990952,4200891579,2372276910,3208408903,3533431907,1412390302,2931980059,4132332400,1947078029,3881505623,4168226417,2941484381,1077988104,1320477388,886195818,18198404,3786409e3,2509781533,112762804,3463356488,1866414978,891333506,18488651,661792760,1628790961,3885187036,3141171499,876946877,2693282273,1372485963,791857591,2686433993,3759982718,3167212022,3472953795,2716379847,445679433,3561995674,3504004811,3574258232,54117162,3331405415,2381918588,3769707343,4154350007,1140177722,4074052095,668550556,3214352940,367459370,261225585,2610173221,4209349473,3468074219,3265815641,314222801,3066103646,3808782860,282218597,3406013506,3773591054,379116347,1285071038,846784868,2669647154,3771962079,3550491691,2305946142,453669953,1268987020,3317592352,3279303384,3744833421,2610507566,3859509063,266596637,3847019092,517658769,3462560207,3443424879,370717030,4247526661,2224018117,4143653529,4112773975,2788324899,2477274417,1456262402,2901442914,1517677493,1846949527,2295493580,3734397586,2176403920,1280348187,1908823572,3871786941,846861322,1172426758,3287448474,3383383037,1655181056,3139813346,901632758,1897031941,2986607138,3066810236,3447102507,1393639104,373351379,950779232,625454576,3124240540,4148612726,2007998917,544563296,2244738638,2330496472,2058025392,1291430526,424198748,50039436,29584100,3605783033,2429876329,2791104160,1057563949,3255363231,3075367218,3463963227,1469046755,985887462]];var o={pbox:[],sbox:[]};function c(e,t){let r=t>>24&255,n=t>>16&255,s=t>>8&255,i=255&t,a=e.sbox[0][r]+e.sbox[1][n];return a^=e.sbox[2][s],a+=e.sbox[3][i],a}function d(e,t,r){let n,i=t,a=r;for(let o=0;o<s;++o)i^=e.pbox[o],a=c(e,i)^a,n=i,i=a,a=n;return n=i,i=a,a=n,a^=e.pbox[s],i^=e.pbox[17],{left:i,right:a}}var u=r.Blowfish=t.extend({_doReset:function(){if(this._keyPriorReset!==this._key){var e=this._keyPriorReset=this._key,t=e.words,r=e.sigBytes/4;!function(e,t,r){for(let i=0;i<4;i++){e.sbox[i]=[];for(let t=0;t<256;t++)e.sbox[i][t]=a[i][t]}let n=0;for(let a=0;a<18;a++)e.pbox[a]=i[a]^t[n],n++,n>=r&&(n=0);let s=0,o=0,c=0;for(let i=0;i<18;i+=2)c=d(e,s,o),s=c.left,o=c.right,e.pbox[i]=s,e.pbox[i+1]=o;for(let i=0;i<4;i++)for(let t=0;t<256;t+=2)c=d(e,s,o),s=c.left,o=c.right,e.sbox[i][t]=s,e.sbox[i][t+1]=o}(o,t,r)}},encryptBlock:function(e,t){var r=d(o,e[t],e[t+1]);e[t]=r.left,e[t+1]=r.right},decryptBlock:function(e,t){var r=function(e,t,r){let n,s=t,i=r;for(let a=17;a>1;--a)s^=e.pbox[a],i=c(e,s)^i,n=s,s=i,i=n;return n=s,s=i,i=n,i^=e.pbox[1],s^=e.pbox[0],{left:s,right:i}}(o,e[t],e[t+1]);e[t]=r.left,e[t+1]=r.right},blockSize:2,keySize:4,ivSize:2});e.Blowfish=t._createHelper(u)}(),n.Blowfish)},3145:(e,t,r)=>{function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}r.d(t,{A:()=>n})},3200:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ProfileLevelId=t.Level=t.Profile=void 0,t.parseProfileLevelId=h,t.profileLevelIdToString=m,t.profileToString=function(e){switch(e){case s.ConstrainedBaseline:return"ConstrainedBaseline";case s.Baseline:return"Baseline";case s.Main:return"Main";case s.ConstrainedHigh:return"ConstrainedHigh";case s.High:return"High";case s.PredictiveHigh444:return"PredictiveHigh444";default:return void n.warn(`profileToString() | unrecognized profile ${e}`)}},t.levelToString=function(e){switch(e){case i.L1_b:return"1b";case i.L1:return"1";case i.L1_1:return"1.1";case i.L1_2:return"1.2";case i.L1_3:return"1.3";case i.L2:return"2";case i.L2_1:return"2.1";case i.L2_2:return"2.2";case i.L3:return"3";case i.L3_1:return"3.1";case i.L3_2:return"3.2";case i.L4:return"4";case i.L4_1:return"4.1";case i.L4_2:return"4.2";case i.L5:return"5";case i.L5_1:return"5.1";case i.L5_2:return"5.2";default:return void n.warn(`levelToString() | unrecognized level ${e}`)}},t.parseSdpProfileLevelId=f,t.isSameProfile=function(e={},t={}){const r=f(e),n=f(t);return Boolean(r&&n&&r.profile===n.profile)},t.isSameProfileAndLevel=function(e={},t={}){const r=f(e),n=f(t);return Boolean(r&&n&&r.profile===n.profile&&r.level==n.level)},t.generateProfileLevelIdStringForAnswer=function(e={},t={}){if(!e["profile-level-id"]&&!t["profile-level-id"])return void n.warn("generateProfileLevelIdStringForAnswer() | profile-level-id missing in local and remote params");const r=f(e),s=f(t);if(!r)throw new TypeError("invalid local_profile_level_id");if(!s)throw new TypeError("invalid remote_profile_level_id");if(r.profile!==s.profile)throw new TypeError("H264 Profile mismatch");const a=v(e)&&v(t),c=r.level,d=s.level,u=(h=_=d,((p=g=c)===i.L1_b?h!==i.L1&&h!==i.L1_b:h===i.L1_b?p!==i.L1:p<h)?g:_),l=a?c:u;var p,h,g,_;return n.debug(`generateProfileLevelIdStringForAnswer() | result [profile:${r.profile}, level:${l}]`),m(new o(r.profile,l))},t.supportedLevel=function(e,t){for(let r=p.length-1;r>=0;--r){const s=p[r];if(256*s.max_macroblock_frame_size<=e&&s.max_macroblocks_per_second<=t*s.max_macroblock_frame_size)return n.debug(`supportedLevel() | result [max_frame_pixel_count:${e}, max_fps:${t}, level:${s.level}]`),s.level}n.warn(`supportedLevel() | no level supported [max_frame_pixel_count:${e}, max_fps:${t}]`)};const n=new(r(3582).Logger);var s,i,a;(a=s||(t.Profile=s={}))[a.ConstrainedBaseline=1]="ConstrainedBaseline",a[a.Baseline=2]="Baseline",a[a.Main=3]="Main",a[a.ConstrainedHigh=4]="ConstrainedHigh",a[a.High=5]="High",a[a.PredictiveHigh444=6]="PredictiveHigh444",function(e){e[e.L1_b=0]="L1_b",e[e.L1=10]="L1",e[e.L1_1=11]="L1_1",e[e.L1_2=12]="L1_2",e[e.L1_3=13]="L1_3",e[e.L2=20]="L2",e[e.L2_1=21]="L2_1",e[e.L2_2=22]="L2_2",e[e.L3=30]="L3",e[e.L3_1=31]="L3_1",e[e.L3_2=32]="L3_2",e[e.L4=40]="L4",e[e.L4_1=41]="L4_1",e[e.L4_2=42]="L4_2",e[e.L5=50]="L5",e[e.L5_1=51]="L5_1",e[e.L5_2=52]="L5_2"}(i||(t.Level=i={}));class o{constructor(e,t){this.profile=e,this.level=t}}t.ProfileLevelId=o;const c=new o(s.ConstrainedBaseline,i.L3_1);class d{constructor(e){this.mask=~g("x",e),this.masked_value=g("1",e)}isMatch(e){return this.masked_value===(e&this.mask)}}class u{constructor(e,t,r){this.profile_idc=e,this.profile_iop=t,this.profile=r}}const l=[new u(66,new d("x1xx0000"),s.ConstrainedBaseline),new u(77,new d("1xxx0000"),s.ConstrainedBaseline),new u(88,new d("11xx0000"),s.ConstrainedBaseline),new u(66,new d("x0xx0000"),s.Baseline),new u(88,new d("10xx0000"),s.Baseline),new u(77,new d("0x0x0000"),s.Main),new u(100,new d("00000000"),s.High),new u(100,new d("00001100"),s.ConstrainedHigh),new u(244,new d("00000000"),s.PredictiveHigh444)],p=[{max_macroblocks_per_second:1485,max_macroblock_frame_size:99,level:i.L1},{max_macroblocks_per_second:1485,max_macroblock_frame_size:99,level:i.L1_b},{max_macroblocks_per_second:3e3,max_macroblock_frame_size:396,level:i.L1_1},{max_macroblocks_per_second:6e3,max_macroblock_frame_size:396,level:i.L1_2},{max_macroblocks_per_second:11880,max_macroblock_frame_size:396,level:i.L1_3},{max_macroblocks_per_second:11880,max_macroblock_frame_size:396,level:i.L2},{max_macroblocks_per_second:19800,max_macroblock_frame_size:792,level:i.L2_1},{max_macroblocks_per_second:20250,max_macroblock_frame_size:1620,level:i.L2_2},{max_macroblocks_per_second:40500,max_macroblock_frame_size:1620,level:i.L3},{max_macroblocks_per_second:108e3,max_macroblock_frame_size:3600,level:i.L3_1},{max_macroblocks_per_second:216e3,max_macroblock_frame_size:5120,level:i.L3_2},{max_macroblocks_per_second:245760,max_macroblock_frame_size:8192,level:i.L4},{max_macroblocks_per_second:245760,max_macroblock_frame_size:8192,level:i.L4_1},{max_macroblocks_per_second:522240,max_macroblock_frame_size:8704,level:i.L4_2},{max_macroblocks_per_second:589824,max_macroblock_frame_size:22080,level:i.L5},{max_macroblocks_per_second:983040,max_macroblock_frame_size:36864,level:i.L5_1},{max_macroblocks_per_second:2073600,max_macroblock_frame_size:36864,level:i.L5_2}];function h(e){if("string"!=typeof e||6!==e.length)return;const t=parseInt(e,16);if(0===t)return;const r=255&t,s=t>>8&255,a=t>>16&255;let c;switch(r){case i.L1_1:c=16&s?i.L1_b:i.L1_1;break;case i.L1:case i.L1_2:case i.L1_3:case i.L2:case i.L2_1:case i.L2_2:case i.L3:case i.L3_1:case i.L3_2:case i.L4:case i.L4_1:case i.L4_2:case i.L5:case i.L5_1:case i.L5_2:c=r;break;default:return void n.warn(`parseProfileLevelId() | unrecognized level_idc [str:${e}, level_idc:${r}]`)}for(const i of l)if(a===i.profile_idc&&i.profile_iop.isMatch(s))return n.debug(`parseProfileLevelId() | result [str:${e}, profile:${i.profile}, level:${c}]`),new o(i.profile,c);n.warn(`parseProfileLevelId() | unrecognized profile_idc/profile_iop combination [str:${e}, profile_idc:${a}, profile_iop:${s}]`)}function m(e){if(e.level==i.L1_b)switch(e.profile){case s.ConstrainedBaseline:return"42f00b";case s.Baseline:return"42100b";case s.Main:return"4d100b";default:return void n.warn(`profileLevelIdToString() | Level 1_b not is allowed for profile ${e.profile}`)}let t;switch(e.profile){case s.ConstrainedBaseline:t="42e0";break;case s.Baseline:t="4200";break;case s.Main:t="4d00";break;case s.ConstrainedHigh:t="640c";break;case s.High:t="6400";break;case s.PredictiveHigh444:t="f400";break;default:return void n.warn(`profileLevelIdToString() | unrecognized profile ${e.profile}`)}let r=e.level.toString(16);return 1===r.length&&(r=`0${r}`),`${t}${r}`}function f(e={}){const t=e["profile-level-id"];return t?h(t):c}function g(e,t){return Number(t[0]===e)<<7|Number(t[1]===e)<<6|Number(t[2]===e)<<5|Number(t[3]===e)<<4|Number(t[4]===e)<<3|Number(t[5]===e)<<2|Number(t[6]===e)<<1|Number(t[7]===e)}function v(e={}){const t=e["level-asymmetry-allowed"];return!0===t||1===t||"1"===t}},3240:function(e,t,r){var n,s,i,a,o,c;e.exports=(n=r(9021),i=(s=n).lib,a=i.Base,o=i.WordArray,(c=s.x64={}).Word=a.extend({init:function(e,t){this.high=e,this.low=t}}),c.WordArray=a.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:8*e.length},toX32:function(){for(var e=this.words,t=e.length,r=[],n=0;n<t;n++){var s=e[n];r.push(s.high),r.push(s.low)}return o.create(r,this.sigBytes)},clone:function(){for(var e=a.clone.call(this),t=e.words=this.words.slice(0),r=t.length,n=0;n<r;n++)t[n]=t[n].clone();return e}}),n)},3303:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.parse=function(e){const t=r.exec(e??"");return t?{spatialLayers:Number(t[1]),temporalLayers:Number(t[2])}:{spatialLayers:1,temporalLayers:1}};const r=new RegExp("^[LS]([1-9]\\d{0,1})T([1-9]\\d{0,1})")},3465:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default="00000000-0000-0000-0000-000000000000"},3471:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OfferMediaSection=t.AnswerMediaSection=t.MediaSection=void 0;const s=n(7363),i=n(1765);class a{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:n,planB:s=!1}){if(r(this,"_mediaObject"),r(this,"_planB"),this._mediaObject={},this._planB=s,e&&this.setIceParameters(e),t){this._mediaObject.candidates=[];for(const e of t){const t={component:1};t.foundation=e.foundation,t.ip=e.address??e.ip,t.port=e.port,t.priority=e.priority,t.transport=e.protocol,t.type=e.type,e.tcpType&&(t.tcptype=e.tcpType),this._mediaObject.candidates.push(t)}this._mediaObject.endOfCandidates="end-of-candidates",this._mediaObject.iceOptions="renomination"}n&&this.setDtlsRole(n.role)}get mid(){return String(this._mediaObject.mid)}get closed(){return 0===this._mediaObject.port}getObject(){return this._mediaObject}setIceParameters(e){this._mediaObject.iceUfrag=e.usernameFragment,this._mediaObject.icePwd=e.password}pause(){this._mediaObject.direction="inactive"}disable(){this.pause(),delete this._mediaObject.ext,delete this._mediaObject.ssrcs,delete this._mediaObject.ssrcGroups,delete this._mediaObject.simulcast,delete this._mediaObject.simulcast_03,delete this._mediaObject.rids,delete this._mediaObject.extmapAllowMixed}close(){this.disable(),this._mediaObject.port=0}}function o(e){const t=new RegExp("^(audio|video)/(.+)","i").exec(e.mimeType);if(!t)throw new TypeError("invalid codec.mimeType");return t[2]}t.MediaSection=a,t.AnswerMediaSection=class extends a{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:r,sctpParameters:n,plainRtpParameters:s,planB:a=!1,offerMediaObject:c,offerRtpParameters:d,answerRtpParameters:u,codecOptions:l}){switch(super({iceParameters:e,iceCandidates:t,dtlsParameters:r,planB:a}),this._mediaObject.mid=String(c.mid),this._mediaObject.type=c.type,this._mediaObject.protocol=c.protocol,s?(this._mediaObject.connection={ip:s.ip,version:s.ipVersion},this._mediaObject.port=s.port):(this._mediaObject.connection={ip:"127.0.0.1",version:4},this._mediaObject.port=7),c.type){case"audio":case"video":this._mediaObject.direction="recvonly",this._mediaObject.rtp=[],this._mediaObject.rtcpFb=[],this._mediaObject.fmtp=[];for(const e of u.codecs){const t={payload:e.payloadType,codec:o(e),rate:e.clockRate};e.channels>1&&(t.encoding=e.channels),this._mediaObject.rtp.push(t);const r=i.clone(e.parameters)??{};let n=i.clone(e.rtcpFeedback)??[];if(l){const{opusStereo:t,opusFec:s,opusDtx:i,opusMaxPlaybackRate:a,opusMaxAverageBitrate:o,opusPtime:c,opusNack:u,videoGoogleStartBitrate:p,videoGoogleMaxBitrate:h,videoGoogleMinBitrate:m}=l,f=d.codecs.find(t=>t.payloadType===e.payloadType);switch(e.mimeType.toLowerCase()){case"audio/opus":case"audio/multiopus":void 0!==t&&(f.parameters["sprop-stereo"]=t?1:0,r.stereo=t?1:0),void 0!==s&&(f.parameters.useinbandfec=s?1:0,r.useinbandfec=s?1:0),void 0!==i&&(f.parameters.usedtx=i?1:0,r.usedtx=i?1:0),void 0!==a&&(r.maxplaybackrate=a),void 0!==o&&(r.maxaveragebitrate=o),void 0!==c&&(f.parameters.ptime=c,r.ptime=c),u||(f.rtcpFeedback=f.rtcpFeedback.filter(e=>"nack"!==e.type||e.parameter),n=n.filter(e=>"nack"!==e.type||e.parameter));break;case"video/vp8":case"video/vp9":case"video/h264":case"video/h265":void 0!==p&&(r["x-google-start-bitrate"]=p),void 0!==h&&(r["x-google-max-bitrate"]=h),void 0!==m&&(r["x-google-min-bitrate"]=m)}}const s={payload:e.payloadType,config:""};for(const e of Object.keys(r))s.config&&(s.config+=";"),s.config+=`${e}=${r[e]}`;s.config&&this._mediaObject.fmtp.push(s);for(const i of n)this._mediaObject.rtcpFb.push({payload:e.payloadType,type:i.type,subtype:i.parameter})}this._mediaObject.payloads=u.codecs.map(e=>e.payloadType).join(" "),this._mediaObject.ext=[];for(const e of u.headerExtensions)(c.ext??[]).some(t=>t.uri===e.uri)&&this._mediaObject.ext.push({uri:e.uri,value:e.id});if("extmap-allow-mixed"===c.extmapAllowMixed&&(this._mediaObject.extmapAllowMixed="extmap-allow-mixed"),c.simulcast){this._mediaObject.simulcast={dir1:"recv",list1:c.simulcast.list1},this._mediaObject.rids=[];for(const e of c.rids??[])"send"===e.direction&&this._mediaObject.rids.push({id:e.id,direction:"recv"})}else if(c.simulcast_03){this._mediaObject.simulcast_03={value:c.simulcast_03.value.replace(/send/g,"recv")},this._mediaObject.rids=[];for(const e of c.rids??[])"send"===e.direction&&this._mediaObject.rids.push({id:e.id,direction:"recv"})}this._mediaObject.rtcpMux="rtcp-mux",this._mediaObject.rtcpRsize="rtcp-rsize",this._planB&&"video"===this._mediaObject.type&&(this._mediaObject.xGoogleFlag="conference");break;case"application":"number"==typeof c.sctpPort?(this._mediaObject.payloads="webrtc-datachannel",this._mediaObject.sctpPort=n.port,this._mediaObject.maxMessageSize=n.maxMessageSize):c.sctpmap&&(this._mediaObject.payloads=n.port,this._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:n.port,maxMessageSize:n.maxMessageSize})}}setDtlsRole(e){switch(e){case"client":this._mediaObject.setup="active";break;case"server":this._mediaObject.setup="passive";break;case"auto":this._mediaObject.setup="actpass"}}resume(){this._mediaObject.direction="recvonly"}muxSimulcastStreams(e){var t,r;if(!(null==(t=this._mediaObject.simulcast)?void 0:t.list1))return;const n={};for(const s of e)s.rid&&(n[s.rid]=s);const i=this._mediaObject.simulcast.list1,a=s.parseSimulcastStreamList(i);for(const s of a)for(const e of s)e.paused=!(null==(r=n[e.scid])?void 0:r.active);this._mediaObject.simulcast.list1=a.map(e=>e.map(e=>`${e.paused?"~":""}${e.scid}`).join(",")).join(";")}},t.OfferMediaSection=class extends a{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:r,sctpParameters:n,plainRtpParameters:s,planB:i=!1,mid:a,kind:c,offerRtpParameters:d,streamId:u,trackId:l,oldDataChannelSpec:p=!1}){var h;switch(super({iceParameters:e,iceCandidates:t,dtlsParameters:r,planB:i}),this._mediaObject.mid=String(a),this._mediaObject.type=c,s?(this._mediaObject.connection={ip:s.ip,version:s.ipVersion},this._mediaObject.protocol="RTP/AVP",this._mediaObject.port=s.port):(this._mediaObject.connection={ip:"127.0.0.1",version:4},this._mediaObject.protocol=n?"UDP/DTLS/SCTP":"UDP/TLS/RTP/SAVPF",this._mediaObject.port=7),this._mediaObject.extmapAllowMixed="extmap-allow-mixed",c){case"audio":case"video":{this._mediaObject.direction="sendonly",this._mediaObject.rtp=[],this._mediaObject.rtcpFb=[],this._mediaObject.fmtp=[],this._planB||(this._mediaObject.msid=`${u??"-"} ${l}`);for(const n of d.codecs){const e={payload:n.payloadType,codec:o(n),rate:n.clockRate};n.channels>1&&(e.encoding=n.channels),this._mediaObject.rtp.push(e);const t={payload:n.payloadType,config:""};for(const r of Object.keys(n.parameters))t.config&&(t.config+=";"),t.config+=`${r}=${n.parameters[r]}`;t.config&&this._mediaObject.fmtp.push(t);for(const r of n.rtcpFeedback)this._mediaObject.rtcpFb.push({payload:n.payloadType,type:r.type,subtype:r.parameter})}this._mediaObject.payloads=d.codecs.map(e=>e.payloadType).join(" "),this._mediaObject.ext=[];for(const n of d.headerExtensions)this._mediaObject.ext.push({uri:n.uri,value:n.id});this._mediaObject.rtcpMux="rtcp-mux",this._mediaObject.rtcpRsize="rtcp-rsize";const e=d.encodings[0],t=e.ssrc,r=null==(h=e.rtx)?void 0:h.ssrc;this._mediaObject.ssrcs=[],this._mediaObject.ssrcGroups=[],d.rtcp.cname&&this._mediaObject.ssrcs.push({id:t,attribute:"cname",value:d.rtcp.cname}),this._planB&&this._mediaObject.ssrcs.push({id:t,attribute:"msid",value:`${u??"-"} ${l}`}),r&&(d.rtcp.cname&&this._mediaObject.ssrcs.push({id:r,attribute:"cname",value:d.rtcp.cname}),this._planB&&this._mediaObject.ssrcs.push({id:r,attribute:"msid",value:`${u??"-"} ${l}`}),this._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:`${t} ${r}`}));break}case"application":p?(this._mediaObject.payloads=n.port,this._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:n.port,maxMessageSize:n.maxMessageSize}):(this._mediaObject.payloads="webrtc-datachannel",this._mediaObject.sctpPort=n.port,this._mediaObject.maxMessageSize=n.maxMessageSize)}}setDtlsRole(e){this._mediaObject.setup="actpass"}resume(){this._mediaObject.direction="sendonly"}planBReceive({offerRtpParameters:e,streamId:t,trackId:r}){var n;const s=e.encodings[0],i=s.ssrc,a=null==(n=s.rtx)?void 0:n.ssrc,c=this._mediaObject.payloads.split(" ");for(const d of e.codecs){if(c.includes(String(d.payloadType)))continue;const e={payload:d.payloadType,codec:o(d),rate:d.clockRate};d.channels>1&&(e.encoding=d.channels),this._mediaObject.rtp.push(e);const t={payload:d.payloadType,config:""};for(const r of Object.keys(d.parameters))t.config&&(t.config+=";"),t.config+=`${r}=${d.parameters[r]}`;t.config&&this._mediaObject.fmtp.push(t);for(const r of d.rtcpFeedback)this._mediaObject.rtcpFb.push({payload:d.payloadType,type:r.type,subtype:r.parameter})}this._mediaObject.payloads+=` ${e.codecs.filter(e=>!this._mediaObject.payloads.includes(e.payloadType)).map(e=>e.payloadType).join(" ")}`,this._mediaObject.payloads=this._mediaObject.payloads.trim(),e.rtcp.cname&&this._mediaObject.ssrcs.push({id:i,attribute:"cname",value:e.rtcp.cname}),this._mediaObject.ssrcs.push({id:i,attribute:"msid",value:`${t??"-"} ${r}`}),a&&(e.rtcp.cname&&this._mediaObject.ssrcs.push({id:a,attribute:"cname",value:e.rtcp.cname}),this._mediaObject.ssrcs.push({id:a,attribute:"msid",value:`${t??"-"} ${r}`}),this._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:`${i} ${a}`}))}planBStopReceiving({offerRtpParameters:e}){var t;const r=e.encodings[0],n=r.ssrc,s=null==(t=r.rtx)?void 0:t.ssrc;this._mediaObject.ssrcs=this._mediaObject.ssrcs.filter(e=>e.id!==n&&e.id!==s),s&&(this._mediaObject.ssrcGroups=this._mediaObject.ssrcGroups.filter(e=>e.ssrcs!==`${n} ${s}`))}}},3518:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Consumer=void 0;const s=n(2994),i=n(3953),a=n(4893),o=new s.Logger("Consumer");class c extends i.EnhancedEventEmitter{constructor({id:e,localId:t,producerId:n,rtpReceiver:s,track:a,rtpParameters:c,appData:d}){super(),r(this,"_id"),r(this,"_localId"),r(this,"_producerId"),r(this,"_closed",!1),r(this,"_rtpReceiver"),r(this,"_track"),r(this,"_rtpParameters"),r(this,"_paused"),r(this,"_appData"),r(this,"_observer",new i.EnhancedEventEmitter),o.debug("constructor()"),this._id=e,this._localId=t,this._producerId=n,this._rtpReceiver=s,this._track=a,this._rtpParameters=c,this._paused=!a.enabled,this._appData=d??{},this.onTrackEnded=this.onTrackEnded.bind(this),this.handleTrack()}get id(){return this._id}get localId(){return this._localId}get producerId(){return this._producerId}get closed(){return this._closed}get kind(){return this._track.kind}get rtpReceiver(){return this._rtpReceiver}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get appData(){return this._appData}set appData(e){this._appData=e}get observer(){return this._observer}close(){this._closed||(o.debug("close()"),this._closed=!0,this.destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(o.debug("transportClosed()"),this._closed=!0,this.destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}async getStats(){if(this._closed)throw new a.InvalidStateError("closed");return new Promise((e,t)=>{this.safeEmit("@getstats",e,t)})}pause(){o.debug("pause()"),this._closed?o.error("pause() | Consumer closed"):this._paused?o.debug("pause() | Consumer is already paused"):(this._paused=!0,this._track.enabled=!1,this.emit("@pause"),this._observer.safeEmit("pause"))}resume(){o.debug("resume()"),this._closed?o.error("resume() | Consumer closed"):this._paused?(this._paused=!1,this._track.enabled=!0,this.emit("@resume"),this._observer.safeEmit("resume")):o.debug("resume() | Consumer is already resumed")}onTrackEnded(){o.debug('track "ended" event'),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}handleTrack(){this._track.addEventListener("ended",this.onTrackEnded)}destroyTrack(){try{this._track.removeEventListener("ended",this.onTrackEnded),this._track.stop()}catch(e){}}}t.Consumer=c},3582:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Logger=void 0;const s=n(r(7833)),i="h264-profile-level-id";t.Logger=class{constructor(e){e?(this._debug=(0,s.default)(`${i}:${e}`),this._warn=(0,s.default)(`${i}:WARN:${e}`),this._error=(0,s.default)(`${i}:ERROR:${e}`)):(this._debug=(0,s.default)(i),this._warn=(0,s.default)(`${i}:WARN`),this._error=(0,s.default)(`${i}:ERROR`)),this._debug.log=function(){}.bind(),this._warn.log=function(){}.bind(),this._error.log=function(){}.bind()}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}}},3662:(e,t,r)=>{function n(e,t){return(n=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}r.d(t,{A:()=>n})},3738:e=>{function t(r){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(r)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},3779:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});const r="undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);t.default={randomUUID:r}},3785:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.clone=function(e){return void 0===e?void 0:Number.isNaN(e)?NaN:"function"==typeof structuredClone?structuredClone(e):JSON.parse(JSON.stringify(e))}},3797:function(e,t,r){var n,s,i;e.exports=(i=r(9021),r(7165),i.mode.OFB=(s=(n=i.lib.BlockCipherMode.extend()).Encryptor=n.extend({processBlock:function(e,t){var r=this._cipher,n=r.blockSize,s=this._iv,i=this._keystream;s&&(i=this._keystream=s.slice(0),this._iv=void 0),r.encryptBlock(i,0);for(var a=0;a<n;a++)e[t+a]^=i[a]}}),n.Decryptor=s,n),i.mode.OFB)},3804:(e,t,r)=>{var n=r(5602),s=/%[sdv%]/g,i=function(e){var t=1,r=arguments,n=r.length;return e.replace(s,function(e){if(t>=n)return e;var s=r[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(s);case"%d":return Number(s);case"%v":return""}})},a=function(e,t,r){var n=[e+"="+(t.format instanceof Function?t.format(t.push?r:r[t.name]):t.format)];if(t.names)for(var s=0;s<t.names.length;s+=1){var a=t.names[s];t.name?n.push(r[t.name][a]):n.push(r[t.names[s]])}else n.push(r[t.name]);return i.apply(null,n)},o=["v","o","s","i","u","e","p","c","b","t","r","z","a"],c=["i","c","b","a"];e.exports=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach(function(e){null==e.payloads&&(e.payloads="")});var r=t.outerOrder||o,s=t.innerOrder||c,i=[];return r.forEach(function(t){n[t].forEach(function(r){r.name in e&&null!=e[r.name]?i.push(a(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach(function(e){i.push(a(t,r,e))})})}),e.media.forEach(function(e){i.push(a("m",n.m[0],e)),s.forEach(function(t){n[t].forEach(function(r){r.name in e&&null!=e[r.name]?i.push(a(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach(function(e){i.push(a(t,r,e))})})})}),i.join("\r\n")+"\r\n"}},3953:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EnhancedEventEmitter=void 0;const n=r(9596),s=new(r(2994).Logger)("EnhancedEventEmitter");class i extends n.EventEmitter{constructor(){super(),this.setMaxListeners(1/0)}emit(e,...t){return super.emit(e,...t)}safeEmit(e,...t){try{return super.emit(e,...t)}catch(r){s.error("safeEmit() | event listener threw an error [eventName:%s]:%o",e,r);try{super.emit("listenererror",e,r)}catch(n){}return Boolean(super.listenerCount(e))}}on(e,t){return super.on(e,t),this}off(e,t){return super.off(e,t),this}addListener(e,t){return super.on(e,t),this}prependListener(e,t){return super.prependListener(e,t),this}once(e,t){return super.once(e,t),this}prependOnceListener(e,t){return super.prependOnceListener(e,t),this}removeListener(e,t){return super.off(e,t),this}removeAllListeners(e){return super.removeAllListeners(e),this}listenerCount(e){return super.listenerCount(e)}listeners(e){return super.listeners(e)}rawListeners(e){return super.rawListeners(e)}}t.EnhancedEventEmitter=i},3954:(e,t,r)=>{function n(e){return(n=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}r.d(t,{A:()=>n})},4039:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ReactNativeUnifiedPlan=void 0;const s=n(7363),i=n(2994),a=n(1765),o=n(8046),c=n(5544),d=n(5938),u=n(4256),l=n(4893),p=n(521),h=n(1305),m=n(3303),f=new i.Logger("ReactNativeUnifiedPlan"),g={OS:1024,MIS:1024};class v extends p.HandlerInterface{constructor(){super(),r(this,"_closed",!1),r(this,"_direction"),r(this,"_remoteSdp"),r(this,"_sendingRtpParametersByKind"),r(this,"_sendingRemoteRtpParametersByKind"),r(this,"_forcedLocalDtlsRole"),r(this,"_pc"),r(this,"_mapMidTransceiver",new Map),r(this,"_sendStream",new MediaStream),r(this,"_hasDataChannelMediaSection",!1),r(this,"_nextSendSctpStreamId",0),r(this,"_transportReady",!1)}static createFactory(){return()=>new v}get name(){return"ReactNativeUnifiedPlan"}close(){if(f.debug("close()"),!this._closed){if(this._closed=!0,this._sendStream.release(!1),this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}}async getNativeRtpCapabilities(){f.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{e.addTransceiver("audio"),e.addTransceiver("video");const r=await e.createOffer();try{e.close()}catch(t){}const n=s.parse(r.sdp),i=c.extractRtpCapabilities({sdpObject:n});return u.addNackSupportForOpus(i),i}catch(r){try{e.close()}catch(t){}throw r}}async getNativeSctpCapabilities(){return f.debug("getNativeSctpCapabilities()"),{numStreams:g}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:s,iceServers:i,iceTransportPolicy:a,additionalSettings:c,proprietaryConstraints:d,extendedRtpCapabilities:u}){this.assertNotClosed(),f.debug("run()"),this._direction=e,this._remoteSdp=new h.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:s}),this._sendingRtpParametersByKind={audio:o.getSendingRtpParameters("audio",u),video:o.getSendingRtpParameters("video",u)},this._sendingRemoteRtpParametersByKind={audio:o.getSendingRemoteRtpParameters("audio",u),video:o.getSendingRemoteRtpParameters("video",u)},n.role&&"auto"!==n.role&&(this._forcedLocalDtlsRole="server"===n.role?"client":"server"),this._pc=new RTCPeerConnection({iceServers:i??[],iceTransportPolicy:a??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan",...c},d),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",e=>{this.emit("@icecandidateerror",e)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(f.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})}async updateIceServers(e){this.assertNotClosed(),f.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(this.assertNotClosed(),f.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady)if("send"===this._direction){const e=await this._pc.createOffer({iceRestart:!0});f.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();f.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:n,onRtpSender:i}){this.assertNotClosed(),this.assertSendDirection(),f.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),t&&t.length>1&&t.forEach((e,t)=>{e.rid=`r${t}`});const u=a.clone(this._sendingRtpParametersByKind[e.kind]);u.codecs=o.reduceCodecs(u.codecs,n);const l=a.clone(this._sendingRemoteRtpParametersByKind[e.kind]);l.codecs=o.reduceCodecs(l.codecs,n);const p=this._remoteSdp.getNextMediaSectionIdx(),h=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream],sendEncodings:t});i&&i(h.sender);let g,v=await this._pc.createOffer(),_=s.parse(v.sdp);_.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed(),this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:_});let y=!1;const b=(0,m.parse)((t??[{}])[0].scalabilityMode);t&&1===t.length&&b.spatialLayers>1&&"video/vp9"===u.codecs[0].mimeType.toLowerCase()&&(f.debug("send() | enabling legacy simulcast for VP9 SVC"),y=!0,_=s.parse(v.sdp),g=_.media[p.idx],d.addLegacySimulcast({offerMediaObject:g,numStreams:b.spatialLayers}),v={type:"offer",sdp:s.write(_)}),f.debug("send() | calling pc.setLocalDescription() [offer:%o]",v),await this._pc.setLocalDescription(v);let w=h.mid??void 0;if(w||f.warn("send() | missing transceiver.mid (bug in react-native-webrtc, using a workaround"),u.mid=w,_=s.parse(this._pc.localDescription.sdp),g=_.media[p.idx],u.rtcp.cname=c.getCname({offerMediaObject:g}),t)if(1===t.length){let e=d.getRtpEncodings({offerMediaObject:g});Object.assign(e[0],t[0]),y&&(e=[e[0]]),u.encodings=e}else u.encodings=t;else u.encodings=d.getRtpEncodings({offerMediaObject:g});if(u.encodings.length>1&&("video/vp8"===u.codecs[0].mimeType.toLowerCase()||"video/h264"===u.codecs[0].mimeType.toLowerCase()))for(const s of u.encodings)s.scalabilityMode?s.scalabilityMode=`L1T${b.temporalLayers}`:s.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:g,reuseMid:p.reuseMid,offerRtpParameters:u,answerRtpParameters:l,codecOptions:r});const S={type:"answer",sdp:this._remoteSdp.getSdp()};return f.debug("send() | calling pc.setRemoteDescription() [answer:%o]",S),await this._pc.setRemoteDescription(S),w||(w=h.mid,u.mid=w),this._mapMidTransceiver.set(w,h),{localId:w,rtpParameters:u,rtpSender:h.sender}}async stopSending(e){if(this.assertSendDirection(),this._closed)return;f.debug("stopSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");if(t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.closeMediaSection(t.mid))try{t.stop()}catch(s){}const r=await this._pc.createOffer();f.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const n={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n),this._mapMidTransceiver.delete(e)}async pauseSending(e){this.assertNotClosed(),this.assertSendDirection(),f.debug("pauseSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive",this._remoteSdp.pauseMediaSection(e);const r=await this._pc.createOffer();f.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const n={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n)}async resumeSending(e){this.assertNotClosed(),this.assertSendDirection(),f.debug("resumeSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(this._remoteSdp.resumeSendingMediaSection(e),!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="sendonly";const r=await this._pc.createOffer();f.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const n={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n)}async replaceTrack(e,t){this.assertNotClosed(),this.assertSendDirection(),t?f.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):f.debug("replaceTrack() [localId:%s, no track]",e);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");await r.sender.replaceTrack(t)}async setMaxSpatialLayer(e,t){this.assertNotClosed(),this.assertSendDirection(),f.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const n=r.sender.getParameters();n.encodings.forEach((e,r)=>{e.active=r<=t}),await r.sender.setParameters(n),this._remoteSdp.muxMediaSectionSimulcast(e,n.encodings);const s=await this._pc.createOffer();f.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);const i={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async setRtpEncodingParameters(e,t){this.assertNotClosed(),this.assertSendDirection(),f.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const n=r.sender.getParameters();n.encodings.forEach((e,r)=>{n.encodings[r]={...e,...t}}),await r.sender.setParameters(n),this._remoteSdp.muxMediaSectionSimulcast(e,n.encodings);const s=await this._pc.createOffer();f.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);const i={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async getSenderStats(e){this.assertNotClosed(),this.assertSendDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:n,protocol:i}){this.assertNotClosed(),this.assertSendDirection();const a={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:r,protocol:i};f.debug("sendDataChannel() [options:%o]",a);const o=this._pc.createDataChannel(n,a);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%g.MIS,!this._hasDataChannelMediaSection){const e=await this._pc.createOffer(),t=s.parse(e.sdp),r=t.media.find(e=>"application"===e.type);this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:t}),f.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:r});const n={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n),this._hasDataChannelMediaSection=!0}return{dataChannel:o,sctpStreamParameters:{streamId:a.id,ordered:a.ordered,maxPacketLifeTime:a.maxPacketLifeTime,maxRetransmits:a.maxRetransmits}}}async receive(e){this.assertNotClosed(),this.assertRecvDirection();const t=[],r=new Map;for(const s of e){const{trackId:e,kind:t,rtpParameters:n,streamId:i}=s;f.debug("receive() [trackId:%s, kind:%s]",e,t);const a=n.mid??String(this._mapMidTransceiver.size);r.set(e,a),this._remoteSdp.receive({mid:a,kind:t,offerRtpParameters:n,streamId:i??n.rtcp.cname,trackId:e})}const n={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",n),await this._pc.setRemoteDescription(n);for(const s of e){const{trackId:e,onRtpReceiver:t}=s;if(t){const n=r.get(e),s=this._pc.getTransceivers().find(e=>e.mid===n);if(!s)throw new Error("transceiver not found");t(s.receiver)}}let i=await this._pc.createAnswer();const a=s.parse(i.sdp);for(const s of e){const{trackId:e,rtpParameters:t}=s,n=r.get(e),i=a.media.find(e=>String(e.mid)===n);c.applyCodecParameters({offerRtpParameters:t,answerMediaObject:i})}i={type:"answer",sdp:s.write(a)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:a}),f.debug("receive() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i);for(const s of e){const{trackId:e}=s,n=r.get(e),i=this._pc.getTransceivers().find(e=>e.mid===n);if(!i)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(n,i),t.push({localId:n,track:i.receiver.track,rtpReceiver:i.receiver})}return t}async stopReceiving(e){if(this.assertRecvDirection(),this._closed)return;for(const n of e){f.debug("stopReceiving() [localId:%s]",n);const e=this._mapMidTransceiver.get(n);if(!e)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(e.mid)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const r=await this._pc.createAnswer();f.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r);for(const n of e)this._mapMidTransceiver.delete(n)}async pauseReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(const n of e){f.debug("pauseReceiving() [localId:%s]",n);const e=this._mapMidTransceiver.get(n);if(!e)throw new Error("associated RTCRtpTransceiver not found");e.direction="inactive",this._remoteSdp.pauseMediaSection(n)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const r=await this._pc.createAnswer();f.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r)}async resumeReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(const n of e){f.debug("resumeReceiving() [localId:%s]",n);const e=this._mapMidTransceiver.get(n);if(!e)throw new Error("associated RTCRtpTransceiver not found");e.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(n)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const r=await this._pc.createAnswer();f.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r)}async getReceiverStats(e){this.assertNotClosed(),this.assertRecvDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:n,ordered:i,maxPacketLifeTime:a,maxRetransmits:o}=e,c={negotiated:!0,id:n,ordered:i,maxPacketLifeTime:a,maxRetransmits:o,protocol:r};f.debug("receiveDataChannel() [options:%o]",c);const d=this._pc.createDataChannel(t,c);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const e={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();if(!this._transportReady){const e=s.parse(t.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:e})}f.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setLocalDescription(t),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=s.parse(this._pc.localDescription.sdp));const r=c.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await new Promise((e,t)=>{this.safeEmit("@connect",{dtlsParameters:r},e,t)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new l.InvalidStateError("method called in a closed handler")}assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}t.ReactNativeUnifiedPlan=v},4160:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},4253:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AwaitQueueRemovedTaskError=t.AwaitQueueStoppedError=void 0;class r extends Error{constructor(e){super(e??"queue stopped"),this.name="AwaitQueueStoppedError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,r)}}t.AwaitQueueStoppedError=r;class n extends Error{constructor(e){super(e??"queue task removed"),this.name="AwaitQueueRemovedTaskError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,n)}}t.AwaitQueueRemovedTaskError=n},4256:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.addNackSupportForOpus=function(e){var t;for(const r of e.codecs??[])"audio/opus"!==r.mimeType.toLowerCase()&&"audio/multiopus"!==r.mimeType.toLowerCase()||(null==(t=r.rtcpFeedback)?void 0:t.some(e=>"nack"===e.type&&!e.parameter))||(r.rtcpFeedback||(r.rtcpFeedback=[]),r.rtcpFeedback.push({type:"nack"}))}},4299:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.updateV7State=void 0;const n=r(2291),s=r(6011),i={};function a(e,t,r){return e.msecs??(e.msecs=-1/0),e.seq??(e.seq=0),t>e.msecs?(e.seq=r[6]<<23|r[7]<<16|r[8]<<8|r[9],e.msecs=t):(e.seq=e.seq+1|0,0===e.seq&&e.msecs++),e}function o(e,t,r,n,s=0){if(e.length<16)throw new Error("Random bytes length must be >= 16");if(n){if(s<0||s+16>n.length)throw new RangeError(`UUID byte range ${s}:${s+15} is out of buffer bounds`)}else n=new Uint8Array(16),s=0;return t??(t=Date.now()),r??(r=127*e[6]<<24|e[7]<<16|e[8]<<8|e[9]),n[s++]=t/1099511627776&255,n[s++]=t/4294967296&255,n[s++]=t/16777216&255,n[s++]=t/65536&255,n[s++]=t/256&255,n[s++]=255&t,n[s++]=112|r>>>28&15,n[s++]=r>>>20&255,n[s++]=128|r>>>14&63,n[s++]=r>>>6&255,n[s++]=r<<2&255|3&e[10],n[s++]=e[11],n[s++]=e[12],n[s++]=e[13],n[s++]=e[14],n[s++]=e[15],n}t.updateV7State=a,t.default=function(e,t,r){var c;let d;if(e)d=o(e.random??(null==(c=e.rng)?void 0:c.call(e))??(0,n.default)(),e.msecs,e.seq,t,r);else{const e=Date.now(),s=(0,n.default)();a(i,e,s),d=o(s,i.msecs,i.seq,t,r)}return t??(0,s.unsafeStringify)(d)}},4373:e=>{e.exports=function(e){var t=Object(e),r=[];for(var n in t)r.unshift(n);return function e(){for(;r.length;)if((n=r.pop())in t)return e.value=n,e.done=!1,e;return e.done=!0,e}},e.exports.__esModule=!0,e.exports.default=e.exports},4467:(e,t,r)=>{r.d(t,{A:()=>s});var n=r(816);function s(e,t,r){return(t=(0,n.A)(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}},4496:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getRtpEncodings=function({offerMediaObject:e,track:t}){const r=new Set;for(const i of e.ssrcs??[])if("msid"===i.attribute&&i.value.split(" ")[1]===t.id){const e=i.id;r.add(e)}if(0===r.size)throw new Error(`a=ssrc line with msid information not found [track.id:${t.id}]`);const n=new Map;for(const i of e.ssrcGroups??[]){if("FID"!==i.semantics)continue;let[e,t]=i.ssrcs.split(/\s+/);e=Number(e),t=Number(t),r.has(e)&&(r.delete(e),r.delete(t),n.set(e,t))}for(const i of r)n.set(i,null);const s=[];for(const[i,a]of n){const e={ssrc:i};a&&(e.rtx={ssrc:a}),s.push(e)}return s},t.addLegacySimulcast=function({offerMediaObject:e,track:t,numStreams:r}){if(r<=1)throw new TypeError("numStreams must be greater than 1");let n,s,i;if(!(e.ssrcs??[]).find(e=>"msid"===e.attribute&&e.value.split(" ")[1]===t.id&&(n=e.id,i=e.value.split(" ")[0],!0)))throw new Error(`a=ssrc line with msid information not found [track.id:${t.id}]`);(e.ssrcGroups??[]).some(e=>{if("FID"!==e.semantics)return!1;const t=e.ssrcs.split(/\s+/);return Number(t[0])===n&&(s=Number(t[1]),!0)});const a=e.ssrcs.find(e=>"cname"===e.attribute&&e.id===n);if(!a)throw new Error(`a=ssrc line with cname information not found [track.id:${t.id}]`);const o=a.value,c=[],d=[];for(let u=0;u<r;++u)c.push(n+u),s&&d.push(s+u);e.ssrcGroups=e.ssrcGroups??[],e.ssrcs=e.ssrcs??[],e.ssrcGroups.push({semantics:"SIM",ssrcs:c.join(" ")});for(const u of c)e.ssrcs.push({id:u,attribute:"cname",value:o}),e.ssrcs.push({id:u,attribute:"msid",value:`${i} ${t.id}`});for(let u=0;u<d.length;++u){const r=c[u],n=d[u];e.ssrcs.push({id:n,attribute:"cname",value:o}),e.ssrcs.push({id:n,attribute:"msid",value:`${i} ${t.id}`}),e.ssrcGroups.push({semantics:"FID",ssrcs:`${r} ${n}`})}}},4557:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.URL=t.DNS=void 0;const n=r(2829),s=r(2988);var i=r(2988);function a(e,t,r,i){return(0,s.default)(80,n.default,e,t,r,i)}Object.defineProperty(t,"DNS",{enumerable:!0,get:function(){return i.DNS}}),Object.defineProperty(t,"URL",{enumerable:!0,get:function(){return i.URL}}),a.DNS=s.DNS,a.URL=s.URL,t.default=a},4633:(e,t,r)=>{var n=r(5172),s=r(6993),i=r(5869),a=r(887),o=r(1791),c=r(4373),d=r(579);function u(){var t=s(),r=t.m(u),l=(Object.getPrototypeOf?Object.getPrototypeOf(r):r.__proto__).constructor;function p(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===l||"GeneratorFunction"===(t.displayName||t.name))}var h={throw:1,return:2,break:3,continue:3};function m(e){var t,r;return function(n){t||(t={stop:function(){return r(n.a,2)},catch:function(){return n.v},abrupt:function(e,t){return r(n.a,h[e],t)},delegateYield:function(e,s,i){return t.resultName=s,r(n.d,d(e),i)},finish:function(e){return r(n.f,e)}},r=function(e,r,s){n.p=t.prev,n.n=t.next;try{return e(r,s)}finally{t.next=n.n}}),t.resultName&&(t[t.resultName]=n.v,t.resultName=void 0),t.sent=n.v,t.next=n.n;try{return e.call(this,t)}finally{n.p=t.prev,n.n=t.next}}}return(e.exports=u=function(){return{wrap:function(e,r,n,s){return t.w(m(e),r,n,s&&s.reverse())},isGeneratorFunction:p,mark:t.m,awrap:function(e,t){return new n(e,t)},AsyncIterator:o,async:function(e,t,r,n,s){return(p(t)?a:i)(m(e),t,r,n,s)},keys:c,values:d}},e.exports.__esModule=!0,e.exports.default=e.exports)()}e.exports=u,e.exports.__esModule=!0,e.exports.default=e.exports},4636:function(e,t,r){var n;e.exports=(n=r(9021),function(e){var t=n,r=t.lib,s=r.WordArray,i=r.Hasher,a=t.algo,o=[];!function(){for(var t=0;t<64;t++)o[t]=4294967296*e.abs(e.sin(t+1))|0}();var c=a.MD5=i.extend({_doReset:function(){this._hash=new s.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var r=0;r<16;r++){var n=t+r,s=e[n];e[n]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8)}var i=this._hash.words,a=e[t+0],c=e[t+1],h=e[t+2],m=e[t+3],f=e[t+4],g=e[t+5],v=e[t+6],_=e[t+7],y=e[t+8],b=e[t+9],w=e[t+10],S=e[t+11],R=e[t+12],k=e[t+13],E=e[t+14],T=e[t+15],C=i[0],P=i[1],O=i[2],x=i[3];C=d(C,P,O,x,a,7,o[0]),x=d(x,C,P,O,c,12,o[1]),O=d(O,x,C,P,h,17,o[2]),P=d(P,O,x,C,m,22,o[3]),C=d(C,P,O,x,f,7,o[4]),x=d(x,C,P,O,g,12,o[5]),O=d(O,x,C,P,v,17,o[6]),P=d(P,O,x,C,_,22,o[7]),C=d(C,P,O,x,y,7,o[8]),x=d(x,C,P,O,b,12,o[9]),O=d(O,x,C,P,w,17,o[10]),P=d(P,O,x,C,S,22,o[11]),C=d(C,P,O,x,R,7,o[12]),x=d(x,C,P,O,k,12,o[13]),O=d(O,x,C,P,E,17,o[14]),C=u(C,P=d(P,O,x,C,T,22,o[15]),O,x,c,5,o[16]),x=u(x,C,P,O,v,9,o[17]),O=u(O,x,C,P,S,14,o[18]),P=u(P,O,x,C,a,20,o[19]),C=u(C,P,O,x,g,5,o[20]),x=u(x,C,P,O,w,9,o[21]),O=u(O,x,C,P,T,14,o[22]),P=u(P,O,x,C,f,20,o[23]),C=u(C,P,O,x,b,5,o[24]),x=u(x,C,P,O,E,9,o[25]),O=u(O,x,C,P,m,14,o[26]),P=u(P,O,x,C,y,20,o[27]),C=u(C,P,O,x,k,5,o[28]),x=u(x,C,P,O,h,9,o[29]),O=u(O,x,C,P,_,14,o[30]),C=l(C,P=u(P,O,x,C,R,20,o[31]),O,x,g,4,o[32]),x=l(x,C,P,O,y,11,o[33]),O=l(O,x,C,P,S,16,o[34]),P=l(P,O,x,C,E,23,o[35]),C=l(C,P,O,x,c,4,o[36]),x=l(x,C,P,O,f,11,o[37]),O=l(O,x,C,P,_,16,o[38]),P=l(P,O,x,C,w,23,o[39]),C=l(C,P,O,x,k,4,o[40]),x=l(x,C,P,O,a,11,o[41]),O=l(O,x,C,P,m,16,o[42]),P=l(P,O,x,C,v,23,o[43]),C=l(C,P,O,x,b,4,o[44]),x=l(x,C,P,O,R,11,o[45]),O=l(O,x,C,P,T,16,o[46]),C=p(C,P=l(P,O,x,C,h,23,o[47]),O,x,a,6,o[48]),x=p(x,C,P,O,_,10,o[49]),O=p(O,x,C,P,E,15,o[50]),P=p(P,O,x,C,g,21,o[51]),C=p(C,P,O,x,R,6,o[52]),x=p(x,C,P,O,m,10,o[53]),O=p(O,x,C,P,w,15,o[54]),P=p(P,O,x,C,c,21,o[55]),C=p(C,P,O,x,y,6,o[56]),x=p(x,C,P,O,T,10,o[57]),O=p(O,x,C,P,v,15,o[58]),P=p(P,O,x,C,k,21,o[59]),C=p(C,P,O,x,f,6,o[60]),x=p(x,C,P,O,S,10,o[61]),O=p(O,x,C,P,h,15,o[62]),P=p(P,O,x,C,b,21,o[63]),i[0]=i[0]+C|0,i[1]=i[1]+P|0,i[2]=i[2]+O|0,i[3]=i[3]+x|0},_doFinalize:function(){var t=this._data,r=t.words,n=8*this._nDataBytes,s=8*t.sigBytes;r[s>>>5]|=128<<24-s%32;var i=e.floor(n/4294967296),a=n;r[15+(s+64>>>9<<4)]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),r[14+(s+64>>>9<<4)]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),t.sigBytes=4*(r.length+1),this._process();for(var o=this._hash,c=o.words,d=0;d<4;d++){var u=c[d];c[d]=16711935&(u<<8|u>>>24)|4278255360&(u<<24|u>>>8)}return o},clone:function(){var e=i.clone.call(this);return e._hash=this._hash.clone(),e}});function d(e,t,r,n,s,i,a){var o=e+(t&r|~t&n)+s+a;return(o<<i|o>>>32-i)+t}function u(e,t,r,n,s,i,a){var o=e+(t&n|r&~n)+s+a;return(o<<i|o>>>32-i)+t}function l(e,t,r,n,s,i,a){var o=e+(t^r^n)+s+a;return(o<<i|o>>>32-i)+t}function p(e,t,r,n,s,i,a){var o=e+(r^(t|~n))+s+a;return(o<<i|o>>>32-i)+t}t.MD5=i._createHelper(c),t.HmacMD5=i._createHmacHelper(c)}(Math),n.MD5)},4725:function(e,t,r){var n,s,i;e.exports=(n=r(9021),i=(s=n).lib.WordArray,s.enc.Base64url={stringify:function(e,t){void 0===t&&(t=!0);var r=e.words,n=e.sigBytes,s=t?this._safe_map:this._map;e.clamp();for(var i=[],a=0;a<n;a+=3)for(var o=(r[a>>>2]>>>24-a%4*8&255)<<16|(r[a+1>>>2]>>>24-(a+1)%4*8&255)<<8|r[a+2>>>2]>>>24-(a+2)%4*8&255,c=0;c<4&&a+.75*c<n;c++)i.push(s.charAt(o>>>6*(3-c)&63));var d=s.charAt(64);if(d)for(;i.length%4;)i.push(d);return i.join("")},parse:function(e,t){void 0===t&&(t=!0);var r=e.length,n=t?this._safe_map:this._map,s=this._reverseMap;if(!s){s=this._reverseMap=[];for(var a=0;a<n.length;a++)s[n.charCodeAt(a)]=a}var o=n.charAt(64);if(o){var c=e.indexOf(o);-1!==c&&(r=c)}return function(e,t,r){for(var n=[],s=0,a=0;a<t;a++)if(a%4){var o=r[e.charCodeAt(a-1)]<<a%4*2|r[e.charCodeAt(a)]>>>6-a%4*2;n[s>>>2]|=o<<24-s%4*8,s++}return i.create(n,s)}(e,r,s)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_safe_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"},n.enc.Base64url)},4756:(e,t,r)=>{var n=r(4633)();e.exports=n;try{regeneratorRuntime=n}catch(s){"object"==typeof globalThis?globalThis.regeneratorRuntime=n:Function("r","regeneratorRuntime = r")(n)}},4893:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.InvalidStateError=t.UnsupportedError=void 0;class r extends Error{constructor(e){super(e),this.name="UnsupportedError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,r):this.stack=new Error(e).stack}}t.UnsupportedError=r;class n extends Error{constructor(e){super(e),this.name="InvalidStateError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,n):this.stack=new Error(e).stack}}t.InvalidStateError=n},4905:function(e,t,r){var n;e.exports=(n=r(9021),r(7165),n.pad.Iso10126={pad:function(e,t){var r=4*t,s=r-e.sigBytes%r;e.concat(n.lib.WordArray.random(s-1)).concat(n.lib.WordArray.create([s<<24],1))},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},n.pad.Iso10126)},4973:(e,t,r)=>{r.d(t,{Zu:()=>c,lp:()=>o});var n,s=r(467),i=r(4756),a=r.n(i),o=(r(9027),n=(0,s.A)(a().mark(function e(t){return a().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===navigator.mediaDevices&&(navigator.mediaDevices={}),void 0===navigator.mediaDevices.getUserMedia&&(navigator.mediaDevices.getUserMedia=function(e){var t=navigator.webkitGetUserMedia||navigator.mozGetUserMedia;return t?new Promise(function(r,n){t.call(navigator,e,r,n)}):Promise.reject(new Error("getUserMedia is not implemented in this browser"))}),e.next=1,navigator.mediaDevices.getUserMedia(t);case 1:return e.abrupt("return",e.sent);case 2:case"end":return e.stop()}},e)})),function(e){return n.apply(this,arguments)}),c=function(){var e=(0,s.A)(a().mark(function e(t){return a().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===navigator.mediaDevices&&(navigator.mediaDevices={}),void 0===navigator.mediaDevices.getDisplayMedia&&(navigator.mediaDevices.getDisplayMedia=function(e){var t=navigator.webkitGetDisplayMedia||navigator.mozGetDisplayMedia;return t?new Promise(function(r,n){t.call(navigator,e,r,n)}):Promise.reject(new Error("getDisplayMedia is not implemented in this browser"))}),e.next=1,navigator.mediaDevices.getDisplayMedia(t);case 1:return e.abrupt("return",e.sent);case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},5020:(e,t,r)=>{var n=function(e){return String(Number(e))===e?Number(e):e},s=function(e,t,r){var s=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:s&&!t[e.name]&&(t[e.name]={});var i=e.push?{}:s?t[e.name]:t;!function(e,t,r,s){if(s&&!r)t[s]=n(e[1]);else for(var i=0;i<r.length;i+=1)null!=e[i+1]&&(t[r[i]]=n(e[i+1]))}(r.match(e.reg),i,e.names,e.name),e.push&&t[e.push].push(i)},i=r(5602),a=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(e){var t={},r=[],n=t;return e.split(/(\r\n|\r|\n)/).filter(a).forEach(function(e){var t=e[0],a=e.slice(2);"m"===t&&(r.push({rtp:[],fmtp:[]}),n=r[r.length-1]);for(var o=0;o<(i[t]||[]).length;o+=1){var c=i[t][o];if(c.reg.test(a))return s(c,n,a)}}),t.media=r,t};var o=function(e,t){var r=t.split(/=(.+)/,2);return 2===r.length?e[r[0]]=n(r[1]):1===r.length&&t.length>1&&(e[r[0]]=void 0),e};t.parseParams=function(e){return e.split(/;\s?/).reduce(o,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(e){return e.toString().split(" ").map(Number)},t.parseRemoteCandidates=function(e){for(var t=[],r=e.split(" ").map(n),s=0;s<r.length;s+=3)t.push({component:r[s],ip:r[s+1],port:r[s+2]});return t},t.parseImageAttributes=function(e){return e.split(" ").map(function(e){return e.substring(1,e.length-1).split(",").reduce(o,{})})},t.parseSimulcastStreamList=function(e){return e.split(";").map(function(e){return e.split(",").map(function(e){var t,r=!1;return"~"!==e[0]?t=n(e):(t=n(e.substring(1,e.length)),r=!0),{scid:t,paused:r}})})}},5071:(e,t,r)=>{r.d(t,{V:()=>n});var n={HLS_STARTING:"HLS_STARTING",HLS_STARTED:"HLS_STARTED",HLS_PLAYABLE:"HLS_PLAYABLE",HLS_STOPPING:"HLS_STOPPING",HLS_STOPPED:"HLS_STOPPED"}},5172:e=>{e.exports=function(e,t){this.v=e,this.k=t},e.exports.__esModule=!0,e.exports.default=e.exports},5248:(e,t,r)=>{r(1765)},5328:(e,t,r)=>{var n,o,c,d,u,l,p,h,m,f,g,v,_,y,b,w;Object.defineProperty(t,"__esModule",{value:!0}),t.FakeMediaStreamTrack=void 0;const S=r(182),R=r(5862),k=r(3785),E=class e extends R.FakeEventTarget{constructor({kind:e,id:t,label:r,contentHint:s,enabled:R,muted:k,readyState:E,capabilities:T,constraints:C,settings:P,data:O}){super(),i(this,n),i(this,o),i(this,c),i(this,d),i(this,u),i(this,l),i(this,p),i(this,h),i(this,m),i(this,f),i(this,g),i(this,v,null),i(this,_,null),i(this,y,null),i(this,b,null),i(this,w,null),a(this,n,t??(0,S.v4)()),a(this,o,e),a(this,c,r??""),a(this,p,s??""),a(this,u,R??!0),a(this,l,k??!1),a(this,d,E??"live"),a(this,h,T??{}),a(this,m,C??{}),a(this,f,P??{}),a(this,g,O??{})}get id(){return s(this,n)}get kind(){return s(this,o)}get label(){return s(this,c)}get contentHint(){return s(this,p)}set contentHint(e){a(this,p,e)}get enabled(){return s(this,u)}set enabled(e){const t=s(this,u)!==e;a(this,u,e),t&&this.dispatchEvent(new Event("enabledchange"))}get muted(){return s(this,l)}get readyState(){return s(this,d)}get data(){return s(this,g)}set data(e){a(this,g,e)}get onmute(){return s(this,v)}set onmute(e){s(this,v)&&this.removeEventListener("mute",s(this,v)),a(this,v,e),e&&this.addEventListener("mute",e)}get onunmute(){return s(this,_)}set onunmute(e){s(this,_)&&this.removeEventListener("unmute",s(this,_)),a(this,_,e),e&&this.addEventListener("unmute",e)}get onended(){return s(this,y)}set onended(e){s(this,y)&&this.removeEventListener("ended",s(this,y)),a(this,y,e),e&&this.addEventListener("ended",e)}get onenabledchange(){return s(this,b)}set onenabledchange(e){s(this,b)&&this.removeEventListener("enabledchange",s(this,b)),a(this,b,e),e&&this.addEventListener("enabledchange",e)}get onstopped(){return s(this,w)}set onstopped(e){s(this,w)&&this.removeEventListener("stopped",s(this,w)),a(this,w,e),e&&this.addEventListener("stopped",e)}addEventListener(e,t,r){super.addEventListener(e,t,r)}removeEventListener(e,t){super.removeEventListener(e,t)}stop(){"ended"!==s(this,d)&&(a(this,d,"ended"),this.dispatchEvent(new Event("stopped")))}clone({id:t,data:r}={}){return new e({id:t??(0,S.v4)(),kind:s(this,o),label:s(this,c),contentHint:s(this,p),enabled:s(this,u),muted:s(this,l),readyState:s(this,d),capabilities:(0,k.clone)(s(this,h)),constraints:(0,k.clone)(s(this,m)),settings:(0,k.clone)(s(this,f)),data:r??(0,k.clone)(s(this,g))})}getCapabilities(){return s(this,h)}getConstraints(){return s(this,m)}async applyConstraints(e={}){return a(this,m,e),Promise.resolve()}getSettings(){return s(this,f)}remoteStop(){"ended"!==s(this,d)&&(a(this,d,"ended"),this.dispatchEvent(new Event("stopped")),this.dispatchEvent(new Event("ended")))}remoteMute(){s(this,l)||(a(this,l,!0),this.dispatchEvent(new Event("mute")))}remoteUnmute(){s(this,l)&&(a(this,l,!1),this.dispatchEvent(new Event("unmute")))}};n=new WeakMap,o=new WeakMap,c=new WeakMap,d=new WeakMap,u=new WeakMap,l=new WeakMap,p=new WeakMap,h=new WeakMap,m=new WeakMap,f=new WeakMap,g=new WeakMap,v=new WeakMap,_=new WeakMap,y=new WeakMap,b=new WeakMap,w=new WeakMap;let T=E;t.FakeMediaStreamTrack=T},5370:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},5414:e=>{e.exports=(()=>{var e={43:function(e,t,r){var n,s;n=function(){var e=function(){},t="undefined",r=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),n=["trace","debug","info","warn","error"];function s(e,t){var r=e[t];if("function"==typeof r.bind)return r.bind(e);try{return Function.prototype.bind.call(r,e)}catch(n){return function(){return Function.prototype.apply.apply(r,[e,arguments])}}}function i(){console.log&&(console.log.apply||Function.prototype.apply.apply(console.log,[console,arguments])),console.trace}function a(t,r){for(var s=0;s<n.length;s++){var i=n[s];this[i]=s<t?e:this.methodFactory(i,t,r)}this.log=this.debug}function o(e,r,n){return function(){typeof console!==t&&(a.call(this,r,n),this[e].apply(this,arguments))}}function c(n,a,c){return"debug"===(d=n)&&(d="log"),typeof console!==t&&("trace"===d&&r?i:void 0!==console[d]?s(console,d):void 0!==console.log?s(console,"log"):e)||o.apply(this,arguments);var d}function d(e,r,s){var i,o=this,d="loglevel";function u(){var e;if(typeof window!==t&&d){try{e=window.localStorage[d]}catch(s){}if(typeof e===t)try{var r=window.document.cookie,n=r.indexOf(encodeURIComponent(d)+"=");-1!==n&&(e=/^([^;]+)/.exec(r.slice(n))[1])}catch(s){}return void 0===o.levels[e]&&(e=void 0),e}}"string"==typeof e?d+=":"+e:"symbol"==typeof e&&(d=void 0),o.name=e,o.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},o.methodFactory=s||c,o.getLevel=function(){return i},o.setLevel=function(r,s){if("string"==typeof r&&void 0!==o.levels[r.toUpperCase()]&&(r=o.levels[r.toUpperCase()]),!("number"==typeof r&&r>=0&&r<=o.levels.SILENT))throw"log.setLevel() called with invalid level: "+r;if(i=r,!1!==s&&function(e){var r=(n[e]||"silent").toUpperCase();if(typeof window!==t&&d){try{return void(window.localStorage[d]=r)}catch(s){}try{window.document.cookie=encodeURIComponent(d)+"="+r+";"}catch(s){}}}(r),a.call(o,r,e),typeof console===t&&r<o.levels.SILENT)return"No console available for logging"},o.setDefaultLevel=function(e){u()||o.setLevel(e,!1)},o.enableAll=function(e){o.setLevel(o.levels.TRACE,e)},o.disableAll=function(e){o.setLevel(o.levels.SILENT,e)};var l=u();null==l&&(l=null==r?"WARN":r),o.setLevel(l,!1)}var u=new d,l={};u.getLogger=function(e){if("symbol"!=typeof e&&"string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=l[e];return t||(t=l[e]=new d(e,u.getLevel(),u.methodFactory)),t};var p=typeof window!==t?window.log:void 0;return u.noConflict=function(){return typeof window!==t&&window.log===u&&(window.log=p),u},u.getLoggers=function(){return l},u.default=u,u},void 0===(s=n.call(t,r,t,e))||(e.exports=s)}},t={};function r(n){var s=t[n];if(void 0!==s)return s.exports;var i=t[n]={exports:{}};return e[n].call(i.exports,i,i.exports,r),i.exports}r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var n={};return(()=>{r.r(n),r.d(n,{VideoSDKMetrics:()=>me});const e="inbound",t="outbound",s={codec_id_in:"",codec_in:{mime_type:null,clock_rate:null,sdp_fmtp_line:null},delta_jitter_ms_in:0,delta_rtt_ms_out:null,percent_packets_lost_in:0,delta_packets_in:0,delta_packets_lost_in:0,total_packets_in:0,total_packets_lost_in:0,total_KBytes_in:0,delta_KBytes_in:0,delta_kbs_in:0,timestamp_in:null,ssrc:"",total_concealment_events:0,delta_concealment_events:0,total_inserted_samples_for_decelaration:0,delta_inserted_samples_for_decelaration:0,total_removed_samples_for_accelaration:0,delta_removed_samples_for_accelaration:0,direction:e},i={codec_id_out:"",codec_out:{mime_type:null,clock_rate:null,sdp_fmtp_line:null},delta_jitter_ms_out:0,delta_rtt_ms_out:null,percent_packets_lost_out:0,delta_packets_out:0,delta_packets_lost_out:0,total_packets_out:0,total_packets_lost_out:0,total_KBytes_out:0,delta_KBytes_out:0,delta_kbs_out:0,timestamp_out:null,ssrc:"",direction:t},a={codec_id_in:"",size_in:{width:null,height:null,framerate:null},codec_in:{mime_type:null,clock_rate:null},delta_jitter_ms_in:0,percent_packets_lost_in:0,delta_packets_in:0,delta_packets_lost_in:0,total_packets_in:0,total_packets_lost_in:0,total_KBytes_in:0,delta_KBytes_in:0,delta_kbs_in:0,ssrc:"",direction:e},o={codec_id_out:"",size_out:{width:null,height:null,framerate:null},codec_out:{mime_type:null,clock_rate:null},delta_jitter_ms_out:0,delta_rtt_ms_out:null,percent_packets_lost_out:0,delta_packets_out:0,delta_packets_lost_out:0,total_packets_out:0,total_packets_lost_out:0,total_KBytes_out:0,delta_KBytes_out:0,delta_kbs_out:0,limitation_out:{reason:null,durations:null,resolutionChanges:0},timestamp_out:null,ssrc:"",direction:t},c="inbound-rtp",d="bytesReceived",u="bytesSent",l="clockRate",p="codecId",h="currentRoundTripTime",m="roundTripTime",f="fractionLost",g="frameHeight",v="frameWidth",_="qualityLimitationReason",y="qualityLimitationDurations",b="qualityLimitationResolutionChanges",w="id",S="jitter",R="kind",k="mimeType",E="packetsLost",T="packetsReceived",C="packetsSent",P="responsesReceived",O="ssrc",x="selected",D="timestamp",I="totalRoundTripTime",A="roundTripTimeMeasurements",M="type",L="framesDecoded",N="framesEncoded",j="totalDecodeTime",B="totalEncodeTime",U="pliCount",F="nackCount",q="trackId",W="trackIdentifier",V="mediaSourceId",H="audio",z="video",K={0:"ETHERNET",2:"CELLULAR_5G",3:"WIFI",5:"CELLULAR_4G",10:"CELLULAR"},G="audio",$="video",J="network",Q="data";var Y=r(43);const X=()=>`${(new Date).toISOString()} | metrics`,Z=(e,t,r)=>`${e} | ${t} | ${r}`;Y.setDefaultLevel(Y.levels.TRACE);const ee=(e,t,r)=>{r?Y.debug(Z(X(),e,t),r):Y.debug(Z(X(),e,t))},te=(e,t)=>{Y.warn(Z(X(),e,t))},re=(e,t)=>{Y.error(Z(X(),e,t))},ne="extractor   ",se=(t,r,n)=>{if(!r)return null;const c={};let d=r[H][t];d||(d=n===e?{...s}:{...i}),c[H]=d;let u=r[z][t];return u||(u=n===e?{...a}:{...o}),c[z]=u,c},ie=(e,t,r,n)=>{let s=!1;const i=n[t].total_rtt_ms_out,a=n[t].total_rtt_measure_out,o=r?r[t].total_rtt_ms_out:0,c=r?r[t].total_rtt_measure_out:0,d={rtt:null,totalRTT:i,totalRTTMeasurements:a};if(e[D]===n[t].timestamp_out)return d;if(!Object.prototype.hasOwnProperty.call(e,m))return d;if(Object.prototype.hasOwnProperty.call(e,A)&&(s=!0,0===Number(e[A])||Number(e[A])-c===a))return d;const u=Number(1e3)*Number(e[m]);let l=i+u,p=a+1;return s&&(l=Number(1e3)*Number(e[I])-o,p=Number(e[A])-c),{rtt:u,totalRTT:l,totalRTTMeasurements:p}},ae=(e,t,r)=>e[D]===r[t].timestamp_out?null:Object.prototype.hasOwnProperty.call(e,S)?Number(1e3)*(Number(e[S])||0):null,oe=(e,t,r,n)=>{if(!Object.prototype.hasOwnProperty.call(e,C)||!Object.prototype.hasOwnProperty.call(e,u))return{packetsSent:r[t].total_packets_out,packetsLost:r[t].total_packets_lost_out,bytesSent:r[t].total_KBytes_out};const s=Number(e[C])||0-(n?n[t].total_packets_out:0),i=s-r[t].total_packets_out,a=Number(e[u])/1024-(n?n[t].total_KBytes_out:0),o=a-r[t].total_KBytes_out,c=e[D]||Date.now(),d=n?n.timestamp:null;let l=r.timestamp;!l&&d&&(l=d);const p=l?c-l:0;return{packetsSent:s,deltaPacketsSent:i,KBytesSent:a,deltaKBytesSent:o,kbsSent:p>0?.008*o*1024/p*1e3:0}},ce=(e,t,r,n)=>{let s=r[t].total_packets_lost_out,i=0,a=0;return Object.prototype.hasOwnProperty.call(e,E)&&(s=Number(e[E])||0-(n?n[t].total_packets_lost_out:0),i=s-r[t].total_packets_lost_out),Object.prototype.hasOwnProperty.call(e,f)&&(a=Number(100*e[f])),{packetsLost:s,deltaPacketsLost:i,fractionLost:a}},de=(e,t,r,n)=>{if(!Object.prototype.hasOwnProperty.call(e,T)||!Object.prototype.hasOwnProperty.call(e,E)||!Object.prototype.hasOwnProperty.call(e,d))return{percent_packets_lost:r[t].percent_packets_lost_in,packetsReceived:r[t].total_packets_in,packetsLost:r[t].total_packets_lost_in,bytesReceived:r[t].total_KBytes_in};const s=(Number(e[T])||0)-(n?n[t].total_packets_in:0),i=(Number(e[E])||0)-(n?n[t].total_packets_lost_in:0),a=i-r[t].total_packets_lost_in,o=s-r[t].total_packets_in,c=s!==r[t].total_packets_in?100*a/(a+o):0,u=Number(e[d])/1024-(n?n[t].total_KBytes_in:0),l=u-r[t].total_KBytes_in,p=e[D]||Date.now(),h=n?n.timestamp:null;let m=r.timestamp;!m&&h&&(m=h);const f=m?p-m:0;return{percentPacketsLost:c,packetsReceived:s,deltaPacketsReceived:o,packetsLost:i,deltaPacketsLost:a,KBytesReceived:u,deltaKBytesReceived:l,kbsReceived:f>0?.008*l*1024/f*1e3:0}},ue=e=>Object.prototype.hasOwnProperty.call(e,g)&&Object.prototype.hasOwnProperty.call(e,v)?{width:e[v]||null,height:e[g]||null,framerate:e.framesPerSecond}:{width:null,height:null,framerate:null};class le{constructor(e,t){this._callbacks={onStatsCollected:null},this._id=`collector-${t}`,this._moduleName=this._id,this._probeId=t,this._config=e,this._state="idle",this._statsReports=[]}registerCallback(e,t,r){e in this._callbacks?(this._callbacks[e]={callback:t,context:r},ee(this._moduleName,`registered callback '${e}'`)):re(this._moduleName,`can't register callback for '${e}' - not found`)}unregisterCallback(e){e in this._callbacks?(this._callbacks[e]=null,delete this._callbacks[e],ee(this._moduleName,`unregistered callback '${e}'`)):re(this._moduleName,`can't unregister callback for '${e}' - not found`)}analyze(r,n){const m=(e=>{const t={name:"",meetingId:"",peerId:"",timestamp:null,count:0,audio:{},video:{},network:{infrastructure:3},data:{delta_kbs_bandwidth_in:0,delta_kbs_bandwidth_out:0,delta_rtt_connectivity_ms:null,total_rtt_connectivity_ms:0}};if(e){const t={...e,audio:{},video:{},data:{...e.data},network:{...e.network}};return Object.keys(e.audio).forEach(r=>{t.audio[r]={...e.audio[r]}}),Object.keys(e.video).forEach(r=>{t.video[r]={...e.video[r]}}),t}return{...t,audio:{},video:{},data:{...t.data},network:{...t.network}}})(n);m.name=this._config.name,m.meetingId=this._config.meetingId,m.peerId=this._config.peerId,m.count=n?n.count+1:1;let f=null;return r.forEach(r=>{!f&&r.timestamp&&(f=r.timestamp),((r,n,s,i)=>{if(!r)return[];switch(r[M]){case"candidate-pair":let m=!1;if(r.nominated&&"succeeded"===r.state&&(m=!0,ee(ne,`analyze() - got stats ${r[M]} for ${s}`,r),x in r&&!r[x]&&(m=!1)),m){r.localCandidateId,r.remoteCandidateId;const e=((e,t)=>{const r=(e[d]||0)/1024-0,n=(e[u]||0)/1024-0,s=e[D]||Date.now(),i=r-t.data.total_KBytes_in,a=n-t.data.total_KBytes_out;let o=t.timestamp;const c=o?s-o:0;return{total_KBytes_received:r,total_KBytes_sent:n,delta_KBytes_received:i,delta_KBytes_sent:a,kbs_speed_received:c>0?.008*i*1024/c*1e3:0,kbs_speed_sent:c>0?.008*a*1024/c*1e3:0}})(r,n),t=((o=r).availableIncomingBitrate,o.availableOutgoingBitrate,((e,t,r,n)=>{if(!Object.prototype.hasOwnProperty.call(e,h))return{rtt:null,totalRTT:n[t].total_rtt_connectivity_ms,totalRTTMeasurements:n[t].total_rtt_connectivity_measure};const s=Number(1e3)*Number(e[h]);let i=n[t].total_rtt_connectivity_ms+s,a=n[t].total_rtt_connectivity_measure+1;return Object.prototype.hasOwnProperty.call(e,I)&&(i=Number(1e3)*Number(e[I])-0),Object.prototype.hasOwnProperty.call(e,P)&&(a=Number(e[P])-0),{rtt:s,totalRTT:i,totalRTTMeasurements:a}})(r,"data",0,n));return[{type:Q,value:{total_KBytes_in:e.total_KBytes_received}},{type:Q,value:{total_KBytes_out:e.total_KBytes_sent}},{type:Q,value:{delta_KBytes_in:e.delta_KBytes_received}},{type:Q,value:{delta_KBytes_out:e.delta_KBytes_sent}},{type:Q,value:{delta_kbs_in:e.kbs_speed_received}},{type:Q,value:{delta_kbs_out:e.kbs_speed_sent}},{type:Q,value:{delta_rtt_connectivity_ms:t.rtt}}]}break;case"local-candidate":if(r[w]===n.network.local_candidate_id)return[{type:J,value:{infrastructure:r.networkType}},{type:J,value:{local_candidate_protocol:r.protocol||""}},{type:J,value:{local_candidate_relay_protocol:(a=r,"relay"!==a.candidateType?"":a.relayProtocol||"")}}];break;case c:{ee(ne,`analyze() - got stats ${r[M]} for ${s}`,r);const t=r[O],a=se(t,n,e);a&&(a.timestamp=n.timestamp);const o=se(t,i,e);if(o&&(o.timestamp=i.timestamp),r[R]===H){const e=de(r,H,a,o),n=ae(r,H,a),s=r[p]||"",i=((e,t,r)=>{const n=Number(e.concealmentEvents)||0,s=n-(r[t].total_concealment_events||0),i=Number(e.insertedSamplesForDeceleration)||0,a=i-(r[t].total_inserted_samples_for_decelaration||0),o=Number(e.removedSamplesForAcceleration)||0;return{totalConcealmentEvents:n,deltaConcealmentEvents:s,totalInsertedSamplesForDecelaration:i,deltaInsertedSamplesForDecelaration:a,totalRemovedSamplesForAccelaration:o,deltaRemovedSampleForAccelaration:o-(r[t].total_removed_samples_for_accelaration||0)}})(r,H,a);return[{ssrc:t,type:G,value:{codec_id_in:s}},{ssrc:t,type:G,value:{total_packets_in:e.packetsReceived}},{ssrc:t,type:G,value:{delta_packets_in:e.deltaPacketsReceived}},{ssrc:t,type:G,value:{total_packets_lost_in:e.packetsLost}},{ssrc:t,type:G,value:{delta_packets_lost_in:e.deltaPacketsLost}},{ssrc:t,type:G,value:{percent_packets_lost_in:e.percentPacketsLost}},{ssrc:t,type:G,value:{total_KBytes_in:e.KBytesReceived}},{ssrc:t,type:G,value:{delta_KBytes_in:e.deltaKBytesReceived}},{ssrc:t,type:G,value:{delta_kbs_in:e.kbsReceived}},{ssrc:t,type:G,value:{delta_jitter_ms_in:n}},{ssrc:t,type:G,value:{total_concealment_events:i.totalConcealmentEvents}},{ssrc:t,type:G,value:{delta_concealment_events:i.deltaConcealmentEvents}},{ssrc:t,type:G,value:{total_inserted_samples_for_decelaration:i.totalInsertedSamplesForDecelaration}},{ssrc:t,type:G,value:{delta_inserted_samples_for_decelaration:i.deltaInsertedSamplesForDecelaration}},{ssrc:t,type:G,value:{total_removed_samples_for_accelaration:i.totalRemovedSamplesForAccelaration}},{ssrc:t,type:G,value:{delta_removed_samples_for_accelaration:i.deltaRemovedSampleForAccelaration}},{ssrc:t,type:G,value:{track_in:r[q]}},{ssrc:t,type:G,value:{track_id_in:r[W]}},{ssrc:t,type:G,value:{media_source_id:r[V]}}]}if(r[R]===z){((e,t)=>{if(!Object.prototype.hasOwnProperty.call(e,L)||!Object.prototype.hasOwnProperty.call(e,j))return{delta_ms_decode_frame:t[z].delta_ms_decode_frame_in,frames_decoded:t[z].total_frames_decoded_in,total_decode_time:t[z].total_time_decoded_in};e[L],e[j],t[z].total_time_decoded_in,t[z].total_frames_decoded_in})(r,a);const e=de(r,z,a,o),n=ae(r,z,a),s=(r.decoderImplementation,r[p]||null),i=ue(r);return((e,t,r)=>{if(!Object.prototype.hasOwnProperty.call(e,U)||!Object.prototype.hasOwnProperty.call(e,F))return{pliCount:t.total_pli_sent_in,nackCount:t.total_nack_sent_in,deltaPliCount:0,deltaNackCount:0};e[U],r&&r[z].total_pli_sent_in,e[F],r&&r[z].total_nack_sent_in,t[z].total_pli_sent_in,t[z].total_nack_sent_in})(r,a,o),[{ssrc:t,type:$,value:{codec_id_in:s}},{ssrc:t,type:$,value:{total_packets_in:e.packetsReceived}},{ssrc:t,type:$,value:{delta_packets_in:e.deltaPacketsReceived}},{ssrc:t,type:$,value:{total_packets_lost_in:e.packetsLost}},{ssrc:t,type:$,value:{delta_packets_lost_in:e.deltaPacketsLost}},{ssrc:t,type:$,value:{percent_packets_lost_in:e.percentPacketsLost}},{ssrc:t,type:$,value:{total_KBytes_in:e.KBytesReceived}},{ssrc:t,type:$,value:{delta_KBytes_in:e.deltaKBytesReceived}},{ssrc:t,type:$,value:{delta_kbs_in:e.kbsReceived}},{ssrc:t,type:$,value:{delta_jitter_ms_in:n}},{ssrc:t,type:$,value:{size_in:i}},{ssrc:t,type:$,value:{track_in:r[q]}},{ssrc:t,type:$,value:{track_id_in:r[W]}},{ssrc:t,type:$,value:{media_source_id:r[V]}},{ssrc:t,type:$,value:{pause_count:r.pauseCount}},{ssrc:t,type:$,value:{total_pauses_duration:r.totalPausesDuration}},{ssrc:t,type:$,value:{freeze_count:r.freezeCount}},{ssrc:t,type:$,value:{total_freezes_duration:r.totalFreezesDuration}}]}break}case"outbound-rtp":{ee(ne,`analyze() - got stats ${r[M]} for ${s}`,r);const e=r[O],a=se(e,n,t);a&&(a.timestamp=n.timestamp);const o=se(e,i,t);if(o&&(o.timestamp=i.timestamp),r[R]===H){const t=r[p]||null,n=oe(r,H,a,o);return[{ssrc:e,type:G,value:{codec_id_out:t}},{ssrc:e,type:G,value:{total_packets_out:n.packetsSent}},{ssrc:e,type:G,value:{delta_packets_out:n.deltaPacketsSent}},{ssrc:e,type:G,value:{total_KBytes_out:n.KBytesSent}},{type:G,value:{delta_KBytes_out:n.deltaKBytesSent}},{ssrc:e,type:G,value:{delta_kbs_out:n.kbsSent}},{ssrc:e,type:G,value:{track_out:r[q]}},{ssrc:e,type:G,value:{track_id_out:r[W]}},{ssrc:e,type:G,value:{media_source_id:r[V]}}]}if(r[R]===z){r.encoderImplementation;const t=r[p]||null,n=(((e,t)=>{if(!Object.prototype.hasOwnProperty.call(e,N)||!Object.prototype.hasOwnProperty.call(e,B))return{delta_ms_encode_frame:t[z].delta_ms_encode_frame_out,frames_encoded:t[z].total_frames_encoded_out,total_encode_time:t[z].total_time_encoded_out};e[N],e[B],t[z].total_time_encoded_out,t[z].total_frames_encoded_out})(r,a),ue(r)),s=(e=>{const t=Object.prototype.hasOwnProperty.call(e,_)?e[_]:null,r=Object.prototype.hasOwnProperty.call(e,b)?e[b]:null,n=Object.prototype.hasOwnProperty.call(e,y)?e[y]:null;return n&&Object.keys(n).forEach(e=>{n[e]>1e3&&(n[e]=Number(n[e]/1e3))}),{reason:t,durations:n,resolutionChanges:r}})(r),i=(((e,t,r)=>{if(!Object.prototype.hasOwnProperty.call(e,U)||!Object.prototype.hasOwnProperty.call(e,F))return{pliCount:t.total_pli_received_out,nackCount:t.total_nack_received_out,deltaPliCount:0,deltaNackCount:0};e[U],r&&r[z].total_pli_received_out,e[F],r&&r[z].total_nack_received_out,t[z].total_pli_received_out,t[z].total_nack_received_out})(r,a,o),oe(r,z,a,o));return[{ssrc:e,type:$,value:{codec_id_out:t}},{ssrc:e,type:$,value:{total_packets_out:i.packetsSent}},{ssrc:e,type:$,value:{delta_packets_out:i.deltaPacketsSent}},{ssrc:e,type:$,value:{total_KBytes_out:i.KBytesSent}},{ssrc:e,type:$,value:{delta_KBytes_out:i.deltaKBytesSent}},{ssrc:e,type:$,value:{delta_kbs_out:i.kbsSent}},{ssrc:e,type:$,value:{size_out:n}},{ssrc:e,type:$,value:{limitation_out:s}},{ssrc:e,type:$,value:{track_out:r[q]}},{ssrc:e,type:$,value:{track_id_out:r[W]}},{ssrc:e,type:$,value:{media_source_id:r[V]}}]}break}case"media-source":{ee(ne,`analyze() - got stats ${r[M]} for ${s}`,r);const e=[];return Object.keys(n[H]).forEach(t=>{const s=n[H][t];if(s.media_source_id===r[w]){var i=r[W];e.push({ssrc:s.ssrc,type:G,value:{track_id_out:i}})}}),Object.keys(n[z]).forEach(t=>{const s=n[z][t];if(s.media_source_id===r[w]){var i=r[W];e.push({ssrc:s.ssrc,type:$,value:{track_id_out:i}})}}),e}case"track":{ee(ne,`analyze() - got stats ${r[M]} for ${s}`,r);const e=[];return Object.keys(n[H]).forEach(t=>{const i=n[H][t];if(i.track_in===r[w]||i.track_out===r[w]){ee(ne,`analyze() - got stats ${r[M]} for ${s}`,r);var a=r[W];r[w]===i.track_in?e.push({ssrc:i.ssrc,type:G,value:{track_id_in:a}}):e.push({ssrc:i.ssrc,type:G,value:{track_id_out:a}})}}),Object.keys(n[z]).forEach(t=>{const i=n[z][t];if(i.track_in===r[w]||i.track_out===r[w]){ee(ne,`analyze() - got stats ${r[M]} for ${s}`,r);var a=r[W];r[w]===i.track_in?e.push({ssrc:i.ssrc,type:$,value:{track_id_in:a}}):e.push({ssrc:i.ssrc,type:$,value:{track_id_out:a}})}}),e}case"codec":const f=[];return Object.keys(n[H]).forEach(e=>{const t=n[H][e];if(t.codec_id_in===r[w]||t.codec_id_out===r[w]){ee(ne,`analyze() - got stats ${r[M]} for ${s}`,r);const e={channels:(i=r).channels||null,clock_rate:i[l]||null,mime_type:i[k]||null,sdp_fmtp_line:i.sdpFmtpLine||null};r[w]===t.codec_id_in?f.push({ssrc:t.ssrc,type:G,value:{codec_in:e}}):f.push({ssrc:t.ssrc,type:G,value:{codec_out:e}})}var i}),Object.keys(n[z]).forEach(e=>{const t=n[z][e];if(t.codec_id_in===r[w]||t.codec_id_out===r[w]){ee(ne,`analyze() - got stats ${r[M]} for ${s}`,r);const e={clock_rate:(i=r)[l]||null,mime_type:i[k]||null};r[w]===t.codec_id_in?f.push({ssrc:t.ssrc,type:$,value:{codec_in:e}}):f.push({ssrc:t.ssrc,type:$,value:{codec_out:e}})}var i}),f;case"remote-inbound-rtp":{ee(ne,`analyze() - got stats ${r[M]} for ${s}`,r);const e=r[O],a=se(e,n,t),o=se(e,i,t);if(r[R]===H){const t=ie(r,H,o,a),n=ae(r,H,a),s=ce(r,H,a,o);return[{ssrc:e,type:G,value:{delta_rtt_ms_out:t.rtt}},{ssrc:e,type:G,value:{delta_jitter_ms_out:n}},{ssrc:e,type:G,value:{timestamp_out:r[D]}},{ssrc:e,type:G,value:{total_packets_lost_out:s.packetsLost}},{ssrc:e,type:G,value:{delta_packets_lost_out:s.deltaPacketsLost}},{ssrc:e,type:G,value:{percent_packets_lost_out:s.fractionLost}}]}if(r[R]===z){const t=ie(r,z,o,a),n=ae(r,z,a),s=ce(r,z,a,o);return[{ssrc:e,type:$,value:{delta_rtt_ms_out:t.rtt}},{ssrc:e,type:$,value:{delta_jitter_ms_out:n}},{ssrc:e,type:$,value:{timestamp_out:r[D]}},{ssrc:e,type:$,value:{total_packets_lost_out:s.packetsLost}},{ssrc:e,type:$,value:{delta_packets_lost_out:s.deltaPacketsLost}}]}break}case"remote-outbound-rtp":{ee(ne,`analyze() - got stats ${r[M]} for ${s}`,r);const e=r[O],a=se(e,n,t),o=se(e,i,t);if(r[R]===H){const t=ie(r,H,o,a);return[{ssrc:e,type:G,value:{delta_rtt_ms_in:t.rtt}},{ssrc:e,type:G,value:{timestamp_in:r[D]}}]}break}}var a,o;return[]})(r,m,m.name,null).forEach(e=>{if(e.value&&e.type)if(e.ssrc){let d=m[e.type][e.ssrc];d||(t=e.type,n=r.type,d=t===H?n===c?{...s}:{...i}:n===c?{...a}:{...o},d.ssrc=e.ssrc,m[e.type][e.ssrc]=d),Object.keys(e.value).forEach(t=>{void 0!==e.value[t]&&(d[t]=e.value[t])})}else Object.keys(e.value).forEach(t=>{void 0!==e.value[t]&&(m[e.type][t]=e.value[t])});var t,n})}),m.timestamp=f,m}async collectStats(){try{const e=await this._config.monitoringObject.getStats(),t=this.analyze(e,this._statsReports.slice().pop()||null);return this._statsReports.push(t),this.fireOnStatsCollected(t),e}catch(e){return re(this._moduleName,`got error ${e}`),null}}fireOnStatsCollected(r){if(this._callbacks.onStatsCollected){const n={};n.meetingId=r.meetingId,n.peerId=r.peerId,n.name=r.name,n.audio=[],n.video=[],Object.values(r.audio).forEach(s=>{const i={};if(i.network=K[r.network.infrastructure],i.timestamp=r.timestamp,s.direction==e){i.codec=s.codec_in.mime_type,i.jitter=s.delta_jitter_ms_in,i.bitrate=s.delta_kbs_in,i.packetsLost=s.delta_packets_lost_in,i.rtt=r.data.delta_rtt_connectivity_ms||0,i.totalPackets=s.delta_packets_in,i.concealmentEvents=s.delta_concealment_events,i.removedSampleForAccelaration=s.delta_removed_samples_for_accelaration,i.insertedSamplesForDecelaration=s.delta_inserted_samples_for_decelaration;const e=JSON.stringify(s.track_id_in).replace(/[{}"]/g,"");i.trackId=e}else s.direction==t&&(i.codec=s.codec_out.mime_type,i.jitter=s.delta_jitter_ms_out,i.bitrate=s.delta_kbs_out,i.packetsLost=s.delta_packets_lost_out,i.rtt=r.data.delta_rtt_connectivity_ms||0,i.totalPackets=s.delta_packets_out,i.trackId=s.track_id_out);n.audio.push(i)}),Object.values(r.video).forEach(s=>{const i={};if(i.network=K[r.network.infrastructure],i.timestamp=r.timestamp,s.direction==e){i.codec=s.codec_in.mime_type,i.jitter=s.delta_jitter_ms_in,i.bitrate=s.delta_kbs_in,i.packetsLost=s.delta_packets_lost_in,i.rtt=r.data.delta_rtt_connectivity_ms||0,i.totalPackets=s.delta_packets_in,i.size=s.size_in,i.pauseCount=s.pause_count,i.totalPausesDuration=s.total_pauses_duration,i.freezeCount=s.freeze_count,i.totalFreezesDuration=s.total_freezes_duration;const e=JSON.stringify(s.track_id_in).replace(/[{}"]/g,"");i.trackId=e}else s.direction==t&&(i.codec=s.codec_out.mime_type,i.jitter=s.delta_jitter_ms_out,i.bitrate=s.delta_kbs_out,i.packetsLost=s.delta_packets_lost_out,i.rtt=r.data.delta_rtt_connectivity_ms||0,i.totalPackets=s.delta_packets_out,i.limitation=s.limitation_out,i.size=s.size_out,i.trackId=s.track_id_out);n.video.push(i)}),this._callbacks.onStatsCollected.callback(n)}}}class pe{constructor(e){this._id=e.name&&e.name.substr(0,12).padEnd(12," "),this._moduleName=this._id,this._config=e,this._collector=new le(this._config,this._id)}get id(){return this._id}start(){this._collectorIntervalId?te("Probe already started."):(ee(this._moduleName,"Probe Started"),this._collectorIntervalId=setInterval(()=>{ee(this._moduleName,"Collector collecting stats"),this._collector.collectStats()},this._config.refreshEvery))}stop(){this._collectorIntervalId?(clearInterval(this._collectorIntervalId),ee(this._moduleName,"Probe Stopped")):te("Probe not running, Please start first.")}set onStatsCollected(e){e?this._collector.registerCallback("onStatsCollected",e):this._collector.unregisterCallback("onStatsCollected")}}const he={refreshEvery:2e3,startAfter:0,stopAfter:-1,verbose:!1,peerId:"peerId",meetingId:"meetingId",name:"name"};class me{constructor(e){var t;this._config={defaultConfig:he,...e},this._probes=[],t=this._config.verbose||!1,Y.setLevel(t?Y.levels.TRACE:Y.levels.INFO),ee("VideoSDKMetrics","VideoSDKMetrics initialized")}get probes(){return this._probes}addNewProbe(e,t){if(!e)throw new Error("undefined monitoring object");const r={monitoringObject:e,...t,...this._config},n=new pe(r);return this._probes.push(n),n}removeExistingProbe(e){if(!e)throw new Error("undefined probe");e.stop(),this._probes=this._probes.filter(t=>e.id!==t.id)}getProbe(e){for(let t of this.probes)if(t.id==e)return t}startAllProbes(){this._probes.forEach((e,t)=>{e.start()})}stopAllProbes(){this._probes.forEach(e=>e.stop())}}})(),n})()},5458:(e,t,r)=>{r.d(t,{A:()=>i});var n=r(3145),s=r(7800);function i(e){return function(e){if(Array.isArray(e))return(0,n.A)(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||(0,s.A)(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}},5471:function(e,t,r){var n,s,i,a,o,c,d,u;e.exports=(s=(n=u=r(9021)).lib,i=s.WordArray,a=s.Hasher,o=n.algo,c=[],d=o.SHA1=a.extend({_doReset:function(){this._hash=new i.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var r=this._hash.words,n=r[0],s=r[1],i=r[2],a=r[3],o=r[4],d=0;d<80;d++){if(d<16)c[d]=0|e[t+d];else{var u=c[d-3]^c[d-8]^c[d-14]^c[d-16];c[d]=u<<1|u>>>31}var l=(n<<5|n>>>27)+o+c[d];l+=d<20?1518500249+(s&i|~s&a):d<40?1859775393+(s^i^a):d<60?(s&i|s&a|i&a)-1894007588:(s^i^a)-899497514,o=a,a=i,i=s<<30|s>>>2,s=n,n=l}r[0]=r[0]+n|0,r[1]=r[1]+s|0,r[2]=r[2]+i|0,r[3]=r[3]+a|0,r[4]=r[4]+o|0},_doFinalize:function(){var e=this._data,t=e.words,r=8*this._nDataBytes,n=8*e.sigBytes;return t[n>>>5]|=128<<24-n%32,t[14+(n+64>>>9<<4)]=Math.floor(r/4294967296),t[15+(n+64>>>9<<4)]=r,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=a.clone.call(this);return e._hash=this._hash.clone(),e}}),n.SHA1=a._createHelper(d),n.HmacSHA1=a._createHmacHelper(d),u.SHA1)},5501:(e,t,r)=>{r.d(t,{A:()=>s});var n=r(3662);function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&(0,n.A)(e,t)}},5503:function(e,t,r){var n;e.exports=(n=r(9021),function(){var e=n,t=e.lib.WordArray,r=e.enc;function s(e){return e<<8&4278255360|e>>>8&16711935}r.Utf16=r.Utf16BE={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],s=0;s<r;s+=2){var i=t[s>>>2]>>>16-s%4*8&65535;n.push(String.fromCharCode(i))}return n.join("")},parse:function(e){for(var r=e.length,n=[],s=0;s<r;s++)n[s>>>1]|=e.charCodeAt(s)<<16-s%2*16;return t.create(n,2*r)}},r.Utf16LE={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],i=0;i<r;i+=2){var a=s(t[i>>>2]>>>16-i%4*8&65535);n.push(String.fromCharCode(a))}return n.join("")},parse:function(e){for(var r=e.length,n=[],i=0;i<r;i++)n[i>>>1]|=s(e.charCodeAt(i)<<16-i%2*16);return t.create(n,2*r)}}}(),n.enc.Utf16)},5535:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Chrome70=void 0;const s=n(7363),i=n(2994),a=n(1765),o=n(8046),c=n(5544),d=n(5938),u=n(521),l=n(1305),p=n(3303),h=new i.Logger("Chrome70"),m={OS:1024,MIS:1024};class f extends u.HandlerInterface{constructor(){super(),r(this,"_direction"),r(this,"_remoteSdp"),r(this,"_sendingRtpParametersByKind"),r(this,"_sendingRemoteRtpParametersByKind"),r(this,"_forcedLocalDtlsRole"),r(this,"_pc"),r(this,"_mapMidTransceiver",new Map),r(this,"_sendStream",new MediaStream),r(this,"_hasDataChannelMediaSection",!1),r(this,"_nextSendSctpStreamId",0),r(this,"_transportReady",!1)}static createFactory(){return()=>new f}get name(){return"Chrome70"}close(){if(h.debug("close()"),this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}async getNativeRtpCapabilities(){h.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{e.addTransceiver("audio"),e.addTransceiver("video");const r=await e.createOffer();try{e.close()}catch(t){}const n=s.parse(r.sdp);return c.extractRtpCapabilities({sdpObject:n})}catch(r){try{e.close()}catch(t){}throw r}}async getNativeSctpCapabilities(){return h.debug("getNativeSctpCapabilities()"),{numStreams:m}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:s,iceServers:i,iceTransportPolicy:a,additionalSettings:c,proprietaryConstraints:d,extendedRtpCapabilities:u}){h.debug("run()"),this._direction=e,this._remoteSdp=new l.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:s}),this._sendingRtpParametersByKind={audio:o.getSendingRtpParameters("audio",u),video:o.getSendingRtpParameters("video",u)},this._sendingRemoteRtpParametersByKind={audio:o.getSendingRemoteRtpParameters("audio",u),video:o.getSendingRemoteRtpParameters("video",u)},n.role&&"auto"!==n.role&&(this._forcedLocalDtlsRole="server"===n.role?"client":"server"),this._pc=new RTCPeerConnection({iceServers:i??[],iceTransportPolicy:a??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan",...c},d),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",e=>{this.emit("@icecandidateerror",e)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(h.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})}async updateIceServers(e){h.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(h.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady)if("send"===this._direction){const e=await this._pc.createOffer({iceRestart:!0});h.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};h.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};h.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();h.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:n}){this.assertSendDirection(),h.debug("send() [kind:%s, track.id:%s]",e.kind,e.id);const i=a.clone(this._sendingRtpParametersByKind[e.kind]);i.codecs=o.reduceCodecs(i.codecs,n);const u=a.clone(this._sendingRemoteRtpParametersByKind[e.kind]);u.codecs=o.reduceCodecs(u.codecs,n);const l=this._remoteSdp.getNextMediaSectionIdx(),m=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream]});let f,g=await this._pc.createOffer(),v=s.parse(g.sdp);v.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed(),this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:v}),t&&t.length>1&&(h.debug("send() | enabling legacy simulcast"),v=s.parse(g.sdp),f=v.media[l.idx],d.addLegacySimulcast({offerMediaObject:f,numStreams:t.length}),g={type:"offer",sdp:s.write(v)});let _=!1;const y=(0,p.parse)((t??[{}])[0].scalabilityMode);if(t&&1===t.length&&y.spatialLayers>1&&"video/vp9"===i.codecs[0].mimeType.toLowerCase()&&(h.debug("send() | enabling legacy simulcast for VP9 SVC"),_=!0,v=s.parse(g.sdp),f=v.media[l.idx],d.addLegacySimulcast({offerMediaObject:f,numStreams:y.spatialLayers}),g={type:"offer",sdp:s.write(v)}),h.debug("send() | calling pc.setLocalDescription() [offer:%o]",g),await this._pc.setLocalDescription(g),t){h.debug("send() | applying given encodings");const e=m.sender.getParameters();for(let r=0;r<(e.encodings??[]).length;++r){const n=e.encodings[r],s=t[r];if(!s)break;e.encodings[r]=Object.assign(n,s)}await m.sender.setParameters(e)}const b=m.mid;if(i.mid=b,v=s.parse(this._pc.localDescription.sdp),f=v.media[l.idx],i.rtcp.cname=c.getCname({offerMediaObject:f}),i.encodings=d.getRtpEncodings({offerMediaObject:f}),t)for(let s=0;s<i.encodings.length;++s)t[s]&&Object.assign(i.encodings[s],t[s]);if(_&&(i.encodings=[i.encodings[0]]),i.encodings.length>1&&("video/vp8"===i.codecs[0].mimeType.toLowerCase()||"video/h264"===i.codecs[0].mimeType.toLowerCase()))for(const s of i.encodings)s.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:f,reuseMid:l.reuseMid,offerRtpParameters:i,answerRtpParameters:u,codecOptions:r});const w={type:"answer",sdp:this._remoteSdp.getSdp()};return h.debug("send() | calling pc.setRemoteDescription() [answer:%o]",w),await this._pc.setRemoteDescription(w),this._mapMidTransceiver.set(b,m),{localId:b,rtpParameters:i,rtpSender:m.sender}}async stopSending(e){this.assertSendDirection(),h.debug("stopSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");if(t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.closeMediaSection(t.mid))try{t.stop()}catch(s){}const r=await this._pc.createOffer();h.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const n={type:"answer",sdp:this._remoteSdp.getSdp()};h.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n),this._mapMidTransceiver.delete(e)}async pauseSending(e){}async resumeSending(e){}async replaceTrack(e,t){this.assertSendDirection(),t?h.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):h.debug("replaceTrack() [localId:%s, no track]",e);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");await r.sender.replaceTrack(t)}async setMaxSpatialLayer(e,t){this.assertSendDirection(),h.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const n=r.sender.getParameters();n.encodings.forEach((e,r)=>{e.active=r<=t}),await r.sender.setParameters(n),this._remoteSdp.muxMediaSectionSimulcast(e,n.encodings);const s=await this._pc.createOffer();h.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);const i={type:"answer",sdp:this._remoteSdp.getSdp()};h.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async setRtpEncodingParameters(e,t){this.assertSendDirection(),h.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const n=r.sender.getParameters();n.encodings.forEach((e,r)=>{n.encodings[r]={...e,...t}}),await r.sender.setParameters(n),this._remoteSdp.muxMediaSectionSimulcast(e,n.encodings);const s=await this._pc.createOffer();h.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);const i={type:"answer",sdp:this._remoteSdp.getSdp()};h.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async getSenderStats(e){this.assertSendDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:n,protocol:i}){this.assertSendDirection();const a={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmitTime:t,maxRetransmits:r,protocol:i};h.debug("sendDataChannel() [options:%o]",a);const o=this._pc.createDataChannel(n,a);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%m.MIS,!this._hasDataChannelMediaSection){const e=await this._pc.createOffer(),t=s.parse(e.sdp),r=t.media.find(e=>"application"===e.type);this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:t}),h.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:r});const n={type:"answer",sdp:this._remoteSdp.getSdp()};h.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n),this._hasDataChannelMediaSection=!0}return{dataChannel:o,sctpStreamParameters:{streamId:a.id,ordered:a.ordered,maxPacketLifeTime:a.maxPacketLifeTime,maxRetransmits:a.maxRetransmits}}}async receive(e){this.assertRecvDirection();const t=[],r=new Map;for(const s of e){const{trackId:e,kind:t,rtpParameters:n,streamId:i}=s;h.debug("receive() [trackId:%s, kind:%s]",e,t);const a=n.mid??String(this._mapMidTransceiver.size);r.set(e,a),this._remoteSdp.receive({mid:a,kind:t,offerRtpParameters:n,streamId:i??n.rtcp.cname,trackId:e})}const n={type:"offer",sdp:this._remoteSdp.getSdp()};h.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",n),await this._pc.setRemoteDescription(n);let i=await this._pc.createAnswer();const a=s.parse(i.sdp);for(const s of e){const{trackId:e,rtpParameters:t}=s,n=r.get(e),i=a.media.find(e=>String(e.mid)===n);c.applyCodecParameters({offerRtpParameters:t,answerMediaObject:i})}i={type:"answer",sdp:s.write(a)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:a}),h.debug("receive() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i);for(const s of e){const{trackId:e}=s,n=r.get(e),i=this._pc.getTransceivers().find(e=>e.mid===n);if(!i)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(n,i),t.push({localId:n,track:i.receiver.track,rtpReceiver:i.receiver})}return t}async stopReceiving(e){this.assertRecvDirection();for(const n of e){h.debug("stopReceiving() [localId:%s]",n);const e=this._mapMidTransceiver.get(n);if(!e)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(e.mid)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};h.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const r=await this._pc.createAnswer();h.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r);for(const n of e)this._mapMidTransceiver.delete(n)}async pauseReceiving(e){}async resumeReceiving(e){}async getReceiverStats(e){this.assertRecvDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){this.assertRecvDirection();const{streamId:n,ordered:i,maxPacketLifeTime:a,maxRetransmits:o}=e,c={negotiated:!0,id:n,ordered:i,maxPacketLifeTime:a,maxRetransmitTime:a,maxRetransmits:o,protocol:r};h.debug("receiveDataChannel() [options:%o]",c);const d=this._pc.createDataChannel(t,c);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const e={type:"offer",sdp:this._remoteSdp.getSdp()};h.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();if(!this._transportReady){const e=s.parse(t.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:e})}h.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setLocalDescription(t),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=s.parse(this._pc.localDescription.sdp));const r=c.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await new Promise((e,t)=>{this.safeEmit("@connect",{dtlsParameters:r},e,t)}),this._transportReady=!0}assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}t.Chrome70=f},5544:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.extractRtpCapabilities=function({sdpObject:e}){const t=new Map,r=[];let s=!1,i=!1;for(const a of e.media){const e=a.type;switch(e){case"audio":if(s)continue;s=!0;break;case"video":if(i)continue;i=!0;break;default:continue}for(const r of a.rtp){const n={kind:e,mimeType:`${e}/${r.codec}`,preferredPayloadType:r.payload,clockRate:r.rate,channels:r.encoding,parameters:{},rtcpFeedback:[]};t.set(n.preferredPayloadType,n)}for(const r of a.fmtp??[]){const e=n.parseParams(r.config),s=t.get(r.payload);s&&((null==e?void 0:e.hasOwnProperty("profile-level-id"))&&(e["profile-level-id"]=String(e["profile-level-id"])),s.parameters=e)}for(const r of a.rtcpFb??[]){const n={type:r.type,parameter:r.subtype};if(n.parameter||delete n.parameter,"*"!==r.payload){const e=t.get(r.payload);if(!e)continue;e.rtcpFeedback.push(n)}else for(const r of t.values())r.kind!==e||/.+\/rtx$/i.test(r.mimeType)||r.rtcpFeedback.push(n)}for(const t of a.ext??[]){if(t["encrypt-uri"])continue;const n={kind:e,uri:t.uri,preferredId:t.value};r.push(n)}}return{codecs:Array.from(t.values()),headerExtensions:r}},t.extractDtlsParameters=function({sdpObject:e}){let t,r=e.setup,n=e.fingerprint;if(!r||!n){const t=(e.media??[]).find(e=>0!==e.port);t&&(r??(r=t.setup),n??(n=t.fingerprint))}if(!r)throw new Error("no a=setup found at SDP session or media level");if(!n)throw new Error("no a=fingerprint found at SDP session or media level");switch(r){case"active":t="client";break;case"passive":t="server";break;case"actpass":t="auto"}return{role:t,fingerprints:[{algorithm:n.type,value:n.hash}]}},t.getCname=function({offerMediaObject:e}){const t=(e.ssrcs??[]).find(e=>"cname"===e.attribute);return t?t.value:""},t.applyCodecParameters=function({offerRtpParameters:e,answerMediaObject:t}){for(const r of e.codecs){const e=r.mimeType.toLowerCase();if("audio/opus"!==e)continue;if(!(t.rtp??[]).find(e=>e.payload===r.payloadType))continue;t.fmtp=t.fmtp??[];let s=t.fmtp.find(e=>e.payload===r.payloadType);s||(s={payload:r.payloadType,config:""},t.fmtp.push(s));const i=n.parseParams(s.config);switch(e){case"audio/opus":{const e=r.parameters["sprop-stereo"];void 0!==e&&(i.stereo=Number(e)?1:0);break}}s.config="";for(const t of Object.keys(i))s.config&&(s.config+=";"),s.config+=`${t}=${i[t]}`}};const n=r(7363)},5546:e=>{function t(r,n,s,i){var a=Object.defineProperty;try{a({},"",{})}catch(o){a=0}e.exports=t=function(e,r,n,s){if(r)a?a(e,r,{value:n,enumerable:!s,configurable:!s,writable:!s}):e[r]=n;else{var i=function(r,n){t(e,r,function(e){return this._invoke(r,n,e)})};i("next",0),i("throw",1),i("return",2)}},e.exports.__esModule=!0,e.exports.default=e.exports,t(r,n,s,i)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},5601:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Transport=void 0;const s=n(8876),i=n(2994),a=n(3953),o=n(4893),c=n(1765),d=n(8046),u=n(9792),l=n(3518),p=n(7504),h=n(9166),m=new i.Logger("Transport");class f{constructor(e){r(this,"consumerOptions"),r(this,"promise"),r(this,"resolve"),r(this,"reject"),this.consumerOptions=e,this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class g extends a.EnhancedEventEmitter{constructor({direction:e,id:t,iceParameters:n,iceCandidates:i,dtlsParameters:o,sctpParameters:d,iceServers:u,iceTransportPolicy:l,additionalSettings:p,proprietaryConstraints:h,appData:f,handlerFactory:g,extendedRtpCapabilities:v,canProduceByKind:_}){super(),r(this,"_id"),r(this,"_closed",!1),r(this,"_direction"),r(this,"_extendedRtpCapabilities"),r(this,"_canProduceByKind"),r(this,"_maxSctpMessageSize"),r(this,"_handler"),r(this,"_iceGatheringState","new"),r(this,"_connectionState","new"),r(this,"_appData"),r(this,"_producers",new Map),r(this,"_consumers",new Map),r(this,"_dataProducers",new Map),r(this,"_dataConsumers",new Map),r(this,"_probatorConsumerCreated",!1),r(this,"_awaitQueue",new s.AwaitQueue),r(this,"_pendingConsumerTasks",[]),r(this,"_consumerCreationInProgress",!1),r(this,"_pendingPauseConsumers",new Map),r(this,"_consumerPauseInProgress",!1),r(this,"_pendingResumeConsumers",new Map),r(this,"_consumerResumeInProgress",!1),r(this,"_pendingCloseConsumers",new Map),r(this,"_consumerCloseInProgress",!1),r(this,"_observer",new a.EnhancedEventEmitter),m.debug("constructor() [id:%s, direction:%s]",t,e),this._id=t,this._direction=e,this._extendedRtpCapabilities=v,this._canProduceByKind=_,this._maxSctpMessageSize=d?d.maxMessageSize:null;const y=c.clone(p)??{};delete y.iceServers,delete y.iceTransportPolicy,delete y.bundlePolicy,delete y.rtcpMuxPolicy,delete y.sdpSemantics,this._handler=g(),this._handler.run({direction:e,iceParameters:n,iceCandidates:i,dtlsParameters:o,sctpParameters:d,iceServers:u,iceTransportPolicy:l,additionalSettings:y,proprietaryConstraints:h,extendedRtpCapabilities:v}),this._appData=f??{},this.handleHandler()}get id(){return this._id}get closed(){return this._closed}get direction(){return this._direction}get handler(){return this._handler}get iceGatheringState(){return this._iceGatheringState}get connectionState(){return this._connectionState}get appData(){return this._appData}set appData(e){this._appData=e}get observer(){return this._observer}close(){if(!this._closed){m.debug("close()"),this._closed=!0,this._awaitQueue.stop(),this._handler.close(),this._connectionState="closed";for(const e of this._producers.values())e.transportClosed();this._producers.clear();for(const e of this._consumers.values())e.transportClosed();this._consumers.clear();for(const e of this._dataProducers.values())e.transportClosed();this._dataProducers.clear();for(const e of this._dataConsumers.values())e.transportClosed();this._dataConsumers.clear(),this._observer.safeEmit("close")}}async getStats(){if(this._closed)throw new o.InvalidStateError("closed");return this._handler.getTransportStats()}async restartIce({iceParameters:e}){if(m.debug("restartIce()"),this._closed)throw new o.InvalidStateError("closed");if(!e)throw new TypeError("missing iceParameters");return this._awaitQueue.push(async()=>await this._handler.restartIce(e),"transport.restartIce()")}async updateIceServers({iceServers:e}={}){if(m.debug("updateIceServers()"),this._closed)throw new o.InvalidStateError("closed");if(!Array.isArray(e))throw new TypeError("missing iceServers");return this._awaitQueue.push(async()=>this._handler.updateIceServers(e),"transport.updateIceServers()")}async produce({track:e,encodings:t,codecOptions:r,codec:n,stopTracks:s=!0,disableTrackOnPause:i=!0,zeroRtpOnPause:a=!1,onRtpSender:c,appData:l={}}={}){if(m.debug("produce() [track:%o]",e),this._closed)throw new o.InvalidStateError("closed");if(!e)throw new TypeError("missing track");if("send"!==this._direction)throw new o.UnsupportedError("not a sending Transport");if(!this._canProduceByKind[e.kind])throw new o.UnsupportedError(`cannot produce ${e.kind}`);if("ended"===e.readyState)throw new o.InvalidStateError("track ended");if(0===this.listenerCount("connect")&&"new"===this._connectionState)throw new TypeError('no "connect" listener set into this transport');if(0===this.listenerCount("produce"))throw new TypeError('no "produce" listener set into this transport');if(l&&"object"!=typeof l)throw new TypeError("if given, appData must be an object");return this._awaitQueue.push(async()=>{let o;if(t&&!Array.isArray(t))throw TypeError("encodings must be an array");t&&0===t.length?o=void 0:t&&(o=t.map(e=>{const t={active:!0};return!1===e.active&&(t.active=!1),"boolean"==typeof e.dtx&&(t.dtx=e.dtx),"string"==typeof e.scalabilityMode&&(t.scalabilityMode=e.scalabilityMode),"number"==typeof e.scaleResolutionDownBy&&(t.scaleResolutionDownBy=e.scaleResolutionDownBy),"number"==typeof e.maxBitrate&&(t.maxBitrate=e.maxBitrate),"number"==typeof e.maxFramerate&&(t.maxFramerate=e.maxFramerate),"boolean"==typeof e.adaptivePtime&&(t.adaptivePtime=e.adaptivePtime),"string"==typeof e.priority&&(t.priority=e.priority),"string"==typeof e.networkPriority&&(t.networkPriority=e.networkPriority),t}));const{localId:p,rtpParameters:h,rtpSender:m}=await this._handler.send({track:e,encodings:o,codecOptions:r,codec:n,onRtpSender:c});try{d.validateRtpParameters(h);const{id:t}=await new Promise((t,r)=>{this.safeEmit("produce",{kind:e.kind,rtpParameters:h,appData:l},t,r)}),r=new u.Producer({id:t,localId:p,rtpSender:m,track:e,rtpParameters:h,stopTracks:s,disableTrackOnPause:i,zeroRtpOnPause:a,appData:l});return this._producers.set(r.id,r),this.handleProducer(r),this._observer.safeEmit("newproducer",r),r}catch(f){throw this._handler.stopSending(p).catch(()=>{}),f}},"transport.produce()").catch(t=>{if(s)try{e.stop()}catch(r){}throw t})}async consume({id:e,producerId:t,kind:r,rtpParameters:n,streamId:s,onRtpReceiver:i,appData:a={}}){if(m.debug("consume()"),this._closed)throw new o.InvalidStateError("closed");if("recv"!==this._direction)throw new o.UnsupportedError("not a receiving Transport");if("string"!=typeof e)throw new TypeError("missing id");if("string"!=typeof t)throw new TypeError("missing producerId");if("audio"!==r&&"video"!==r)throw new TypeError(`invalid kind '${r}'`);if(0===this.listenerCount("connect")&&"new"===this._connectionState)throw new TypeError('no "connect" listener set into this transport');if(a&&"object"!=typeof a)throw new TypeError("if given, appData must be an object");const u=c.clone(n);if(!d.canReceive(u,this._extendedRtpCapabilities))throw new o.UnsupportedError("cannot consume this Producer");const l=new f({id:e,producerId:t,kind:r,rtpParameters:u,streamId:s,onRtpReceiver:i,appData:a});return this._pendingConsumerTasks.push(l),queueMicrotask(()=>{this._closed||!1===this._consumerCreationInProgress&&this.createPendingConsumers()}),l.promise}async produceData({ordered:e=!0,maxPacketLifeTime:t,maxRetransmits:r,label:n="",protocol:s="",appData:i={}}={}){if(m.debug("produceData()"),this._closed)throw new o.InvalidStateError("closed");if("send"!==this._direction)throw new o.UnsupportedError("not a sending Transport");if(!this._maxSctpMessageSize)throw new o.UnsupportedError("SCTP not enabled by remote Transport");if(0===this.listenerCount("connect")&&"new"===this._connectionState)throw new TypeError('no "connect" listener set into this transport');if(0===this.listenerCount("producedata"))throw new TypeError('no "producedata" listener set into this transport');if(i&&"object"!=typeof i)throw new TypeError("if given, appData must be an object");return(t||r)&&(e=!1),this._awaitQueue.push(async()=>{const{dataChannel:a,sctpStreamParameters:o}=await this._handler.sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:n,protocol:s});d.validateSctpStreamParameters(o);const{id:c}=await new Promise((e,t)=>{this.safeEmit("producedata",{sctpStreamParameters:o,label:n,protocol:s,appData:i},e,t)}),u=new p.DataProducer({id:c,dataChannel:a,sctpStreamParameters:o,appData:i});return this._dataProducers.set(u.id,u),this.handleDataProducer(u),this._observer.safeEmit("newdataproducer",u),u},"transport.produceData()")}async consumeData({id:e,dataProducerId:t,sctpStreamParameters:r,label:n="",protocol:s="",appData:i={}}){if(m.debug("consumeData()"),this._closed)throw new o.InvalidStateError("closed");if("recv"!==this._direction)throw new o.UnsupportedError("not a receiving Transport");if(!this._maxSctpMessageSize)throw new o.UnsupportedError("SCTP not enabled by remote Transport");if("string"!=typeof e)throw new TypeError("missing id");if("string"!=typeof t)throw new TypeError("missing dataProducerId");if(0===this.listenerCount("connect")&&"new"===this._connectionState)throw new TypeError('no "connect" listener set into this transport');if(i&&"object"!=typeof i)throw new TypeError("if given, appData must be an object");const a=c.clone(r);return d.validateSctpStreamParameters(a),this._awaitQueue.push(async()=>{const{dataChannel:r}=await this._handler.receiveDataChannel({sctpStreamParameters:a,label:n,protocol:s}),o=new h.DataConsumer({id:e,dataProducerId:t,dataChannel:r,sctpStreamParameters:a,appData:i});return this._dataConsumers.set(o.id,o),this.handleDataConsumer(o),this._observer.safeEmit("newdataconsumer",o),o},"transport.consumeData()")}createPendingConsumers(){this._consumerCreationInProgress=!0,this._awaitQueue.push(async()=>{if(0===this._pendingConsumerTasks.length)return void m.debug("createPendingConsumers() | there is no Consumer to be created");const e=[...this._pendingConsumerTasks];let t;this._pendingConsumerTasks=[];const r=[];for(const i of e){const{id:e,kind:t,rtpParameters:n,streamId:s,onRtpReceiver:a}=i.consumerOptions;r.push({trackId:e,kind:t,rtpParameters:n,streamId:s,onRtpReceiver:a})}try{const n=await this._handler.receive(r);for(let r=0;r<n.length;++r){const s=e[r],i=n[r],{id:a,producerId:o,kind:c,rtpParameters:d,appData:u}=s.consumerOptions,{localId:p,rtpReceiver:h,track:m}=i,f=new l.Consumer({id:a,localId:p,producerId:o,rtpReceiver:h,track:m,rtpParameters:d,appData:u});this._consumers.set(f.id,f),this.handleConsumer(f),this._probatorConsumerCreated||t||"video"!==c||(t=f),this._observer.safeEmit("newconsumer",f),s.resolve(f)}}catch(n){for(const t of e)t.reject(n)}if(t)try{const e=d.generateProbatorRtpParameters(t.rtpParameters);await this._handler.receive([{trackId:"probator",kind:"video",rtpParameters:e}]),m.debug("createPendingConsumers() | Consumer for RTP probation created"),this._probatorConsumerCreated=!0}catch(s){m.error("createPendingConsumers() | failed to create Consumer for RTP probation:%o",s)}},"transport.createPendingConsumers()").then(()=>{this._consumerCreationInProgress=!1,this._pendingConsumerTasks.length>0&&this.createPendingConsumers()}).catch(()=>{})}pausePendingConsumers(){this._consumerPauseInProgress=!0,this._awaitQueue.push(async()=>{if(0===this._pendingPauseConsumers.size)return void m.debug("pausePendingConsumers() | there is no Consumer to be paused");const e=Array.from(this._pendingPauseConsumers.values());this._pendingPauseConsumers.clear();try{const t=e.map(e=>e.localId);await this._handler.pauseReceiving(t)}catch(t){m.error("pausePendingConsumers() | failed to pause Consumers:",t)}},"transport.pausePendingConsumers").then(()=>{this._consumerPauseInProgress=!1,this._pendingPauseConsumers.size>0&&this.pausePendingConsumers()}).catch(()=>{})}resumePendingConsumers(){this._consumerResumeInProgress=!0,this._awaitQueue.push(async()=>{if(0===this._pendingResumeConsumers.size)return void m.debug("resumePendingConsumers() | there is no Consumer to be resumed");const e=Array.from(this._pendingResumeConsumers.values());this._pendingResumeConsumers.clear();try{const t=e.map(e=>e.localId);await this._handler.resumeReceiving(t)}catch(t){m.error("resumePendingConsumers() | failed to resume Consumers:",t)}},"transport.resumePendingConsumers").then(()=>{this._consumerResumeInProgress=!1,this._pendingResumeConsumers.size>0&&this.resumePendingConsumers()}).catch(()=>{})}closePendingConsumers(){this._consumerCloseInProgress=!0,this._awaitQueue.push(async()=>{if(0===this._pendingCloseConsumers.size)return void m.debug("closePendingConsumers() | there is no Consumer to be closed");const e=Array.from(this._pendingCloseConsumers.values());this._pendingCloseConsumers.clear();try{await this._handler.stopReceiving(e.map(e=>e.localId))}catch(t){m.error("closePendingConsumers() | failed to close Consumers:",t)}},"transport.closePendingConsumers").then(()=>{this._consumerCloseInProgress=!1,this._pendingCloseConsumers.size>0&&this.closePendingConsumers()}).catch(()=>{})}handleHandler(){const e=this._handler;e.on("@connect",({dtlsParameters:e},t,r)=>{this._closed?r(new o.InvalidStateError("closed")):this.safeEmit("connect",{dtlsParameters:e},t,r)}),e.on("@icegatheringstatechange",e=>{e!==this._iceGatheringState&&(m.debug("ICE gathering state changed to %s",e),this._iceGatheringState=e,this._closed||this.safeEmit("icegatheringstatechange",e))}),e.on("@icecandidateerror",e=>{m.warn(`ICE candidate error [url:${e.url}, localAddress:${e.address}, localPort:${e.port}]: ${e.errorCode} "${e.errorText}"`),this.safeEmit("icecandidateerror",e)}),e.on("@connectionstatechange",e=>{e!==this._connectionState&&(m.debug("connection state changed to %s",e),this._connectionState=e,this._closed||this.safeEmit("connectionstatechange",e))})}handleProducer(e){e.on("@close",()=>{this._producers.delete(e.id),this._closed||this._awaitQueue.push(async()=>await this._handler.stopSending(e.localId),"producer @close event").catch(e=>m.warn("producer.close() failed:%o",e))}),e.on("@pause",(t,r)=>{this._awaitQueue.push(async()=>await this._handler.pauseSending(e.localId),"producer @pause event").then(t).catch(r)}),e.on("@resume",(t,r)=>{this._awaitQueue.push(async()=>await this._handler.resumeSending(e.localId),"producer @resume event").then(t).catch(r)}),e.on("@replacetrack",(t,r,n)=>{this._awaitQueue.push(async()=>await this._handler.replaceTrack(e.localId,t),"producer @replacetrack event").then(r).catch(n)}),e.on("@setmaxspatiallayer",(t,r,n)=>{this._awaitQueue.push(async()=>await this._handler.setMaxSpatialLayer(e.localId,t),"producer @setmaxspatiallayer event").then(r).catch(n)}),e.on("@setrtpencodingparameters",(t,r,n)=>{this._awaitQueue.push(async()=>await this._handler.setRtpEncodingParameters(e.localId,t),"producer @setrtpencodingparameters event").then(r).catch(n)}),e.on("@getstats",(t,r)=>{if(this._closed)return r(new o.InvalidStateError("closed"));this._handler.getSenderStats(e.localId).then(t).catch(r)})}handleConsumer(e){e.on("@close",()=>{this._consumers.delete(e.id),this._pendingPauseConsumers.delete(e.id),this._pendingResumeConsumers.delete(e.id),this._closed||(this._pendingCloseConsumers.set(e.id,e),!1===this._consumerCloseInProgress&&this.closePendingConsumers())}),e.on("@pause",()=>{this._pendingResumeConsumers.has(e.id)&&this._pendingResumeConsumers.delete(e.id),this._pendingPauseConsumers.set(e.id,e),queueMicrotask(()=>{this._closed||!1===this._consumerPauseInProgress&&this.pausePendingConsumers()})}),e.on("@resume",()=>{this._pendingPauseConsumers.has(e.id)&&this._pendingPauseConsumers.delete(e.id),this._pendingResumeConsumers.set(e.id,e),queueMicrotask(()=>{this._closed||!1===this._consumerResumeInProgress&&this.resumePendingConsumers()})}),e.on("@getstats",(t,r)=>{if(this._closed)return r(new o.InvalidStateError("closed"));this._handler.getReceiverStats(e.localId).then(t).catch(r)})}handleDataProducer(e){e.on("@close",()=>{this._dataProducers.delete(e.id)})}handleDataConsumer(e){e.on("@close",()=>{this._dataConsumers.delete(e.id)})}}t.Transport=g},5602:e=>{var t=e.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),(t+=null!=e["network-id"]?" network-id %d":"%v")+(null!=e["network-cost"]?" network-cost %d":"%v")}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=null!=e.id?"id=%s %s":"%v%s",t+=null!=e.mediaClockValue?"=%s":"",(t+=null!=e.rateNumerator?" rate=%s":"")+(null!=e.rateDenominator?"/%s":"")}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(t).forEach(function(e){t[e].forEach(function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")})})},5765:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Safari12=void 0;const s=n(7363),i=n(2994),a=n(1765),o=n(8046),c=n(5544),d=n(5938),u=n(4256),l=n(4893),p=n(521),h=n(1305),m=n(3303),f=new i.Logger("Safari12"),g={OS:1024,MIS:1024};class v extends p.HandlerInterface{constructor(){super(),r(this,"_closed",!1),r(this,"_direction"),r(this,"_remoteSdp"),r(this,"_sendingRtpParametersByKind"),r(this,"_sendingRemoteRtpParametersByKind"),r(this,"_forcedLocalDtlsRole"),r(this,"_pc"),r(this,"_mapMidTransceiver",new Map),r(this,"_sendStream",new MediaStream),r(this,"_hasDataChannelMediaSection",!1),r(this,"_nextSendSctpStreamId",0),r(this,"_transportReady",!1)}static createFactory(){return()=>new v}get name(){return"Safari12"}close(){if(f.debug("close()"),!this._closed){if(this._closed=!0,this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}}async getNativeRtpCapabilities(){f.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});try{e.addTransceiver("audio"),e.addTransceiver("video");const r=await e.createOffer();try{e.close()}catch(t){}const n=s.parse(r.sdp),i=c.extractRtpCapabilities({sdpObject:n});return u.addNackSupportForOpus(i),i}catch(r){try{e.close()}catch(t){}throw r}}async getNativeSctpCapabilities(){return f.debug("getNativeSctpCapabilities()"),{numStreams:g}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:s,iceServers:i,iceTransportPolicy:a,additionalSettings:c,proprietaryConstraints:d,extendedRtpCapabilities:u}){this.assertNotClosed(),f.debug("run()"),this._direction=e,this._remoteSdp=new h.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:s}),this._sendingRtpParametersByKind={audio:o.getSendingRtpParameters("audio",u),video:o.getSendingRtpParameters("video",u)},this._sendingRemoteRtpParametersByKind={audio:o.getSendingRemoteRtpParameters("audio",u),video:o.getSendingRemoteRtpParameters("video",u)},n.role&&"auto"!==n.role&&(this._forcedLocalDtlsRole="server"===n.role?"client":"server"),this._pc=new RTCPeerConnection({iceServers:i??[],iceTransportPolicy:a??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...c},d),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",e=>{this.emit("@icecandidateerror",e)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(f.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})}async updateIceServers(e){this.assertNotClosed(),f.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(this.assertNotClosed(),f.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady)if("send"===this._direction){const e=await this._pc.createOffer({iceRestart:!0});f.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();f.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:n,onRtpSender:i}){this.assertNotClosed(),this.assertSendDirection(),f.debug("send() [kind:%s, track.id:%s]",e.kind,e.id);const u=a.clone(this._sendingRtpParametersByKind[e.kind]);u.codecs=o.reduceCodecs(u.codecs,n);const l=a.clone(this._sendingRemoteRtpParametersByKind[e.kind]);l.codecs=o.reduceCodecs(l.codecs,n);const p=this._remoteSdp.getNextMediaSectionIdx(),h=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream]});i&&i(h.sender);let g,v=await this._pc.createOffer(),_=s.parse(v.sdp);_.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed(),this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:_});const y=(0,m.parse)((t??[{}])[0].scalabilityMode);t&&t.length>1&&(f.debug("send() | enabling legacy simulcast"),_=s.parse(v.sdp),g=_.media[p.idx],d.addLegacySimulcast({offerMediaObject:g,numStreams:t.length}),v={type:"offer",sdp:s.write(_)}),f.debug("send() | calling pc.setLocalDescription() [offer:%o]",v),await this._pc.setLocalDescription(v);const b=h.mid;if(u.mid=b,_=s.parse(this._pc.localDescription.sdp),g=_.media[p.idx],u.rtcp.cname=c.getCname({offerMediaObject:g}),u.encodings=d.getRtpEncodings({offerMediaObject:g}),t)for(let s=0;s<u.encodings.length;++s)t[s]&&Object.assign(u.encodings[s],t[s]);if(u.encodings.length>1&&("video/vp8"===u.codecs[0].mimeType.toLowerCase()||"video/h264"===u.codecs[0].mimeType.toLowerCase()))for(const s of u.encodings)s.scalabilityMode?s.scalabilityMode=`L1T${y.temporalLayers}`:s.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:g,reuseMid:p.reuseMid,offerRtpParameters:u,answerRtpParameters:l,codecOptions:r});const w={type:"answer",sdp:this._remoteSdp.getSdp()};return f.debug("send() | calling pc.setRemoteDescription() [answer:%o]",w),await this._pc.setRemoteDescription(w),this._mapMidTransceiver.set(b,h),{localId:b,rtpParameters:u,rtpSender:h.sender}}async stopSending(e){if(this.assertSendDirection(),this._closed)return;f.debug("stopSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");if(t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.closeMediaSection(t.mid))try{t.stop()}catch(s){}const r=await this._pc.createOffer();f.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const n={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n),this._mapMidTransceiver.delete(e)}async pauseSending(e){this.assertNotClosed(),this.assertSendDirection(),f.debug("pauseSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive",this._remoteSdp.pauseMediaSection(e);const r=await this._pc.createOffer();f.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const n={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n)}async resumeSending(e){this.assertNotClosed(),this.assertSendDirection(),f.debug("resumeSending() [localId:%s]",e);const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="sendonly",this._remoteSdp.resumeSendingMediaSection(e);const r=await this._pc.createOffer();f.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const n={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n)}async replaceTrack(e,t){this.assertNotClosed(),this.assertSendDirection(),t?f.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):f.debug("replaceTrack() [localId:%s, no track]",e);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");await r.sender.replaceTrack(t)}async setMaxSpatialLayer(e,t){this.assertNotClosed(),this.assertSendDirection(),f.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const n=r.sender.getParameters();n.encodings.forEach((e,r)=>{e.active=r<=t}),await r.sender.setParameters(n),this._remoteSdp.muxMediaSectionSimulcast(e,n.encodings);const s=await this._pc.createOffer();f.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);const i={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async setRtpEncodingParameters(e,t){this.assertNotClosed(),this.assertSendDirection(),f.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const r=this._mapMidTransceiver.get(e);if(!r)throw new Error("associated RTCRtpTransceiver not found");const n=r.sender.getParameters();n.encodings.forEach((e,r)=>{n.encodings[r]={...e,...t}}),await r.sender.setParameters(n),this._remoteSdp.muxMediaSectionSimulcast(e,n.encodings);const s=await this._pc.createOffer();f.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);const i={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async getSenderStats(e){this.assertNotClosed(),this.assertSendDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:n,protocol:i}){this.assertNotClosed(),this.assertSendDirection();const a={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:r,protocol:i};f.debug("sendDataChannel() [options:%o]",a);const o=this._pc.createDataChannel(n,a);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%g.MIS,!this._hasDataChannelMediaSection){const e=await this._pc.createOffer(),t=s.parse(e.sdp),r=t.media.find(e=>"application"===e.type);this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:t}),f.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:r});const n={type:"answer",sdp:this._remoteSdp.getSdp()};f.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n),this._hasDataChannelMediaSection=!0}return{dataChannel:o,sctpStreamParameters:{streamId:a.id,ordered:a.ordered,maxPacketLifeTime:a.maxPacketLifeTime,maxRetransmits:a.maxRetransmits}}}async receive(e){this.assertNotClosed(),this.assertRecvDirection();const t=[],r=new Map;for(const s of e){const{trackId:e,kind:t,rtpParameters:n,streamId:i}=s;f.debug("receive() [trackId:%s, kind:%s]",e,t);const a=n.mid??String(this._mapMidTransceiver.size);r.set(e,a),this._remoteSdp.receive({mid:a,kind:t,offerRtpParameters:n,streamId:i??n.rtcp.cname,trackId:e})}const n={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",n),await this._pc.setRemoteDescription(n);for(const s of e){const{trackId:e,onRtpReceiver:t}=s;if(t){const n=r.get(e),s=this._pc.getTransceivers().find(e=>e.mid===n);if(!s)throw new Error("transceiver not found");t(s.receiver)}}let i=await this._pc.createAnswer();const a=s.parse(i.sdp);for(const s of e){const{trackId:e,rtpParameters:t}=s,n=r.get(e),i=a.media.find(e=>String(e.mid)===n);c.applyCodecParameters({offerRtpParameters:t,answerMediaObject:i})}i={type:"answer",sdp:s.write(a)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:a}),f.debug("receive() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i);for(const s of e){const{trackId:e}=s,n=r.get(e),i=this._pc.getTransceivers().find(e=>e.mid===n);if(!i)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(n,i),t.push({localId:n,track:i.receiver.track,rtpReceiver:i.receiver})}return t}async stopReceiving(e){if(this.assertRecvDirection(),this._closed)return;for(const n of e){f.debug("stopReceiving() [localId:%s]",n);const e=this._mapMidTransceiver.get(n);if(!e)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(e.mid)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const r=await this._pc.createAnswer();f.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r);for(const n of e)this._mapMidTransceiver.delete(n)}async pauseReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(const n of e){f.debug("pauseReceiving() [localId:%s]",n);const e=this._mapMidTransceiver.get(n);if(!e)throw new Error("associated RTCRtpTransceiver not found");e.direction="inactive",this._remoteSdp.pauseMediaSection(n)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const r=await this._pc.createAnswer();f.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r)}async resumeReceiving(e){this.assertNotClosed(),this.assertRecvDirection();for(const n of e){f.debug("resumeReceiving() [localId:%s]",n);const e=this._mapMidTransceiver.get(n);if(!e)throw new Error("associated RTCRtpTransceiver not found");e.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(n)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const r=await this._pc.createAnswer();f.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r)}async getReceiverStats(e){this.assertNotClosed(),this.assertRecvDirection();const t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:n,ordered:i,maxPacketLifeTime:a,maxRetransmits:o}=e,c={negotiated:!0,id:n,ordered:i,maxPacketLifeTime:a,maxRetransmits:o,protocol:r};f.debug("receiveDataChannel() [options:%o]",c);const d=this._pc.createDataChannel(t,c);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const e={type:"offer",sdp:this._remoteSdp.getSdp()};f.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();if(!this._transportReady){const e=s.parse(t.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:e})}f.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setLocalDescription(t),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=s.parse(this._pc.localDescription.sdp));const r=c.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await new Promise((e,t)=>{this.safeEmit("@connect",{dtlsParameters:r},e,t)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new l.InvalidStateError("method called in a closed handler")}assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}t.Safari12=v},5862:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FakeEventTarget=void 0,t.FakeEventTarget=class{constructor(){r(this,"listeners",{})}addEventListener(e,t,r={}){var n;t&&((n=this.listeners)[e]??(n[e]=[]),this.listeners[e].push({callback:t,once:!0===r.once}))}removeEventListener(e,t){this.listeners[e]&&(this.listeners[e]=this.listeners[e].filter(e=>e.callback!==t))}dispatchEvent(e){if(!e||"string"!=typeof e.type)throw new Error("invalid event object");const t=this.listeners[e.type];if(!t)return!0;for(const n of[...t]){try{n.callback.call(this,e)}catch(r){setTimeout(()=>{throw r},0)}n.once&&this.removeEventListener(e.type,n.callback)}return!e.defaultPrevented}}},5869:(e,t,r)=>{var n=r(887);e.exports=function(e,t,r,s,i){var a=n(e,t,r,s,i);return a.next().then(function(e){return e.done?e.value:a.next()})},e.exports.__esModule=!0,e.exports.default=e.exports},5938:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getRtpEncodings=function({offerMediaObject:e}){const t=new Set;for(const s of e.ssrcs??[]){const e=s.id;t.add(e)}if(0===t.size)throw new Error("no a=ssrc lines found");const r=new Map;for(const s of e.ssrcGroups??[]){if("FID"!==s.semantics)continue;let[e,n]=s.ssrcs.split(/\s+/);e=Number(e),n=Number(n),t.has(e)&&(t.delete(e),t.delete(n),r.set(e,n))}for(const s of t)r.set(s,null);const n=[];for(const[s,i]of r){const e={ssrc:s};i&&(e.rtx={ssrc:i}),n.push(e)}return n},t.addLegacySimulcast=function({offerMediaObject:e,numStreams:t}){if(t<=1)throw new TypeError("numStreams must be greater than 1");const r=(e.ssrcs??[]).find(e=>"msid"===e.attribute);if(!r)throw new Error("a=ssrc line with msid information not found");const[n,s]=r.value.split(" "),i=Number(r.id);let a;(e.ssrcGroups??[]).some(e=>{if("FID"!==e.semantics)return!1;const t=e.ssrcs.split(/\s+/);return Number(t[0])===i&&(a=Number(t[1]),!0)});const o=e.ssrcs.find(e=>"cname"===e.attribute);if(!o)throw new Error("a=ssrc line with cname information not found");const c=o.value,d=[],u=[];for(let l=0;l<t;++l)d.push(i+l),a&&u.push(a+l);e.ssrcGroups=[],e.ssrcs=[],e.ssrcGroups.push({semantics:"SIM",ssrcs:d.join(" ")});for(const l of d)e.ssrcs.push({id:l,attribute:"cname",value:c}),e.ssrcs.push({id:l,attribute:"msid",value:`${n} ${s}`});for(let l=0;l<u.length;++l){const t=d[l],r=u[l];e.ssrcs.push({id:r,attribute:"cname",value:c}),e.ssrcs.push({id:r,attribute:"msid",value:`${n} ${s}`}),e.ssrcGroups.push({semantics:"FID",ssrcs:`${t} ${r}`})}}},5953:function(e,t,r){var n;e.exports=(n=r(9021),r(3240),function(e){var t=n,r=t.lib,s=r.WordArray,i=r.Hasher,a=t.x64.Word,o=t.algo,c=[],d=[],u=[];!function(){for(var e=1,t=0,r=0;r<24;r++){c[e+5*t]=(r+1)*(r+2)/2%64;var n=(2*e+3*t)%5;e=t%5,t=n}for(e=0;e<5;e++)for(t=0;t<5;t++)d[e+5*t]=t+(2*e+3*t)%5*5;for(var s=1,i=0;i<24;i++){for(var o=0,l=0,p=0;p<7;p++){if(1&s){var h=(1<<p)-1;h<32?l^=1<<h:o^=1<<h-32}128&s?s=s<<1^113:s<<=1}u[i]=a.create(o,l)}}();var l=[];!function(){for(var e=0;e<25;e++)l[e]=a.create()}();var p=o.SHA3=i.extend({cfg:i.cfg.extend({outputLength:512}),_doReset:function(){for(var e=this._state=[],t=0;t<25;t++)e[t]=new a.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(e,t){for(var r=this._state,n=this.blockSize/2,s=0;s<n;s++){var i=e[t+2*s],a=e[t+2*s+1];i=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),a=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),(P=r[s]).high^=a,P.low^=i}for(var o=0;o<24;o++){for(var p=0;p<5;p++){for(var h=0,m=0,f=0;f<5;f++)h^=(P=r[p+5*f]).high,m^=P.low;var g=l[p];g.high=h,g.low=m}for(p=0;p<5;p++){var v=l[(p+4)%5],_=l[(p+1)%5],y=_.high,b=_.low;for(h=v.high^(y<<1|b>>>31),m=v.low^(b<<1|y>>>31),f=0;f<5;f++)(P=r[p+5*f]).high^=h,P.low^=m}for(var w=1;w<25;w++){var S=(P=r[w]).high,R=P.low,k=c[w];k<32?(h=S<<k|R>>>32-k,m=R<<k|S>>>32-k):(h=R<<k-32|S>>>64-k,m=S<<k-32|R>>>64-k);var E=l[d[w]];E.high=h,E.low=m}var T=l[0],C=r[0];for(T.high=C.high,T.low=C.low,p=0;p<5;p++)for(f=0;f<5;f++){var P=r[w=p+5*f],O=l[w],x=l[(p+1)%5+5*f],D=l[(p+2)%5+5*f];P.high=O.high^~x.high&D.high,P.low=O.low^~x.low&D.low}P=r[0];var I=u[o];P.high^=I.high,P.low^=I.low}},_doFinalize:function(){var t=this._data,r=t.words,n=(this._nDataBytes,8*t.sigBytes),i=32*this.blockSize;r[n>>>5]|=1<<24-n%32,r[(e.ceil((n+1)/i)*i>>>5)-1]|=128,t.sigBytes=4*r.length,this._process();for(var a=this._state,o=this.cfg.outputLength/8,c=o/8,d=[],u=0;u<c;u++){var l=a[u],p=l.high,h=l.low;p=16711935&(p<<8|p>>>24)|4278255360&(p<<24|p>>>8),h=16711935&(h<<8|h>>>24)|4278255360&(h<<24|h>>>8),d.push(h),d.push(p)}return new s.init(d,o)},clone:function(){for(var e=i.clone.call(this),t=e._state=this._state.slice(0),r=0;r<25;r++)t[r]=t[r].clone();return e}});t.SHA3=i._createHelper(p),t.HmacSHA3=i._createHmacHelper(p)}(Math),n.SHA3)},6004:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Device=void 0,t.detectDevice=k;const s=n(2109),i=n(2994),a=n(3953),o=n(4893),c=n(1765),d=n(8046),u=n(5601),l=n(2183),p=n(11),h=n(5535),m=n(8155),f=n(7402),g=n(2292),v=n(1767),_=n(5765),y=n(9676),b=n(8633),w=n(4039),S=n(9352),R=new i.Logger("Device");function k(e){var t,r,n,i;if(!e&&"object"==typeof navigator&&"ReactNative"===navigator.product)return R.debug("detectDevice() | React-Native detected"),"undefined"==typeof RTCPeerConnection?void R.warn("detectDevice() | unsupported react-native-webrtc without RTCPeerConnection, forgot to call registerGlobals()?"):"undefined"!=typeof RTCRtpTransceiver?(R.debug("detectDevice() | ReactNative UnifiedPlan handler chosen"),"ReactNativeUnifiedPlan"):(R.debug("detectDevice() | ReactNative PlanB handler chosen"),"ReactNative");if(e||"object"==typeof navigator&&"string"==typeof navigator.userAgent){e??(e=navigator.userAgent);const a=new s.UAParser(e);R.debug("detectDevice() | browser detected [userAgent:%s, parsed:%o]",e,a.getResult());const o=a.getBrowser(),c=null==(t=o.name)?void 0:t.toLowerCase(),d=parseInt(o.major??"0"),u=null==(r=a.getEngine().name)?void 0:r.toLowerCase(),l=a.getOS(),p=null==(n=l.name)?void 0:n.toLowerCase(),h=parseFloat(l.version??"0"),m=null==(i=a.getDevice().model)?void 0:i.toLowerCase(),f="ios"===p||"ipad"===m,g=c&&["chrome","chromium","mobile chrome","chrome webview","chrome headless"].includes(c),v=c&&["firefox","mobile firefox","mobile focus"].includes(c),_=c&&["safari","mobile safari"].includes(c),y=c&&["edge"].includes(c);if((g||y)&&!f&&d>=111)return"Chrome111";if(g&&!f&&d>=74||y&&!f&&d>=88)return"Chrome74";if(g&&!f&&d>=70)return"Chrome70";if(g&&!f&&d>=67)return"Chrome67";if(g&&!f&&d>=55)return"Chrome55";if(v&&!f&&d>=120)return"Firefox120";if(v&&!f&&d>=60)return"Firefox60";if(v&&f&&h>=14.3)return"Safari12";if(_&&d>=12&&"undefined"!=typeof RTCRtpTransceiver&&RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection"))return"Safari12";if(_&&d>=11)return"Safari11";if(y&&!f&&d>=11&&d<=18)return"Edge11";if("webkit"===u&&f&&"undefined"!=typeof RTCRtpTransceiver&&RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection"))return"Safari12";if("blink"===u){const t=e.match(/(?:(?:Chrome|Chromium))[ /](\w+)/i);if(t){const e=Number(t[1]);return e>=111?"Chrome111":e>=74?"Chrome74":e>=70?"Chrome70":e>=67?"Chrome67":"Chrome55"}return"Chrome111"}return void R.warn("detectDevice() | browser not supported [name:%s, version:%s]",c,d)}R.warn("detectDevice() | unknown device")}t.Device=class{constructor({handlerName:e,handlerFactory:t}={}){if(r(this,"_handlerFactory"),r(this,"_handlerName"),r(this,"_loaded",!1),r(this,"_extendedRtpCapabilities"),r(this,"_recvRtpCapabilities"),r(this,"_canProduceByKind"),r(this,"_sctpCapabilities"),r(this,"_observer",new a.EnhancedEventEmitter),R.debug("constructor()"),e&&t)throw new TypeError("just one of handlerName or handlerInterface can be given");if(t)this._handlerFactory=t;else{if(e)R.debug("constructor() | handler given: %s",e);else{if(!(e=k()))throw new o.UnsupportedError("device not supported");R.debug("constructor() | detected handler: %s",e)}switch(e){case"Chrome111":this._handlerFactory=l.Chrome111.createFactory();break;case"Chrome74":this._handlerFactory=p.Chrome74.createFactory();break;case"Chrome70":this._handlerFactory=h.Chrome70.createFactory();break;case"Chrome67":this._handlerFactory=m.Chrome67.createFactory();break;case"Chrome55":this._handlerFactory=f.Chrome55.createFactory();break;case"Firefox120":this._handlerFactory=g.Firefox120.createFactory();break;case"Firefox60":this._handlerFactory=v.Firefox60.createFactory();break;case"Safari12":this._handlerFactory=_.Safari12.createFactory();break;case"Safari11":this._handlerFactory=y.Safari11.createFactory();break;case"Edge11":this._handlerFactory=b.Edge11.createFactory();break;case"ReactNativeUnifiedPlan":this._handlerFactory=w.ReactNativeUnifiedPlan.createFactory();break;case"ReactNative":this._handlerFactory=S.ReactNative.createFactory();break;default:throw new TypeError(`unknown handlerName "${e}"`)}}const n=this._handlerFactory();this._handlerName=n.name,n.close(),this._extendedRtpCapabilities=void 0,this._recvRtpCapabilities=void 0,this._canProduceByKind={audio:!1,video:!1},this._sctpCapabilities=void 0}get handlerName(){return this._handlerName}get loaded(){return this._loaded}get rtpCapabilities(){if(!this._loaded)throw new o.InvalidStateError("not loaded");return this._recvRtpCapabilities}get sctpCapabilities(){if(!this._loaded)throw new o.InvalidStateError("not loaded");return this._sctpCapabilities}get observer(){return this._observer}async load({routerRtpCapabilities:e}){let t;R.debug("load() [routerRtpCapabilities:%o]",e);try{if(this._loaded)throw new o.InvalidStateError("already loaded");const r=c.clone(e);d.validateRtpCapabilities(r),t=this._handlerFactory();const n=await t.getNativeRtpCapabilities();R.debug("load() | got native RTP capabilities:%o",n);const s=c.clone(n);d.validateRtpCapabilities(s),this._extendedRtpCapabilities=d.getExtendedRtpCapabilities(s,r),R.debug("load() | got extended RTP capabilities:%o",this._extendedRtpCapabilities),this._canProduceByKind.audio=d.canSend("audio",this._extendedRtpCapabilities),this._canProduceByKind.video=d.canSend("video",this._extendedRtpCapabilities),this._recvRtpCapabilities=d.getRecvRtpCapabilities(this._extendedRtpCapabilities),d.validateRtpCapabilities(this._recvRtpCapabilities),R.debug("load() | got receiving RTP capabilities:%o",this._recvRtpCapabilities),this._sctpCapabilities=await t.getNativeSctpCapabilities(),R.debug("load() | got native SCTP capabilities:%o",this._sctpCapabilities),d.validateSctpCapabilities(this._sctpCapabilities),R.debug("load() succeeded"),this._loaded=!0,t.close()}catch(r){throw t&&t.close(),r}}canProduce(e){if(!this._loaded)throw new o.InvalidStateError("not loaded");if("audio"!==e&&"video"!==e)throw new TypeError(`invalid kind "${e}"`);return this._canProduceByKind[e]}createSendTransport({id:e,iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:s,iceServers:i,iceTransportPolicy:a,additionalSettings:o,proprietaryConstraints:c,appData:d}){return R.debug("createSendTransport()"),this.createTransport({direction:"send",id:e,iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:s,iceServers:i,iceTransportPolicy:a,additionalSettings:o,proprietaryConstraints:c,appData:d})}createRecvTransport({id:e,iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:s,iceServers:i,iceTransportPolicy:a,additionalSettings:o,proprietaryConstraints:c,appData:d}){return R.debug("createRecvTransport()"),this.createTransport({direction:"recv",id:e,iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:s,iceServers:i,iceTransportPolicy:a,additionalSettings:o,proprietaryConstraints:c,appData:d})}createTransport({direction:e,id:t,iceParameters:r,iceCandidates:n,dtlsParameters:s,sctpParameters:i,iceServers:a,iceTransportPolicy:c,additionalSettings:d,proprietaryConstraints:l,appData:p}){if(!this._loaded)throw new o.InvalidStateError("not loaded");if("string"!=typeof t)throw new TypeError("missing id");if("object"!=typeof r)throw new TypeError("missing iceParameters");if(!Array.isArray(n))throw new TypeError("missing iceCandidates");if("object"!=typeof s)throw new TypeError("missing dtlsParameters");if(i&&"object"!=typeof i)throw new TypeError("wrong sctpParameters");if(p&&"object"!=typeof p)throw new TypeError("if given, appData must be an object");const h=new u.Transport({direction:e,id:t,iceParameters:r,iceCandidates:n,dtlsParameters:s,sctpParameters:i,iceServers:a,iceTransportPolicy:c,additionalSettings:d,proprietaryConstraints:l,appData:p,handlerFactory:this._handlerFactory,extendedRtpCapabilities:this._extendedRtpCapabilities,canProduceByKind:this._canProduceByKind});return this._observer.safeEmit("newtransport",h),h}}},6011:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.unsafeStringify=void 0;const n=r(9746),s=[];for(let a=0;a<256;++a)s.push((a+256).toString(16).slice(1));function i(e,t=0){return(s[e[t+0]]+s[e[t+1]]+s[e[t+2]]+s[e[t+3]]+"-"+s[e[t+4]]+s[e[t+5]]+"-"+s[e[t+6]]+s[e[t+7]]+"-"+s[e[t+8]]+s[e[t+9]]+"-"+s[e[t+10]]+s[e[t+11]]+s[e[t+12]]+s[e[t+13]]+s[e[t+14]]+s[e[t+15]]).toLowerCase()}t.unsafeStringify=i,t.default=function(e,t=0){const r=i(e,t);if(!(0,n.default)(r))throw TypeError("Stringified UUID is invalid");return r}},6298:function(e,t,r){var n;e.exports=(n=r(9021),r(754),r(4636),r(9506),r(7165),function(){var e=n,t=e.lib.StreamCipher,r=e.algo,s=[],i=[],a=[],o=r.Rabbit=t.extend({_doReset:function(){for(var e=this._key.words,t=this.cfg.iv,r=0;r<4;r++)e[r]=16711935&(e[r]<<8|e[r]>>>24)|4278255360&(e[r]<<24|e[r]>>>8);var n=this._X=[e[0],e[3]<<16|e[2]>>>16,e[1],e[0]<<16|e[3]>>>16,e[2],e[1]<<16|e[0]>>>16,e[3],e[2]<<16|e[1]>>>16],s=this._C=[e[2]<<16|e[2]>>>16,4294901760&e[0]|65535&e[1],e[3]<<16|e[3]>>>16,4294901760&e[1]|65535&e[2],e[0]<<16|e[0]>>>16,4294901760&e[2]|65535&e[3],e[1]<<16|e[1]>>>16,4294901760&e[3]|65535&e[0]];for(this._b=0,r=0;r<4;r++)c.call(this);for(r=0;r<8;r++)s[r]^=n[r+4&7];if(t){var i=t.words,a=i[0],o=i[1],d=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),u=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),l=d>>>16|4294901760&u,p=u<<16|65535&d;for(s[0]^=d,s[1]^=l,s[2]^=u,s[3]^=p,s[4]^=d,s[5]^=l,s[6]^=u,s[7]^=p,r=0;r<4;r++)c.call(this)}},_doProcessBlock:function(e,t){var r=this._X;c.call(this),s[0]=r[0]^r[5]>>>16^r[3]<<16,s[1]=r[2]^r[7]>>>16^r[5]<<16,s[2]=r[4]^r[1]>>>16^r[7]<<16,s[3]=r[6]^r[3]>>>16^r[1]<<16;for(var n=0;n<4;n++)s[n]=16711935&(s[n]<<8|s[n]>>>24)|4278255360&(s[n]<<24|s[n]>>>8),e[t+n]^=s[n]},blockSize:4,ivSize:2});function c(){for(var e=this._X,t=this._C,r=0;r<8;r++)i[r]=t[r];for(t[0]=t[0]+1295307597+this._b|0,t[1]=t[1]+3545052371+(t[0]>>>0<i[0]>>>0?1:0)|0,t[2]=t[2]+886263092+(t[1]>>>0<i[1]>>>0?1:0)|0,t[3]=t[3]+1295307597+(t[2]>>>0<i[2]>>>0?1:0)|0,t[4]=t[4]+3545052371+(t[3]>>>0<i[3]>>>0?1:0)|0,t[5]=t[5]+886263092+(t[4]>>>0<i[4]>>>0?1:0)|0,t[6]=t[6]+1295307597+(t[5]>>>0<i[5]>>>0?1:0)|0,t[7]=t[7]+3545052371+(t[6]>>>0<i[6]>>>0?1:0)|0,this._b=t[7]>>>0<i[7]>>>0?1:0,r=0;r<8;r++){var n=e[r]+t[r],s=65535&n,o=n>>>16,c=((s*s>>>17)+s*o>>>15)+o*o,d=((4294901760&n)*n|0)+((65535&n)*n|0);a[r]=c^d}e[0]=a[0]+(a[7]<<16|a[7]>>>16)+(a[6]<<16|a[6]>>>16)|0,e[1]=a[1]+(a[0]<<8|a[0]>>>24)+a[7]|0,e[2]=a[2]+(a[1]<<16|a[1]>>>16)+(a[0]<<16|a[0]>>>16)|0,e[3]=a[3]+(a[2]<<8|a[2]>>>24)+a[1]|0,e[4]=a[4]+(a[3]<<16|a[3]>>>16)+(a[2]<<16|a[2]>>>16)|0,e[5]=a[5]+(a[4]<<8|a[4]>>>24)+a[3]|0,e[6]=a[6]+(a[5]<<16|a[5]>>>16)+(a[4]<<16|a[4]>>>16)|0,e[7]=a[7]+(a[6]<<8|a[6]>>>24)+a[5]|0}e.Rabbit=t._createHelper(o)}(),n.Rabbit)},6308:function(e,t,r){var n,s,i,a,o,c;e.exports=(c=r(9021),r(3009),s=(n=c).lib.WordArray,i=n.algo,a=i.SHA256,o=i.SHA224=a.extend({_doReset:function(){this._hash=new s.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var e=a._doFinalize.call(this);return e.sigBytes-=4,e}}),n.SHA224=a._createHelper(o),n.HmacSHA224=a._createHmacHelper(o),c.SHA224)},6356:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=r(6011),s=r(1425),i=r(6568);t.default=function(e,t,r){e??(e={}),r??(r=0);let a=(0,s.default)({...e,_v6:!0},new Uint8Array(16));if(a=(0,i.default)(a),t){for(let e=0;e<16;e++)t[r+e]=a[e];return t}return(0,n.unsafeStringify)(a)}},6372:function(e,t,r){var n;e.exports=(n=r(9021),r(7165),n.mode.CTRGladman=function(){var e=n.lib.BlockCipherMode.extend();function t(e){if(255&~(e>>24))e+=1<<24;else{var t=e>>16&255,r=e>>8&255,n=255&e;255===t?(t=0,255===r?(r=0,255===n?n=0:++n):++r):++t,e=0,e+=t<<16,e+=r<<8,e+=n}return e}var r=e.Encryptor=e.extend({processBlock:function(e,r){var n=this._cipher,s=n.blockSize,i=this._iv,a=this._counter;i&&(a=this._counter=i.slice(0),this._iv=void 0),function(e){0===(e[0]=t(e[0]))&&(e[1]=t(e[1]))}(a);var o=a.slice(0);n.encryptBlock(o,0);for(var c=0;c<s;c++)e[r+c]^=o[c]}});return e.Decryptor=r,e}(),n.mode.CTRGladman)},6440:function(e,t,r){var n;e.exports=(n=r(9021),function(){if("function"==typeof ArrayBuffer){var e=n.lib.WordArray,t=e.init,r=e.init=function(e){if(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),(e instanceof Int8Array||"undefined"!=typeof Uint8ClampedArray&&e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array)&&(e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength)),e instanceof Uint8Array){for(var r=e.byteLength,n=[],s=0;s<r;s++)n[s>>>2]|=e[s]<<24-s%4*8;t.call(this,n,r)}else t.apply(this,arguments)};r.prototype=e}}(),n.lib.WordArray)},6568:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=r(1797),s=r(6011);t.default=function(e){const t=(r="string"==typeof e?(0,n.default)(e):e,Uint8Array.of((15&r[6])<<4|r[7]>>4&15,(15&r[7])<<4|(240&r[4])>>4,(15&r[4])<<4|(240&r[5])>>4,(15&r[5])<<4|(240&r[0])>>4,(15&r[0])<<4|(240&r[1])>>4,(15&r[1])<<4|(240&r[2])>>4,96|15&r[2],r[3],r[8],r[9],r[10],r[11],r[12],r[13],r[14],r[15]));var r;return"string"==typeof e?(0,s.unsafeStringify)(t):t}},6585:e=>{var t=1e3,r=6e4,n=60*r,s=24*n,i=7*s;function a(e,t,r,n){var s=t>=1.5*r;return Math.round(e/r)+" "+n+(s?"s":"")}e.exports=function(e,o){o=o||{};var c,d,u=typeof e;if("string"===u&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var a=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(a){var o=parseFloat(a[1]);switch((a[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*o;case"weeks":case"week":case"w":return o*i;case"days":case"day":case"d":return o*s;case"hours":case"hour":case"hrs":case"hr":case"h":return o*n;case"minutes":case"minute":case"mins":case"min":case"m":return o*r;case"seconds":case"second":case"secs":case"sec":case"s":return o*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return o;default:return}}}}(e);if("number"===u&&isFinite(e))return o.long?(c=e,(d=Math.abs(c))>=s?a(c,d,s,"day"):d>=n?a(c,d,n,"hour"):d>=r?a(c,d,r,"minute"):d>=t?a(c,d,t,"second"):c+" ms"):function(e){var i=Math.abs(e);return i>=s?Math.round(e/s)+"d":i>=n?Math.round(e/n)+"h":i>=r?Math.round(e/r)+"m":i>=t?Math.round(e/t)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},6697:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i},6746:(e,t,r)=>{r.d(t,{KS:()=>s,fo:()=>n});var n=Object.freeze({SetKey:"setKey",RatchetRequest:"ratchetRequest",KeyRatcheted:"keyRatcheted"}),s=Object.freeze({ParticipantEncryptionStatusChanged:"participantEncryptionStatusChanged",EncryptionError:"encryptionError",E2EEStateChange:"e2eeStateChange"})},6880:function(e){e.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var s=t[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,r),s.l=!0,s.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)r.d(n,s,function(t){return e[t]}.bind(null,s));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=90)}({17:function(e,t,r){t.__esModule=!0,t.default=void 0;var n=r(18),s=function(){function e(){}return e.getFirstMatch=function(e,t){var r=t.match(e);return r&&r.length>0&&r[1]||""},e.getSecondMatch=function(e,t){var r=t.match(e);return r&&r.length>1&&r[2]||""},e.matchAndReturnConst=function(e,t,r){if(e.test(t))return r},e.getWindowsVersionName=function(e){switch(e){case"NT":return"NT";case"XP":case"NT 5.1":return"XP";case"NT 5.0":return"2000";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}},e.getMacOSVersionName=function(e){var t=e.split(".").splice(0,2).map(function(e){return parseInt(e,10)||0});if(t.push(0),10===t[0])switch(t[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}},e.getAndroidVersionName=function(e){var t=e.split(".").splice(0,2).map(function(e){return parseInt(e,10)||0});if(t.push(0),!(1===t[0]&&t[1]<5))return 1===t[0]&&t[1]<6?"Cupcake":1===t[0]&&t[1]>=6?"Donut":2===t[0]&&t[1]<2?"Eclair":2===t[0]&&2===t[1]?"Froyo":2===t[0]&&t[1]>2?"Gingerbread":3===t[0]?"Honeycomb":4===t[0]&&t[1]<1?"Ice Cream Sandwich":4===t[0]&&t[1]<4?"Jelly Bean":4===t[0]&&t[1]>=4?"KitKat":5===t[0]?"Lollipop":6===t[0]?"Marshmallow":7===t[0]?"Nougat":8===t[0]?"Oreo":9===t[0]?"Pie":void 0},e.getVersionPrecision=function(e){return e.split(".").length},e.compareVersions=function(t,r,n){void 0===n&&(n=!1);var s=e.getVersionPrecision(t),i=e.getVersionPrecision(r),a=Math.max(s,i),o=0,c=e.map([t,r],function(t){var r=a-e.getVersionPrecision(t),n=t+new Array(r+1).join(".0");return e.map(n.split("."),function(e){return new Array(20-e.length).join("0")+e}).reverse()});for(n&&(o=a-Math.min(s,i)),a-=1;a>=o;){if(c[0][a]>c[1][a])return 1;if(c[0][a]===c[1][a]){if(a===o)return 0;a-=1}else if(c[0][a]<c[1][a])return-1}},e.map=function(e,t){var r,n=[];if(Array.prototype.map)return Array.prototype.map.call(e,t);for(r=0;r<e.length;r+=1)n.push(t(e[r]));return n},e.find=function(e,t){var r,n;if(Array.prototype.find)return Array.prototype.find.call(e,t);for(r=0,n=e.length;r<n;r+=1){var s=e[r];if(t(s,r))return s}},e.assign=function(e){for(var t,r,n=e,s=arguments.length,i=new Array(s>1?s-1:0),a=1;a<s;a++)i[a-1]=arguments[a];if(Object.assign)return Object.assign.apply(Object,[e].concat(i));var o=function(){var e=i[t];"object"==typeof e&&null!==e&&Object.keys(e).forEach(function(t){n[t]=e[t]})};for(t=0,r=i.length;t<r;t+=1)o();return e},e.getBrowserAlias=function(e){return n.BROWSER_ALIASES_MAP[e]},e.getBrowserTypeByAlias=function(e){return n.BROWSER_MAP[e]||""},e}();t.default=s,e.exports=t.default},18:function(e,t,r){t.__esModule=!0,t.ENGINE_MAP=t.OS_MAP=t.PLATFORMS_MAP=t.BROWSER_MAP=t.BROWSER_ALIASES_MAP=void 0,t.BROWSER_ALIASES_MAP={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},t.BROWSER_MAP={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},t.PLATFORMS_MAP={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},t.OS_MAP={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},t.ENGINE_MAP={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"}},90:function(e,t,r){t.__esModule=!0,t.default=void 0;var n,s=(n=r(91))&&n.__esModule?n:{default:n},i=r(18);function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var o=function(){function e(){}var t,r;return e.getParser=function(e,t){if(void 0===t&&(t=!1),"string"!=typeof e)throw new Error("UserAgent should be a string");return new s.default(e,t)},e.parse=function(e){return new s.default(e).getResult()},t=e,(r=[{key:"BROWSER_MAP",get:function(){return i.BROWSER_MAP}},{key:"ENGINE_MAP",get:function(){return i.ENGINE_MAP}},{key:"OS_MAP",get:function(){return i.OS_MAP}},{key:"PLATFORMS_MAP",get:function(){return i.PLATFORMS_MAP}}])&&a(t,r),e}();t.default=o,e.exports=t.default},91:function(e,t,r){t.__esModule=!0,t.default=void 0;var n=c(r(92)),s=c(r(93)),i=c(r(94)),a=c(r(95)),o=c(r(17));function c(e){return e&&e.__esModule?e:{default:e}}var d=function(){function e(e,t){if(void 0===t&&(t=!1),null==e||""===e)throw new Error("UserAgent parameter can't be empty");this._ua=e,this.parsedResult={},!0!==t&&this.parse()}var t=e.prototype;return t.getUA=function(){return this._ua},t.test=function(e){return e.test(this._ua)},t.parseBrowser=function(){var e=this;this.parsedResult.browser={};var t=o.default.find(n.default,function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some(function(t){return e.test(t)});throw new Error("Browser's test function is not valid")});return t&&(this.parsedResult.browser=t.describe(this.getUA())),this.parsedResult.browser},t.getBrowser=function(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()},t.getBrowserName=function(e){return e?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""},t.getBrowserVersion=function(){return this.getBrowser().version},t.getOS=function(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()},t.parseOS=function(){var e=this;this.parsedResult.os={};var t=o.default.find(s.default,function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some(function(t){return e.test(t)});throw new Error("Browser's test function is not valid")});return t&&(this.parsedResult.os=t.describe(this.getUA())),this.parsedResult.os},t.getOSName=function(e){var t=this.getOS().name;return e?String(t).toLowerCase()||"":t||""},t.getOSVersion=function(){return this.getOS().version},t.getPlatform=function(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()},t.getPlatformType=function(e){void 0===e&&(e=!1);var t=this.getPlatform().type;return e?String(t).toLowerCase()||"":t||""},t.parsePlatform=function(){var e=this;this.parsedResult.platform={};var t=o.default.find(i.default,function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some(function(t){return e.test(t)});throw new Error("Browser's test function is not valid")});return t&&(this.parsedResult.platform=t.describe(this.getUA())),this.parsedResult.platform},t.getEngine=function(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()},t.getEngineName=function(e){return e?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""},t.parseEngine=function(){var e=this;this.parsedResult.engine={};var t=o.default.find(a.default,function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some(function(t){return e.test(t)});throw new Error("Browser's test function is not valid")});return t&&(this.parsedResult.engine=t.describe(this.getUA())),this.parsedResult.engine},t.parse=function(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this},t.getResult=function(){return o.default.assign({},this.parsedResult)},t.satisfies=function(e){var t=this,r={},n=0,s={},i=0;if(Object.keys(e).forEach(function(t){var a=e[t];"string"==typeof a?(s[t]=a,i+=1):"object"==typeof a&&(r[t]=a,n+=1)}),n>0){var a=Object.keys(r),c=o.default.find(a,function(e){return t.isOS(e)});if(c){var d=this.satisfies(r[c]);if(void 0!==d)return d}var u=o.default.find(a,function(e){return t.isPlatform(e)});if(u){var l=this.satisfies(r[u]);if(void 0!==l)return l}}if(i>0){var p=Object.keys(s),h=o.default.find(p,function(e){return t.isBrowser(e,!0)});if(void 0!==h)return this.compareVersion(s[h])}},t.isBrowser=function(e,t){void 0===t&&(t=!1);var r=this.getBrowserName().toLowerCase(),n=e.toLowerCase(),s=o.default.getBrowserTypeByAlias(n);return t&&s&&(n=s.toLowerCase()),n===r},t.compareVersion=function(e){var t=[0],r=e,n=!1,s=this.getBrowserVersion();if("string"==typeof s)return">"===e[0]||"<"===e[0]?(r=e.substr(1),"="===e[1]?(n=!0,r=e.substr(2)):t=[],">"===e[0]?t.push(1):t.push(-1)):"="===e[0]?r=e.substr(1):"~"===e[0]&&(n=!0,r=e.substr(1)),t.indexOf(o.default.compareVersions(s,r,n))>-1},t.isOS=function(e){return this.getOSName(!0)===String(e).toLowerCase()},t.isPlatform=function(e){return this.getPlatformType(!0)===String(e).toLowerCase()},t.isEngine=function(e){return this.getEngineName(!0)===String(e).toLowerCase()},t.is=function(e,t){return void 0===t&&(t=!1),this.isBrowser(e,t)||this.isOS(e)||this.isPlatform(e)},t.some=function(e){var t=this;return void 0===e&&(e=[]),e.some(function(e){return t.is(e)})},e}();t.default=d,e.exports=t.default},92:function(e,t,r){t.__esModule=!0,t.default=void 0;var n,s=(n=r(17))&&n.__esModule?n:{default:n},i=/version\/(\d+(\.?_?\d+)+)/i,a=[{test:[/googlebot/i],describe:function(e){var t={name:"Googlebot"},r=s.default.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,e)||s.default.getFirstMatch(i,e);return r&&(t.version=r),t}},{test:[/opera/i],describe:function(e){var t={name:"Opera"},r=s.default.getFirstMatch(i,e)||s.default.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/opr\/|opios/i],describe:function(e){var t={name:"Opera"},r=s.default.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,e)||s.default.getFirstMatch(i,e);return r&&(t.version=r),t}},{test:[/SamsungBrowser/i],describe:function(e){var t={name:"Samsung Internet for Android"},r=s.default.getFirstMatch(i,e)||s.default.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/Whale/i],describe:function(e){var t={name:"NAVER Whale Browser"},r=s.default.getFirstMatch(i,e)||s.default.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/MZBrowser/i],describe:function(e){var t={name:"MZ Browser"},r=s.default.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,e)||s.default.getFirstMatch(i,e);return r&&(t.version=r),t}},{test:[/focus/i],describe:function(e){var t={name:"Focus"},r=s.default.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,e)||s.default.getFirstMatch(i,e);return r&&(t.version=r),t}},{test:[/swing/i],describe:function(e){var t={name:"Swing"},r=s.default.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,e)||s.default.getFirstMatch(i,e);return r&&(t.version=r),t}},{test:[/coast/i],describe:function(e){var t={name:"Opera Coast"},r=s.default.getFirstMatch(i,e)||s.default.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe:function(e){var t={name:"Opera Touch"},r=s.default.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,e)||s.default.getFirstMatch(i,e);return r&&(t.version=r),t}},{test:[/yabrowser/i],describe:function(e){var t={name:"Yandex Browser"},r=s.default.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,e)||s.default.getFirstMatch(i,e);return r&&(t.version=r),t}},{test:[/ucbrowser/i],describe:function(e){var t={name:"UC Browser"},r=s.default.getFirstMatch(i,e)||s.default.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/Maxthon|mxios/i],describe:function(e){var t={name:"Maxthon"},r=s.default.getFirstMatch(i,e)||s.default.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/epiphany/i],describe:function(e){var t={name:"Epiphany"},r=s.default.getFirstMatch(i,e)||s.default.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/puffin/i],describe:function(e){var t={name:"Puffin"},r=s.default.getFirstMatch(i,e)||s.default.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/sleipnir/i],describe:function(e){var t={name:"Sleipnir"},r=s.default.getFirstMatch(i,e)||s.default.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/k-meleon/i],describe:function(e){var t={name:"K-Meleon"},r=s.default.getFirstMatch(i,e)||s.default.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/micromessenger/i],describe:function(e){var t={name:"WeChat"},r=s.default.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,e)||s.default.getFirstMatch(i,e);return r&&(t.version=r),t}},{test:[/qqbrowser/i],describe:function(e){var t={name:/qqbrowserlite/i.test(e)?"QQ Browser Lite":"QQ Browser"},r=s.default.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,e)||s.default.getFirstMatch(i,e);return r&&(t.version=r),t}},{test:[/msie|trident/i],describe:function(e){var t={name:"Internet Explorer"},r=s.default.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/\sedg\//i],describe:function(e){var t={name:"Microsoft Edge"},r=s.default.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/edg([ea]|ios)/i],describe:function(e){var t={name:"Microsoft Edge"},r=s.default.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/vivaldi/i],describe:function(e){var t={name:"Vivaldi"},r=s.default.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/seamonkey/i],describe:function(e){var t={name:"SeaMonkey"},r=s.default.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/sailfish/i],describe:function(e){var t={name:"Sailfish"},r=s.default.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,e);return r&&(t.version=r),t}},{test:[/silk/i],describe:function(e){var t={name:"Amazon Silk"},r=s.default.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/phantom/i],describe:function(e){var t={name:"PhantomJS"},r=s.default.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/slimerjs/i],describe:function(e){var t={name:"SlimerJS"},r=s.default.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(e){var t={name:"BlackBerry"},r=s.default.getFirstMatch(i,e)||s.default.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/(web|hpw)[o0]s/i],describe:function(e){var t={name:"WebOS Browser"},r=s.default.getFirstMatch(i,e)||s.default.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/bada/i],describe:function(e){var t={name:"Bada"},r=s.default.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/tizen/i],describe:function(e){var t={name:"Tizen"},r=s.default.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,e)||s.default.getFirstMatch(i,e);return r&&(t.version=r),t}},{test:[/qupzilla/i],describe:function(e){var t={name:"QupZilla"},r=s.default.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,e)||s.default.getFirstMatch(i,e);return r&&(t.version=r),t}},{test:[/firefox|iceweasel|fxios/i],describe:function(e){var t={name:"Firefox"},r=s.default.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/electron/i],describe:function(e){var t={name:"Electron"},r=s.default.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/MiuiBrowser/i],describe:function(e){var t={name:"Miui"},r=s.default.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/chromium/i],describe:function(e){var t={name:"Chromium"},r=s.default.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,e)||s.default.getFirstMatch(i,e);return r&&(t.version=r),t}},{test:[/chrome|crios|crmo/i],describe:function(e){var t={name:"Chrome"},r=s.default.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/GSA/i],describe:function(e){var t={name:"Google Search"},r=s.default.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:function(e){var t=!e.test(/like android/i),r=e.test(/android/i);return t&&r},describe:function(e){var t={name:"Android Browser"},r=s.default.getFirstMatch(i,e);return r&&(t.version=r),t}},{test:[/playstation 4/i],describe:function(e){var t={name:"PlayStation 4"},r=s.default.getFirstMatch(i,e);return r&&(t.version=r),t}},{test:[/safari|applewebkit/i],describe:function(e){var t={name:"Safari"},r=s.default.getFirstMatch(i,e);return r&&(t.version=r),t}},{test:[/.*/i],describe:function(e){var t=-1!==e.search("\\(")?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:s.default.getFirstMatch(t,e),version:s.default.getSecondMatch(t,e)}}}];t.default=a,e.exports=t.default},93:function(e,t,r){t.__esModule=!0,t.default=void 0;var n,s=(n=r(17))&&n.__esModule?n:{default:n},i=r(18),a=[{test:[/Roku\/DVP/],describe:function(e){var t=s.default.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,e);return{name:i.OS_MAP.Roku,version:t}}},{test:[/windows phone/i],describe:function(e){var t=s.default.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,e);return{name:i.OS_MAP.WindowsPhone,version:t}}},{test:[/windows /i],describe:function(e){var t=s.default.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,e),r=s.default.getWindowsVersionName(t);return{name:i.OS_MAP.Windows,version:t,versionName:r}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(e){var t={name:i.OS_MAP.iOS},r=s.default.getSecondMatch(/(Version\/)(\d[\d.]+)/,e);return r&&(t.version=r),t}},{test:[/macintosh/i],describe:function(e){var t=s.default.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,e).replace(/[_\s]/g,"."),r=s.default.getMacOSVersionName(t),n={name:i.OS_MAP.MacOS,version:t};return r&&(n.versionName=r),n}},{test:[/(ipod|iphone|ipad)/i],describe:function(e){var t=s.default.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,e).replace(/[_\s]/g,".");return{name:i.OS_MAP.iOS,version:t}}},{test:function(e){var t=!e.test(/like android/i),r=e.test(/android/i);return t&&r},describe:function(e){var t=s.default.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,e),r=s.default.getAndroidVersionName(t),n={name:i.OS_MAP.Android,version:t};return r&&(n.versionName=r),n}},{test:[/(web|hpw)[o0]s/i],describe:function(e){var t=s.default.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,e),r={name:i.OS_MAP.WebOS};return t&&t.length&&(r.version=t),r}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(e){var t=s.default.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,e)||s.default.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,e)||s.default.getFirstMatch(/\bbb(\d+)/i,e);return{name:i.OS_MAP.BlackBerry,version:t}}},{test:[/bada/i],describe:function(e){var t=s.default.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,e);return{name:i.OS_MAP.Bada,version:t}}},{test:[/tizen/i],describe:function(e){var t=s.default.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,e);return{name:i.OS_MAP.Tizen,version:t}}},{test:[/linux/i],describe:function(){return{name:i.OS_MAP.Linux}}},{test:[/CrOS/],describe:function(){return{name:i.OS_MAP.ChromeOS}}},{test:[/PlayStation 4/],describe:function(e){var t=s.default.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,e);return{name:i.OS_MAP.PlayStation4,version:t}}}];t.default=a,e.exports=t.default},94:function(e,t,r){t.__esModule=!0,t.default=void 0;var n,s=(n=r(17))&&n.__esModule?n:{default:n},i=r(18),a=[{test:[/googlebot/i],describe:function(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe:function(e){var t=s.default.getFirstMatch(/(can-l01)/i,e)&&"Nova",r={type:i.PLATFORMS_MAP.mobile,vendor:"Huawei"};return t&&(r.model=t),r}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:function(){return{type:i.PLATFORMS_MAP.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe:function(){return{type:i.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(){return{type:i.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe:function(){return{type:i.PLATFORMS_MAP.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe:function(){return{type:i.PLATFORMS_MAP.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe:function(){return{type:i.PLATFORMS_MAP.tablet}}},{test:function(e){var t=e.test(/ipod|iphone/i),r=e.test(/like (ipod|iphone)/i);return t&&!r},describe:function(e){var t=s.default.getFirstMatch(/(ipod|iphone)/i,e);return{type:i.PLATFORMS_MAP.mobile,vendor:"Apple",model:t}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:function(){return{type:i.PLATFORMS_MAP.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe:function(){return{type:i.PLATFORMS_MAP.mobile}}},{test:function(e){return"blackberry"===e.getBrowserName(!0)},describe:function(){return{type:i.PLATFORMS_MAP.mobile,vendor:"BlackBerry"}}},{test:function(e){return"bada"===e.getBrowserName(!0)},describe:function(){return{type:i.PLATFORMS_MAP.mobile}}},{test:function(e){return"windows phone"===e.getBrowserName()},describe:function(){return{type:i.PLATFORMS_MAP.mobile,vendor:"Microsoft"}}},{test:function(e){var t=Number(String(e.getOSVersion()).split(".")[0]);return"android"===e.getOSName(!0)&&t>=3},describe:function(){return{type:i.PLATFORMS_MAP.tablet}}},{test:function(e){return"android"===e.getOSName(!0)},describe:function(){return{type:i.PLATFORMS_MAP.mobile}}},{test:function(e){return"macos"===e.getOSName(!0)},describe:function(){return{type:i.PLATFORMS_MAP.desktop,vendor:"Apple"}}},{test:function(e){return"windows"===e.getOSName(!0)},describe:function(){return{type:i.PLATFORMS_MAP.desktop}}},{test:function(e){return"linux"===e.getOSName(!0)},describe:function(){return{type:i.PLATFORMS_MAP.desktop}}},{test:function(e){return"playstation 4"===e.getOSName(!0)},describe:function(){return{type:i.PLATFORMS_MAP.tv}}},{test:function(e){return"roku"===e.getOSName(!0)},describe:function(){return{type:i.PLATFORMS_MAP.tv}}}];t.default=a,e.exports=t.default},95:function(e,t,r){t.__esModule=!0,t.default=void 0;var n,s=(n=r(17))&&n.__esModule?n:{default:n},i=r(18),a=[{test:function(e){return"microsoft edge"===e.getBrowserName(!0)},describe:function(e){if(/\sedg\//i.test(e))return{name:i.ENGINE_MAP.Blink};var t=s.default.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,e);return{name:i.ENGINE_MAP.EdgeHTML,version:t}}},{test:[/trident/i],describe:function(e){var t={name:i.ENGINE_MAP.Trident},r=s.default.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:function(e){return e.test(/presto/i)},describe:function(e){var t={name:i.ENGINE_MAP.Presto},r=s.default.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:function(e){var t=e.test(/gecko/i),r=e.test(/like gecko/i);return t&&!r},describe:function(e){var t={name:i.ENGINE_MAP.Gecko},r=s.default.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/(apple)?webkit\/537\.36/i],describe:function(){return{name:i.ENGINE_MAP.Blink}}},{test:[/(apple)?webkit/i],describe:function(e){var t={name:i.ENGINE_MAP.WebKit},r=s.default.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}}];t.default=a,e.exports=t.default}})},6939:function(e,t,r){var n,s,i;e.exports=(i=r(9021),r(7165),i.mode.CTR=(s=(n=i.lib.BlockCipherMode.extend()).Encryptor=n.extend({processBlock:function(e,t){var r=this._cipher,n=r.blockSize,s=this._iv,i=this._counter;s&&(i=this._counter=s.slice(0),this._iv=void 0);var a=i.slice(0);r.encryptBlock(a,0),i[n-1]=i[n-1]+1|0;for(var o=0;o<n;o++)e[t+o]^=a[o]}}),n.Decryptor=s,n),i.mode.CTR)},6993:(e,t,r)=>{var n=r(5546);function s(){var t,r,i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",o=i.toStringTag||"@@toStringTag";function c(e,s,i,a){var o=s&&s.prototype instanceof u?s:u,c=Object.create(o.prototype);return n(c,"_invoke",function(e,n,s){var i,a,o,c=0,u=s||[],l=!1,p={p:0,n:0,v:t,a:h,f:h.bind(t,4),d:function(e,r){return i=e,a=0,o=t,p.n=r,d}};function h(e,n){for(a=e,o=n,r=0;!l&&c&&!s&&r<u.length;r++){var s,i=u[r],h=p.p,m=i[2];e>3?(s=m===n)&&(o=i[(a=i[4])?5:(a=3,3)],i[4]=i[5]=t):i[0]<=h&&((s=e<2&&h<i[1])?(a=0,p.v=n,p.n=i[1]):h<m&&(s=e<3||i[0]>n||n>m)&&(i[4]=e,i[5]=n,p.n=m,a=0))}if(s||e>1)return d;throw l=!0,n}return function(s,u,m){if(c>1)throw TypeError("Generator is already running");for(l&&1===u&&h(u,m),a=u,o=m;(r=a<2?t:o)||!l;){i||(a?a<3?(a>1&&(p.n=-1),h(a,o)):p.n=o:p.v=o);try{if(c=2,i){if(a||(s="next"),r=i[s]){if(!(r=r.call(i,o)))throw TypeError("iterator result is not an object");if(!r.done)return r;o=r.value,a<2&&(a=0)}else 1===a&&(r=i.return)&&r.call(i),a<2&&(o=TypeError("The iterator does not provide a '"+s+"' method"),a=1);i=t}else if((r=(l=p.n<0)?o:e.call(n,p))!==d)break}catch(f){i=t,a=1,o=f}finally{c=1}}return{value:r,done:l}}}(e,i,a),!0),c}var d={};function u(){}function l(){}function p(){}r=Object.getPrototypeOf;var h=[][a]?r(r([][a]())):(n(r={},a,function(){return this}),r),m=p.prototype=u.prototype=Object.create(h);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,n(e,o,"GeneratorFunction")),e.prototype=Object.create(m),e}return l.prototype=p,n(m,"constructor",p),n(p,"constructor",l),l.displayName="GeneratorFunction",n(p,o,"GeneratorFunction"),n(m),n(m,o,"Generator"),n(m,a,function(){return this}),n(m,"toString",function(){return"[object Generator]"}),(e.exports=s=function(){return{w:c,m:f}},e.exports.__esModule=!0,e.exports.default=e.exports)()}e.exports=s,e.exports.__esModule=!0,e.exports.default=e.exports},7007:e=>{var t,r="object"==typeof Reflect?Reflect:null,n=r&&"function"==typeof r.apply?r.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};t=r&&"function"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var s=Number.isNaN||function(e){return e!=e};function i(){i.init.call(this)}e.exports=i,e.exports.once=function(e,t){return new Promise(function(r,n){function s(r){e.removeListener(t,i),n(r)}function i(){"function"==typeof e.removeListener&&e.removeListener("error",s),r([].slice.call(arguments))}var a,o;f(e,t,i,{once:!0}),"error"!==t&&(o=s,"function"==typeof(a=e).on&&f(a,"error",o,{once:!0}))})},i.EventEmitter=i,i.prototype._events=void 0,i.prototype._eventsCount=0,i.prototype._maxListeners=void 0;var a=10;function o(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function c(e){return void 0===e._maxListeners?i.defaultMaxListeners:e._maxListeners}function d(e,t,r,n){var s,i,a;if(o(r),void 0===(i=e._events)?(i=e._events=Object.create(null),e._eventsCount=0):(void 0!==i.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),i=e._events),a=i[t]),void 0===a)a=i[t]=r,++e._eventsCount;else if("function"==typeof a?a=i[t]=n?[r,a]:[a,r]:n?a.unshift(r):a.push(r),(s=c(e))>0&&a.length>s&&!a.warned){a.warned=!0;var d=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");d.name="MaxListenersExceededWarning",d.emitter=e,d.type=t,d.count=a.length,console&&console.warn}return e}function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function l(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},s=u.bind(n);return s.listener=r,n.wrapFn=s,s}function p(e,t,r){var n=e._events;if(void 0===n)return[];var s=n[t];return void 0===s?[]:"function"==typeof s?r?[s.listener||s]:[s]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(s):m(s,s.length)}function h(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function m(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}function f(e,t,r,n){if("function"==typeof e.on)n.once?e.once(t,r):e.on(t,r);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,function s(i){n.once&&e.removeEventListener(t,s),r(i)})}}Object.defineProperty(i,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");a=e}}),i.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},i.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},i.prototype.getMaxListeners=function(){return c(this)},i.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var s="error"===e,i=this._events;if(void 0!==i)s=s&&void 0===i.error;else if(!s)return!1;if(s){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var o=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw o.context=a,o}var c=i[e];if(void 0===c)return!1;if("function"==typeof c)n(c,this,t);else{var d=c.length,u=m(c,d);for(r=0;r<d;++r)n(u[r],this,t)}return!0},i.prototype.addListener=function(e,t){return d(this,e,t,!1)},i.prototype.on=i.prototype.addListener,i.prototype.prependListener=function(e,t){return d(this,e,t,!0)},i.prototype.once=function(e,t){return o(t),this.on(e,l(this,e,t)),this},i.prototype.prependOnceListener=function(e,t){return o(t),this.prependListener(e,l(this,e,t)),this},i.prototype.removeListener=function(e,t){var r,n,s,i,a;if(o(t),void 0===(n=this._events))return this;if(void 0===(r=n[e]))return this;if(r===t||r.listener===t)0===--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(s=-1,i=r.length-1;i>=0;i--)if(r[i]===t||r[i].listener===t){a=r[i].listener,s=i;break}if(s<0)return this;0===s?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,s),1===r.length&&(n[e]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",e,a||t)}return this},i.prototype.off=i.prototype.removeListener,i.prototype.removeAllListeners=function(e){var t,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0===--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var s,i=Object.keys(r);for(n=0;n<i.length;++n)"removeListener"!==(s=i[n])&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},i.prototype.listeners=function(e){return p(this,e,!0)},i.prototype.rawListeners=function(e){return p(this,e,!1)},i.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):h.call(e,t)},i.prototype.listenerCount=h,i.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},7080:(e,t,r)=>{r.d(t,{q:()=>s,s:()=>n});var n={INVALID_API_KEY:4001,INVALID_TOKEN:4002,INVALID_MEETING_ID:4003,INVALID_PARTICIPANT_ID:4004,DUPLICATE_PARTICIPANT:4005,ACCOUNT_DEACTIVATED:4006,ACCOUNT_DISCONTINUED:4007,INVALID_PERMISSIONS:4008,MAX_PARTCIPANT_REACHED:4009,MAX_SPEAKER_REACHED:4010,START_RECORDING_FAILED:4011,STOP_RECORDING_FAILED:4012,START_LIVESTREAM_FAILED:4013,STOP_LIVESTREAM_FAILED:4014,INVALID_LIVESTREAM_CONFIG:4015,START_HLS_FAILED:4016,STOP_HLS_FAILED:4017,START_TRANSCRIPTION_FAILED:4031,STOP_TRANSCRIPTION_FAILED:4032,RECORDING_FAILED:5001,LIVESTREAM_FAILED:5002,HLS_FAILED:5003,TRANSCRIPTION_FAILED:5007,ERROR_GET_VIDEO_MEDIA:3011,ERROR_GET_AUDIO_MEDIA:3012,ERROR_GET_DISPLAY_MEDIA:3013,ERROR_GET_VIDEO_MEDIA_PERMISSION_DENIED:3014,ERROR_GET_AUDIO_MEDIA_PERMISSION_DENIED:3015,ERROR_GET_DISPLAY_MEDIA_PERMISSION_DENIED:3016,ERROR_CAMERA_ACCESS_DENIED_OR_DISMISSED:3017,ERROR_MICROPHONE_ACCESS_DENIED_OR_DISMISSED:3018,ERROR_CAMERA_PERMISSION_DENIED_BY_OS:3019,ERROR_MICROPHONE_PERMISSION_DENIED_BY_OS:3020,ERROR_CAMERA_NOT_FOUND:3021,ERROR_MICROPHONE_NOT_FOUND:3022,ERROR_CAMERA_IN_USE:3023,ERROR_MICROPHONE_IN_USE:3024,ERROR_CAMERA_PERMISSION_OR_AUTOPLAY_ISSUE:3025,ERROR_VIDEO_SOURCE_INITIATION_FAILED:3026,ERROR_WEBCAM_TRACK_ENDED:3027,ERROR_MICROPHONE_TRACK_ENDED:3028,ERROR_INVALID_CUSTOM_VIDEO_TRACK:3029,ERROR_INVALID_CUSTOM_AUDIO_TRACK:3030,ERROR_CUSTOM_VIDEO_TRACK_ENDED:3031,ERROR_CUSTOM_AUDIO_TRACK_ENDED:3032,ERROR_CAMERA_ACCESS_UNAVAILABLE:3033,ERROR_MICROPHONE_ACCESS_UNAVAILABLE:3034,ERROR_ACTION_PERFORMED_BEFORE_MEETING_JOINED:3035,ERROR_RN_CAMERA_ACCESS_DENIED_OR_DISMISSED:3036,ERROR_RN_CAMERA_NOT_FOUND:3037,ERROR_RN_MIC_ACCESS_DENIED_OR_DISMISSED:3038,ERROR_RN_MIC_NOT_FOUND:3039,ERROR_RN_CAMERA_ACCESS_UNAVAILABLE:3040,ERROR_RN_MIC_ACCESS_UNAVAILABLE:3041,ERROR_RN_CAMERA_TRACK_ENDED:3042,ERROR_RN_MIC_TRACK_ENDED:3043},s={ERROR_GET_VIDEO_MEDIA:{code:3011,message:"Your browser/Device does not support Video."},ERROR_GET_AUDIO_MEDIA:{code:3012,message:"Your browser/Device does not support Audio."},ERROR_GET_DISPLAY_MEDIA:{code:3013,message:"Your browser/Device does not support Screen Sharing."},ERROR_GET_VIDEO_MEDIA_PERMISSION_DENIED:{code:3014,message:"Video capture permission denied."},ERROR_GET_AUDIO_MEDIA_PERMISSION_DENIED:{code:3015,message:"Audio capture permission denied."},ERROR_GET_DISPLAY_MEDIA_PERMISSION_DENIED:{code:3016,message:"Screen sharing permission denied."},ERROR_CAMERA_ACCESS_DENIED_OR_DISMISSED:{code:3017,message:"Oops! It seems like camera access was denied or dismissed. To proceed, kindly grant access through your browser settings."},ERROR_MICROPHONE_ACCESS_DENIED_OR_DISMISSED:{code:3018,message:"Oops! It seems like microphone access was denied or dismissed. To proceed, kindly grant access through your browser settings."},ERROR_CAMERA_PERMISSION_DENIED_BY_OS:{code:3019,message:"Camera permission denied by OS system settings. Please check the system settings and grant permission for this browser."},ERROR_MICROPHONE_PERMISSION_DENIED_BY_OS:{code:3020,message:"Microphone permission denied by OS system settings. Please check the system settings and grant permission for this browser."},ERROR_CAMERA_NOT_FOUND:{code:3021,message:"Please ensure your camera is connected and turned on, and that the camera driver is installed and up-to-date."},ERROR_MICROPHONE_NOT_FOUND:{code:3022,message:"Please ensure your microphone is connected and turned on."},ERROR_CAMERA_IN_USE:{code:3023,message:"The camera is being used by another application. Please close any programs utilizing the camera, such as video conferencing tools, screen recording software, or other browsers. Restart your browser and attempt again."},ERROR_MICROPHONE_IN_USE:{code:3024,message:"The microphone is being used by another application. Please close any programs utilizing the microphone, such as video conferencing tools, screen recording software, or other browsers. Restart your browser and attempt again."},ERROR_CAMERA_PERMISSION_OR_AUTOPLAY_ISSUE:{code:3025,message:"It seems like there's an issue with camera permission or video autoplay, you can check out this link for details: http://tinyurl.com/autoplay-issue"},ERROR_VIDEO_SOURCE_INITIATION_FAILED:{code:3026,message:"Unable to initiate video source. Please verify browser settings for video permissions."},ERROR_WEBCAM_TRACK_ENDED:{code:3027,message:"Webcam track has ended or the webcam is disconnected. Please ensure your webcam is properly connected and try restarting it."},ERROR_MICROPHONE_TRACK_ENDED:{code:3028,message:"Microphone track has ended or the microphone is disconnected. Please check your microphone connection and try again."},ERROR_INVALID_CUSTOM_VIDEO_TRACK:{code:3029,message:"The provided custom video track is invalid; reverting to the default video track. Please ensure that the video track meets the required specifications."},ERROR_INVALID_CUSTOM_AUDIO_TRACK:{code:3030,message:"The provided custom audio track is invalid; reverting to the default audio track. Please ensure that the audio track meets the required specifications."},ERROR_CUSTOM_VIDEO_TRACK_ENDED:{code:3031,message:"The provided custom video track is in an ended state. Please verify the video track's status, and try again."},ERROR_CUSTOM_AUDIO_TRACK_ENDED:{code:3032,message:"The provided custom audio track is in an ended state. Please verify the audio track's status, and try again."},ERROR_CAMERA_ACCESS_UNAVAILABLE:{code:3033,message:"Camera access unavailable: Please ensure your device is compatible and that you're on a secure website (https://)."},ERROR_MICROPHONE_ACCESS_UNAVAILABLE:{code:3034,message:"Microphone access unavailable: Please ensure your device is compatible and that you're on a secure website (https://)."},ERROR_ACTION_PERFORMED_BEFORE_MEETING_JOINED:{code:3035,message:"Oops! Something went wrong. The room was in a connecting state, and during that time, an action encountered an issue. Please try again after joining a meeting."},ERROR_RN_CAMERA_ACCESS_DENIED_OR_DISMISSED:{code:3036,message:"Oops! It seems like camera access was denied or dismissed. To proceed, kindly grant access through your App settings."},ERROR_RN_CAMERA_NOT_FOUND:{code:3037,message:"Please ensure your camera is connected and turned on"},ERROR_RN_MIC_ACCESS_DENIED_OR_DISMISSED:{code:3038,message:"Oops! It seems like mic access was denied or dismissed. To proceed, kindly grant access through your App settings."},ERROR_RN_MIC_NOT_FOUND:{code:3039,message:"Please ensure your mic is connected and turned on"},ERROR_RN_CAMERA_ACCESS_UNAVAILABLE:{code:3040,message:"Camera access unavailable: Please ensure your device is compatible."},ERROR_RN_MIC_ACCESS_UNAVAILABLE:{code:3041,message:"Microphone access unavailable: Please ensure your device is compatible."},ERROR_RN_CAMERA_TRACK_ENDED:{code:3042,message:"Camera track has ended. Please make sure your camera is turned on or try restarting it."},ERROR_RN_MIC_TRACK_ENDED:{code:3043,message:"Microphone track has ended or the microphone is disconnected. Please check your microphone connection and try again."}}},7165:function(e,t,r){var n,s,i,a,o,c,d,u,l,p,h,m,f,g,v,_,y,b,w;e.exports=(n=r(9021),r(9506),void(n.lib.Cipher||(s=n,i=s.lib,a=i.Base,o=i.WordArray,c=i.BufferedBlockAlgorithm,d=s.enc,d.Utf8,u=d.Base64,l=s.algo.EvpKDF,p=i.Cipher=c.extend({cfg:a.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,r){this.cfg=this.cfg.extend(r),this._xformMode=e,this._key=t,this.reset()},reset:function(){c.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function e(e){return"string"==typeof e?w:y}return function(t){return{encrypt:function(r,n,s){return e(n).encrypt(t,r,n,s)},decrypt:function(r,n,s){return e(n).decrypt(t,r,n,s)}}}}()}),i.StreamCipher=p.extend({_doFinalize:function(){return this._process(!0)},blockSize:1}),h=s.mode={},m=i.BlockCipherMode=a.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}}),f=h.CBC=function(){var e=m.extend();function t(e,t,r){var n,s=this._iv;s?(n=s,this._iv=void 0):n=this._prevBlock;for(var i=0;i<r;i++)e[t+i]^=n[i]}return e.Encryptor=e.extend({processBlock:function(e,r){var n=this._cipher,s=n.blockSize;t.call(this,e,r,s),n.encryptBlock(e,r),this._prevBlock=e.slice(r,r+s)}}),e.Decryptor=e.extend({processBlock:function(e,r){var n=this._cipher,s=n.blockSize,i=e.slice(r,r+s);n.decryptBlock(e,r),t.call(this,e,r,s),this._prevBlock=i}}),e}(),g=(s.pad={}).Pkcs7={pad:function(e,t){for(var r=4*t,n=r-e.sigBytes%r,s=n<<24|n<<16|n<<8|n,i=[],a=0;a<n;a+=4)i.push(s);var c=o.create(i,n);e.concat(c)},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},i.BlockCipher=p.extend({cfg:p.cfg.extend({mode:f,padding:g}),reset:function(){var e;p.reset.call(this);var t=this.cfg,r=t.iv,n=t.mode;this._xformMode==this._ENC_XFORM_MODE?e=n.createEncryptor:(e=n.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==e?this._mode.init(this,r&&r.words):(this._mode=e.call(n,this,r&&r.words),this._mode.__creator=e)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e,t=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(t.pad(this._data,this.blockSize),e=this._process(!0)):(e=this._process(!0),t.unpad(e)),e},blockSize:4}),v=i.CipherParams=a.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}}),_=(s.format={}).OpenSSL={stringify:function(e){var t=e.ciphertext,r=e.salt;return(r?o.create([1398893684,1701076831]).concat(r).concat(t):t).toString(u)},parse:function(e){var t,r=u.parse(e),n=r.words;return 1398893684==n[0]&&1701076831==n[1]&&(t=o.create(n.slice(2,4)),n.splice(0,4),r.sigBytes-=16),v.create({ciphertext:r,salt:t})}},y=i.SerializableCipher=a.extend({cfg:a.extend({format:_}),encrypt:function(e,t,r,n){n=this.cfg.extend(n);var s=e.createEncryptor(r,n),i=s.finalize(t),a=s.cfg;return v.create({ciphertext:i,key:r,iv:a.iv,algorithm:e,mode:a.mode,padding:a.padding,blockSize:e.blockSize,formatter:n.format})},decrypt:function(e,t,r,n){return n=this.cfg.extend(n),t=this._parse(t,n.format),e.createDecryptor(r,n).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}}),b=(s.kdf={}).OpenSSL={execute:function(e,t,r,n,s){if(n||(n=o.random(8)),s)i=l.create({keySize:t+r,hasher:s}).compute(e,n);else var i=l.create({keySize:t+r}).compute(e,n);var a=o.create(i.words.slice(t),4*r);return i.sigBytes=4*t,v.create({key:i,iv:a,salt:n})}},w=i.PasswordBasedCipher=y.extend({cfg:y.cfg.extend({kdf:b}),encrypt:function(e,t,r,n){var s=(n=this.cfg.extend(n)).kdf.execute(r,e.keySize,e.ivSize,n.salt,n.hasher);n.iv=s.iv;var i=y.encrypt.call(this,e,t,s.key,n);return i.mixIn(s),i},decrypt:function(e,t,r,n){n=this.cfg.extend(n),t=this._parse(t,n.format);var s=n.kdf.execute(r,e.keySize,e.ivSize,t.salt,n.hasher);return n.iv=s.iv,y.decrypt.call(this,e,t,s.key,n)}}))))},7193:function(e,t,r){var n;e.exports=(n=r(9021),r(754),r(4636),r(9506),r(7165),function(){var e=n,t=e.lib.StreamCipher,r=e.algo,s=r.RC4=t.extend({_doReset:function(){for(var e=this._key,t=e.words,r=e.sigBytes,n=this._S=[],s=0;s<256;s++)n[s]=s;s=0;for(var i=0;s<256;s++){var a=s%r,o=t[a>>>2]>>>24-a%4*8&255;i=(i+n[s]+o)%256;var c=n[s];n[s]=n[i],n[i]=c}this._i=this._j=0},_doProcessBlock:function(e,t){e[t]^=i.call(this)},keySize:8,ivSize:0});function i(){for(var e=this._S,t=this._i,r=this._j,n=0,s=0;s<4;s++){r=(r+e[t=(t+1)%256])%256;var i=e[t];e[t]=e[r],e[r]=i,n|=e[(e[t]+e[r])%256]<<24-8*s}return this._i=t,this._j=r,n}e.RC4=t._createHelper(s);var a=r.RC4Drop=s.extend({cfg:s.cfg.extend({drop:192}),_doReset:function(){s._doReset.call(this);for(var e=this.cfg.drop;e>0;e--)i.call(this)}});e.RC4Drop=t._createHelper(a)}(),n.RC4)},7363:(e,t,r)=>{var n=r(5020),s=r(3804),i=r(5602);t.grammar=i,t.write=s,t.parse=n.parse,t.parseParams=n.parseParams,t.parseFmtpConfig=n.parseFmtpConfig,t.parsePayloads=n.parsePayloads,t.parseRemoteCandidates=n.parseRemoteCandidates,t.parseImageAttributes=n.parseImageAttributes,t.parseSimulcastStreamList=n.parseSimulcastStreamList},7402:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Chrome55=void 0;const s=n(7363),i=n(2994),a=n(4893),o=n(1765),c=n(8046),d=n(5544),u=n(4496),l=n(521),p=n(1305),h=new i.Logger("Chrome55"),m={OS:1024,MIS:1024};class f extends l.HandlerInterface{constructor(){super(),r(this,"_direction"),r(this,"_remoteSdp"),r(this,"_sendingRtpParametersByKind"),r(this,"_sendingRemoteRtpParametersByKind"),r(this,"_forcedLocalDtlsRole"),r(this,"_pc"),r(this,"_sendStream",new MediaStream),r(this,"_mapSendLocalIdTrack",new Map),r(this,"_nextSendLocalId",0),r(this,"_mapRecvLocalIdInfo",new Map),r(this,"_hasDataChannelMediaSection",!1),r(this,"_nextSendSctpStreamId",0),r(this,"_transportReady",!1)}static createFactory(){return()=>new f}get name(){return"Chrome55"}close(){if(h.debug("close()"),this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}async getNativeRtpCapabilities(){h.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const r=await e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{e.close()}catch(t){}const n=s.parse(r.sdp);return d.extractRtpCapabilities({sdpObject:n})}catch(r){try{e.close()}catch(t){}throw r}}async getNativeSctpCapabilities(){return h.debug("getNativeSctpCapabilities()"),{numStreams:m}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:s,iceServers:i,iceTransportPolicy:a,additionalSettings:o,proprietaryConstraints:d,extendedRtpCapabilities:u}){h.debug("run()"),this._direction=e,this._remoteSdp=new p.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:s,planB:!0}),this._sendingRtpParametersByKind={audio:c.getSendingRtpParameters("audio",u),video:c.getSendingRtpParameters("video",u)},this._sendingRemoteRtpParametersByKind={audio:c.getSendingRemoteRtpParameters("audio",u),video:c.getSendingRemoteRtpParameters("video",u)},n.role&&"auto"!==n.role&&(this._forcedLocalDtlsRole="server"===n.role?"client":"server"),this._pc=new RTCPeerConnection({iceServers:i??[],iceTransportPolicy:a??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b",...o},d),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",e=>{this.emit("@icecandidateerror",e)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(h.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})}async updateIceServers(e){h.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(h.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady)if("send"===this._direction){const e=await this._pc.createOffer({iceRestart:!0});h.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};h.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};h.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();h.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:n}){this.assertSendDirection(),h.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),n&&h.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(e),this._pc.addStream(this._sendStream);let i,a=await this._pc.createOffer(),l=s.parse(a.sdp);l.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();const p=o.clone(this._sendingRtpParametersByKind[e.kind]);p.codecs=c.reduceCodecs(p.codecs);const m=o.clone(this._sendingRemoteRtpParametersByKind[e.kind]);if(m.codecs=c.reduceCodecs(m.codecs),this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:l}),"video"===e.kind&&t&&t.length>1&&(h.debug("send() | enabling simulcast"),l=s.parse(a.sdp),i=l.media.find(e=>"video"===e.type),u.addLegacySimulcast({offerMediaObject:i,track:e,numStreams:t.length}),a={type:"offer",sdp:s.write(l)}),h.debug("send() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a),l=s.parse(this._pc.localDescription.sdp),i=l.media.find(t=>t.type===e.kind),p.rtcp.cname=d.getCname({offerMediaObject:i}),p.encodings=u.getRtpEncodings({offerMediaObject:i,track:e}),t)for(let s=0;s<p.encodings.length;++s)t[s]&&Object.assign(p.encodings[s],t[s]);if(p.encodings.length>1&&"video/vp8"===p.codecs[0].mimeType.toLowerCase())for(const s of p.encodings)s.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:i,offerRtpParameters:p,answerRtpParameters:m,codecOptions:r});const f={type:"answer",sdp:this._remoteSdp.getSdp()};h.debug("send() | calling pc.setRemoteDescription() [answer:%o]",f),await this._pc.setRemoteDescription(f);const g=String(this._nextSendLocalId);return this._nextSendLocalId++,this._mapSendLocalIdTrack.set(g,e),{localId:g,rtpParameters:p}}async stopSending(e){this.assertSendDirection(),h.debug("stopSending() [localId:%s]",e);const t=this._mapSendLocalIdTrack.get(e);if(!t)throw new Error("track not found");this._mapSendLocalIdTrack.delete(e),this._sendStream.removeTrack(t),this._pc.addStream(this._sendStream);const r=await this._pc.createOffer();h.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r);try{await this._pc.setLocalDescription(r)}catch(s){if(0===this._sendStream.getTracks().length)return void h.warn("stopSending() | ignoring expected error due no sending tracks: %s",s.toString());throw s}if("stable"===this._pc.signalingState)return;const n={type:"answer",sdp:this._remoteSdp.getSdp()};h.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n)}async pauseSending(e){}async resumeSending(e){}async replaceTrack(e,t){throw new a.UnsupportedError("not implemented")}async setMaxSpatialLayer(e,t){throw new a.UnsupportedError(" not implemented")}async setRtpEncodingParameters(e,t){throw new a.UnsupportedError("not supported")}async getSenderStats(e){throw new a.UnsupportedError("not implemented")}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:n,protocol:i}){this.assertSendDirection();const a={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmitTime:t,maxRetransmits:r,protocol:i};h.debug("sendDataChannel() [options:%o]",a);const o=this._pc.createDataChannel(n,a);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%m.MIS,!this._hasDataChannelMediaSection){const e=await this._pc.createOffer(),t=s.parse(e.sdp),r=t.media.find(e=>"application"===e.type);this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:t}),h.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:r});const n={type:"answer",sdp:this._remoteSdp.getSdp()};h.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n),this._hasDataChannelMediaSection=!0}return{dataChannel:o,sctpStreamParameters:{streamId:a.id,ordered:a.ordered,maxPacketLifeTime:a.maxPacketLifeTime,maxRetransmits:a.maxRetransmits}}}async receive(e){this.assertRecvDirection();const t=[];for(const s of e){const{trackId:e,kind:t,rtpParameters:r,streamId:n}=s;h.debug("receive() [trackId:%s, kind:%s]",e,t);const i=t;this._remoteSdp.receive({mid:i,kind:t,offerRtpParameters:r,streamId:n??r.rtcp.cname,trackId:e})}const r={type:"offer",sdp:this._remoteSdp.getSdp()};h.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);let n=await this._pc.createAnswer();const i=s.parse(n.sdp);for(const s of e){const{kind:e,rtpParameters:t}=s,r=e,n=i.media.find(e=>String(e.mid)===r);d.applyCodecParameters({offerRtpParameters:t,answerMediaObject:n})}n={type:"answer",sdp:s.write(i)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:i}),h.debug("receive() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n);for(const s of e){const{kind:e,trackId:r,rtpParameters:n}=s,i=e,a=r,o=s.streamId??n.rtcp.cname,c=this._pc.getRemoteStreams().find(e=>e.id===o).getTrackById(a);if(!c)throw new Error("remote track not found");this._mapRecvLocalIdInfo.set(a,{mid:i,rtpParameters:n}),t.push({localId:a,track:c})}return t}async stopReceiving(e){this.assertRecvDirection();for(const n of e){h.debug("stopReceiving() [localId:%s]",n);const{mid:e,rtpParameters:t}=this._mapRecvLocalIdInfo.get(n)??{};this._mapRecvLocalIdInfo.delete(n),this._remoteSdp.planBStopReceiving({mid:e,offerRtpParameters:t})}const t={type:"offer",sdp:this._remoteSdp.getSdp()};h.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const r=await this._pc.createAnswer();h.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r)}async pauseReceiving(e){}async resumeReceiving(e){}async getReceiverStats(e){throw new a.UnsupportedError("not implemented")}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){this.assertRecvDirection();const{streamId:n,ordered:i,maxPacketLifeTime:a,maxRetransmits:o}=e,c={negotiated:!0,id:n,ordered:i,maxPacketLifeTime:a,maxRetransmitTime:a,maxRetransmits:o,protocol:r};h.debug("receiveDataChannel() [options:%o]",c);const d=this._pc.createDataChannel(t,c);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const e={type:"offer",sdp:this._remoteSdp.getSdp()};h.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();if(!this._transportReady){const e=s.parse(t.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:e})}h.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setLocalDescription(t),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=s.parse(this._pc.localDescription.sdp));const r=d.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await new Promise((e,t)=>{this.safeEmit("@connect",{dtlsParameters:r},e,t)}),this._transportReady=!0}assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}t.Chrome55=f},7504:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DataProducer=void 0;const s=n(2994),i=n(3953),a=n(4893),o=new s.Logger("DataProducer");class c extends i.EnhancedEventEmitter{constructor({id:e,dataChannel:t,sctpStreamParameters:n,appData:s}){super(),r(this,"_id"),r(this,"_dataChannel"),r(this,"_closed",!1),r(this,"_sctpStreamParameters"),r(this,"_appData"),r(this,"_observer",new i.EnhancedEventEmitter),o.debug("constructor()"),this._id=e,this._dataChannel=t,this._sctpStreamParameters=n,this._appData=s??{},this.handleDataChannel()}get id(){return this._id}get closed(){return this._closed}get sctpStreamParameters(){return this._sctpStreamParameters}get readyState(){return this._dataChannel.readyState}get label(){return this._dataChannel.label}get protocol(){return this._dataChannel.protocol}get bufferedAmount(){return this._dataChannel.bufferedAmount}get bufferedAmountLowThreshold(){return this._dataChannel.bufferedAmountLowThreshold}set bufferedAmountLowThreshold(e){this._dataChannel.bufferedAmountLowThreshold=e}get appData(){return this._appData}set appData(e){this._appData=e}get observer(){return this._observer}close(){this._closed||(o.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(o.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}send(e){if(o.debug("send()"),this._closed)throw new a.InvalidStateError("closed");this._dataChannel.send(e)}handleDataChannel(){this._dataChannel.addEventListener("open",()=>{this._closed||(o.debug('DataChannel "open" event'),this.safeEmit("open"))}),this._dataChannel.addEventListener("error",e=>{if(this._closed)return;let{error:t}=e;t||(t=new Error("unknown DataChannel error")),"sctp-failure"===t.errorDetail?o.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",t.sctpCauseCode,t.message):o.error('DataChannel "error" event: %o',t),this.safeEmit("error",t)}),this._dataChannel.addEventListener("close",()=>{this._closed||(o.warn('DataChannel "close" event'),this._closed=!0,this.emit("@close"),this.safeEmit("close"),this._observer.safeEmit("close"))}),this._dataChannel.addEventListener("message",()=>{this._closed||o.warn('DataChannel "message" event in a DataProducer, message discarded')}),this._dataChannel.addEventListener("bufferedamountlow",()=>{this._closed||this.safeEmit("bufferedamountlow")})}}t.DataProducer=c},7628:function(e,t,r){var n;e.exports=(n=r(9021),r(754),r(4636),r(9506),r(7165),function(){var e=n,t=e.lib,r=t.WordArray,s=t.BlockCipher,i=e.algo,a=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],o=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],c=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],d=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],u=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],l=i.DES=s.extend({_doReset:function(){for(var e=this._key.words,t=[],r=0;r<56;r++){var n=a[r]-1;t[r]=e[n>>>5]>>>31-n%32&1}for(var s=this._subKeys=[],i=0;i<16;i++){var d=s[i]=[],u=c[i];for(r=0;r<24;r++)d[r/6|0]|=t[(o[r]-1+u)%28]<<31-r%6,d[4+(r/6|0)]|=t[28+(o[r+24]-1+u)%28]<<31-r%6;for(d[0]=d[0]<<1|d[0]>>>31,r=1;r<7;r++)d[r]=d[r]>>>4*(r-1)+3;d[7]=d[7]<<5|d[7]>>>27}var l=this._invSubKeys=[];for(r=0;r<16;r++)l[r]=s[15-r]},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._subKeys)},decryptBlock:function(e,t){this._doCryptBlock(e,t,this._invSubKeys)},_doCryptBlock:function(e,t,r){this._lBlock=e[t],this._rBlock=e[t+1],p.call(this,4,252645135),p.call(this,16,65535),h.call(this,2,858993459),h.call(this,8,16711935),p.call(this,1,1431655765);for(var n=0;n<16;n++){for(var s=r[n],i=this._lBlock,a=this._rBlock,o=0,c=0;c<8;c++)o|=d[c][((a^s[c])&u[c])>>>0];this._lBlock=a,this._rBlock=i^o}var l=this._lBlock;this._lBlock=this._rBlock,this._rBlock=l,p.call(this,1,1431655765),h.call(this,8,16711935),h.call(this,2,858993459),p.call(this,16,65535),p.call(this,4,252645135),e[t]=this._lBlock,e[t+1]=this._rBlock},keySize:2,ivSize:2,blockSize:2});function p(e,t){var r=(this._lBlock>>>e^this._rBlock)&t;this._rBlock^=r,this._lBlock^=r<<e}function h(e,t){var r=(this._rBlock>>>e^this._lBlock)&t;this._lBlock^=r,this._rBlock^=r<<e}e.DES=s._createHelper(l);var m=i.TripleDES=s.extend({_doReset:function(){var e=this._key.words;if(2!==e.length&&4!==e.length&&e.length<6)throw new Error("Invalid key length - 3DES requires the key length to be 64, 128, 192 or >192.");var t=e.slice(0,2),n=e.length<4?e.slice(0,2):e.slice(2,4),s=e.length<6?e.slice(0,2):e.slice(4,6);this._des1=l.createEncryptor(r.create(t)),this._des2=l.createEncryptor(r.create(n)),this._des3=l.createEncryptor(r.create(s))},encryptBlock:function(e,t){this._des1.encryptBlock(e,t),this._des2.decryptBlock(e,t),this._des3.encryptBlock(e,t)},decryptBlock:function(e,t){this._des3.decryptBlock(e,t),this._des2.encryptBlock(e,t),this._des1.decryptBlock(e,t)},keySize:6,ivSize:2,blockSize:2});e.TripleDES=s._createHelper(m)}(),n.TripleDES)},7654:(e,t,r)=>{var n,s="__lodash_hash_undefined__",i=/^\[object .+?Constructor\]$/,a="object"==typeof r.g&&r.g&&r.g.Object===Object&&r.g,o="object"==typeof self&&self&&self.Object===Object&&self,c=a||o||Function("return this")(),d=Array.prototype,u=Function.prototype,l=Object.prototype,p=c["__core-js_shared__"],h=(n=/[^.]+$/.exec(p&&p.keys&&p.keys.IE_PROTO||""))?"Symbol(src)_1."+n:"",m=u.toString,f=l.hasOwnProperty,g=l.toString,v=RegExp("^"+m.call(f).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),_=d.splice,y=T(c,"Map"),b=T(Object,"create");function w(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function S(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function R(e){var t=-1,r=e?e.length:0;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function k(e,t){for(var r=e.length;r--;)if(P(e[r][0],t))return r;return-1}function E(e,t){var r,n,s=e.__data__;return("string"==(n=typeof(r=t))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?s["string"==typeof t?"string":"hash"]:s.map}function T(e,t){var r,n,s=(n=t,null==(r=e)?void 0:r[n]);return function(e){return!(!O(e)||h&&h in e)&&("[object Function]"==(r=O(t=e)?g.call(t):"")||"[object GeneratorFunction]"==r||function(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(r){}return t}(e)?v:i).test(function(e){if(null!=e){try{return m.call(e)}catch(t){}try{return e+""}catch(t){}}return""}(e));var t,r}(s)?s:void 0}function C(e,t){if("function"!=typeof e||t&&"function"!=typeof t)throw new TypeError("Expected a function");var r=function(){var n=arguments,s=t?t.apply(this,n):n[0],i=r.cache;if(i.has(s))return i.get(s);var a=e.apply(this,n);return r.cache=i.set(s,a),a};return r.cache=new(C.Cache||R),r}function P(e,t){return e===t||e!=e&&t!=t}function O(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}w.prototype.clear=function(){this.__data__=b?b(null):{}},w.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},w.prototype.get=function(e){var t=this.__data__;if(b){var r=t[e];return r===s?void 0:r}return f.call(t,e)?t[e]:void 0},w.prototype.has=function(e){var t=this.__data__;return b?void 0!==t[e]:f.call(t,e)},w.prototype.set=function(e,t){return this.__data__[e]=b&&void 0===t?s:t,this},S.prototype.clear=function(){this.__data__=[]},S.prototype.delete=function(e){var t=this.__data__,r=k(t,e);return!(r<0||(r==t.length-1?t.pop():_.call(t,r,1),0))},S.prototype.get=function(e){var t=this.__data__,r=k(t,e);return r<0?void 0:t[r][1]},S.prototype.has=function(e){return k(this.__data__,e)>-1},S.prototype.set=function(e,t){var r=this.__data__,n=k(r,e);return n<0?r.push([e,t]):r[n][1]=t,this},R.prototype.clear=function(){this.__data__={hash:new w,map:new(y||S),string:new w}},R.prototype.delete=function(e){return E(this,e).delete(e)},R.prototype.get=function(e){return E(this,e).get(e)},R.prototype.has=function(e){return E(this,e).has(e)},R.prototype.set=function(e,t){return E(this,e).set(e,t),this},C.Cache=R,e.exports=C},7800:(e,t,r)=>{r.d(t,{A:()=>s});var n=r(3145);function s(e,t){if(e){if("string"==typeof e)return(0,n.A)(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?(0,n.A)(e,t):void 0}}},7833:(e,t,r)=>{t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const r="color: "+this.color;t.splice(1,0,r,"color: inherit");let n=0,s=0;t[0].replace(/%[a-zA-Z%]/g,e=>{"%%"!==e&&(n++,"%c"===e&&(s=n))}),t.splice(s,0,r)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(r){}},t.load=function(){let e;try{e=t.storage.getItem("debug")||t.storage.getItem("DEBUG")}catch(r){}return!e&&"undefined"!=typeof process&&"env"in process&&(e=Qe.DEBUG),e},t.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let e;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&(e=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(e[1],10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0)}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=r(736)(t);const{formatters:n}=e.exports;n.j=function(e){try{return JSON.stringify(e)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}},8046:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.validateRtpCapabilities=function(e){if("object"!=typeof e)throw new TypeError("caps is not an object");if(e.codecs&&!Array.isArray(e.codecs))throw new TypeError("caps.codecs is not an array");e.codecs||(e.codecs=[]);for(const t of e.codecs)d(t);if(e.headerExtensions&&!Array.isArray(e.headerExtensions))throw new TypeError("caps.headerExtensions is not an array");e.headerExtensions||(e.headerExtensions=[]);for(const t of e.headerExtensions)l(t)},t.validateRtpParameters=c,t.validateSctpStreamParameters=function(e){if("object"!=typeof e)throw new TypeError("params is not an object");if("number"!=typeof e.streamId)throw new TypeError("missing params.streamId");let t=!1;if("boolean"==typeof e.ordered?t=!0:e.ordered=!0,e.maxPacketLifeTime&&"number"!=typeof e.maxPacketLifeTime)throw new TypeError("invalid params.maxPacketLifeTime");if(e.maxRetransmits&&"number"!=typeof e.maxRetransmits)throw new TypeError("invalid params.maxRetransmits");if(e.maxPacketLifeTime&&e.maxRetransmits)throw new TypeError("cannot provide both maxPacketLifeTime and maxRetransmits");if(t&&e.ordered&&(e.maxPacketLifeTime||e.maxRetransmits))throw new TypeError("cannot be ordered with maxPacketLifeTime or maxRetransmits");if(t||!e.maxPacketLifeTime&&!e.maxRetransmits||(e.ordered=!1),e.label&&"string"!=typeof e.label)throw new TypeError("invalid params.label");if(e.protocol&&"string"!=typeof e.protocol)throw new TypeError("invalid params.protocol")},t.validateSctpCapabilities=function(e){if("object"!=typeof e)throw new TypeError("caps is not an object");if(!e.numStreams||"object"!=typeof e.numStreams)throw new TypeError("missing caps.numStreams");!function(e){if("object"!=typeof e)throw new TypeError("numStreams is not an object");if("number"!=typeof e.OS)throw new TypeError("missing numStreams.OS");if("number"!=typeof e.MIS)throw new TypeError("missing numStreams.MIS")}(e.numStreams)},t.getExtendedRtpCapabilities=function(e,t){const r={codecs:[],headerExtensions:[]};for(const n of t.codecs??[]){if(f(n))continue;const t=(e.codecs??[]).find(e=>g(e,n,{strict:!0,modify:!0}));if(!t)continue;const s={mimeType:t.mimeType,kind:t.kind,clockRate:t.clockRate,channels:t.channels,localPayloadType:t.preferredPayloadType,localRtxPayloadType:void 0,remotePayloadType:n.preferredPayloadType,remoteRtxPayloadType:void 0,localParameters:t.parameters,remoteParameters:n.parameters,rtcpFeedback:_(t,n)};r.codecs.push(s)}for(const n of r.codecs){const r=e.codecs.find(e=>f(e)&&e.parameters.apt===n.localPayloadType),s=t.codecs.find(e=>f(e)&&e.parameters.apt===n.remotePayloadType);r&&s&&(n.localRtxPayloadType=r.preferredPayloadType,n.remoteRtxPayloadType=s.preferredPayloadType)}for(const n of t.headerExtensions){const t=e.headerExtensions.find(e=>v(e,n));if(!t)continue;const s={kind:n.kind,uri:n.uri,sendId:t.preferredId,recvId:n.preferredId,encrypt:t.preferredEncrypt,direction:"sendrecv"};switch(n.direction){case"sendrecv":s.direction="sendrecv";break;case"recvonly":s.direction="sendonly";break;case"sendonly":s.direction="recvonly";break;case"inactive":s.direction="inactive"}r.headerExtensions.push(s)}return r},t.getRecvRtpCapabilities=function(e){const t={codecs:[],headerExtensions:[]};for(const r of e.codecs){const e={mimeType:r.mimeType,kind:r.kind,preferredPayloadType:r.remotePayloadType,clockRate:r.clockRate,channels:r.channels,parameters:r.localParameters,rtcpFeedback:r.rtcpFeedback};if(t.codecs.push(e),!r.remoteRtxPayloadType)continue;const n={mimeType:`${r.kind}/rtx`,kind:r.kind,preferredPayloadType:r.remoteRtxPayloadType,clockRate:r.clockRate,parameters:{apt:r.remotePayloadType},rtcpFeedback:[]};t.codecs.push(n)}for(const r of e.headerExtensions){if("sendrecv"!==r.direction&&"recvonly"!==r.direction)continue;const e={kind:r.kind,uri:r.uri,preferredId:r.recvId,preferredEncrypt:r.encrypt,direction:r.direction};t.headerExtensions.push(e)}return t},t.getSendingRtpParameters=function(e,t){const r={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};for(const n of t.codecs){if(n.kind!==e)continue;const t={mimeType:n.mimeType,payloadType:n.localPayloadType,clockRate:n.clockRate,channels:n.channels,parameters:n.localParameters,rtcpFeedback:n.rtcpFeedback};if(r.codecs.push(t),n.localRtxPayloadType){const e={mimeType:`${n.kind}/rtx`,payloadType:n.localRtxPayloadType,clockRate:n.clockRate,parameters:{apt:n.localPayloadType},rtcpFeedback:[]};r.codecs.push(e)}}for(const n of t.headerExtensions){if(n.kind&&n.kind!==e||"sendrecv"!==n.direction&&"sendonly"!==n.direction)continue;const t={uri:n.uri,id:n.sendId,encrypt:n.encrypt,parameters:{}};r.headerExtensions.push(t)}return r},t.getSendingRemoteRtpParameters=function(e,t){const r={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};for(const n of t.codecs){if(n.kind!==e)continue;const t={mimeType:n.mimeType,payloadType:n.localPayloadType,clockRate:n.clockRate,channels:n.channels,parameters:n.remoteParameters,rtcpFeedback:n.rtcpFeedback};if(r.codecs.push(t),n.localRtxPayloadType){const e={mimeType:`${n.kind}/rtx`,payloadType:n.localRtxPayloadType,clockRate:n.clockRate,parameters:{apt:n.localPayloadType},rtcpFeedback:[]};r.codecs.push(e)}}for(const n of t.headerExtensions){if(n.kind&&n.kind!==e||"sendrecv"!==n.direction&&"sendonly"!==n.direction)continue;const t={uri:n.uri,id:n.sendId,encrypt:n.encrypt,parameters:{}};r.headerExtensions.push(t)}if(r.headerExtensions.some(e=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===e.uri))for(const n of r.codecs)n.rtcpFeedback=(n.rtcpFeedback??[]).filter(e=>"goog-remb"!==e.type);else if(r.headerExtensions.some(e=>"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===e.uri))for(const n of r.codecs)n.rtcpFeedback=(n.rtcpFeedback??[]).filter(e=>"transport-cc"!==e.type);else for(const n of r.codecs)n.rtcpFeedback=(n.rtcpFeedback??[]).filter(e=>"transport-cc"!==e.type&&"goog-remb"!==e.type);return r},t.reduceCodecs=function(e,t){const r=[];if(t){for(let n=0;n<e.length;++n)if(g(e[n],t,{strict:!0})){r.push(e[n]),f(e[n+1])&&r.push(e[n+1]);break}if(0===r.length)throw new TypeError("no matching codec found")}else r.push(e[0]),f(e[1])&&r.push(e[1]);return r},t.generateProbatorRtpParameters=function(e){c(e=s.clone(e));const t={mid:i,codecs:[],headerExtensions:[],encodings:[{ssrc:a}],rtcp:{cname:"probator"}};return t.codecs.push(e.codecs[0]),t.codecs[0].payloadType=o,t.headerExtensions=e.headerExtensions,t},t.canSend=function(e,t){return t.codecs.some(t=>t.kind===e)},t.canReceive=function(e,t){if(c(e),0===e.codecs.length)return!1;const r=e.codecs[0];return t.codecs.some(e=>e.remotePayloadType===r.payloadType)};const n=r(3200),s=r(1765),i="probator",a=1234,o=127;function c(e){if("object"!=typeof e)throw new TypeError("params is not an object");if(e.mid&&"string"!=typeof e.mid)throw new TypeError("params.mid is not a string");if(!Array.isArray(e.codecs))throw new TypeError("missing params.codecs");for(const t of e.codecs)p(t);if(e.headerExtensions&&!Array.isArray(e.headerExtensions))throw new TypeError("params.headerExtensions is not an array");e.headerExtensions||(e.headerExtensions=[]);for(const t of e.headerExtensions)h(t);if(e.encodings&&!Array.isArray(e.encodings))throw new TypeError("params.encodings is not an array");e.encodings||(e.encodings=[]);for(const t of e.encodings)m(t);if(e.rtcp&&"object"!=typeof e.rtcp)throw new TypeError("params.rtcp is not an object");e.rtcp||(e.rtcp={}),function(e){if("object"!=typeof e)throw new TypeError("rtcp is not an object");if(e.cname&&"string"!=typeof e.cname)throw new TypeError("invalid rtcp.cname");e.reducedSize&&"boolean"==typeof e.reducedSize||(e.reducedSize=!0)}(e.rtcp)}function d(e){const t=new RegExp("^(audio|video)/(.+)","i");if("object"!=typeof e)throw new TypeError("codec is not an object");if(!e.mimeType||"string"!=typeof e.mimeType)throw new TypeError("missing codec.mimeType");const r=t.exec(e.mimeType);if(!r)throw new TypeError("invalid codec.mimeType");if(e.kind=r[1].toLowerCase(),e.preferredPayloadType&&"number"!=typeof e.preferredPayloadType)throw new TypeError("invalid codec.preferredPayloadType");if("number"!=typeof e.clockRate)throw new TypeError("missing codec.clockRate");"audio"===e.kind?"number"!=typeof e.channels&&(e.channels=1):delete e.channels,e.parameters&&"object"==typeof e.parameters||(e.parameters={});for(const n of Object.keys(e.parameters)){let t=e.parameters[n];if(void 0===t&&(e.parameters[n]="",t=""),"string"!=typeof t&&"number"!=typeof t)throw new TypeError(`invalid codec parameter [key:${n}s, value:${t}]`);if("apt"===n&&"number"!=typeof t)throw new TypeError("invalid codec apt parameter")}e.rtcpFeedback&&Array.isArray(e.rtcpFeedback)||(e.rtcpFeedback=[]);for(const n of e.rtcpFeedback)u(n)}function u(e){if("object"!=typeof e)throw new TypeError("fb is not an object");if(!e.type||"string"!=typeof e.type)throw new TypeError("missing fb.type");e.parameter&&"string"==typeof e.parameter||(e.parameter="")}function l(e){if("object"!=typeof e)throw new TypeError("ext is not an object");if("audio"!==e.kind&&"video"!==e.kind)throw new TypeError("invalid ext.kind");if(!e.uri||"string"!=typeof e.uri)throw new TypeError("missing ext.uri");if("number"!=typeof e.preferredId)throw new TypeError("missing ext.preferredId");if(e.preferredEncrypt&&"boolean"!=typeof e.preferredEncrypt)throw new TypeError("invalid ext.preferredEncrypt");if(e.preferredEncrypt||(e.preferredEncrypt=!1),e.direction&&"string"!=typeof e.direction)throw new TypeError("invalid ext.direction");e.direction||(e.direction="sendrecv")}function p(e){const t=new RegExp("^(audio|video)/(.+)","i");if("object"!=typeof e)throw new TypeError("codec is not an object");if(!e.mimeType||"string"!=typeof e.mimeType)throw new TypeError("missing codec.mimeType");const r=t.exec(e.mimeType);if(!r)throw new TypeError("invalid codec.mimeType");if("number"!=typeof e.payloadType)throw new TypeError("missing codec.payloadType");if("number"!=typeof e.clockRate)throw new TypeError("missing codec.clockRate");"audio"===r[1].toLowerCase()?"number"!=typeof e.channels&&(e.channels=1):delete e.channels,e.parameters&&"object"==typeof e.parameters||(e.parameters={});for(const n of Object.keys(e.parameters)){let t=e.parameters[n];if(void 0===t&&(e.parameters[n]="",t=""),"string"!=typeof t&&"number"!=typeof t)throw new TypeError(`invalid codec parameter [key:${n}s, value:${t}]`);if("apt"===n&&"number"!=typeof t)throw new TypeError("invalid codec apt parameter")}e.rtcpFeedback&&Array.isArray(e.rtcpFeedback)||(e.rtcpFeedback=[]);for(const n of e.rtcpFeedback)u(n)}function h(e){if("object"!=typeof e)throw new TypeError("ext is not an object");if(!e.uri||"string"!=typeof e.uri)throw new TypeError("missing ext.uri");if("number"!=typeof e.id)throw new TypeError("missing ext.id");if(e.encrypt&&"boolean"!=typeof e.encrypt)throw new TypeError("invalid ext.encrypt");e.encrypt||(e.encrypt=!1),e.parameters&&"object"==typeof e.parameters||(e.parameters={});for(const t of Object.keys(e.parameters)){let r=e.parameters[t];if(void 0===r&&(e.parameters[t]="",r=""),"string"!=typeof r&&"number"!=typeof r)throw new TypeError("invalid header extension parameter")}}function m(e){if("object"!=typeof e)throw new TypeError("encoding is not an object");if(e.ssrc&&"number"!=typeof e.ssrc)throw new TypeError("invalid encoding.ssrc");if(e.rid&&"string"!=typeof e.rid)throw new TypeError("invalid encoding.rid");if(e.rtx&&"object"!=typeof e.rtx)throw new TypeError("invalid encoding.rtx");if(e.rtx&&"number"!=typeof e.rtx.ssrc)throw new TypeError("missing encoding.rtx.ssrc");if(e.dtx&&"boolean"==typeof e.dtx||(e.dtx=!1),e.scalabilityMode&&"string"!=typeof e.scalabilityMode)throw new TypeError("invalid encoding.scalabilityMode")}function f(e){return!!e&&/.+\/rtx$/i.test(e.mimeType)}function g(e,t,{strict:r=!1,modify:s=!1}={}){const i=e.mimeType.toLowerCase();if(i!==t.mimeType.toLowerCase())return!1;if(e.clockRate!==t.clockRate)return!1;if(e.channels!==t.channels)return!1;switch(i){case"video/h264":if(r){if((e.parameters["packetization-mode"]??0)!==(t.parameters["packetization-mode"]??0))return!1;if(!n.isSameProfile(e.parameters,t.parameters))return!1;let r;try{r=n.generateProfileLevelIdStringForAnswer(e.parameters,t.parameters)}catch(a){return!1}s&&(r?(e.parameters["profile-level-id"]=r,t.parameters["profile-level-id"]=r):(delete e.parameters["profile-level-id"],delete t.parameters["profile-level-id"]))}break;case"video/vp9":if(r&&(e.parameters["profile-id"]??0)!==(t.parameters["profile-id"]??0))return!1}return!0}function v(e,t){return!(e.kind&&t.kind&&e.kind!==t.kind||e.uri!==t.uri)}function _(e,t){const r=[];for(const n of e.rtcpFeedback??[]){const e=(t.rtcpFeedback??[]).find(e=>e.type===n.type&&(e.parameter===n.parameter||!e.parameter&&!n.parameter));e&&r.push(e)}return r}},8056:function(e,t,r){var n;e.exports=(n=r(9021),function(){var e=n,t=e.lib,r=t.WordArray,s=t.Hasher,i=e.algo,a=r.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),o=r.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),c=r.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),d=r.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),u=r.create([0,1518500249,1859775393,2400959708,2840853838]),l=r.create([1352829926,1548603684,1836072691,2053994217,0]),p=i.RIPEMD160=s.extend({_doReset:function(){this._hash=r.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var r=0;r<16;r++){var n=t+r,s=e[n];e[n]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8)}var i,p,y,b,w,S,R,k,E,T,C,P=this._hash.words,O=u.words,x=l.words,D=a.words,I=o.words,A=c.words,M=d.words;for(S=i=P[0],R=p=P[1],k=y=P[2],E=b=P[3],T=w=P[4],r=0;r<80;r+=1)C=i+e[t+D[r]]|0,C+=r<16?h(p,y,b)+O[0]:r<32?m(p,y,b)+O[1]:r<48?f(p,y,b)+O[2]:r<64?g(p,y,b)+O[3]:v(p,y,b)+O[4],C=(C=_(C|=0,A[r]))+w|0,i=w,w=b,b=_(y,10),y=p,p=C,C=S+e[t+I[r]]|0,C+=r<16?v(R,k,E)+x[0]:r<32?g(R,k,E)+x[1]:r<48?f(R,k,E)+x[2]:r<64?m(R,k,E)+x[3]:h(R,k,E)+x[4],C=(C=_(C|=0,M[r]))+T|0,S=T,T=E,E=_(k,10),k=R,R=C;C=P[1]+y+E|0,P[1]=P[2]+b+T|0,P[2]=P[3]+w+S|0,P[3]=P[4]+i+R|0,P[4]=P[0]+p+k|0,P[0]=C},_doFinalize:function(){var e=this._data,t=e.words,r=8*this._nDataBytes,n=8*e.sigBytes;t[n>>>5]|=128<<24-n%32,t[14+(n+64>>>9<<4)]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),e.sigBytes=4*(t.length+1),this._process();for(var s=this._hash,i=s.words,a=0;a<5;a++){var o=i[a];i[a]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8)}return s},clone:function(){var e=s.clone.call(this);return e._hash=this._hash.clone(),e}});function h(e,t,r){return e^t^r}function m(e,t,r){return e&t|~e&r}function f(e,t,r){return(e|~t)^r}function g(e,t,r){return e&r|t&~r}function v(e,t,r){return e^(t|~r)}function _(e,t){return e<<t|e>>>32-t}e.RIPEMD160=s._createHelper(p),e.HmacRIPEMD160=s._createHmacHelper(p)}(),n.RIPEMD160)},8057:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var s=Object.getOwnPropertyDescriptor(t,r);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,s)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),s=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),s(r(6004),t),s(r(5601),t),s(r(9792),t),s(r(3518),t),s(r(7504),t),s(r(9166),t),s(r(5370),t),s(r(4160),t),s(r(521),t),s(r(4893),t)},8124:function(e,t,r){var n;e.exports=(n=r(9021),r(7165),n.pad.NoPadding={pad:function(){},unpad:function(){}},n.pad.NoPadding)},8155:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Chrome67=void 0;const s=n(7363),i=n(2994),a=n(1765),o=n(8046),c=n(5544),d=n(4496),u=n(521),l=n(1305),p=new i.Logger("Chrome67"),h={OS:1024,MIS:1024};class m extends u.HandlerInterface{constructor(){super(),r(this,"_direction"),r(this,"_remoteSdp"),r(this,"_sendingRtpParametersByKind"),r(this,"_sendingRemoteRtpParametersByKind"),r(this,"_forcedLocalDtlsRole"),r(this,"_pc"),r(this,"_sendStream",new MediaStream),r(this,"_mapSendLocalIdRtpSender",new Map),r(this,"_nextSendLocalId",0),r(this,"_mapRecvLocalIdInfo",new Map),r(this,"_hasDataChannelMediaSection",!1),r(this,"_nextSendSctpStreamId",0),r(this,"_transportReady",!1)}static createFactory(){return()=>new m}get name(){return"Chrome67"}close(){if(p.debug("close()"),this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}async getNativeRtpCapabilities(){p.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const r=await e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{e.close()}catch(t){}const n=s.parse(r.sdp);return c.extractRtpCapabilities({sdpObject:n})}catch(r){try{e.close()}catch(t){}throw r}}async getNativeSctpCapabilities(){return p.debug("getNativeSctpCapabilities()"),{numStreams:h}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:s,iceServers:i,iceTransportPolicy:a,additionalSettings:c,proprietaryConstraints:d,extendedRtpCapabilities:u}){p.debug("run()"),this._direction=e,this._remoteSdp=new l.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:s,planB:!0}),this._sendingRtpParametersByKind={audio:o.getSendingRtpParameters("audio",u),video:o.getSendingRtpParameters("video",u)},this._sendingRemoteRtpParametersByKind={audio:o.getSendingRemoteRtpParameters("audio",u),video:o.getSendingRemoteRtpParameters("video",u)},n.role&&"auto"!==n.role&&(this._forcedLocalDtlsRole="server"===n.role?"client":"server"),this._pc=new RTCPeerConnection({iceServers:i??[],iceTransportPolicy:a??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b",...c},d),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",e=>{this.emit("@icecandidateerror",e)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(p.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})}async updateIceServers(e){p.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(p.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady)if("send"===this._direction){const e=await this._pc.createOffer({iceRestart:!0});p.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();p.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:n}){this.assertSendDirection(),p.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),n&&p.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(e),this._pc.addTrack(e,this._sendStream);let i,u=await this._pc.createOffer(),l=s.parse(u.sdp);l.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();const h=a.clone(this._sendingRtpParametersByKind[e.kind]);h.codecs=o.reduceCodecs(h.codecs);const m=a.clone(this._sendingRemoteRtpParametersByKind[e.kind]);if(m.codecs=o.reduceCodecs(m.codecs),this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:l}),"video"===e.kind&&t&&t.length>1&&(p.debug("send() | enabling simulcast"),l=s.parse(u.sdp),i=l.media.find(e=>"video"===e.type),d.addLegacySimulcast({offerMediaObject:i,track:e,numStreams:t.length}),u={type:"offer",sdp:s.write(l)}),p.debug("send() | calling pc.setLocalDescription() [offer:%o]",u),await this._pc.setLocalDescription(u),l=s.parse(this._pc.localDescription.sdp),i=l.media.find(t=>t.type===e.kind),h.rtcp.cname=c.getCname({offerMediaObject:i}),h.encodings=d.getRtpEncodings({offerMediaObject:i,track:e}),t)for(let s=0;s<h.encodings.length;++s)t[s]&&Object.assign(h.encodings[s],t[s]);if(h.encodings.length>1&&"video/vp8"===h.codecs[0].mimeType.toLowerCase())for(const s of h.encodings)s.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:i,offerRtpParameters:h,answerRtpParameters:m,codecOptions:r});const f={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("send() | calling pc.setRemoteDescription() [answer:%o]",f),await this._pc.setRemoteDescription(f);const g=String(this._nextSendLocalId);this._nextSendLocalId++;const v=this._pc.getSenders().find(t=>t.track===e);return this._mapSendLocalIdRtpSender.set(g,v),{localId:g,rtpParameters:h,rtpSender:v}}async stopSending(e){this.assertSendDirection(),p.debug("stopSending() [localId:%s]",e);const t=this._mapSendLocalIdRtpSender.get(e);if(!t)throw new Error("associated RTCRtpSender not found");this._pc.removeTrack(t),t.track&&this._sendStream.removeTrack(t.track),this._mapSendLocalIdRtpSender.delete(e);const r=await this._pc.createOffer();p.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r);try{await this._pc.setLocalDescription(r)}catch(s){if(0===this._sendStream.getTracks().length)return void p.warn("stopSending() | ignoring expected error due no sending tracks: %s",s.toString());throw s}if("stable"===this._pc.signalingState)return;const n={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n)}async pauseSending(e){}async resumeSending(e){}async replaceTrack(e,t){this.assertSendDirection(),t?p.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):p.debug("replaceTrack() [localId:%s, no track]",e);const r=this._mapSendLocalIdRtpSender.get(e);if(!r)throw new Error("associated RTCRtpSender not found");const n=r.track;await r.replaceTrack(t),n&&this._sendStream.removeTrack(n),t&&this._sendStream.addTrack(t)}async setMaxSpatialLayer(e,t){this.assertSendDirection(),p.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const r=this._mapSendLocalIdRtpSender.get(e);if(!r)throw new Error("associated RTCRtpSender not found");const n=r.getParameters();n.encodings.forEach((e,r)=>{e.active=r<=t}),await r.setParameters(n)}async setRtpEncodingParameters(e,t){this.assertSendDirection(),p.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const r=this._mapSendLocalIdRtpSender.get(e);if(!r)throw new Error("associated RTCRtpSender not found");const n=r.getParameters();n.encodings.forEach((e,r)=>{n.encodings[r]={...e,...t}}),await r.setParameters(n)}async getSenderStats(e){this.assertSendDirection();const t=this._mapSendLocalIdRtpSender.get(e);if(!t)throw new Error("associated RTCRtpSender not found");return t.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:n,protocol:i}){this.assertSendDirection();const a={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmitTime:t,maxRetransmits:r,protocol:i};p.debug("sendDataChannel() [options:%o]",a);const o=this._pc.createDataChannel(n,a);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%h.MIS,!this._hasDataChannelMediaSection){const e=await this._pc.createOffer(),t=s.parse(e.sdp),r=t.media.find(e=>"application"===e.type);this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:t}),p.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:r});const n={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n),this._hasDataChannelMediaSection=!0}return{dataChannel:o,sctpStreamParameters:{streamId:a.id,ordered:a.ordered,maxPacketLifeTime:a.maxPacketLifeTime,maxRetransmits:a.maxRetransmits}}}async receive(e){this.assertRecvDirection();const t=[];for(const s of e){const{trackId:e,kind:t,rtpParameters:r,streamId:n}=s;p.debug("receive() [trackId:%s, kind:%s]",e,t);const i=t;this._remoteSdp.receive({mid:i,kind:t,offerRtpParameters:r,streamId:n??r.rtcp.cname,trackId:e})}const r={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);let n=await this._pc.createAnswer();const i=s.parse(n.sdp);for(const s of e){const{kind:e,rtpParameters:t}=s,r=e,n=i.media.find(e=>String(e.mid)===r);c.applyCodecParameters({offerRtpParameters:t,answerMediaObject:n})}n={type:"answer",sdp:s.write(i)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:i}),p.debug("receive() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n);for(const s of e){const{kind:e,trackId:r,rtpParameters:n}=s,i=r,a=e,o=this._pc.getReceivers().find(e=>e.track&&e.track.id===i);if(!o)throw new Error("new RTCRtpReceiver not");this._mapRecvLocalIdInfo.set(i,{mid:a,rtpParameters:n,rtpReceiver:o}),t.push({localId:i,track:o.track,rtpReceiver:o})}return t}async stopReceiving(e){this.assertRecvDirection();for(const n of e){p.debug("stopReceiving() [localId:%s]",n);const{mid:e,rtpParameters:t}=this._mapRecvLocalIdInfo.get(n)??{};this._mapRecvLocalIdInfo.delete(n),this._remoteSdp.planBStopReceiving({mid:e,offerRtpParameters:t})}const t={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const r=await this._pc.createAnswer();p.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r)}async pauseReceiving(e){}async resumeReceiving(e){}async getReceiverStats(e){this.assertRecvDirection();const{rtpReceiver:t}=this._mapRecvLocalIdInfo.get(e)??{};if(!t)throw new Error("associated RTCRtpReceiver not found");return t.getStats()}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){this.assertRecvDirection();const{streamId:n,ordered:i,maxPacketLifeTime:a,maxRetransmits:o}=e,c={negotiated:!0,id:n,ordered:i,maxPacketLifeTime:a,maxRetransmitTime:a,maxRetransmits:o,protocol:r};p.debug("receiveDataChannel() [options:%o]",c);const d=this._pc.createDataChannel(t,c);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const e={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();if(!this._transportReady){const e=s.parse(t.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:e})}p.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setLocalDescription(t),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=s.parse(this._pc.localDescription.sdp));const r=c.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await new Promise((e,t)=>{this.safeEmit("@connect",{dtlsParameters:r},e,t)}),this._transportReady=!0}assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}t.Chrome67=m},8274:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Logger=void 0;const s=n(7833),i="awaitqueue";t.Logger=class{constructor(e){r(this,"_debug"),r(this,"_warn"),r(this,"_error"),e?(this._debug=s(`${i}:${e}`),this._warn=s(`${i}:WARN:${e}`),this._error=s(`${i}:ERROR:${e}`)):(this._debug=s(i),this._warn=s(`${i}:WARN`),this._error=s(`${i}:ERROR`)),this._debug.log=function(){}.bind(),this._warn.log=function(){}.bind(),this._error.log=function(){}.bind()}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}}},8278:(e,t,r)=>{r.d(t,{Ag:()=>a,Wm:()=>o,sn:()=>c,tr:()=>u});var n=r(467),s=r(4756),i=r.n(s);function a(){return void 0!==window.RTCRtpSender&&void 0!==window.RTCRtpSender.prototype.createEncodedStreams||o()}function o(){return void 0!==window.RTCRtpScriptTransform}function c(e){return d.apply(this,arguments)}function d(){return(d=(0,n.A)(i().mark(function e(t){var r,n;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new TextEncoder,e.next=1,crypto.subtle.importKey("raw",r.encode(t),{name:"PBKDF2"},!1,["deriveBits","deriveKey"]);case 1:return n=e.sent,e.abrupt("return",n);case 2:case"end":return e.stop()}},e)}))).apply(this,arguments)}function u(e){return l.apply(this,arguments)}function l(){return(l=(0,n.A)(i().mark(function e(t){var r;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,crypto.subtle.importKey("raw",t,"HKDF",!1,["deriveBits","deriveKey"]);case 1:return r=e.sent,e.abrupt("return",r);case 2:case"end":return e.stop()}},e)}))).apply(this,arguments)}r(1806)},8286:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=r(3779),s=r(2291),i=r(6011);t.default=function(e,t,r){var a;if(n.default.randomUUID&&!t&&!e)return n.default.randomUUID();const o=(e=e||{}).random??(null==(a=e.rng)?void 0:a.call(e))??(0,s.default)();if(o.length<16)throw new Error("Random bytes length must be >= 16");if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t){if((r=r||0)<0||r+16>t.length)throw new RangeError(`UUID byte range ${r}:${r+15} is out of buffer bounds`);for(let e=0;e<16;++e)t[r+e]=o[e];return t}return(0,i.unsafeStringify)(o)}},8454:function(e,t,r){var n,s;e.exports=(s=r(9021),r(7165),s.mode.ECB=((n=s.lib.BlockCipherMode.extend()).Encryptor=n.extend({processBlock:function(e,t){this._cipher.encryptBlock(e,t)}}),n.Decryptor=n.extend({processBlock:function(e,t){this._cipher.decryptBlock(e,t)}}),n),s.mode.ECB)},8624:(e,t,r)=>{r.r(t),r.d(t,{DOMException:()=>w,Headers:()=>u,Request:()=>v,Response:()=>y,fetch:()=>S});var n="undefined"!=typeof globalThis&&globalThis||"undefined"!=typeof self&&self||void 0!==r.g&&r.g||{},s={searchParams:"URLSearchParams"in n,iterable:"Symbol"in n&&"iterator"in Symbol,blob:"FileReader"in n&&"Blob"in n&&function(){try{return new Blob,!0}catch(e){return!1}}(),formData:"FormData"in n,arrayBuffer:"ArrayBuffer"in n};if(s.arrayBuffer)var i=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],a=ArrayBuffer.isView||function(e){return e&&i.indexOf(Object.prototype.toString.call(e))>-1};function o(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(e)||""===e)throw new TypeError('Invalid character in header field name: "'+e+'"');return e.toLowerCase()}function c(e){return"string"!=typeof e&&(e=String(e)),e}function d(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return s.iterable&&(t[Symbol.iterator]=function(){return t}),t}function u(e){this.map={},e instanceof u?e.forEach(function(e,t){this.append(t,e)},this):Array.isArray(e)?e.forEach(function(e){if(2!=e.length)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+e.length);this.append(e[0],e[1])},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}function l(e){if(!e._noBody)return e.bodyUsed?Promise.reject(new TypeError("Already read")):void(e.bodyUsed=!0)}function p(e){return new Promise(function(t,r){e.onload=function(){t(e.result)},e.onerror=function(){r(e.error)}})}function h(e){var t=new FileReader,r=p(t);return t.readAsArrayBuffer(e),r}function m(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function f(){return this.bodyUsed=!1,this._initBody=function(e){var t;this.bodyUsed=this.bodyUsed,this._bodyInit=e,e?"string"==typeof e?this._bodyText=e:s.blob&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:s.formData&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:s.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():s.arrayBuffer&&s.blob&&(t=e)&&DataView.prototype.isPrototypeOf(t)?(this._bodyArrayBuffer=m(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):s.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(e)||a(e))?this._bodyArrayBuffer=m(e):this._bodyText=e=Object.prototype.toString.call(e):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):s.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},s.blob&&(this.blob=function(){var e=l(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer)return l(this)||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer));if(s.blob)return this.blob().then(h);throw new Error("could not read as ArrayBuffer")},this.text=function(){var e,t,r,n,s,i=l(this);if(i)return i;if(this._bodyBlob)return e=this._bodyBlob,r=p(t=new FileReader),s=(n=/charset=([A-Za-z0-9_-]+)/.exec(e.type))?n[1]:"utf-8",t.readAsText(e,s),r;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),r=new Array(t.length),n=0;n<t.length;n++)r[n]=String.fromCharCode(t[n]);return r.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},s.formData&&(this.formData=function(){return this.text().then(_)}),this.json=function(){return this.text().then(JSON.parse)},this}u.prototype.append=function(e,t){e=o(e),t=c(t);var r=this.map[e];this.map[e]=r?r+", "+t:t},u.prototype.delete=function(e){delete this.map[o(e)]},u.prototype.get=function(e){return e=o(e),this.has(e)?this.map[e]:null},u.prototype.has=function(e){return this.map.hasOwnProperty(o(e))},u.prototype.set=function(e,t){this.map[o(e)]=c(t)},u.prototype.forEach=function(e,t){for(var r in this.map)this.map.hasOwnProperty(r)&&e.call(t,this.map[r],r,this)},u.prototype.keys=function(){var e=[];return this.forEach(function(t,r){e.push(r)}),d(e)},u.prototype.values=function(){var e=[];return this.forEach(function(t){e.push(t)}),d(e)},u.prototype.entries=function(){var e=[];return this.forEach(function(t,r){e.push([r,t])}),d(e)},s.iterable&&(u.prototype[Symbol.iterator]=u.prototype.entries);var g=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function v(e,t){if(!(this instanceof v))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');var r,s,i=(t=t||{}).body;if(e instanceof v){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new u(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,i||null==e._bodyInit||(i=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"same-origin",!t.headers&&this.headers||(this.headers=new u(t.headers)),this.method=(s=(r=t.method||this.method||"GET").toUpperCase(),g.indexOf(s)>-1?s:r),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal||function(){if("AbortController"in n)return(new AbortController).signal}(),this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&i)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(i),!("GET"!==this.method&&"HEAD"!==this.method||"no-store"!==t.cache&&"no-cache"!==t.cache)){var a=/([?&])_=[^&]*/;a.test(this.url)?this.url=this.url.replace(a,"$1_="+(new Date).getTime()):this.url+=(/\?/.test(this.url)?"&":"?")+"_="+(new Date).getTime()}}function _(e){var t=new FormData;return e.trim().split("&").forEach(function(e){if(e){var r=e.split("="),n=r.shift().replace(/\+/g," "),s=r.join("=").replace(/\+/g," ");t.append(decodeURIComponent(n),decodeURIComponent(s))}}),t}function y(e,t){if(!(this instanceof y))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=void 0===t.statusText?"":""+t.statusText,this.headers=new u(t.headers),this.url=t.url||"",this._initBody(e)}v.prototype.clone=function(){return new v(this,{body:this._bodyInit})},f.call(v.prototype),f.call(y.prototype),y.prototype.clone=function(){return new y(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new u(this.headers),url:this.url})},y.error=function(){var e=new y(null,{status:200,statusText:""});return e.ok=!1,e.status=0,e.type="error",e};var b=[301,302,303,307,308];y.redirect=function(e,t){if(-1===b.indexOf(t))throw new RangeError("Invalid status code");return new y(null,{status:t,headers:{location:e}})};var w=n.DOMException;try{new w}catch(R){(w=function(e,t){this.message=e,this.name=t;var r=Error(e);this.stack=r.stack}).prototype=Object.create(Error.prototype),w.prototype.constructor=w}function S(e,t){return new Promise(function(r,i){var a=new v(e,t);if(a.signal&&a.signal.aborted)return i(new w("Aborted","AbortError"));var d=new XMLHttpRequest;function l(){d.abort()}if(d.onload=function(){var e,t,n={statusText:d.statusText,headers:(e=d.getAllResponseHeaders()||"",t=new u,e.replace(/\r?\n[\t ]+/g," ").split("\r").map(function(e){return 0===e.indexOf("\n")?e.substr(1,e.length):e}).forEach(function(e){var r=e.split(":"),n=r.shift().trim();if(n){var s=r.join(":").trim();try{t.append(n,s)}catch(i){}}}),t)};0===a.url.indexOf("file://")&&(d.status<200||d.status>599)?n.status=200:n.status=d.status,n.url="responseURL"in d?d.responseURL:n.headers.get("X-Request-URL");var s="response"in d?d.response:d.responseText;setTimeout(function(){r(new y(s,n))},0)},d.onerror=function(){setTimeout(function(){i(new TypeError("Network request failed"))},0)},d.ontimeout=function(){setTimeout(function(){i(new TypeError("Network request timed out"))},0)},d.onabort=function(){setTimeout(function(){i(new w("Aborted","AbortError"))},0)},d.open(a.method,function(e){try{return""===e&&n.location.href?n.location.href:e}catch(t){return e}}(a.url),!0),"include"===a.credentials?d.withCredentials=!0:"omit"===a.credentials&&(d.withCredentials=!1),"responseType"in d&&(s.blob?d.responseType="blob":s.arrayBuffer&&(d.responseType="arraybuffer")),t&&"object"==typeof t.headers&&!(t.headers instanceof u||n.Headers&&t.headers instanceof n.Headers)){var p=[];Object.getOwnPropertyNames(t.headers).forEach(function(e){p.push(o(e)),d.setRequestHeader(e,c(t.headers[e]))}),a.headers.forEach(function(e,t){-1===p.indexOf(t)&&d.setRequestHeader(t,e)})}else a.headers.forEach(function(e,t){d.setRequestHeader(t,e)});a.signal&&(a.signal.addEventListener("abort",l),d.onreadystatechange=function(){4===d.readyState&&a.signal.removeEventListener("abort",l)}),d.send(void 0===a._bodyInit?null:a._bodyInit)})}S.polyfill=!0,n.fetch||(n.fetch=S,n.Headers=u,n.Request=v,n.Response=y)},8633:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Edge11=void 0;const s=n(2994),i=n(4893),a=n(1765),o=n(8046),c=n(8751),d=n(521),u=new s.Logger("Edge11");class l extends d.HandlerInterface{constructor(){super(),r(this,"_sendingRtpParametersByKind"),r(this,"_remoteIceParameters"),r(this,"_remoteIceCandidates"),r(this,"_remoteDtlsParameters"),r(this,"_iceGatherer"),r(this,"_iceTransport"),r(this,"_dtlsTransport"),r(this,"_rtpSenders",new Map),r(this,"_rtpReceivers",new Map),r(this,"_nextSendLocalId",0),r(this,"_cname"),r(this,"_transportReady",!1)}static createFactory(){return()=>new l}get name(){return"Edge11"}close(){u.debug("close()");try{this._iceGatherer.close()}catch(e){}try{this._iceTransport.stop()}catch(e){}try{this._dtlsTransport.stop()}catch(e){}for(const r of this._rtpSenders.values())try{r.stop()}catch(t){}for(const r of this._rtpReceivers.values())try{r.stop()}catch(t){}this.emit("@close")}async getNativeRtpCapabilities(){return u.debug("getNativeRtpCapabilities()"),c.getCapabilities()}async getNativeSctpCapabilities(){return u.debug("getNativeSctpCapabilities()"),{numStreams:{OS:0,MIS:0}}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:s,iceServers:i,iceTransportPolicy:c,additionalSettings:d,proprietaryConstraints:l,extendedRtpCapabilities:p}){u.debug("run()"),this._sendingRtpParametersByKind={audio:o.getSendingRtpParameters("audio",p),video:o.getSendingRtpParameters("video",p)},this._remoteIceParameters=t,this._remoteIceCandidates=r,this._remoteDtlsParameters=n,this._cname=`CNAME-${a.generateRandomNumber()}`,this.setIceGatherer({iceServers:i,iceTransportPolicy:c}),this.setIceTransport(),this.setDtlsTransport()}async updateIceServers(e){throw new i.UnsupportedError("not supported")}async restartIce(e){if(u.debug("restartIce()"),this._remoteIceParameters=e,this._transportReady){u.debug("restartIce() | calling iceTransport.start()"),this._iceTransport.start(this._iceGatherer,e,"controlling");for(const e of this._remoteIceCandidates)this._iceTransport.addRemoteCandidate(e);this._iceTransport.addRemoteCandidate({})}}async getTransportStats(){return this._iceTransport.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:n}){u.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),this._transportReady||await this.setupTransport({localDtlsRole:"server"}),u.debug("send() | calling new RTCRtpSender()");const s=new RTCRtpSender(e,this._dtlsTransport),i=a.clone(this._sendingRtpParametersByKind[e.kind]);i.codecs=o.reduceCodecs(i.codecs,n);const d=i.codecs.some(e=>/.+\/rtx$/i.test(e.mimeType));t||(t=[{}]);for(const o of t)o.ssrc=a.generateRandomNumber(),d&&(o.rtx={ssrc:a.generateRandomNumber()});i.encodings=t,i.rtcp={cname:this._cname,reducedSize:!0,mux:!0};const l=c.mangleRtpParameters(i);u.debug("send() | calling rtpSender.send() [params:%o]",l),await s.send(l);const p=String(this._nextSendLocalId);return this._nextSendLocalId++,this._rtpSenders.set(p,s),{localId:p,rtpParameters:i,rtpSender:s}}async stopSending(e){u.debug("stopSending() [localId:%s]",e);const t=this._rtpSenders.get(e);if(!t)throw new Error("RTCRtpSender not found");this._rtpSenders.delete(e);try{u.debug("stopSending() | calling rtpSender.stop()"),t.stop()}catch(r){throw u.warn("stopSending() | rtpSender.stop() failed:%o",r),r}}async pauseSending(e){}async resumeSending(e){}async replaceTrack(e,t){t?u.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):u.debug("replaceTrack() [localId:%s, no track]",e);const r=this._rtpSenders.get(e);if(!r)throw new Error("RTCRtpSender not found");r.setTrack(t)}async setMaxSpatialLayer(e,t){u.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const r=this._rtpSenders.get(e);if(!r)throw new Error("RTCRtpSender not found");const n=r.getParameters();n.encodings.forEach((e,r)=>{e.active=r<=t}),await r.setParameters(n)}async setRtpEncodingParameters(e,t){u.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const r=this._rtpSenders.get(e);if(!r)throw new Error("RTCRtpSender not found");const n=r.getParameters();n.encodings.forEach((e,r)=>{n.encodings[r]={...e,...t}}),await r.setParameters(n)}async getSenderStats(e){const t=this._rtpSenders.get(e);if(!t)throw new Error("RTCRtpSender not found");return t.getStats()}async sendDataChannel(e){throw new i.UnsupportedError("not implemented")}async receive(e){const t=[];for(const r of e){const{trackId:e,kind:t}=r;u.debug("receive() [trackId:%s, kind:%s]",e,t)}this._transportReady||await this.setupTransport({localDtlsRole:"server"});for(const r of e){const{trackId:e,kind:n,rtpParameters:s}=r;u.debug("receive() | calling new RTCRtpReceiver()");const i=new RTCRtpReceiver(this._dtlsTransport,n);i.addEventListener("error",e=>{u.error('rtpReceiver "error" event [event:%o]',e)});const a=c.mangleRtpParameters(s);u.debug("receive() | calling rtpReceiver.receive() [params:%o]",a),await i.receive(a);const o=e;this._rtpReceivers.set(o,i),t.push({localId:o,track:i.track,rtpReceiver:i})}return t}async stopReceiving(e){for(const r of e){u.debug("stopReceiving() [localId:%s]",r);const e=this._rtpReceivers.get(r);if(!e)throw new Error("RTCRtpReceiver not found");this._rtpReceivers.delete(r);try{u.debug("stopReceiving() | calling rtpReceiver.stop()"),e.stop()}catch(t){u.warn("stopReceiving() | rtpReceiver.stop() failed:%o",t)}}}async pauseReceiving(e){}async resumeReceiving(e){}async getReceiverStats(e){const t=this._rtpReceivers.get(e);if(!t)throw new Error("RTCRtpReceiver not found");return t.getStats()}async receiveDataChannel(e){throw new i.UnsupportedError("not implemented")}setIceGatherer({iceServers:e,iceTransportPolicy:t}){const r=new RTCIceGatherer({iceServers:e??[],gatherPolicy:t??"all"});r.addEventListener("error",e=>{u.error('iceGatherer "error" event [event:%o]',e)});try{r.gather()}catch(n){u.debug("setIceGatherer() | iceGatherer.gather() failed: %s",n.toString())}this._iceGatherer=r}setIceTransport(){const e=new RTCIceTransport(this._iceGatherer);e.addEventListener("statechange",()=>{switch(e.state){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}),e.addEventListener("icestatechange",()=>{switch(e.state){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}),e.addEventListener("candidatepairchange",e=>{u.debug('iceTransport "candidatepairchange" event [pair:%o]',e.pair)}),this._iceTransport=e}setDtlsTransport(){const e=new RTCDtlsTransport(this._iceTransport);e.addEventListener("statechange",()=>{u.debug('dtlsTransport "statechange" event [state:%s]',e.state)}),e.addEventListener("dtlsstatechange",()=>{u.debug('dtlsTransport "dtlsstatechange" event [state:%s]',e.state),"closed"===e.state&&this.emit("@connectionstatechange","closed")}),e.addEventListener("error",e=>{u.error('dtlsTransport "error" event [event:%o]',e)}),this._dtlsTransport=e}async setupTransport({localDtlsRole:e}){u.debug("setupTransport()");const t=this._dtlsTransport.getLocalParameters();t.role=e,await new Promise((e,r)=>{this.safeEmit("@connect",{dtlsParameters:t},e,r)}),this._iceTransport.start(this._iceGatherer,this._remoteIceParameters,"controlling");for(const r of this._remoteIceCandidates)this._iceTransport.addRemoteCandidate(r);this._iceTransport.addRemoteCandidate({}),this._remoteDtlsParameters.fingerprints=this._remoteDtlsParameters.fingerprints.filter(e=>"sha-256"===e.algorithm||"sha-384"===e.algorithm||"sha-512"===e.algorithm),this._dtlsTransport.start(this._remoteDtlsParameters),this._transportReady=!0}}t.Edge11=l},8751:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getCapabilities=function(){const e=RTCRtpReceiver.getCapabilities(),t=n.clone(e);for(const r of t.codecs??[]){if(r.channels=r.numChannels,delete r.numChannels,r.mimeType=r.mimeType??`${r.kind}/${r.name}`,r.parameters){const e=r.parameters;e.apt&&(e.apt=Number(e.apt)),e["packetization-mode"]&&(e["packetization-mode"]=Number(e["packetization-mode"]))}for(const e of r.rtcpFeedback??[])e.parameter||(e.parameter="")}return t},t.mangleRtpParameters=function(e){const t=n.clone(e);t.mid&&(t.muxId=t.mid,delete t.mid);for(const r of t.codecs)r.channels&&(r.numChannels=r.channels,delete r.channels),r.mimeType&&!r.name&&(r.name=r.mimeType.split("/")[1]),delete r.mimeType;return t};const n=r(1765)},8876:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AwaitQueueRemovedTaskError=t.AwaitQueueStoppedError=t.AwaitQueue=void 0;var n=r(9275);Object.defineProperty(t,"AwaitQueue",{enumerable:!0,get:function(){return n.AwaitQueue}});var s=r(4253);Object.defineProperty(t,"AwaitQueueStoppedError",{enumerable:!0,get:function(){return s.AwaitQueueStoppedError}}),Object.defineProperty(t,"AwaitQueueRemovedTaskError",{enumerable:!0,get:function(){return s.AwaitQueueRemovedTaskError}})},9021:function(e,t,r){var n;e.exports=(n=n||function(e){var t;if("undefined"!=typeof window&&window.crypto&&(t=window.crypto),"undefined"!=typeof self&&self.crypto&&(t=self.crypto),"undefined"!=typeof globalThis&&globalThis.crypto&&(t=globalThis.crypto),!t&&"undefined"!=typeof window&&window.msCrypto&&(t=window.msCrypto),!t&&void 0!==r.g&&r.g.crypto&&(t=r.g.crypto),!t)try{t=r(477)}catch(f){}var n=function(){if(t){if("function"==typeof t.getRandomValues)try{return t.getRandomValues(new Uint32Array(1))[0]}catch(f){}if("function"==typeof t.randomBytes)try{return t.randomBytes(4).readInt32LE()}catch(f){}}throw new Error("Native crypto module could not be used to get secure random number.")},s=Object.create||function(){function e(){}return function(t){var r;return e.prototype=t,r=new e,e.prototype=null,r}}(),i={},a=i.lib={},o=a.Base={extend:function(e){var t=s(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},c=a.WordArray=o.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||u).stringify(this)},concat:function(e){var t=this.words,r=e.words,n=this.sigBytes,s=e.sigBytes;if(this.clamp(),n%4)for(var i=0;i<s;i++){var a=r[i>>>2]>>>24-i%4*8&255;t[n+i>>>2]|=a<<24-(n+i)%4*8}else for(var o=0;o<s;o+=4)t[n+o>>>2]=r[o>>>2];return this.sigBytes+=s,this},clamp:function(){var t=this.words,r=this.sigBytes;t[r>>>2]&=4294967295<<32-r%4*8,t.length=e.ceil(r/4)},clone:function(){var e=o.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],r=0;r<e;r+=4)t.push(n());return new c.init(t,e)}}),d=i.enc={},u=d.Hex={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],s=0;s<r;s++){var i=t[s>>>2]>>>24-s%4*8&255;n.push((i>>>4).toString(16)),n.push((15&i).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n+=2)r[n>>>3]|=parseInt(e.substr(n,2),16)<<24-n%8*4;return new c.init(r,t/2)}},l=d.Latin1={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],s=0;s<r;s++){var i=t[s>>>2]>>>24-s%4*8&255;n.push(String.fromCharCode(i))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n++)r[n>>>2]|=(255&e.charCodeAt(n))<<24-n%4*8;return new c.init(r,t)}},p=d.Utf8={stringify:function(e){try{return decodeURIComponent(escape(l.stringify(e)))}catch(t){throw new Error("Malformed UTF-8 data")}},parse:function(e){return l.parse(unescape(encodeURIComponent(e)))}},h=a.BufferedBlockAlgorithm=o.extend({reset:function(){this._data=new c.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=p.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var r,n=this._data,s=n.words,i=n.sigBytes,a=this.blockSize,o=i/(4*a),d=(o=t?e.ceil(o):e.max((0|o)-this._minBufferSize,0))*a,u=e.min(4*d,i);if(d){for(var l=0;l<d;l+=a)this._doProcessBlock(s,l);r=s.splice(0,d),n.sigBytes-=u}return new c.init(r,u)},clone:function(){var e=o.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),m=(a.Hasher=h.extend({cfg:o.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){h.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,r){return new e.init(r).finalize(t)}},_createHmacHelper:function(e){return function(t,r){return new m.HMAC.init(e,r).finalize(t)}}}),i.algo={});return i}(Math),n)},9027:(e,t,r)=>{r.d(t,{$:()=>n});var n={networkPriorities:{audio:"high",dominatingVideo:"high",otherVideos:"medium",screenShare:"medium"},aspectRatios:{fourThree:{label:"fourThree",value:1.333},oneSixNine:{label:"oneSixNine",value:1.777}},audioProfiles:{speech_low_quality:{sampleRate:16e3,bitRate:24,sampleSize:16,stereo:!1,dtx:!0,fec:!0,maxPlaybackRate:16e3,packetTime:20,autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0,channelCount:1},speech_standard:{sampleRate:32e3,bitRate:24,sampleSize:24,stereo:!1,dtx:!0,fec:!0,maxPlaybackRate:32e3,packetTime:30,autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0,channelCount:1},music_standard:{sampleRate:48e3,bitRate:40,sampleSize:32,stereo:!1,dtx:!1,fec:!0,maxPlaybackRate:48e3,packetTime:40,autoGainControl:!1,echoCancellation:!1,noiseSuppression:!1,channelCount:1},standard_stereo:{sampleRate:48e3,sampleSize:32,bitRate:64,stereo:!0,dtx:!1,fec:!0,maxPlaybackRate:48e3,packetTime:40,autoGainControl:!1,echoCancellation:!1,noiseSuppression:!1,channelCount:2},high_quality:{sampleRate:48e3,sampleSize:32,bitRate:128,stereo:!1,dtx:!1,fec:!0,maxPlaybackRate:48e3,packetTime:60,autoGainControl:!1,echoCancellation:!1,noiseSuppression:!1,channelCount:1},high_quality_stereo:{sampleRate:48e3,sampleSize:32,bitRate:192,stereo:!0,dtx:!1,fec:!0,maxPlaybackRate:48e3,packetTime:60,autoGainControl:!1,echoCancellation:!1,noiseSuppression:!1,channelCount:2}},videoProfiles:{h90p_w160p:{width:160,height:90,bitRate:6e4,frameRate:15,aspectRatio:"oneSixNine"},h180p_w320p:{width:320,height:180,bitRate:12e4,frameRate:15,aspectRatio:"oneSixNine"},h216p_w384p:{width:384,height:216,bitRate:18e4,frameRate:15,aspectRatio:"oneSixNine"},h360p_w640p:{width:640,height:360,bitRate:3e5,frameRate:20,aspectRatio:"osneSixNine"},h360p_w640p_150kbps:{width:640,height:360,bitRate:15e4,frameRate:15,aspectRatio:"oneSixNine"},h540p_w960p:{width:960,height:540,bitRate:6e5,frameRate:25,aspectRatio:"oneSixNine"},h720p_w1280p:{width:1280,height:720,bitRate:2e6,frameRate:30,aspectRatio:"oneSixNine"},h1080p_w1920p:{width:1920,height:1080,bitRate:3e6,frameRate:30,aspectRatio:"oneSixNine"},h1440p_w2560p:{width:2560,height:1440,bitRate:5e6,frameRate:30,aspectRatio:"oneSixNine"},h2160p_w3840p:{width:3840,height:2160,bitRate:8e6,frameRate:30,aspectRatio:"oneSixNine"},h120p_w160p:{width:160,height:120,bitRate:8e4,frameRate:15,aspectRatio:"fourThree"},h180p_w240p:{width:240,height:180,bitRate:1e5,frameRate:15,aspectRatio:"fourThree"},h240p_w320p:{width:320,height:240,bitRate:15e4,frameRate:15,aspectRatio:"fourThree"},h360p_w480p:{width:480,height:360,bitRate:225e3,frameRate:20,aspectRatio:"fourThree"},h480p_w640p:{width:640,height:480,bitRate:3e5,frameRate:25,aspectRatio:"fourThree"},h540p_w720p:{width:720,height:540,bitRate:45e4,frameRate:30,aspectRatio:"fourThree"},h720p_w960p:{width:960,height:720,bitRate:15e5,frameRate:30,aspectRatio:"fourThree"},h1080p_w1440p:{width:1440,height:1080,bitRate:25e5,frameRate:30,aspectRatio:"fourThree"},h1440p_w1920p:{width:1920,height:1440,bitRate:35e5,frameRate:30,aspectRatio:"fourThree"}},screenShareProfiles:{h360p_30fps:{resolution:{width:640,height:360},frameRate:30,bitrates:{high:4e5,medium:2e5,low:1e5}},h480p_15fps:{resolution:{width:854,height:480},frameRate:15,bitrates:{high:3e5,medium:15e4,low:75e3}},h480p_30fps:{resolution:{width:854,height:480},frameRate:30,bitrates:{high:5e5,medium:25e4,low:125e3}},h720p_5fps:{resolution:{width:1280,height:720},frameRate:5,bitrates:{high:4e5,medium:2e5,low:1e5}},h720p_15fps:{resolution:{width:1280,height:720},frameRate:15,bitrates:{high:1e6,medium:5e5,low:25e4}},h720p_30fps:{resolution:{width:1280,height:720},frameRate:30,bitrates:{high:15e5,medium:75e4,low:375e3}},h1080p_15fps:{resolution:{width:1920,height:1080},frameRate:15,bitrates:{high:15e5,medium:75e4,low:3e5}},h1080p_30fps:{resolution:{width:1920,height:1080},frameRate:30,bitrates:{high:2e6,medium:1e6,low:5e5}}},simulcastProfiles:{3840:[{scaleResolutionDownBy:12,maxBitRate:15e4},{scaleResolutionDownBy:6,maxBitRate:5e5},{scaleResolutionDownBy:1,maxBitRate:1e7}],1920:[{scaleResolutionDownBy:6,maxBitRate:15e4},{scaleResolutionDownBy:3,maxBitRate:5e5},{scaleResolutionDownBy:1,maxBitRate:35e5}],1280:[{scaleResolutionDownBy:4,maxBitRate:15e4},{scaleResolutionDownBy:2,maxBitRate:5e5},{scaleResolutionDownBy:1,maxBitRate:12e5}],640:[{scaleResolutionDownBy:2,maxBitRate:15e4},{scaleResolutionDownBy:1,maxBitRate:5e5}],320:[{scaleResolutionDownBy:1,maxBitRate:15e4}]},requestTimeout:2e4,requestRetries:3,transportOptions:{tcp:!0},videoKSVCEncodings:[{scalabilityMode:"S3T3_KEY"}],videoSVCEncodings:[{scalabilityMode:"S3T3",dtx:!0}]}},9166:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DataConsumer=void 0;const s=n(2994),i=n(3953),a=new s.Logger("DataConsumer");class o extends i.EnhancedEventEmitter{constructor({id:e,dataProducerId:t,dataChannel:n,sctpStreamParameters:s,appData:o}){super(),r(this,"_id"),r(this,"_dataProducerId"),r(this,"_dataChannel"),r(this,"_closed",!1),r(this,"_sctpStreamParameters"),r(this,"_appData"),r(this,"_observer",new i.EnhancedEventEmitter),a.debug("constructor()"),this._id=e,this._dataProducerId=t,this._dataChannel=n,this._sctpStreamParameters=s,this._appData=o??{},this.handleDataChannel()}get id(){return this._id}get dataProducerId(){return this._dataProducerId}get closed(){return this._closed}get sctpStreamParameters(){return this._sctpStreamParameters}get readyState(){return this._dataChannel.readyState}get label(){return this._dataChannel.label}get protocol(){return this._dataChannel.protocol}get binaryType(){return this._dataChannel.binaryType}set binaryType(e){this._dataChannel.binaryType=e}get appData(){return this._appData}set appData(e){this._appData=e}get observer(){return this._observer}close(){this._closed||(a.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(a.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}handleDataChannel(){this._dataChannel.addEventListener("open",()=>{this._closed||(a.debug('DataChannel "open" event'),this.safeEmit("open"))}),this._dataChannel.addEventListener("error",e=>{if(this._closed)return;let{error:t}=e;t||(t=new Error("unknown DataChannel error")),"sctp-failure"===t.errorDetail?a.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",t.sctpCauseCode,t.message):a.error('DataChannel "error" event: %o',t),this.safeEmit("error",t)}),this._dataChannel.addEventListener("close",()=>{this._closed||(a.warn('DataChannel "close" event'),this._closed=!0,this.emit("@close"),this.safeEmit("close"),this._observer.safeEmit("close"))}),this._dataChannel.addEventListener("message",e=>{this._closed||this.safeEmit("message",e.data)})}}t.DataConsumer=o},9275:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AwaitQueue=void 0;const s=n(8274),i=n(4253),a=new s.Logger("AwaitQueue");t.AwaitQueue=class{constructor(){r(this,"pendingTasks",new Map),r(this,"nextTaskId",0),r(this,"stopping",!1),a.debug("constructor()")}get size(){return this.pendingTasks.size}async push(e,t){if(t=t??e.name,a.debug(`push() [name:${t}]`),"function"!=typeof e)throw new TypeError("given task is not a function");if(t)try{Object.defineProperty(e,"name",{value:t})}catch(r){}return new Promise((r,n)=>{const s={id:this.nextTaskId++,task:e,name:t,enqueuedAt:Date.now(),executedAt:void 0,completed:!1,resolve:e=>{if(s.completed)return;s.completed=!0,this.pendingTasks.delete(s.id),a.debug(`resolving task [name:${s.name}]`),r(e);const[t]=this.pendingTasks.values();t&&!t.executedAt&&this.execute(t)},reject:e=>{if(!s.completed&&(s.completed=!0,this.pendingTasks.delete(s.id),a.debug(`rejecting task [name:${s.name}]: %s`,String(e)),n(e),!this.stopping)){const[e]=this.pendingTasks.values();e&&!e.executedAt&&this.execute(e)}}};this.pendingTasks.set(s.id,s),1===this.pendingTasks.size&&this.execute(s)})}stop(){a.debug("stop()"),this.stopping=!0;for(const e of this.pendingTasks.values())a.debug(`stop() | stopping task [name:${e.name}]`),e.reject(new i.AwaitQueueStoppedError);this.stopping=!1}remove(e){a.debug(`remove() [taskIdx:${e}]`);const t=Array.from(this.pendingTasks.values())[e];t?t.reject(new i.AwaitQueueRemovedTaskError):a.debug(`stop() | no task with given idx [taskIdx:${e}]`)}dump(){const e=Date.now();let t=0;return Array.from(this.pendingTasks.values()).map(r=>({idx:t++,task:r.task,name:r.name,enqueuedTime:r.executedAt?r.executedAt-r.enqueuedAt:e-r.enqueuedAt,executionTime:r.executedAt?e-r.executedAt:0}))}async execute(e){if(a.debug(`execute() [name:${e.name}]`),e.executedAt)throw new Error("task already being executed");e.executedAt=Date.now();try{const t=await e.task();e.resolve(t)}catch(t){e.reject(t)}}}},9352:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ReactNative=void 0;const s=n(7363),i=n(2994),a=n(4893),o=n(1765),c=n(8046),d=n(5544),u=n(4496),l=n(521),p=n(1305),h=new i.Logger("ReactNative"),m={OS:1024,MIS:1024};class f extends l.HandlerInterface{constructor(){super(),r(this,"_direction"),r(this,"_remoteSdp"),r(this,"_sendingRtpParametersByKind"),r(this,"_sendingRemoteRtpParametersByKind"),r(this,"_forcedLocalDtlsRole"),r(this,"_pc"),r(this,"_sendStream",new MediaStream),r(this,"_mapSendLocalIdTrack",new Map),r(this,"_nextSendLocalId",0),r(this,"_mapRecvLocalIdInfo",new Map),r(this,"_hasDataChannelMediaSection",!1),r(this,"_nextSendSctpStreamId",0),r(this,"_transportReady",!1)}static createFactory(){return()=>new f}get name(){return"ReactNative"}close(){if(h.debug("close()"),this._sendStream.release(!1),this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}async getNativeRtpCapabilities(){h.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const r=await e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{e.close()}catch(t){}const n=s.parse(r.sdp);return d.extractRtpCapabilities({sdpObject:n})}catch(r){try{e.close()}catch(t){}throw r}}async getNativeSctpCapabilities(){return h.debug("getNativeSctpCapabilities()"),{numStreams:m}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:s,iceServers:i,iceTransportPolicy:a,additionalSettings:o,proprietaryConstraints:d,extendedRtpCapabilities:u}){h.debug("run()"),this._direction=e,this._remoteSdp=new p.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:s,planB:!0}),this._sendingRtpParametersByKind={audio:c.getSendingRtpParameters("audio",u),video:c.getSendingRtpParameters("video",u)},this._sendingRemoteRtpParametersByKind={audio:c.getSendingRemoteRtpParameters("audio",u),video:c.getSendingRemoteRtpParameters("video",u)},n.role&&"auto"!==n.role&&(this._forcedLocalDtlsRole="server"===n.role?"client":"server"),this._pc=new RTCPeerConnection({iceServers:i??[],iceTransportPolicy:a??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b",...o},d),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",e=>{this.emit("@icecandidateerror",e)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(h.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})}async updateIceServers(e){h.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(h.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady)if("send"===this._direction){const e=await this._pc.createOffer({iceRestart:!0});h.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};h.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};h.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();h.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:n}){this.assertSendDirection(),h.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),n&&h.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(e),this._pc.addStream(this._sendStream);let i,a=await this._pc.createOffer(),l=s.parse(a.sdp);l.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();const p=o.clone(this._sendingRtpParametersByKind[e.kind]);p.codecs=c.reduceCodecs(p.codecs);const m=o.clone(this._sendingRemoteRtpParametersByKind[e.kind]);if(m.codecs=c.reduceCodecs(m.codecs),this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:l}),"video"===e.kind&&t&&t.length>1&&(h.debug("send() | enabling simulcast"),l=s.parse(a.sdp),i=l.media.find(e=>"video"===e.type),u.addLegacySimulcast({offerMediaObject:i,track:e,numStreams:t.length}),a={type:"offer",sdp:s.write(l)}),h.debug("send() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a),l=s.parse(this._pc.localDescription.sdp),i=l.media.find(t=>t.type===e.kind),p.rtcp.cname=d.getCname({offerMediaObject:i}),p.encodings=u.getRtpEncodings({offerMediaObject:i,track:e}),t)for(let s=0;s<p.encodings.length;++s)t[s]&&Object.assign(p.encodings[s],t[s]);if(p.encodings.length>1&&("video/vp8"===p.codecs[0].mimeType.toLowerCase()||"video/h264"===p.codecs[0].mimeType.toLowerCase()))for(const s of p.encodings)s.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:i,offerRtpParameters:p,answerRtpParameters:m,codecOptions:r});const f={type:"answer",sdp:this._remoteSdp.getSdp()};h.debug("send() | calling pc.setRemoteDescription() [answer:%o]",f),await this._pc.setRemoteDescription(f);const g=String(this._nextSendLocalId);return this._nextSendLocalId++,this._mapSendLocalIdTrack.set(g,e),{localId:g,rtpParameters:p}}async stopSending(e){this.assertSendDirection(),h.debug("stopSending() [localId:%s]",e);const t=this._mapSendLocalIdTrack.get(e);if(!t)throw new Error("track not found");this._mapSendLocalIdTrack.delete(e),this._sendStream.removeTrack(t),this._pc.addStream(this._sendStream);const r=await this._pc.createOffer();h.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r);try{await this._pc.setLocalDescription(r)}catch(s){if(0===this._sendStream.getTracks().length)return void h.warn("stopSending() | ignoring expected error due no sending tracks: %s",s.toString());throw s}if("stable"===this._pc.signalingState)return;const n={type:"answer",sdp:this._remoteSdp.getSdp()};h.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n)}async pauseSending(e){}async resumeSending(e){}async replaceTrack(e,t){throw new a.UnsupportedError("not implemented")}async setMaxSpatialLayer(e,t){throw new a.UnsupportedError("not implemented")}async setRtpEncodingParameters(e,t){throw new a.UnsupportedError("not implemented")}async getSenderStats(e){throw new a.UnsupportedError("not implemented")}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:n,protocol:i}){this.assertSendDirection();const a={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmitTime:t,maxRetransmits:r,protocol:i};h.debug("sendDataChannel() [options:%o]",a);const o=this._pc.createDataChannel(n,a);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%m.MIS,!this._hasDataChannelMediaSection){const e=await this._pc.createOffer(),t=s.parse(e.sdp),r=t.media.find(e=>"application"===e.type);this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:t}),h.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:r});const n={type:"answer",sdp:this._remoteSdp.getSdp()};h.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n),this._hasDataChannelMediaSection=!0}return{dataChannel:o,sctpStreamParameters:{streamId:a.id,ordered:a.ordered,maxPacketLifeTime:a.maxPacketLifeTime,maxRetransmits:a.maxRetransmits}}}async receive(e){this.assertRecvDirection();const t=[],r=new Map;for(const s of e){const{trackId:e,kind:t,rtpParameters:n}=s;h.debug("receive() [trackId:%s, kind:%s]",e,t);const i=t;let a=s.streamId??n.rtcp.cname;h.debug("receive() | forcing a random remote streamId to avoid well known bug in react-native-webrtc"),a+=`-hack-${o.generateRandomNumber()}`,r.set(e,a),this._remoteSdp.receive({mid:i,kind:t,offerRtpParameters:n,streamId:a,trackId:e})}const n={type:"offer",sdp:this._remoteSdp.getSdp()};h.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",n),await this._pc.setRemoteDescription(n);let i=await this._pc.createAnswer();const a=s.parse(i.sdp);for(const s of e){const{kind:e,rtpParameters:t}=s,r=e,n=a.media.find(e=>String(e.mid)===r);d.applyCodecParameters({offerRtpParameters:t,answerMediaObject:n})}i={type:"answer",sdp:s.write(a)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:a}),h.debug("receive() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i);for(const s of e){const{kind:e,trackId:n,rtpParameters:i}=s,a=n,o=e,c=r.get(n),d=this._pc.getRemoteStreams().find(e=>e.id===c).getTrackById(a);if(!d)throw new Error("remote track not found");this._mapRecvLocalIdInfo.set(a,{mid:o,rtpParameters:i}),t.push({localId:a,track:d})}return t}async stopReceiving(e){this.assertRecvDirection();for(const n of e){h.debug("stopReceiving() [localId:%s]",n);const{mid:e,rtpParameters:t}=this._mapRecvLocalIdInfo.get(n)??{};this._mapRecvLocalIdInfo.delete(n),this._remoteSdp.planBStopReceiving({mid:e,offerRtpParameters:t})}const t={type:"offer",sdp:this._remoteSdp.getSdp()};h.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const r=await this._pc.createAnswer();h.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r)}async pauseReceiving(e){}async resumeReceiving(e){}async getReceiverStats(e){throw new a.UnsupportedError("not implemented")}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){this.assertRecvDirection();const{streamId:n,ordered:i,maxPacketLifeTime:a,maxRetransmits:o}=e,c={negotiated:!0,id:n,ordered:i,maxPacketLifeTime:a,maxRetransmitTime:a,maxRetransmits:o,protocol:r};h.debug("receiveDataChannel() [options:%o]",c);const d=this._pc.createDataChannel(t,c);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const e={type:"offer",sdp:this._remoteSdp.getSdp()};h.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();if(!this._transportReady){const e=s.parse(t.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:e})}h.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setLocalDescription(t),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=s.parse(this._pc.localDescription.sdp));const r=d.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await new Promise((e,t)=>{this.safeEmit("@connect",{dtlsParameters:r},e,t)}),this._transportReady=!0}assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}t.ReactNative=f},9506:function(e,t,r){var n,s,i,a,o,c,d,u;e.exports=(u=r(9021),r(5471),r(1025),i=(s=(n=u).lib).Base,a=s.WordArray,c=(o=n.algo).MD5,d=o.EvpKDF=i.extend({cfg:i.extend({keySize:4,hasher:c,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var r,n=this.cfg,s=n.hasher.create(),i=a.create(),o=i.words,c=n.keySize,d=n.iterations;o.length<c;){r&&s.update(r),r=s.update(e).finalize(t),s.reset();for(var u=1;u<d;u++)r=s.finalize(r),s.reset();i.concat(r)}return i.sigBytes=4*c,i}}),n.EvpKDF=function(e,t,r){return d.create(r).compute(e,t)},u.EvpKDF)},9557:function(e,t,r){var n,s,i,a,o,c,d,u;e.exports=(u=r(9021),r(3240),r(1380),s=(n=u).x64,i=s.Word,a=s.WordArray,o=n.algo,c=o.SHA512,d=o.SHA384=c.extend({_doReset:function(){this._hash=new a.init([new i.init(3418070365,3238371032),new i.init(1654270250,914150663),new i.init(2438529370,812702999),new i.init(355462360,4144912697),new i.init(1731405415,4290775857),new i.init(2394180231,1750603025),new i.init(3675008525,1694076839),new i.init(1203062813,3204075428)])},_doFinalize:function(){var e=c._doFinalize.call(this);return e.sigBytes-=16,e}}),n.SHA384=c._createHelper(d),n.HmacSHA384=c._createHmacHelper(d),u.SHA384)},9596:e=>{var t,r="object"==typeof Reflect?Reflect:null,n=r&&"function"==typeof r.apply?r.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};t=r&&"function"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var s=Number.isNaN||function(e){return e!=e};function i(){i.init.call(this)}e.exports=i,e.exports.once=function(e,t){return new Promise(function(r,n){function s(r){e.removeListener(t,i),n(r)}function i(){"function"==typeof e.removeListener&&e.removeListener("error",s),r([].slice.call(arguments))}var a,o;f(e,t,i,{once:!0}),"error"!==t&&(o=s,"function"==typeof(a=e).on&&f(a,"error",o,{once:!0}))})},i.EventEmitter=i,i.prototype._events=void 0,i.prototype._eventsCount=0,i.prototype._maxListeners=void 0;var a=10;function o(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function c(e){return void 0===e._maxListeners?i.defaultMaxListeners:e._maxListeners}function d(e,t,r,n){var s,i,a;if(o(r),void 0===(i=e._events)?(i=e._events=Object.create(null),e._eventsCount=0):(void 0!==i.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),i=e._events),a=i[t]),void 0===a)a=i[t]=r,++e._eventsCount;else if("function"==typeof a?a=i[t]=n?[r,a]:[a,r]:n?a.unshift(r):a.push(r),(s=c(e))>0&&a.length>s&&!a.warned){a.warned=!0;var d=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");d.name="MaxListenersExceededWarning",d.emitter=e,d.type=t,d.count=a.length,console&&console.warn}return e}function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function l(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},s=u.bind(n);return s.listener=r,n.wrapFn=s,s}function p(e,t,r){var n=e._events;if(void 0===n)return[];var s=n[t];return void 0===s?[]:"function"==typeof s?r?[s.listener||s]:[s]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(s):m(s,s.length)}function h(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function m(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}function f(e,t,r,n){if("function"==typeof e.on)n.once?e.once(t,r):e.on(t,r);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,function s(i){n.once&&e.removeEventListener(t,s),r(i)})}}Object.defineProperty(i,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");a=e}}),i.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},i.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},i.prototype.getMaxListeners=function(){return c(this)},i.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var s="error"===e,i=this._events;if(void 0!==i)s=s&&void 0===i.error;else if(!s)return!1;if(s){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var o=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw o.context=a,o}var c=i[e];if(void 0===c)return!1;if("function"==typeof c)n(c,this,t);else{var d=c.length,u=m(c,d);for(r=0;r<d;++r)n(u[r],this,t)}return!0},i.prototype.addListener=function(e,t){return d(this,e,t,!1)},i.prototype.on=i.prototype.addListener,i.prototype.prependListener=function(e,t){return d(this,e,t,!0)},i.prototype.once=function(e,t){return o(t),this.on(e,l(this,e,t)),this},i.prototype.prependOnceListener=function(e,t){return o(t),this.prependListener(e,l(this,e,t)),this},i.prototype.removeListener=function(e,t){var r,n,s,i,a;if(o(t),void 0===(n=this._events))return this;if(void 0===(r=n[e]))return this;if(r===t||r.listener===t)0===--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(s=-1,i=r.length-1;i>=0;i--)if(r[i]===t||r[i].listener===t){a=r[i].listener,s=i;break}if(s<0)return this;0===s?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,s),1===r.length&&(n[e]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",e,a||t)}return this},i.prototype.off=i.prototype.removeListener,i.prototype.removeAllListeners=function(e){var t,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0===--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var s,i=Object.keys(r);for(n=0;n<i.length;++n)"removeListener"!==(s=i[n])&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},i.prototype.listeners=function(e){return p(this,e,!0)},i.prototype.rawListeners=function(e){return p(this,e,!1)},i.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):h.call(e,t)},i.prototype.listenerCount=h,i.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},9633:(e,t,r)=>{r.d(t,{l:()=>v});var n=r(467),s=r(3029),i=r(2901),a=r(388),o=r(3954),c=r(5501),d=r(4756),u=r.n(d),l=r(7007),p=r(1806),h=r(6746),m=r(8278);function f(e,t,r){return t=(0,o.A)(t),(0,a.A)(e,g()?Reflect.construct(t,r||[],(0,o.A)(e).constructor):t.apply(e,r))}function g(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(g=function(){return!!e})()}var v=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,s.A)(this,t),f(this,t,[Object.assign(Object.assign({},e),{sharedKey:!0,ratchetWindowSize:0,failureTolerance:-1})])}return(0,c.A)(t,e),(0,i.A)(t,[{key:"setSharedKey",value:(r=(0,n.A)(u().mark(function e(t){var r,n;return u().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t){e.next=2;break}return e.next=1,(0,m.sn)(t);case 1:n=e.sent,e.next=4;break;case 2:return e.next=3,(0,m.tr)(t);case 3:n=e.sent;case 4:r=n,this.onSetEncryptionKey(r);case 5:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})}]);var r}(function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,s.A)(this,t),(e=f(this,t)).onKeyRatcheted=function(e,t){},e.keyInfoMap=new Map,e.options=Object.assign(Object.assign({},p.T4),r),e.on(h.fo.KeyRatcheted,e.onKeyRatcheted),e}return(0,c.A)(t,e),(0,i.A)(t,[{key:"onSetEncryptionKey",value:function(e,t,r){var n={key:e,participantIdentity:t,keyIndex:r};if(!this.options.sharedKey&&!t)throw new Error("participant identity needs to be passed for encryption key if sharedKey option is false");this.keyInfoMap.set("".concat(null!=t?t:"shared","-").concat(null!=r?r:0),n),this.emit(h.fo.SetKey,n)}},{key:"getKeys",value:function(){return Array.from(this.keyInfoMap.values())}},{key:"getOptions",value:function(){return this.options}},{key:"ratchetKey",value:function(e,t){this.emit(h.fo.RatchetRequest,e,t)}}])}(l.EventEmitter))},9676:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Safari11=void 0;const s=n(7363),i=n(2994),a=n(1765),o=n(8046),c=n(5544),d=n(4496),u=n(521),l=n(1305),p=new i.Logger("Safari11"),h={OS:1024,MIS:1024};class m extends u.HandlerInterface{constructor(){super(),r(this,"_direction"),r(this,"_remoteSdp"),r(this,"_sendingRtpParametersByKind"),r(this,"_sendingRemoteRtpParametersByKind"),r(this,"_forcedLocalDtlsRole"),r(this,"_pc"),r(this,"_sendStream",new MediaStream),r(this,"_mapSendLocalIdRtpSender",new Map),r(this,"_nextSendLocalId",0),r(this,"_mapRecvLocalIdInfo",new Map),r(this,"_hasDataChannelMediaSection",!1),r(this,"_nextSendSctpStreamId",0),r(this,"_transportReady",!1)}static createFactory(){return()=>new m}get name(){return"Safari11"}close(){if(p.debug("close()"),this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}async getNativeRtpCapabilities(){p.debug("getNativeRtpCapabilities()");const e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const r=await e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{e.close()}catch(t){}const n=s.parse(r.sdp);return c.extractRtpCapabilities({sdpObject:n})}catch(r){try{e.close()}catch(t){}throw r}}async getNativeSctpCapabilities(){return p.debug("getNativeSctpCapabilities()"),{numStreams:h}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:s,iceServers:i,iceTransportPolicy:a,additionalSettings:c,proprietaryConstraints:d,extendedRtpCapabilities:u}){p.debug("run()"),this._direction=e,this._remoteSdp=new l.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:s,planB:!0}),this._sendingRtpParametersByKind={audio:o.getSendingRtpParameters("audio",u),video:o.getSendingRtpParameters("video",u)},this._sendingRemoteRtpParametersByKind={audio:o.getSendingRemoteRtpParameters("audio",u),video:o.getSendingRemoteRtpParameters("video",u)},n.role&&"auto"!==n.role&&(this._forcedLocalDtlsRole="server"===n.role?"client":"server"),this._pc=new RTCPeerConnection({iceServers:i??[],iceTransportPolicy:a??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...c},d),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",e=>{this.emit("@icecandidateerror",e)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(p.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})}async updateIceServers(e){p.debug("updateIceServers()");const t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){if(p.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady)if("send"===this._direction){const e=await this._pc.createOffer({iceRestart:!0});p.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e);const t={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}else{const e={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();p.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:n}){this.assertSendDirection(),p.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),n&&p.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(e),this._pc.addTrack(e,this._sendStream);let i,u=await this._pc.createOffer(),l=s.parse(u.sdp);l.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();const h=a.clone(this._sendingRtpParametersByKind[e.kind]);h.codecs=o.reduceCodecs(h.codecs);const m=a.clone(this._sendingRemoteRtpParametersByKind[e.kind]);if(m.codecs=o.reduceCodecs(m.codecs),this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:l}),"video"===e.kind&&t&&t.length>1&&(p.debug("send() | enabling simulcast"),l=s.parse(u.sdp),i=l.media.find(e=>"video"===e.type),d.addLegacySimulcast({offerMediaObject:i,track:e,numStreams:t.length}),u={type:"offer",sdp:s.write(l)}),p.debug("send() | calling pc.setLocalDescription() [offer:%o]",u),await this._pc.setLocalDescription(u),l=s.parse(this._pc.localDescription.sdp),i=l.media.find(t=>t.type===e.kind),h.rtcp.cname=c.getCname({offerMediaObject:i}),h.encodings=d.getRtpEncodings({offerMediaObject:i,track:e}),t)for(let s=0;s<h.encodings.length;++s)t[s]&&Object.assign(h.encodings[s],t[s]);if(h.encodings.length>1&&"video/vp8"===h.codecs[0].mimeType.toLowerCase())for(const s of h.encodings)s.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:i,offerRtpParameters:h,answerRtpParameters:m,codecOptions:r});const f={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("send() | calling pc.setRemoteDescription() [answer:%o]",f),await this._pc.setRemoteDescription(f);const g=String(this._nextSendLocalId);this._nextSendLocalId++;const v=this._pc.getSenders().find(t=>t.track===e);return this._mapSendLocalIdRtpSender.set(g,v),{localId:g,rtpParameters:h,rtpSender:v}}async stopSending(e){this.assertSendDirection();const t=this._mapSendLocalIdRtpSender.get(e);if(!t)throw new Error("associated RTCRtpSender not found");t.track&&this._sendStream.removeTrack(t.track),this._mapSendLocalIdRtpSender.delete(e);const r=await this._pc.createOffer();p.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r);try{await this._pc.setLocalDescription(r)}catch(s){if(0===this._sendStream.getTracks().length)return void p.warn("stopSending() | ignoring expected error due no sending tracks: %s",s.toString());throw s}if("stable"===this._pc.signalingState)return;const n={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n)}async pauseSending(e){}async resumeSending(e){}async replaceTrack(e,t){this.assertSendDirection(),t?p.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):p.debug("replaceTrack() [localId:%s, no track]",e);const r=this._mapSendLocalIdRtpSender.get(e);if(!r)throw new Error("associated RTCRtpSender not found");const n=r.track;await r.replaceTrack(t),n&&this._sendStream.removeTrack(n),t&&this._sendStream.addTrack(t)}async setMaxSpatialLayer(e,t){this.assertSendDirection(),p.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,t);const r=this._mapSendLocalIdRtpSender.get(e);if(!r)throw new Error("associated RTCRtpSender not found");const n=r.getParameters();n.encodings.forEach((e,r)=>{e.active=r<=t}),await r.setParameters(n)}async setRtpEncodingParameters(e,t){this.assertSendDirection(),p.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,t);const r=this._mapSendLocalIdRtpSender.get(e);if(!r)throw new Error("associated RTCRtpSender not found");const n=r.getParameters();n.encodings.forEach((e,r)=>{n.encodings[r]={...e,...t}}),await r.setParameters(n)}async getSenderStats(e){this.assertSendDirection();const t=this._mapSendLocalIdRtpSender.get(e);if(!t)throw new Error("associated RTCRtpSender not found");return t.getStats()}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:n,protocol:i}){this.assertSendDirection();const a={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:r,protocol:i};p.debug("sendDataChannel() [options:%o]",a);const o=this._pc.createDataChannel(n,a);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%h.MIS,!this._hasDataChannelMediaSection){const e=await this._pc.createOffer(),t=s.parse(e.sdp),r=t.media.find(e=>"application"===e.type);this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:t}),p.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),this._remoteSdp.sendSctpAssociation({offerMediaObject:r});const n={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n),this._hasDataChannelMediaSection=!0}return{dataChannel:o,sctpStreamParameters:{streamId:a.id,ordered:a.ordered,maxPacketLifeTime:a.maxPacketLifeTime,maxRetransmits:a.maxRetransmits}}}async receive(e){this.assertRecvDirection();const t=[];for(const s of e){const{trackId:e,kind:t,rtpParameters:r,streamId:n}=s;p.debug("receive() [trackId:%s, kind:%s]",e,t);const i=t;this._remoteSdp.receive({mid:i,kind:t,offerRtpParameters:r,streamId:n??r.rtcp.cname,trackId:e})}const r={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);let n=await this._pc.createAnswer();const i=s.parse(n.sdp);for(const s of e){const{kind:e,rtpParameters:t}=s,r=e,n=i.media.find(e=>String(e.mid)===r);c.applyCodecParameters({offerRtpParameters:t,answerMediaObject:n})}n={type:"answer",sdp:s.write(i)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:i}),p.debug("receive() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n);for(const s of e){const{kind:e,trackId:r,rtpParameters:n}=s,i=e,a=r,o=this._pc.getReceivers().find(e=>e.track&&e.track.id===a);if(!o)throw new Error("new RTCRtpReceiver not");this._mapRecvLocalIdInfo.set(a,{mid:i,rtpParameters:n,rtpReceiver:o}),t.push({localId:a,track:o.track,rtpReceiver:o})}return t}async stopReceiving(e){this.assertRecvDirection();for(const n of e){p.debug("stopReceiving() [localId:%s]",n);const{mid:e,rtpParameters:t}=this._mapRecvLocalIdInfo.get(n)??{};this._mapRecvLocalIdInfo.delete(n),this._remoteSdp.planBStopReceiving({mid:e,offerRtpParameters:t})}const t={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const r=await this._pc.createAnswer();p.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r)}async getReceiverStats(e){this.assertRecvDirection();const{rtpReceiver:t}=this._mapRecvLocalIdInfo.get(e)??{};if(!t)throw new Error("associated RTCRtpReceiver not found");return t.getStats()}async pauseReceiving(e){}async resumeReceiving(e){}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){this.assertRecvDirection();const{streamId:n,ordered:i,maxPacketLifeTime:a,maxRetransmits:o}=e,c={negotiated:!0,id:n,ordered:i,maxPacketLifeTime:a,maxRetransmits:o,protocol:r};p.debug("receiveDataChannel() [options:%o]",c);const d=this._pc.createDataChannel(t,c);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const e={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e);const t=await this._pc.createAnswer();if(!this._transportReady){const e=s.parse(t.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:e})}p.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setLocalDescription(t),this._hasDataChannelMediaSection=!0}return{dataChannel:d}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t||(t=s.parse(this._pc.localDescription.sdp));const r=c.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await new Promise((e,t)=>{this.safeEmit("@connect",{dtlsParameters:r},e,t)}),this._transportReady=!0}assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}t.Safari11=m},9746:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=r(6697);t.default=function(e){return"string"==typeof e&&n.default.test(e)}},9792:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Producer=void 0;const s=n(2994),i=n(3953),a=n(4893),o=new s.Logger("Producer");class c extends i.EnhancedEventEmitter{constructor({id:e,localId:t,rtpSender:n,track:s,rtpParameters:a,stopTracks:c,disableTrackOnPause:d,zeroRtpOnPause:u,appData:l}){super(),r(this,"_id"),r(this,"_localId"),r(this,"_closed",!1),r(this,"_rtpSender"),r(this,"_track"),r(this,"_kind"),r(this,"_rtpParameters"),r(this,"_paused"),r(this,"_maxSpatialLayer"),r(this,"_stopTracks"),r(this,"_disableTrackOnPause"),r(this,"_zeroRtpOnPause"),r(this,"_appData"),r(this,"_observer",new i.EnhancedEventEmitter),o.debug("constructor()"),this._id=e,this._localId=t,this._rtpSender=n,this._track=s,this._kind=s.kind,this._rtpParameters=a,this._paused=!!d&&!s.enabled,this._maxSpatialLayer=void 0,this._stopTracks=c,this._disableTrackOnPause=d,this._zeroRtpOnPause=u,this._appData=l??{},this.onTrackEnded=this.onTrackEnded.bind(this),this.handleTrack()}get id(){return this._id}get localId(){return this._localId}get closed(){return this._closed}get kind(){return this._kind}get rtpSender(){return this._rtpSender}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get maxSpatialLayer(){return this._maxSpatialLayer}get appData(){return this._appData}set appData(e){this._appData=e}get observer(){return this._observer}close(){this._closed||(o.debug("close()"),this._closed=!0,this.destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(o.debug("transportClosed()"),this._closed=!0,this.destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}async getStats(){if(this._closed)throw new a.InvalidStateError("closed");return new Promise((e,t)=>{this.safeEmit("@getstats",e,t)})}pause(){o.debug("pause()"),this._closed?o.error("pause() | Producer closed"):(this._paused=!0,this._track&&this._disableTrackOnPause&&(this._track.enabled=!1),this._zeroRtpOnPause&&new Promise((e,t)=>{this.safeEmit("@pause",e,t)}).catch(()=>{}),this._observer.safeEmit("pause"))}resume(){o.debug("resume()"),this._closed?o.error("resume() | Producer closed"):(this._paused=!1,this._track&&this._disableTrackOnPause&&(this._track.enabled=!0),this._zeroRtpOnPause&&new Promise((e,t)=>{this.safeEmit("@resume",e,t)}).catch(()=>{}),this._observer.safeEmit("resume"))}async replaceTrack({track:e}){if(o.debug("replaceTrack() [track:%o]",e),this._closed){if(e&&this._stopTracks)try{e.stop()}catch(t){}throw new a.InvalidStateError("closed")}if(e&&"ended"===e.readyState)throw new a.InvalidStateError("track ended");e!==this._track?(await new Promise((t,r)=>{this.safeEmit("@replacetrack",e,t,r)}),this.destroyTrack(),this._track=e,this._track&&this._disableTrackOnPause&&(this._paused?this._paused&&(this._track.enabled=!1):this._track.enabled=!0),this.handleTrack()):o.debug("replaceTrack() | same track, ignored")}async setMaxSpatialLayer(e){if(this._closed)throw new a.InvalidStateError("closed");if("video"!==this._kind)throw new a.UnsupportedError("not a video Producer");if("number"!=typeof e)throw new TypeError("invalid spatialLayer");e!==this._maxSpatialLayer&&(await new Promise((t,r)=>{this.safeEmit("@setmaxspatiallayer",e,t,r)}).catch(()=>{}),this._maxSpatialLayer=e)}async setRtpEncodingParameters(e){if(this._closed)throw new a.InvalidStateError("closed");if("object"!=typeof e)throw new TypeError("invalid params");await new Promise((t,r)=>{this.safeEmit("@setrtpencodingparameters",e,t,r)})}onTrackEnded(){o.debug('track "ended" event'),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}handleTrack(){this._track&&this._track.addEventListener("ended",this.onTrackEnded)}destroyTrack(){if(this._track)try{this._track.removeEventListener("ended",this.onTrackEnded),this._stopTracks&&this._track.stop()}catch(e){}}}t.Producer=c}},t={};function n(r){var s=t[r];if(void 0!==s)return s.exports;var i=t[r]={exports:{}};return e[r].call(i.exports,i,i.exports,n),i.exports}n.amdO={},n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var o={};return(()=>{n.r(o),n.d(o,{CameraDeviceInfo:()=>br,DeviceInfo:()=>yr,ExternalE2EEKeyProvider:()=>xi.l,MicrophoneDeviceInfo:()=>wr,VideoSDK:()=>Li,ZujoSDK:()=>Bi});var e=n(2284),t=n(467),r=n(3029),s=n(2901),i=n(4467),a=n(4756),c=n.n(a),d=n(6880),u=n.n(d);function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach(function(t){(0,i.A)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function h(e){return"Minified Redux error #"+e+"; visit https://redux.js.org/Errors?code="+e+" for the full message or use the non-minified dev environment for full errors. "}var m="function"==typeof Symbol&&Symbol.observable||"@@observable",f=function(){return Math.random().toString(36).substring(7).split("").join(".")},g={INIT:"@@redux/INIT"+f(),REPLACE:"@@redux/REPLACE"+f(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+f()}};function v(e,t,r){var n;if("function"==typeof t&&"function"==typeof r||"function"==typeof r&&"function"==typeof arguments[3])throw new Error(h(0));if("function"==typeof t&&void 0===r&&(r=t,t=void 0),void 0!==r){if("function"!=typeof r)throw new Error(h(1));return r(v)(e,t)}if("function"!=typeof e)throw new Error(h(2));var s=e,i=t,a=[],o=a,c=!1;function d(){o===a&&(o=a.slice())}function u(){if(c)throw new Error(h(3));return i}function l(e){if("function"!=typeof e)throw new Error(h(4));if(c)throw new Error(h(5));var t=!0;return d(),o.push(e),function(){if(t){if(c)throw new Error(h(6));t=!1,d();var r=o.indexOf(e);o.splice(r,1),a=null}}}function p(e){if(!function(e){if("object"!=typeof e||null===e)return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}(e))throw new Error(h(7));if(void 0===e.type)throw new Error(h(8));if(c)throw new Error(h(9));try{c=!0,i=s(i,e)}finally{c=!1}for(var t=a=o,r=0;r<t.length;r++)(0,t[r])();return e}return p({type:g.INIT}),(n={dispatch:p,subscribe:l,getState:u,replaceReducer:function(e){if("function"!=typeof e)throw new Error(h(10));s=e,p({type:g.REPLACE})}})[m]=function(){var e,t=l;return(e={subscribe:function(e){if("object"!=typeof e||null===e)throw new Error(h(11));function r(){e.next&&e.next(u())}return r(),{unsubscribe:t(r)}}})[m]=function(){return this},e},n}function _(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return 0===t.length?function(e){return e}:1===t.length?t[0]:t.reduce(function(e,t){return function(){return e(t.apply(void 0,arguments))}})}function y(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(e){return function(){var r=e.apply(void 0,arguments),n=function(){throw new Error(h(15))},s={getState:r.getState,dispatch:function(){return n.apply(void 0,arguments)}},i=t.map(function(e){return e(s)});return n=_.apply(void 0,i)(r.dispatch),p(p({},r),{},{dispatch:n})}}}function b(e){return function(t){var r=t.dispatch,n=t.getState;return function(t){return function(s){return"function"==typeof s?s(r,n,e):t(s)}}}}var w=b();w.withExtraArgument=b;const S=w;var R=n(2211),k=n.n(R);function E(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function T(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?E(Object(r),!0).forEach(function(t){(0,i.A)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):E(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var C={url:null,state:"new",activeSpeakerId:null,statsPeerId:null,faceDetection:!1};function P(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function O(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?P(Object(r),!0).forEach(function(t){(0,i.A)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):P(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var x={id:null,displayName:null,displayNameSet:!1,device:null,canSendMic:!1,canSendWebcam:!1,canChangeWebcam:!1,webcamInProgress:!1,shareInProgress:!1,audioOnly:!1,audioOnlyInProgress:!1,audioMuted:!1,restartIceInProgress:!1};function D(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function I(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?D(Object(r),!0).forEach(function(t){(0,i.A)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):D(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var A={};function M(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function L(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?M(Object(r),!0).forEach(function(t){(0,i.A)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):M(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var N={},j=n(5458);function B(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function U(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?B(Object(r),!0).forEach(function(t){(0,i.A)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):B(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var F={};function q(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function W(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?q(Object(r),!0).forEach(function(t){(0,i.A)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):q(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var V={};function H(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function z(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?H(Object(r),!0).forEach(function(t){(0,i.A)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):H(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var K={},G=[];const $=function(e){for(var t=Object.keys(e),r={},n=0;n<t.length;n++){var s=t[n];"function"==typeof e[s]&&(r[s]=e[s])}var i,a,o=Object.keys(r);try{a=r,Object.keys(a).forEach(function(e){var t=a[e];if(void 0===t(void 0,{type:g.INIT}))throw new Error(h(12));if(void 0===t(void 0,{type:g.PROBE_UNKNOWN_ACTION()}))throw new Error(h(13))})}catch(a){i=a}return function(e,t){if(void 0===e&&(e={}),i)throw i;for(var n=!1,s={},a=0;a<o.length;a++){var c=o[a],d=r[c],u=e[c],l=d(u,t);if(void 0===l)throw t&&t.type,new Error(h(14));s[c]=l,n=n||l!==u}return(n=n||o.length!==Object.keys(e).length)?s:e}}({room:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:C,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_ROOM_URL":var r=t.payload.url;return T(T({},e),{},{url:r});case"SET_ROOM_STATE":var n=t.payload.state;return T(T({},e),{},"connected"===n?{state:n}:{state:n,activeSpeakerId:null,statsPeerId:null});case"SET_ROOM_ACTIVE_SPEAKER":var s=t.payload.peerId;return T(T({},e),{},{activeSpeakerId:s});case"SET_ROOM_STATS_PEER_ID":var i=t.payload.peerId;return e.statsPeerId===i?T(T({},e),{},{statsPeerId:null}):T(T({},e),{},{statsPeerId:i});case"SET_FACE_DETECTION":var a=t.payload;return T(T({},e),{},{faceDetection:a});case"REMOVE_PEER":var o=t.payload.peerId,c=T({},e);return o&&o===e.activeSpeakerId&&(c.activeSpeakerId=null),o&&o===e.statsPeerId&&(c.statsPeerId=null),c;default:return e}},me:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:x,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_ROOM_STATE":return"closed"===t.payload.state?O(O({},e),{},{webcamInProgress:!1,shareInProgress:!1,audioOnly:!1,audioOnlyInProgress:!1,audioMuted:!1,restartIceInProgress:!1}):e;case"SET_ME":var r=t.payload,n=r.peerId,s=r.displayName,i=r.displayNameSet,a=r.device;return O(O({},e),{},{id:n,displayName:s,displayNameSet:i,device:a});case"SET_MEDIA_CAPABILITIES":var o=t.payload,c=o.canSendMic,d=o.canSendWebcam;return O(O({},e),{},{canSendMic:c,canSendWebcam:d});case"SET_CAN_CHANGE_WEBCAM":var u=t.payload;return O(O({},e),{},{canChangeWebcam:u});case"SET_WEBCAM_IN_PROGRESS":var l=t.payload.flag;return O(O({},e),{},{webcamInProgress:l});case"SET_SHARE_IN_PROGRESS":var p=t.payload.flag;return O(O({},e),{},{shareInProgress:p});case"SET_DISPLAY_NAME":var h=t.payload.displayName;return h||(h=e.displayName),O(O({},e),{},{displayName:h,displayNameSet:!0});case"SET_AUDIO_ONLY_STATE":var m=t.payload.enabled;return O(O({},e),{},{audioOnly:m});case"SET_AUDIO_ONLY_IN_PROGRESS":var f=t.payload.flag;return O(O({},e),{},{audioOnlyInProgress:f});case"SET_AUDIO_MUTED_STATE":var g=t.payload.enabled;return O(O({},e),{},{audioMuted:g});case"SET_RESTART_ICE_IN_PROGRESS":var v=t.payload.flag;return O(O({},e),{},{restartIceInProgress:v});default:return e}},producers:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:A,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_ROOM_STATE":return"closed"===t.payload.state?{}:e;case"ADD_PRODUCER":var r=t.payload.producer;return I(I({},e),{},(0,i.A)({},r.id,r));case"REMOVE_PRODUCER":var n=t.payload.producerId,s=I({},e);return delete s[n],s;case"SET_PRODUCER_PAUSED":var a=t.payload.producerId,o=I(I({},e[a]),{},{paused:!0});return I(I({},e),{},(0,i.A)({},a,o));case"SET_PRODUCER_RESUMED":var c=t.payload.producerId,d=I(I({},e[c]),{},{paused:!1});return I(I({},e),{},(0,i.A)({},c,d));case"SET_PRODUCER_TRACK":var u=t.payload,l=u.producerId,p=u.track,h=I(I({},e[l]),{},{track:p});return I(I({},e),{},(0,i.A)({},l,h));case"SET_PRODUCER_SCORE":var m=t.payload,f=m.producerId,g=m.score,v=e[f];if(!v)return e;var _=I(I({},v),{},{score:g});return I(I({},e),{},(0,i.A)({},f,_));default:return e}},dataProducers:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:N,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_ROOM_STATE":return"closed"===t.payload.state?{}:e;case"ADD_DATA_PRODUCER":var r=t.payload.dataProducer;return L(L({},e),{},(0,i.A)({},r.id,r));case"REMOVE_DATA_PRODUCER":var n=t.payload.dataProducerId,s=L({},e);return delete s[n],s;default:return e}},peers:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:F,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_ROOM_STATE":return"closed"===t.payload.state?{}:e;case"ADD_PEER":var r=t.payload.peer;return U(U({},e),{},(0,i.A)({},r.id,r));case"REMOVE_PEER":var n=t.payload.peerId,s=U({},e);return delete s[n],s;case"SET_PEER_DISPLAY_NAME":var a=t.payload,o=a.displayName,c=e[a.peerId];if(!c)throw new Error("no Peer found");var d=U(U({},c),{},{displayName:o});return U(U({},e),{},(0,i.A)({},d.id,d));case"ADD_CONSUMER":var u=t.payload,l=u.consumer,p=e[u.peerId];if(!p)return U({},e);var h=[].concat((0,j.A)(p.consumers),[l.id]),m=U(U({},p),{},{consumers:h});return U(U({},e),{},(0,i.A)({},m.id,m));case"REMOVE_CONSUMER":var f=t.payload,g=f.consumerId,v=e[f.peerId];if(!v)return e;var _=v.consumers.indexOf(g);if(-1===_)return U({},e);var y=v.consumers.slice();y.splice(_,1);var b=U(U({},v),{},{consumers:y});return U(U({},e),{},(0,i.A)({},b.id,b));case"ADD_DATA_CONSUMER":var w=t.payload,S=w.dataConsumer,R=w.peerId;if(!R)return e;var k=e[R];if(!k)return U({},e);var E=[].concat((0,j.A)(k.dataConsumers),[S.id]),T=U(U({},k),{},{dataConsumers:E});return U(U({},e),{},(0,i.A)({},T.id,T));case"REMOVE_DATA_CONSUMER":var C=t.payload,P=C.dataConsumerId,O=C.peerId;if(!O)return e;var x=e[O];if(!x)return e;var D=x.dataConsumers.indexOf(P);if(-1===D)return U({},e);var I=x.dataConsumers.slice();I.splice(D,1);var A=U(U({},x),{},{dataConsumers:I});return U(U({},e),{},(0,i.A)({},A.id,A));default:return e}},consumers:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:V,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_ROOM_STATE":return"closed"===t.payload.state?{}:e;case"ADD_CONSUMER":var r=t.payload.consumer;return W(W({},e),{},(0,i.A)({},r.id,r));case"REMOVE_CONSUMER":var n=t.payload.consumerId,s=W({},e);return delete s[n],s;case"SET_CONSUMER_PAUSED":var a,o=t.payload,c=o.consumerId,d=o.originator;return a=W(W({},e[c]),{},"local"===d?{locallyPaused:!0,paused:!0}:{remotelyPaused:!0,paused:!0}),W(W({},e),{},(0,i.A)({},c,a));case"SET_CONSUMER_RESUMED":var u,l=t.payload,p=l.consumerId,h=l.originator;return u=W(W({},e[p]),{},"local"===h?{locallyPaused:!1,paused:!1}:{remotelyPaused:!1,paused:!1}),W(W({},e),{},(0,i.A)({},p,u));case"SET_CONSUMER_CURRENT_LAYERS":var m=t.payload,f=m.consumerId,g=m.spatialLayer,v=m.temporalLayer,_=W(W({},e[f]),{},{currentSpatialLayer:g,currentTemporalLayer:v});return W(W({},e),{},(0,i.A)({},f,_));case"SET_CONSUMER_PREFERRED_LAYERS":var y=t.payload,b=y.consumerId,w=y.spatialLayer,S=y.temporalLayer,R=W(W({},e[b]),{},{preferredSpatialLayer:w,preferredTemporalLayer:S});return W(W({},e),{},(0,i.A)({},b,R));case"SET_CONSUMER_PRIORITY":var k=t.payload,E=k.consumerId,T=k.priority,C=W(W({},e[E]),{},{priority:T});return W(W({},e),{},(0,i.A)({},E,C));case"SET_CONSUMER_TRACK":var P=t.payload,O=P.consumerId,x=P.track,D=W(W({},e[O]),{},{track:x});return W(W({},e),{},(0,i.A)({},O,D));case"SET_CONSUMER_SCORE":var I=t.payload,A=I.consumerId,M=I.score,L=e[A];if(!L)return e;var N=W(W({},L),{},{score:M});return W(W({},e),{},(0,i.A)({},A,N));default:return e}},dataConsumers:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:K,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_ROOM_STATE":return"closed"===t.payload.state?{}:e;case"ADD_DATA_CONSUMER":var r=t.payload.dataConsumer;return z(z({},e),{},(0,i.A)({},r.id,r));case"REMOVE_DATA_CONSUMER":var n=t.payload.dataConsumerId,s=z({},e);return delete s[n],s;default:return e}},notifications:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:G,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"ADD_NOTIFICATION":var r=t.payload.notification;return[].concat((0,j.A)(e),[r]);case"REMOVE_NOTIFICATION":var n=t.payload.notificationId;return e.filter(function(e){return e.id!==n});case"REMOVE_ALL_NOTIFICATIONS":return[];default:return e}}});var J=n(1919),Q=n(7007),Y=n(296),X=(n(1919).default,(0,s.A)(function e(){(0,r.A)(this,e),this.roomClient=null})),Z=new(function(){function e(){(0,r.A)(this,e),e.instance||(e.instance=new X)}return(0,s.A)(e,[{key:"getInstance",value:function(){return e.instance}}])}());Object.freeze(Z);var ee=Z.getInstance(),te="state",re=(0,s.A)(function e(t){(0,r.A)(this,e),(0,i.A)(this,"pausedBy",void 0),this.id=t.id,this.kind=t.track.kind,this.codec=t.codec,this.track=t.track,this.producerOrConsumer=t.instance,t.appData&&!0===t.appData.share&&"video"===t.track.kind&&(this.kind="share"),t.appData&&!0===t.appData.share&&"audio"===t.track.kind&&(this.kind="shareAudio"),this.rtpSender=t.rtpSender,this.rtpReceiver=t.rtpReceiver,this.eventEmitter=new Q},[{key:"pause",value:function(){ee.roomClient._pauseConsumer(this.producerOrConsumer)}},{key:"resume",value:function(){ee.roomClient._resumeConsumer(this.producerOrConsumer)}},{key:"handleStateChanged",value:function(e){var t=e.state;e.streamId,this.eventEmitter.emit(te,{state:t,timestamp:(new Date).getTime()})}},{key:"paused",get:function(){return this.producerOrConsumer.paused}},{key:"on",value:function(e,t){if(e!==te)throw new Error("Invalid event type from STREAM onn");this.eventEmitter.on(e,t)}},{key:"off",value:function(e,t){if(e!==te)throw new Error("Invalid event type from STREAM off");this.eventEmitter.off(e,t)}}]),ne=n(1803);function se(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function ie(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return ae(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?ae(e,t):void 0}}(e))||t){r&&(e=r);var n=0,s=function(){};return{s:s,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,o=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){o=!0,i=e},f:function(){try{a||null==r.return||r.return()}finally{if(o)throw i}}}}function ae(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var oe,ce,de,ue,le,pe="stream-enabled",he="stream-disabled",me="media-status-changed",fe="video-quality-changed",ge="stream-paused",ve="stream-resumed",_e="producer-added",ye="producer-removed",be="consumer-added",we="consumer-removed",Se="e2ee-state-change",Re=(0,s.A)(function e(n){var s=this;(0,r.A)(this,e),(0,i.A)(this,"captureImage",(0,t.A)(c().mark(function e(){var r,n,i,a,o,d,u,l,p,h,m=arguments;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=(r=m.length>0&&void 0!==m[0]?m[0]:{}).height,i=r.width,e.prev=1,a=(0,j.A)(s.streams.values()),o=ie(a),e.prev=2,u=c().mark(function e(){var r,s,a,o,u;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("video"!=(r=d.value).kind){e.next=4;break}return e.prev=1,(s=new MediaStream).addTrack(r.track),(a=document.createElement("video")).srcObject=s,a.playsInline=!0,(o=document.createElement("canvas")).id="canvasId",e.next=2,new Promise(function(e,r){a.addEventListener("loadeddata",(0,t.A)(c().mark(function t(){var s,d,u,l,p,h,m;return c().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return s=a.videoWidth,d=a.videoHeight,u=16/9,null==n&&null==i&&(n=d,i=s),null==n&&null==n||(n<=0||n>d)&&(n=d),null==i&&null==i||(i<=0||i>s)&&(i=s),null==n&&(n=i/u),null==i&&(i=n*u),o.width=i,o.height=n,t.prev=1,t.next=2,a.play();case 2:document.body.appendChild(a),l=(o.width-s*u)/2,p=(o.height-d*u)/2,o.getContext("2d").clearRect(0,0,l/2,p/2),o.getContext("2d").drawImage(a,0,0),h=o.toDataURL("image/jpeg").split(";base64,")[1],document.body.appendChild(o),document.body.removeChild(o),document.body.removeChild(a),e(h),t.next=4;break;case 3:t.prev=3,m=t.catch(1),r(m);case 4:case"end":return t.stop()}},t,null,[[1,3]])})))});case 2:return u=e.sent,e.abrupt("return",{v:u});case 3:e.prev=3,e.catch(1);case 4:case"end":return e.stop()}},e,null,[[1,3]])}),o.s();case 3:if((d=o.n()).done){e.next=6;break}return e.delegateYield(u(),"t0",4);case 4:if(!(l=e.t0)){e.next=5;break}return e.abrupt("return",l.v);case 5:e.next=3;break;case 6:e.next=8;break;case 7:e.prev=7,p=e.catch(2),o.e(p);case 8:return e.prev=8,o.f(),e.finish(8);case 9:throw new Error("Camera must be on to capture an image");case 10:e.prev=10,h=e.catch(1),ee.roomClient._videosdkLogs&&ee.roomClient._videosdkLogs.pushLogs({logText:"Error on image capture",logType:"ERROR",attributes:{error:h.message}});case 11:case"end":return e.stop()}},e,null,[[1,10],[2,7,8,9]])}))),this.id=n.id,this.displayName=n.displayName,this.streams=new Map,this.quality="low",this.screenShareQuality="high",this.local=n.local||!1,this.pinState={cam:!1,share:!1},this.webcamOn=!1,this.micOn=!1,this.mode=n.mode,this.metaData=n.metaData,this.eventEmitter=new Q.EventEmitter,this.participantVideoElements=new Map,this.participantAudioElements=new Map,this.videoVisible=!1,this.height=null,this.width=null,this.resizeObserver=null},[{key:"_setPinState",value:function(e){null!=e.cam&&(this.pinState.cam=e.cam),null!=e.share&&(this.pinState.share=e.share)}},{key:"remove",value:function(){ee.roomClient.removePeer(this.id)}},{key:"enableMic",value:function(){ee.roomClient.enablePeerMic(this.id)}},{key:"disableMic",value:function(){ee.roomClient.disablePeerMic(this.id)}},{key:"enableWebcam",value:function(){ee.roomClient.enablePeerWebcam(this.id)}},{key:"disableWebcam",value:function(){ee.roomClient.disablePeerWebcam(this.id)}},{key:"getTransportStats",value:function(){return ee.roomClient.getTransportRemoteStats({participantId:this.id})}},{key:"handleStreamStateChanged",value:function(e){var t=e.state,r=(e.peerId,e.streamId),n=this.streams.get(r);null!=n&&("video"!==n.kind&&"share"!==n.kind||n.handleStateChanged({state:t,streamId:r}))}},{key:"addStream",value:function(e){if(e){this.streams.set(e.id,e),"video"!==e.kind||this.local||ee.roomClient.setConsumerQuality(e.id,this.quality);var t=new MediaStream;t.addTrack(e.track);try{if(["video","share"].includes(e.kind)){var r=this.participantVideoElements.get(e.kind);if(r){var n={display:"block",objectFit:"share"===e.kind?"contain":"cover",width:"100%"};Object.assign(r.style,n),r.srcObject=t,r.play().catch(function(e){}),("share"===e.kind||"video"===e.kind&&this.videoVisible)&&e.resume()}}if(("audio"===e.kind||"shareAudio"===e.kind)&&!this.local){var s=this.participantAudioElements.get(e.kind);s&&(s.srcObject=t,s.play().catch(function(e){}))}this.eventEmitter.emit(pe,e),"video"===e.kind&&!this.local&&this.height&&this.width&&this.setViewPort(this.width,this.height)}catch(i){}}}},{key:"updateStream",value:function(e){this.streams.set(e.id,e),this.eventEmitter.emit(pe,e)}},{key:"deleteStream",value:function(e){var t=this.streams.get(e);if(null!=t){this.streams.delete(e);var r={video:{collection:this.participantVideoElements,type:"video"},share:{collection:this.participantVideoElements,type:"share"},audio:{collection:this.participantAudioElements,type:"audio"},shareAudio:{collection:this.participantAudioElements,type:"shareAudio"}}[t.kind];if(r){var n=r.collection.get(r.type);n&&(n.style.display="none")}return this.eventEmitter.emit(he,t),t}}},{key:"streamResumed",value:function(e){this.streams.get(e)}},{key:"streamPaused",value:function(e){this.streams.get(e)}},{key:"updateParticipantMediaState",value:function(e,t){"audio"==e?this.micOn=t:"video"==e&&(this.webcamOn=t),this.eventEmitter.emit(me,{peerId:this.id,kind:e,newStatus:t})}},{key:"handleParticipantPause",value:function(e){if(null!=e&&e.consumerId){var t=this.streams.get(e.consumerId);t&&(t.pausedBy="SUB_MANAGER")}this.eventEmitter.emit(ge,{kind:null==e?void 0:e.kind,reason:null==e?void 0:e.reason})}},{key:"handleParticipantResume",value:function(e){if(null!=e&&e.consumerId){var t=this.streams.get(e.consumerId);t&&(t.pausedBy=void 0)}this.eventEmitter.emit(ve,{kind:null==e?void 0:e.kind,reason:null==e?void 0:e.reason})}},{key:"handleE2EEStateChange",value:function(e){null==e||delete e.peerId,this.eventEmitter.emit(Se,e)}},{key:"videoQualityChanged",value:function(e,t){this.eventEmitter.emit(fe,{peerId:this.id,prevQuality:e,currentQuality:t})}},{key:"setQuality",value:function(e){if(!this.local){if("undefined"!=typeof document&&this.resizeObserver){var t=document.querySelector("#f-".concat(this.id));t&&this.resizeObserver.unobserve(t)}this.quality=e,(0,j.A)(this.streams.entries()).forEach(function(t){var r=t[1];"video"===r.kind&&ee.roomClient.setConsumerQuality(r.id,e)})}}},{key:"setScreenShareQuality",value:function(e){this.local||(this.screenShareQuality=e,this.streams.forEach(function(t){"share"===t.kind&&ee.roomClient.setConsumerScreenShareQuality(t.id,e)}))}},{key:"setViewPort",value:function(e,t){(0,j.A)(this.streams.entries()).forEach(function(r){var n=r[1];"video"===n.kind&&ee.roomClient.setViewPort(n.producerOrConsumer,e,t)})}},{key:"pin",value:function(e){switch(e){case"SHARE_AND_CAM":case void 0:this._setPinState({cam:!0,share:!0});break;case"CAM":this._setPinState({cam:!0});break;case"SHARE":this._setPinState({share:!0});break;default:throw new Error("Unknown pin type")}ee.roomClient.pinStateChange({peerId:this.id,state:this.pinState})}},{key:"unpin",value:function(e){switch(e){case"SHARE_AND_CAM":case void 0:this._setPinState({cam:!1,share:!1});break;case"CAM":this._setPinState({cam:!1});break;case"SHARE":this._setPinState({share:!1});break;default:throw new Error("Unknown unpin type")}ee.roomClient.pinStateChange({peerId:this.id,state:this.pinState})}},{key:"switchTo",value:(le=(0,t.A)(c().mark(function e(t){var r,n,s;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.meetingId,n=t.payload,s=t.token,e.next=1,ee.roomClient.switchPeerRoom({peerId:this.id,roomId:r,payload:n,token:s});case 1:case"end":return e.stop()}},e,this)})),function(e){return le.apply(this,arguments)})},{key:"getVideoStats",value:(ue=(0,t.A)(c().mark(function e(){var t,r,n,s,i,a;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.local){e.next=2;break}return e.next=1,ee.roomClient.getVideoRemoteStats();case 1:return e.abrupt("return",e.sent);case 2:t=(0,j.A)(this.streams.entries()),r=ie(t),e.prev=3,r.s();case 4:if((n=r.n()).done){e.next=7;break}if(s=(0,Y.A)(n.value,2),i=s[0],"video"!=s[1].kind){e.next=6;break}return e.next=5,ee.roomClient.getConsumerRemoteStats(i);case 5:return e.abrupt("return",e.sent);case 6:e.next=4;break;case 7:e.next=9;break;case 8:e.prev=8,a=e.catch(3),r.e(a);case 9:return e.prev=9,r.f(),e.finish(9);case 10:case"end":return e.stop()}},e,this,[[3,8,9,10]])})),function(){return ue.apply(this,arguments)})},{key:"getShareStats",value:(de=(0,t.A)(c().mark(function e(){var t,r,n,s,i,a;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.local){e.next=2;break}return e.next=1,ee.roomClient.getShareRemoteStats();case 1:return e.abrupt("return",e.sent);case 2:t=(0,j.A)(this.streams.entries()),r=ie(t),e.prev=3,r.s();case 4:if((n=r.n()).done){e.next=7;break}if(s=(0,Y.A)(n.value,2),i=s[0],"share"!=s[1].kind){e.next=6;break}return e.next=5,ee.roomClient.getConsumerRemoteStats(i);case 5:return e.abrupt("return",e.sent);case 6:e.next=4;break;case 7:e.next=9;break;case 8:e.prev=8,a=e.catch(3),r.e(a);case 9:return e.prev=9,r.f(),e.finish(9);case 10:case"end":return e.stop()}},e,this,[[3,8,9,10]])})),function(){return de.apply(this,arguments)})},{key:"getShareAudioStats",value:(ce=(0,t.A)(c().mark(function e(){var t,r,n,s,i,a;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.local){e.next=2;break}return e.next=1,ee.roomClient.getShareAudioRemoteStats();case 1:return e.abrupt("return",e.sent);case 2:t=(0,j.A)(this.streams.entries()),r=ie(t),e.prev=3,r.s();case 4:if((n=r.n()).done){e.next=7;break}if(s=(0,Y.A)(n.value,2),i=s[0],"shareAudio"!=s[1].kind){e.next=6;break}return e.next=5,ee.roomClient.getConsumerRemoteStats(i);case 5:return e.abrupt("return",e.sent);case 6:e.next=4;break;case 7:e.next=9;break;case 8:e.prev=8,a=e.catch(3),r.e(a);case 9:return e.prev=9,r.f(),e.finish(9);case 10:case"end":return e.stop()}},e,this,[[3,8,9,10]])})),function(){return ce.apply(this,arguments)})},{key:"getAudioStats",value:(oe=(0,t.A)(c().mark(function e(){var t,r,n,s,i,a;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.micOn){e.next=1;break}return e.abrupt("return",[]);case 1:if(!this.local){e.next=3;break}return e.next=2,ee.roomClient.getAudioRemoteStats();case 2:return e.abrupt("return",e.sent);case 3:t=(0,j.A)(this.streams.entries()),r=ie(t),e.prev=4,r.s();case 5:if((n=r.n()).done){e.next=8;break}if(s=(0,Y.A)(n.value,2),i=s[0],"audio"!=s[1].kind){e.next=7;break}return e.next=6,ee.roomClient.getConsumerRemoteStats(i);case 6:return e.abrupt("return",e.sent);case 7:e.next=5;break;case 8:e.next=10;break;case 9:e.prev=9,a=e.catch(4),r.e(a);case 10:return e.prev=10,r.f(),e.finish(10);case 11:case"end":return e.stop()}},e,this,[[4,9,10,11]])})),function(){return oe.apply(this,arguments)})},{key:"consumeMicStreams",value:function(){ee.roomClient.consumeMicStreams(this.id)}},{key:"consumeWebcamStreams",value:function(){ee.roomClient.consumeWebcamStreams(this.id)}},{key:"stopConsumingWebcamStreams",value:function(){ee.roomClient.stopConsumingWebcamStreams(this.id)}},{key:"stopConsumingMicStreams",value:function(){ee.roomClient.stopConsumingMicStreams(this.id)}},{key:"renderVideo",value:function(e){for(var t,r=this,n=e.type,s=void 0===n?"video":n,a=e.maxQuality,o=void 0===a?"auto":a,c=e.videostyle,d=void 0===c?{}:c,u=e.containerStyle,l=void 0===u?{}:u,p=0,h=(0,j.A)(this.streams.values());p<h.length;p++){var m=h[p];m.kind==s&&(t=new MediaStream).addTrack(m.track)}if(this.participantVideoElements.get(s)){if(t){var f=this.participantVideoElements.get(s);f&&(f.srcObject=t,f.play().catch(function(e){}))}return this.participantVideoElements.get(s)}try{var g=document.createElement("div");g.classList.add("video-container","participant-video-".concat(this.id)),g.setAttribute("id","f-".concat(this.id).concat("share"===s?"-share":"")),g.style.setProperty("position","relative"),Object.assign(g.style,l);var v=document.createElement("video");if(v.setAttribute("id","v-".concat(this.id).concat("share"===s?"-share":"")),v.setAttribute("playsinline",""),v.setAttribute("webkit-playsinline",""),v.setAttribute("x5-playsinline",""),v.playsinline=!0,v.muted=!0,v.autoplay=!0,v.onerror=function(e){},Object.assign(v.style,function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?se(Object(r),!0).forEach(function(t){(0,i.A)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):se(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({width:"100%",height:"100%",objectFit:"share"===s?"contain":"cover"},d)),t&&(v.srcObject=t,v.play().then(function(e){}).catch(function(e){})),g.appendChild(v),this.participantVideoElements.set(s,v),this.videoVisible=!1,!this.local&&"video"===s){var _=(0,ne.sg)(function(e){if(0!=e.length)if(e[e.length-1].intersectionRatio>0){r.videoVisible=!0;for(var t=0,n=(0,j.A)(r.streams.values());t<n.length;t++){var s=n[t];"video"==s.kind&&"SUB_MANAGER"!==s.pausedBy&&s.paused&&s.resume()}}else{r.videoVisible=!1;for(var i=0,a=(0,j.A)(r.streams.values());i<a.length;i++){var o=a[i];"video"==o.kind&&o.pause()}}},500);if(new IntersectionObserver(_,{root:null,rootMargin:"0px",threshold:0}).observe(g),"auto"==o&&"video"===s){var y=(0,ne.sg)(function(e){var t=e[0].contentRect,n=t.width,s=t.height;n>0&&s>0&&(r.height=s,r.width=n,r.setViewPort(n,s))},500),b=new ResizeObserver(y);b.observe(g),this.resizeObserver=b}}return"video"!==s||"auto"===o||this.local||this.setQuality(o),g}catch(w){}}},{key:"renderAudio",value:function(e){var t=e.type,r=void 0===t?"audio":t;if(this.local)return null;try{if(this.participantAudioElements.get(r)){var n=this.participantAudioElements.get(r),s=this.getAudioStream(r);return s&&n&&(n.srcObject=s,n.play().catch(function(e){})),n}var i=document.createElement("audio");i.setAttribute("id","a-".concat(this.id,"-").concat(r)),i.autoplay=!1,i.playsInline=!0,i.controls=!1,i.style.display="none",i.onerror=function(e){};var a=this.getAudioStream(r);return a&&(i.srcObject=a,i.play().catch(function(e){})),this.participantAudioElements.set(r,i),i}catch(o){return null}}},{key:"getAudioStream",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"audio",t=(0,j.A)(this.streams.values()).find(function(t){return t.kind===e});if(t){var r=new MediaStream;return r.addTrack(t.track),t.resume(),r}return null}},{key:"addProducer",value:function(e){this.eventEmitter.emit(_e,e)}},{key:"removeProducer",value:function(e){this.eventEmitter.emit(ye,e)}},{key:"addConsumer",value:function(e){this.eventEmitter.emit(be,e)}},{key:"removeConsumer",value:function(e){this.eventEmitter.emit(we,e)}},{key:"on",value:function(e,t){switch(e){case pe:case he:case me:case fe:case ge:case ve:case _e:case ye:case be:case we:case Se:this.eventEmitter.on(e,t);break;default:throw new Error("Invalid event type from participant onn")}}},{key:"off",value:function(e,t){switch(e){case pe:case he:case me:case fe:case ge:case ve:case _e:case ye:case be:case we:case Se:this.eventEmitter.off(e,t);break;default:throw new Error("Invalid event type from participant off")}}}]),ke=n(388),Ee=n(3954),Te=n(5501),Ce={CHARACTER_SPEAKING:"CHARACTER_SPEAKING",CHARACTER_THINKING:"CHARACTER_THINKING",CHARACTER_LISTENING:"CHARACTER_LISTENING"},Pe=n(2107);function Oe(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Oe=function(){return!!e})()}function xe(e,t,r){De(e,t),t.set(e,r)}function De(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function Ie(e,t){return e.get(Me(e,t))}function Ae(e,t,r){return e.set(Me(e,t),r),r}function Me(e,t,r){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:r;throw new TypeError("Private element is not present on this object")}var Le="stream-enabled",Ne="stream-disabled",je="character-joined",Be="character-left",Ue="media-status-changed",Fe="video-quality-changed",qe="character-state-changed",We="character-message",Ve="user-message",He="data",ze="error",Ke=new WeakMap,Ge=new WeakMap,$e=new WeakMap,Je=new WeakMap,Qe=new WeakMap,Ye=new WeakMap,Xe=new WeakMap,Ze=new WeakSet,et=function(e){function n(e){var s,a,o,d,u,l;return(0,r.A)(this,n),a=this,o=n,d=[{id:e.id,displayName:e.displayName,mode:Pe.nI.SEND_AND_RECV,metaData:e.metaData}],o=(0,Ee.A)(o),De(u=s=(0,ke.A)(a,Oe()?Reflect.construct(o,d||[],(0,Ee.A)(a).constructor):o.apply(a,d)),l=Ze),l.add(u),xe(s,Ke,void 0),xe(s,Ge,void 0),xe(s,$e,void 0),xe(s,Je,void 0),xe(s,Qe,void 0),xe(s,Ye,void 0),xe(s,Xe,void 0),(0,i.A)(s,"captureImage",(0,t.A)(c().mark(function e(){var t,r=arguments;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:throw(t=r.length>0&&void 0!==r[0]?r[0]:{}).height,t.width,new Error("captureImage method is not supported on character");case 1:case"end":return e.stop()}},e)}))),Ae(Qe,s,e.interactionId||null),s.id=e.id||null,Ae(Ke,s,e.characterRole),Ae(Ge,s,e.characterMode),Ae($e,s,e.knowledgeBases||[]),s.displayName=e.displayName,Ae(Je,s,e.language),Ae(Ye,s,e.state||Ce.CHARACTER_LISTENING),Ae(Xe,s,e.roomClient),s}return(0,Te.A)(n,e),(0,s.A)(n,[{key:"join",value:(p=(0,t.A)(c().mark(function e(){var t;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,Ie(Xe,this).joinCharacter({interactionId:Ie(Qe,this),characterId:this.id,characterRole:Ie(Ke,this),displayName:this.displayName,characterMode:Ie(Ge,this),knowledgeBases:Ie($e,this),language:Ie(Je,this),metaData:this.metaData});case 1:(t=e.sent)&&(this.id=t.characterId,this.displayName=t.displayName,Ae(Ge,this,t.characterMode),Ae(Ke,this,t.characterRole),Ae(Qe,this,t.interactionId),Ae($e,this,t.knowledgeBases),Ae(Je,this,t.language),Ie(Xe,this)._eventEmitter.emit("INIT_CHARACTER",this));case 2:case"end":return e.stop()}},e,this)})),function(){return p.apply(this,arguments)})},{key:"leave",value:(l=(0,t.A)(c().mark(function e(){return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,Ie(Xe,this).removeCharacter();case 1:case"end":return e.stop()}},e,this)})),function(){return l.apply(this,arguments)})},{key:"remove",value:(u=(0,t.A)(c().mark(function e(){return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("remove method is not supported on character");case 1:case"end":return e.stop()}},e)})),function(){return u.apply(this,arguments)})},{key:"sendMessage",value:(d=(0,t.A)(c().mark(function e(t){return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,Ie(Xe,this).sendCharacterMessage({interactionId:Ie(Qe,this),text:t});case 1:case"end":return e.stop()}},e,this)})),function(e){return d.apply(this,arguments)})},{key:"handleCharacterStateChanged",value:function(e){Object.keys(Ce).includes(e.status)&&(Me(Ze,this,tt).call(this,e.status),this.eventEmitter.emit(qe,e))}},{key:"handleCharacterMessage",value:function(e){this.eventEmitter.emit(We,e)}},{key:"interrupt",value:(o=(0,t.A)(c().mark(function e(){return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,Ie(Xe,this).interruptCharacter({interactionId:Ie(Qe,this)});case 1:case"end":return e.stop()}},e,this)})),function(){return o.apply(this,arguments)})},{key:"handleUserMessage",value:function(e){this.eventEmitter.emit(Ve,e)}},{key:"handleCharacterData",value:function(e){var t=e.topic,r=e.data;this.eventEmitter.emit(He,t,r)}},{key:"handleCharacterError",value:function(e){var t=e.data;this.eventEmitter.listenerCount(ze)>0&&this.eventEmitter.emit(ze,t)}},{key:"enableMic",value:function(){Ie(Xe,this).enablePeerMic(this.id)}},{key:"disableMic",value:function(){Ie(Xe,this).disablePeerMic(this.id)}},{key:"enableWebcam",value:function(){Ie(Xe,this).enablePeerWebcam(this.id)}},{key:"disableWebcam",value:function(){Ie(Xe,this).disablePeerWebcam(this.id)}},{key:"updateStream",value:function(e){throw new Error("updateStream method is not supported on character")}},{key:"switchTo",value:(a=(0,t.A)(c().mark(function e(t){return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:throw t.meetingId,t.payload,t.token,new Error("switchTo method is not supported on character");case 1:case"end":return e.stop()}},e)})),function(e){return a.apply(this,arguments)})},{key:"pin",value:function(e){throw new Error("pin method is not supported on character")}},{key:"on",value:function(e,t){switch(e){case Le:case Ne:case je:case Be:case Ue:case Fe:case qe:case We:case Ve:case He:case ze:this.eventEmitter.on(e,t);break;default:throw new Error("Invalid event type")}}},{key:"off",value:function(e,t){switch(e){case Le:case Ne:case je:case Be:case Ue:case Fe:case qe:case We:case Ve:case He:case ze:this.eventEmitter.off(e,t);break;default:throw new Error("Invalid event type")}}},{key:"state",get:function(){return Ie(Ye,this)}},{key:"knowledgeBases",get:function(){return Ie($e,this)}},{key:"characterMode",get:function(){return Ie(Ge,this)}},{key:"characterRole",get:function(){return Ie(Ke,this)}},{key:"interactionId",get:function(){return Ie(Qe,this)}},{key:"language",get:function(){return Ie(Je,this)}}]);var a,o,d,u,l,p}(Re);function tt(e){Ae(Ye,this,e)}function rt(e,t){return e.get(nt(e,t))}function nt(e,t,r){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:r;throw new TypeError("Private element is not present on this object")}var st=new WeakMap,it=function(){return(0,s.A)(function e(t,n){var s,i,a=t.id,o=t.displayName;(0,r.A)(this,e),function(e,t,r){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,r)}(this,st,void 0),this.id=a,this.displayName=o,i=n,(s=st).set(nt(s,this),i)},[{key:"switchTo",value:(e=(0,t.A)(c().mark(function e(t){var r,n,s;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.meetingId,n=t.payload,s=t.token,e.next=1,ee.roomClient.connectionSwitchPeerRoom({roomId:r,connectionRoomId:rt(st,this),payload:n,peerId:this.id,token:s});case 1:case"end":return e.stop()}},e,this)})),function(t){return e.apply(this,arguments)})}]);var e}(),at="participant-joined",ot="participant-left",ct="chat-message",dt=function(){return(0,s.A)(function e(t,n){var s=this;(0,r.A)(this,e),this.eventEmitter=new Q.EventEmitter,this.id=t,this.participants=new Map,n.forEach(function(e){s.participants.set(e.id,new it(e,s.id))})},[{key:"participantJoin",value:function(e){var t=new it(e,this.id);this.participants.set(e.id,t),this.eventEmitter.emit(at,t)}},{key:"participantLeft",value:function(e){this.participants.delete(e),this.eventEmitter.emit(ot,e)}},{key:"sendChatMessage",value:function(e){ee.roomClient.connectionSendChatMessage({roomId:this.id,message:e})}},{key:"sendChatMessageEvent",value:function(e){var t=e.participantId,r=e.message;this.eventEmitter.emit(ct,{participantId:t,message:r})}},{key:"end",value:(e=(0,t.A)(c().mark(function e(){return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,ee.roomClient.connectionEndMeeting({roomId:this.id});case 1:case"end":return e.stop()}},e,this)})),function(){return e.apply(this,arguments)})},{key:"on",value:function(e,t){switch(e){case at:case ot:case ct:this.eventEmitter.on(e,t);break;default:throw new Error("Invalid event type")}}},{key:"off",value:function(e,t){switch(e){case at:case ot:case ct:this.eventEmitter.off(e,t);break;default:throw new Error("Invalid event type")}}}]);var e}(),ut=(0,s.A)(function e(t){var n=t.roomId,s=t.peers,i=t.payload;(0,r.A)(this,e),this.id=n,this.payload=i,this.meeting=new dt(n,s)},[{key:"close",value:function(){ee.roomClient.closeConnection(this.id)}}]);function lt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function pt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?lt(Object(r),!0).forEach(function(t){(0,i.A)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):lt(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function ht(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function mt(e,t){return e.get(ft(e,t))}function ft(e,t,r){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:r;throw new TypeError("Private element is not present on this object")}var gt="error",vt="meeting-joined",_t="meeting-left",yt="participant-mode-changed",bt="participant-joined",wt="participant-left",St="speaker-changed",Rt="presenter-changed",kt="main-participant-changed",Et="chat-message",Tt="entry-requested",Ct="entry-responded",Pt="recording-state-changed",Ot="recording-started",xt="recording-stopped",Dt="livestream-state-changed",It="livestream-started",At="livestream-stopped",Mt="hls-state-changed",Lt="hls-started",Nt="hls-stopped",jt="whiteboard-started",Bt="whiteboard-stopped",Ut="video-state-changed",Ft="video-seeked",qt="mic-requested",Wt="webcam-requested",Vt="stream-enabled",Ht="stream-disabled",zt="pin-state-changed",Kt="connection-open",Gt="connection-close",$t="switch-meeting",Jt="meeting-state-changed",Qt="quality-limitation",Yt="paused-all-streams",Xt="resumed-all-streams",Zt="transcription-state-changed",er="transcription-text",tr="character-joined",rr="character-left",nr="media-relay-started",sr="media-relay-stopped",ir="media-relay-error",ar="media-relay-request-response",or="media-relay-request-received",cr=new WeakMap,dr=new WeakSet,ur=function(){return(0,s.A)(function n(s,a,o){var d,u,l,p,h=this;(0,r.A)(this,n),ht(this,d=dr),d.add(this),function(e,t){ht(e,t),t.set(e,void 0)}(this,cr),(0,i.A)(this,"pubSub",{publish:(p=(0,t.A)(c().mark(function t(r,n,s,i){return c().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(null==i){t.next=1;break}if("object"==(0,e.A)(i)){t.next=1;break}throw new Error('"payload" can only be object.');case 1:return t.next=2,h.roomClient.pubsubPublish(r,n,s,i);case 2:case"end":return t.stop()}},t)})),function(e,t,r,n){return p.apply(this,arguments)}),subscribe:(l=(0,t.A)(c().mark(function e(t,r){var n;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!mt(cr,h).listeners(t).includes(r)){e.next=1;break}return e.abrupt("return");case 1:return e.next=2,h.roomClient.pubsubSubscribe(t);case 2:return n=e.sent,mt(cr,h).on(t,r),e.abrupt("return",n);case 3:case"end":return e.stop()}},e)})),function(e,t){return l.apply(this,arguments)}),unsubscribe:(u=(0,t.A)(c().mark(function e(t,r){return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(mt(cr,h).off(t,r),0!=mt(cr,h).listeners(t).length){e.next=1;break}return e.next=1,h.roomClient.pubsubUnsubscribe(t);case 1:case"end":return e.stop()}},e)})),function(e,t){return u.apply(this,arguments)})}),(0,i.A)(this,"uploadBase64File",function(){var e=(0,t.A)(c().mark(function e(t){var r,n,s,i,a,o,d,u;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.base64Data,n=t.token,s=t.fileName,e.prev=1,r&&n&&s){e.next=2;break}throw new Error("please provide base64Data, token and fileName");case 2:return i="https://".concat(h.baseUrl,"/base64-upload?roomId=").concat(h.id),a={fileName:s,base64Data:r},e.next=3,fetch(i,{method:"POST",body:JSON.stringify(a),headers:{"Content-Type":"application/json",Authorization:n}});case 3:return o=e.sent,e.next=4,o.json();case 4:return d=e.sent,e.abrupt("return",d.url);case 5:e.prev=5,u=e.catch(1),h.roomClient._videosdkLogs&&h.roomClient._videosdkLogs.pushLogs({logText:"Error while Uploading Base64 File",logType:"ERROR",attributes:{error:u.message}});case 6:case"end":return e.stop()}},e,null,[[1,5]])}));return function(t){return e.apply(this,arguments)}}()),(0,i.A)(this,"fetchBase64File",function(){var e=(0,t.A)(c().mark(function e(t){var r,n,s,i,a,o;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.url,n=t.token,e.prev=1,r&&n){e.next=2;break}throw new Error("please provide url and token");case 2:return e.next=3,fetch(r,{headers:{Authorization:n}});case 3:return s=e.sent,e.next=4,s.arrayBuffer();case 4:return i=e.sent,a=window.btoa(new Uint8Array(i).reduce(function(e,t){return e+String.fromCharCode(t)},"")),e.abrupt("return",a);case 5:e.prev=5,o=e.catch(1),h.roomClient._videosdkLogs&&h.roomClient._videosdkLogs.pushLogs({logText:"Error while fetching Base64 File",logType:"ERROR",attributes:{error:o.message}});case 6:case"end":return e.stop()}},e,null,[[1,5]])}));return function(t){return e.apply(this,arguments)}}()),this.id=s,this.roomClient=o,this.activeSpeakerId=null,this.activePresenterId=null,this.mainParticipantId=null,this.connections=new Map,this.localParticipant=a,this.participants=new Map,this.characters=new Map,this.baseUrl=null,this.livestreamState="LIVESTREAM_STOPPED",this.recordingState="RECORDING_STOPPED",this.hlsState="HLS_STOPPED",this.transcriptionState="TRANSCRIPTION_STOPPED",this.hlsUrls={downstreamUrl:null,playbackHlsUrl:null,livestreamUrl:null},this.messages=[],this.eventEmitter=new Q.EventEmitter,function(e,t,r){e.set(ft(e,t),r)}(cr,this,new Q.EventEmitter),this.eventEmitter.setMaxListeners(9999),mt(cr,this).setMaxListeners(9999),this.roomClient.on("ERROR",function(e){return h.handleError(e)}),this.roomClient.on("ADD_PEER",function(e){return h.handlePeerAdd(e)}),this.roomClient.on("REMOVE_PEER",function(e){return h.handlePeerRemove(e)}),this.roomClient.on("STREAM_STATE_CHANGED",function(e){return h.handleStreamState(e)}),this.roomClient.on("ADD_PRODUCER",function(e){return h.handleProducerAdd(e)}),this.roomClient.on("UPDATE_PRODUCER",function(e){return h.handleUpdateProducer(e)}),this.roomClient.on("REMOVE_PRODUCER",function(e){return h.handleProducerRemove(e)}),this.roomClient.on("ADD_CONSUMER",function(e){return h.handleConsumerAdd(e)}),this.roomClient.on("REMOVE_CONSUMER",function(e){return h.handleConsumerRemove(e)}),this.roomClient.on("CONSUMER_RESUMED",function(e){return h.handleConsumerResume(e)}),this.roomClient.on("CONSUMER_PAUSED",function(e){return h.handleConsumerPause(e)}),this.roomClient.on("PARTICIPANT_MEDIA_STATE_CHANGED",function(e){return h.handleParticipantMediaStateChanged(e)}),this.roomClient.on("CHAT_MESSAGE",function(e){return h.handleNewChatMessage(e)}),this.roomClient.on("SET_ROOM_ACTIVE_SPEAKER",function(e){return h.handleSpeakerChange(e)}),this.roomClient.on("ENTRY_REQUESTED",function(e){return h.handleEntryRequested(e)}),this.roomClient.on("ENTRY_RESPONDED",function(e){return h.handleEntryResponded(e)}),this.roomClient.on("MEETING_JOINED",function(e){return h.handleMeetingJoined(e)}),this.roomClient.on("MEETING_LEFT",function(e){return h.handleMeetingLeft(e)}),this.roomClient.on("RECORDING_STATE_CHANGED",function(e){h.handleRecordingStateChanged(e)}),this.roomClient.on("RECORDING_STARTED",function(e){return h.handleRecordingStarted(e)}),this.roomClient.on("RECORDING_STOPPED",function(e){return h.handleRecordingStopped(e)}),this.roomClient.on("LIVESTREAM_STATE_CHANGED",function(e){h.handleLivestreamStateChanged(e)}),this.roomClient.on("LIVESTREAM_STARTED",function(e){return h.handleLivestreamStarted(e)}),this.roomClient.on("LIVESTREAM_STOPPED",function(e){return h.handleLivestreamStopped(e)}),this.roomClient.on("HLS_STATE_CHANGED",function(e){h.handleHlsStateChanged(e)}),this.roomClient.on("HLS_STARTED",function(e){h.handleHlsStarted(e)}),this.roomClient.on("HLS_STOPPED",function(e){h.handleHlsStopped(e)}),this.roomClient.on("TRANSCRIPTION_STATE_CHANGED",function(e){h.handleTranscriptionStateChanged(e)}),this.roomClient.on("TRANSCRIPTION_TEXT",function(e){h.handleTranscriptionText(e)}),this.roomClient.on("SUB_MANAGER_RESUMED",function(e){h.handleParticipantResumeBySubManager(e)}),this.roomClient.on("SUB_MANAGER_PAUSED",function(e){h.handleParticipantPausedBySubManager(e)}),this.roomClient.on("WHITEBOARD_STARTED",function(e){return h.handleWhiteboardStarted(e)}),this.roomClient.on("WHITEBOARD_STOPPED",function(e){return h.handleWhiteboardStopped(e)}),this.roomClient.on("VIDEO_STATE_CHANGED",function(e){return h.handleVideoStateChanged(e)}),this.roomClient.on("VIDEO_SEEKED",function(e){return h.handleVideoSeeked(e)}),this.roomClient.on("PIN_STATE_CHANGED",function(e){h.handlePinStateChanged(e)}),this.roomClient.on("MIC_REQUESTED",function(e){return h.handleMicRequested(e)}),this.roomClient.on("WEBCAM_REQUESTED",function(e){return h.handleWebcamRequested(e)}),this.roomClient.on("CONNECTION_OPEN",function(e){return h.handleConnectionOpen(e)}),this.roomClient.on("CONNECTION_CLOSE",function(e){return h.handleConnectionClose(e)}),this.roomClient.on("CONNECTION_PARTICIPANT_JOIN",function(e){return h.handleConnectionParticipantJoin(e)}),this.roomClient.on("SWITCH_ROOM",function(e){return h.handleSwitchMeeting(e)}),this.roomClient.on("CONNECTION_CHAT_MESSAGE",function(e){return h.handleConnectionChatMessage(e)}),this.roomClient.on("CONNECTION_PARTICIPANT_LEFT",function(e){h.handleConnectionParticipantLeft(e)}),this.roomClient.on("PUBSUB_MESSAGE",function(e){return ft(dr,h,lr).call(h,e)}),this.roomClient.on("PEER_MODE_CHANGED",function(e){return ft(dr,h,pr).call(h,e)}),this.updateMainParticipant(this.localParticipant.id),this.roomClient.on("MEETING_STATE_CHANGED",function(e){return h.handleMeetingStateChanged(e)}),this.roomClient.on("QUALITY_LIMITATION_INTERNAL",function(e){return h.handleQualityChanged(e)}),this.roomClient.on("ALL_CONSUMERS_PAUSED",function(e){return h.handleConsumersPaused(e)}),this.roomClient.on("ALL_CONSUMERS_RESUMED",function(e){return h.handleConsumersResumed(e)}),this.roomClient.on("VIDEO_QUALITY_CHANGED",function(e){return h.handleVideoQualityChanged(e)}),this.roomClient.on("ADD_CHARACTER",function(e){return h.handleAddCharacter(e)}),this.roomClient.on("INIT_CHARACTER",function(e){return h.handleInitCharacter(e)}),this.roomClient.on("REMOVE_CHARACTER",function(e){return h.handleRemoveCharacter(e)}),this.roomClient.on("CHARACTER_STATE_CHANGED",function(e){return h.handleCharacterStateChanged(e)}),this.roomClient.on("CHARACTER_MESSAGE",function(e){return h.handleCharacterMessage(e)}),this.roomClient.on("USER_MESSAGE",function(e){return h.handleUserMessage(e)}),this.roomClient.on("CHARACTER_DATA",function(e){return h.handleOnCharacterData(e)}),this.roomClient.on("CHARACTER_ERROR",function(e){return h.handleOnCharacterError(e)}),this.roomClient.on("E2EE_STATE_CHANGE",function(e){return h.handleE2EEStateChange(e)}),this.roomClient.on("REMOVE_PARTICIPANTS_FOR_SWITCH_MEETING",function(){return h.handleOnRemoveCurrentMeetingParticipant()}),this.roomClient.on("MEDIA_RELAY_STARTED",function(e){return h.handleMediaRelayStart(e)}),this.roomClient.on("MEDIA_RELAY_STOPPED",function(e){return h.handleMediaRelayStop(e)}),this.roomClient.on("MEDIA_RELAY_ERROR",function(e){return h.handleMediaRelayError(e)}),this.roomClient.on("MEDIA_RELAY_REQUEST_RESPONSE",function(e){return h.handleMediaRelayRequestResponse(e)}),this.roomClient.on("MEDIA_RELAY_REQUEST_RECEIVED",function(e){return h.handleMediaRelayRequest(e)})},[{key:"isE2EEEnabled",get:function(){return this.roomClient.isE2EEEnabled}},{key:"handleError",value:function(e){this.eventEmitter.listenerCount(gt)>0&&this.eventEmitter.emit(gt,e)}},{key:"join",value:function(){this.roomClient.join()}},{key:"changeMode",value:function(e){this.roomClient.changeMode(e)}},{key:"leave",value:function(){this.roomClient.close({sendLeft:!0})}},{key:"end",value:function(){this.roomClient.closeRoom()}},{key:"respondEntry",value:function(e,t){this.roomClient.respondEntry(e,t)}},{key:"pinnedParticipants",get:function(){return this.roomClient._pinnedParticipants}},{key:"muteMic",value:function(){this.roomClient.disableMic()}},{key:"unmuteMic",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;this.roomClient.enableMic(e)}},{key:"publishAudio",value:(y=(0,t.A)(c().mark(function e(){var t,r=arguments;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:void 0,e.next=1,this.roomClient.enableMic(t);case 1:return e.abrupt("return");case 2:case"end":return e.stop()}},e,this)})),function(){return y.apply(this,arguments)})},{key:"unpublishAudio",value:(_=(0,t.A)(c().mark(function e(){return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,this.roomClient.disableMic();case 1:return e.abrupt("return");case 2:case"end":return e.stop()}},e,this)})),function(){return _.apply(this,arguments)})},{key:"disableWebcam",value:function(){this.roomClient.disableWebcam()}},{key:"enableWebcam",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;this.roomClient.enableWebcam(e)}},{key:"publishVideo",value:(v=(0,t.A)(c().mark(function e(){var t,r=arguments;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:void 0,this.roomClient.enableWebcam(t),e.abrupt("return");case 1:case"end":return e.stop()}},e,this)})),function(){return v.apply(this,arguments)})},{key:"unpublishVideo",value:(g=(0,t.A)(c().mark(function e(){return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.roomClient.disableWebcam(),e.abrupt("return");case 1:case"end":return e.stop()}},e,this)})),function(){return g.apply(this,arguments)})},{key:"disableScreenShare",value:function(){this.roomClient.disableShare()}},{key:"enableScreenShare",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;this.roomClient.enableShare(e)}},{key:"pubblishScreenShare",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;this.roomClient.enableShare(e)}},{key:"unpublishScreenShare",value:function(){this.roomClient.disableShare()}},{key:"sendChatMessage",value:function(e){this.roomClient.sendChatMessage(e);var t={text:e,timestamp:(new Date).getTime(),senderId:this.localParticipant.id,senderName:this.localParticipant.displayName};this.handleNewChatMessage(t)}},{key:"pauseAllStreams",value:function(e){this.roomClient.pauseAllConsumers(e)}},{key:"resumeAllStreams",value:function(e){this.roomClient.resumeAllConsumers(e)}},{key:"startRecording",value:function(e,t,r,n){this.roomClient.startRecording(e,t,r,n)}},{key:"stopRecording",value:function(){this.roomClient.stopRecording()}},{key:"startTranscription",value:function(e){this.roomClient.startTranscription(e)}},{key:"stopTranscription",value:function(){this.roomClient.stopTranscription()}},{key:"startLivestream",value:function(e,t){this.roomClient.startLivestream(e,t)}},{key:"stopLivestream",value:function(){this.roomClient.stopLivestream()}},{key:"startHls",value:(f=(0,t.A)(c().mark(function e(t,r){return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,this.roomClient.startHls(t,r);case 1:case"end":return e.stop()}},e,this)})),function(e,t){return f.apply(this,arguments)})},{key:"stopHls",value:function(){this.roomClient.stopHls()}},{key:"createCharacter",value:function(e){if(!e.interactionId&&!e.id)throw new Error("InteractionId or id is required");return new et(pt(pt({},e),{},{roomClient:this.roomClient}))}},{key:"getMics",value:(m=(0,t.A)(c().mark(function e(){return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,this.roomClient.getMics();case 1:return e.abrupt("return",e.sent);case 2:case"end":return e.stop()}},e,this)})),function(){return m.apply(this,arguments)})},{key:"getWebcams",value:(h=(0,t.A)(c().mark(function e(){return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,this.roomClient.getWebcams();case 1:return e.abrupt("return",e.sent);case 2:case"end":return e.stop()}},e,this)})),function(){return h.apply(this,arguments)})},{key:"changeMic",value:function(e){this.roomClient.changeMic(e)}},{key:"changeWebcam",value:function(e){this.roomClient.changeWebcam(e)}},{key:"replaceWebcamStream",value:function(e){this.roomClient.replaceWebcamStream(e)}},{key:"setWebcamQuality",value:function(e){this.roomClient.setWebcamQuality(e)}},{key:"startWhiteboard",value:function(){this.roomClient.startWhiteboard()}},{key:"stopWhiteboard",value:function(){this.roomClient.stopWhiteboard()}},{key:"startVideo",value:function(e){var t=e.link;this.roomClient.startVideo({link:t})}},{key:"stopVideo",value:function(){this.roomClient.stopVideo()}},{key:"resumeVideo",value:function(){this.roomClient.resumeVideo()}},{key:"refreshConnection",value:function(){this.roomClient.restartIce()}},{key:"pauseVideo",value:function(e){var t=e.currentTime;this.roomClient.pauseVideo(t)}},{key:"seekVideo",value:function(e){var t=e.currentTime;this.roomClient.seekVideo(t)}},{key:"handlePeerAdd",value:function(e){var t=e.peer,r=new Re(t);this.participants.set(r.id,r),this.eventEmitter.emit(bt,r),1===this.participants.size&&this.updateMainParticipant(r.id)}},{key:"handleStreamState",value:function(e){var t=e.state,r=e.peerId,n=e.streamId,s=this.participants.get(r);null!=s&&s.handleStreamStateChanged({state:t,peerId:r,streamId:n})}},{key:"handlePeerRemove",value:function(e){var t=e.peerId,r=this.participants.get(t);null!=r&&(this.participants.delete(t),this.eventEmitter.emit(wt,r),this.activePresenterId===r.id&&(this.activePresenterId=null,this.eventEmitter.emit(Rt,this.activePresenterId)),this.mainParticipantId===r.id&&(this.participants.size>0?this.updateMainParticipant(this.participants.entries().next().value[1].id):this.updateMainParticipant(this.localParticipant.id)))}},{key:"handleProducerAdd",value:function(e){var t=e.producer,r={id:t.id,rtpSender:t.rtpSender};this.localParticipant.addProducer(r);var n=new re(t);this.localParticipant.addStream(n),"share"===n.kind&&(this.activePresenterId=this.localParticipant.id,this.eventEmitter.emit(Rt,this.activePresenterId),this.updateMainParticipant(this.localParticipant.id))}},{key:"handleUpdateProducer",value:function(e){var t=e.producer,r=new re(t);this.localParticipant.updateStream(r)}},{key:"handleProducerRemove",value:function(e){var t=e.producerId;this.localParticipant.removeProducer(t);var r=this.localParticipant.deleteStream(t);if(r&&"share"===r.kind){this.activePresenterId=null,this.eventEmitter.emit(Rt,this.activePresenterId);var n=this.participants.size>0?this.participants.entries().next().value[1].id:null;this.updateMainParticipant(this.activeSpeakerId||n||this.localParticipant.id)}}},{key:"handleConsumerAdd",value:function(e){var t=e.consumer,r=e.peerId,n=this.participants.get(r)||this.characters.get(r);if(n){var s={id:t.id,rtpReceiver:t.rtpReceiver};n.addConsumer(s);var i=new re(t);n.addStream(i),this.eventEmitter.emit(Vt,i),"share"===i.kind&&(this.activePresenterId=n.id,this.eventEmitter.emit(Rt,this.activePresenterId),this.updateMainParticipant(n.id))}}},{key:"handleConsumerResume",value:function(e){var t=e.consumerId,r=e.peerId,n=this.participants.get(r);n&&n.streamResumed(t)}},{key:"handleConsumerPause",value:function(e){var t=e.consumerId,r=e.peerId,n=this.participants.get(r);n&&n.streamPaused(t)}},{key:"handleConsumerRemove",value:function(e){var t=e.consumerId,r=e.peerId,n=this.participants.get(r)||this.characters.get(r);if(null!=n&&n){n.removeConsumer(t);var s=n.deleteStream(t);if(this.eventEmitter.emit(Ht,s),s&&"share"===s.kind){this.activePresenterId=null,this.eventEmitter.emit(Rt,this.activePresenterId);var i=this.participants.size>0?this.participants.entries().next().value[1].id:null;this.updateMainParticipant(this.activeSpeakerId||i||this.localParticipant.id)}}}},{key:"handleParticipantMediaStateChanged",value:function(e){var t=e.peerId,r=e.kind,n=e.newState,s=this.participants.get(t)||this.characters.get(t);this.localParticipant.id==t&&(s=this.localParticipant),s&&s&&("audio"==r?s.micOn=n:"video"==r&&(s.webcamOn=n),s.updateParticipantMediaState(r,n))}},{key:"handleParticipantPausedBySubManager",value:function(e){var t=this.participants.get(e.peerId);t&&t&&t.handleParticipantPause(e)}},{key:"handleParticipantResumeBySubManager",value:function(e){var t=this.participants.get(e.peerId);t&&t&&t.handleParticipantResume(e)}},{key:"handleSpeakerChange",value:function(e){var t=e.peerId;this.activeSpeakerId!==t&&(this.activeSpeakerId=t,this.eventEmitter.emit(St,t),t&&t!==this.localParticipant.id&&this.activePresenterId!==this.mainParticipantId&&t!==this.mainParticipantId&&this.updateMainParticipant(t))}},{key:"handleNewChatMessage",value:function(e){var t=e.senderId,r={senderId:t,text:e.text,timestamp:e.timestamp};if(this.localParticipant.id===t)r.senderName=this.localParticipant.displayName;else{var n=this.participants.get(t);n&&(r.senderName=n.displayName)}this.messages.push(r),this.eventEmitter.emit(Et,r)}},{key:"updateMainParticipant",value:function(e){var t;this.mainParticipantId=e,t=e===this.localParticipant.id?this.localParticipant:this.participants.get(this.mainParticipantId),this.eventEmitter.emit(kt,t)}},{key:"handleEntryRequested",value:function(e){var t=this,r=e.id,n=e.name;this.eventEmitter.emit(Tt,{participantId:r,name:n,allow:function(){t.roomClient.respondEntry(r,"allowed")},deny:function(){t.roomClient.respondEntry(r,"denied")}})}},{key:"handleEntryResponded",value:function(e){var t=e.id,r=e.decision;this.eventEmitter.emit(Ct,t,r)}},{key:"handleMeetingJoined",value:function(e){var t=e.peers,r=e.poll,n=e.messages,s=e.baseUrl,i=e.switchRoomId;"string"==typeof i&&(this.id=i),this.baseUrl=s,n.length>0&&(this.messages=n),this.eventEmitter.emit(vt,{switchRoomId:i||null,peers:t,poll:r,messages:n})}},{key:"handleMeetingLeft",value:function(e){this.eventEmitter.emit(_t,e)}},{key:"handleRecordingStateChanged",value:function(e){this.recordingState=e.status,this.eventEmitter.emit(Pt,e)}},{key:"handleLivestreamStateChanged",value:function(e){this.livestreamState=e.status,this.eventEmitter.emit(Dt,e)}},{key:"handleHlsStateChanged",value:function(e){this.hlsState=e.status,"HLS_PLAYABLE"==e.status?this.hlsUrls={downstreamUrl:e.downstreamUrl,playbackHlsUrl:e.playbackHlsUrl,livestreamUrl:e.livestreamUrl}:"HLS_STOPPED"==e.status&&(this.hlsUrls={downstreamUrl:null,playbackHlsUrl:null,livestreamUrl:null}),this.eventEmitter.emit(Mt,e)}},{key:"handleTranscriptionStateChanged",value:function(e){this.transcriptionState=e.status,this.eventEmitter.emit(Zt,e)}},{key:"handleTranscriptionText",value:function(e){this.eventEmitter.emit(er,e)}},{key:"handleRecordingStarted",value:function(){this.eventEmitter.emit(Ot)}},{key:"handleRecordingStopped",value:function(){this.eventEmitter.emit(xt)}},{key:"handleLivestreamStarted",value:function(){this.eventEmitter.emit(It)}},{key:"handleLivestreamStopped",value:function(){this.eventEmitter.emit(At)}},{key:"handleHlsStarted",value:function(e){this.eventEmitter.emit(Lt,e)}},{key:"handleHlsStopped",value:function(){this.eventEmitter.emit(Nt)}},{key:"handleWhiteboardStarted",value:function(e){this.eventEmitter.emit(jt,e)}},{key:"handleWhiteboardStopped",value:function(e){!function(e){if(null==e)throw new TypeError("Cannot destructure "+e)}(e),this.eventEmitter.emit(Bt)}},{key:"handleAddCharacter",value:function(e){var t,r=e.id,n=null!==(t=this.characters.get(r))&&void 0!==t?t:new et(pt(pt({},e),{},{state:Ce.CHARACTER_LISTENING,roomClient:this.roomClient}));this.characters.set(r,n),this.eventEmitter.emit(tr,n),n.eventEmitter.emit(tr)}},{key:"handleInitCharacter",value:function(e){this.characters.set(e.id,e)}},{key:"handleRemoveCharacter",value:function(e){var t=e.id;if(this.characters.has(t)){var r=this.characters.get(t);this.eventEmitter.emit(rr,r),r.eventEmitter.emit(rr),this.characters.delete(t)}}},{key:"handleCharacterStateChanged",value:function(e){var t=e.id;this.characters.has(t)&&this.characters.get(t).handleCharacterStateChanged(e)}},{key:"handleCharacterMessage",value:function(e){var t=e.id;this.characters.has(t)&&this.characters.get(t).handleCharacterMessage(e)}},{key:"handleUserMessage",value:function(e){var t=e.id;this.characters.has(t)&&this.characters.get(t).handleUserMessage(e)}},{key:"handleOnCharacterData",value:function(e){var t=e.id;this.characters.has(t)&&this.characters.get(t).handleCharacterData(e)}},{key:"handleOnCharacterError",value:function(e){var t=e.id;this.characters.has(t)&&this.characters.get(t).handleCharacterError(e)}},{key:"handleOnRemoveCurrentMeetingParticipant",value:function(){var e=this;(0,j.A)(this.participants.keys()).forEach(function(t){t!==e.localParticipant.id&&e.handlePeerRemove({peerId:t})})}},{key:"handleVideoStateChanged",value:function(e){this.eventEmitter.emit(Ut,e)}},{key:"handleVideoSeeked",value:function(e){var t=e.currentTime;this.eventEmitter.emit(Ft,{currentTime:t})}},{key:"handlePinStateChanged",value:function(e){var t=e.peerId,r=e.state,n=e.pinnedBy;this.eventEmitter.emit(zt,{participantId:t,state:r,pinnedBy:n})}},{key:"handleMeetingStateChanged",value:function(e){var t=e.state;this.eventEmitter.emit(Jt,{state:t})}},{key:"handleQualityChanged",value:function(e){var t=e.type,r=e.state,n=e.timestamp;this.eventEmitter.emit(Qt,{type:t,state:r,timestamp:n})}},{key:"handleConsumersPaused",value:function(e){var t=e.kind;this.eventEmitter.emit(Yt,{kind:t})}},{key:"handleConsumersResumed",value:function(e){var t=e.kind;this.eventEmitter.emit(Xt,{kind:t})}},{key:"handleVideoQualityChanged",value:function(e){var t=e.peerId,r=e.prevQuality,n=e.currentQuality,s=this.participants.get(t)||this.characters.get(t);s&&s&&s.videoQualityChanged(r,n)}},{key:"handleMicRequested",value:function(e){var t=this,r=e.peerId;this.eventEmitter.emit(qt,{participantId:r,accept:function(){return t.unmuteMic()},reject:function(){}})}},{key:"handleWebcamRequested",value:function(e){var t=this,r=e.peerId;this.eventEmitter.emit(Wt,{participantId:r,accept:function(){return t.enableWebcam()},reject:function(){}})}},{key:"handleConnectionParticipantJoin",value:function(e){var t=e.roomId,r=e.peer,n=this.connections.get(t);null!=n&&n.meeting.participantJoin(r)}},{key:"handleConnectionParticipantLeft",value:function(e){var t=e.roomId,r=e.peerId,n=this.connections.get(t);null!=n&&n.meeting.participantLeft(r)}},{key:"handleConnectionOpen",value:function(e){var t=e.peers,r=e.roomId,n=e.payload,s=new ut({roomId:r,peers:t,payload:n});this.connections.set(s.id,s),this.eventEmitter.emit(Kt,s)}},{key:"handleConnectionClose",value:function(e){var t=e.roomId;null!=this.connections.get(t)&&(this.connections.delete(t),this.eventEmitter.emit(Gt,t))}},{key:"handleMediaRelayError",value:function(e){var t=e.meetingId,r=e.error;this.eventEmitter.emit(ir,{meetingId:t,error:r})}},{key:"handleMediaRelayRequest",value:function(e){var t=this,r=e.peerId,n=e.meetingId,s=e.displayName;this.eventEmitter.emit(or,{participantId:r,meetingId:n,displayName:s,accept:function(){return t.roomClient.handleRelayRequestResponse({decision:"allowed",meetingId:n,peerId:r})},reject:function(){return t.roomClient.handleRelayRequestResponse({decision:"denied",meetingId:n,peerId:r})}})}},{key:"handleMediaRelayRequestResponse",value:function(e){var t=e.decision,r=e.decidedBy,n=e.meetingId;this.eventEmitter.emit(ar,{decision:t,decidedBy:r,meetingId:n})}},{key:"handleMediaRelayStart",value:function(e){var t=e.meetingId;this.eventEmitter.emit(nr,{meetingId:t})}},{key:"handleMediaRelayStop",value:function(e){var t=e.meetingId,r=e.reason;this.eventEmitter.emit(sr,{meetingId:t,reason:r})}},{key:"requestMediaRelay",value:(p=(0,t.A)(c().mark(function e(t){var r,n,s;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.destinationMeetingId,n=t.token,s=t.kinds,r){e.next=1;break}throw new Error("Parameter destinationMeetingId is required when calling requestMediaRelay.");case 1:return e.next=2,this.roomClient.requestMediaRelay(r,n,s);case 2:case"end":return e.stop()}},e,this)})),function(e){return p.apply(this,arguments)})},{key:"stopMediaRelay",value:(l=(0,t.A)(c().mark(function e(t){return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=1;break}throw new Error("Parameter destinationMeetingId is required when calling stopMediaRelay.");case 1:return e.next=2,this.roomClient.stopMediaRelay(t);case 2:case"end":return e.stop()}},e,this)})),function(e){return l.apply(this,arguments)})},{key:"enableAdaptiveSubscription",value:(u=(0,t.A)(c().mark(function e(){return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,this.roomClient.enableAdaptiveSubscription();case 1:case"end":return e.stop()}},e,this)})),function(){return u.apply(this,arguments)})},{key:"disableAdaptiveSubscription",value:(d=(0,t.A)(c().mark(function e(){return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,this.roomClient.disableAdaptiveSubscription();case 1:case"end":return e.stop()}},e,this)})),function(){return d.apply(this,arguments)})},{key:"enableE2EE",value:(o=(0,t.A)(c().mark(function e(){return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,this.roomClient.toggleE2EEEnabled(!0);case 1:case"end":return e.stop()}},e,this)})),function(){return o.apply(this,arguments)})},{key:"disableE2EE",value:(a=(0,t.A)(c().mark(function e(){return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,this.roomClient.toggleE2EEEnabled(!1);case 1:case"end":return e.stop()}},e,this)})),function(){return a.apply(this,arguments)})},{key:"handleSwitchMeeting",value:function(e){var t=e.roomId,r=e.token,n=e.payload,s=e.peerId,i=e.connectionPeerId,a=e.connectionRoomId,o=s?{meetingId:t,payload:n,token:r,participantId:s}:{meetingId:t,payload:n,token:r,connectionParticipantId:i,connectionMeetingId:a};this.eventEmitter.emit($t,o)}},{key:"handleConnectionChatMessage",value:function(e){var t=e.roomId,r=e.peerId,n=e.message,s=this.connections.get(t);null!=s&&s.meeting.sendChatMessageEvent({participantId:r,message:n})}},{key:"handleE2EEStateChange",value:function(e){var t=e.peerId,r=this.localParticipant.id==t?this.localParticipant:this.participants.get(t)||this.characters.get(t);r&&r&&r.handleE2EEStateChange(e)}},{key:"connectTo",value:(n=(0,t.A)(c().mark(function e(t){var r,n;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.meetingId,n=t.payload,e.next=1,this.roomClient.openConnection({roomId:r,payload:n});case 1:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"switchTo",value:function(e){var t=e.meetingId,r=e.token;if(!t||"string"!=typeof t||""===t.trim())throw new Error("Invalid meetingId: must be a non-empty string");this.roomClient.switchTo({meetingId:t,token:r,participantId:this.localParticipant.id})}},{key:"selectedCameraDevice",get:function(){var e;return null===(e=this.roomClient._webcam)||void 0===e?void 0:e.device}},{key:"selectedMicrophoneDevice",get:function(){var e;return null===(e=this.roomClient._mic)||void 0===e?void 0:e.device}},{key:"on",value:function(e,t){switch(e){case bt:case wt:case St:case Rt:case kt:case Et:case Tt:case Ct:case Pt:case Ot:case xt:case Dt:case It:case At:case Lt:case Nt:case Mt:case Zt:case er:case Vt:case Ht:case jt:case Bt:case tr:case rr:case vt:case _t:case Ut:case Ft:case qt:case Wt:case zt:case Kt:case Gt:case $t:case Jt:case yt:case Yt:case Xt:case nr:case sr:case ir:case or:case ar:case gt:case Qt:this.eventEmitter.on(e,t);break;default:throw new Error("Invalid event type "+e)}}},{key:"off",value:function(e,t){switch(e){case bt:case wt:case St:case Rt:case kt:case Et:case Tt:case Ct:case Pt:case Ot:case xt:case Dt:case It:case At:case Mt:case Lt:case Nt:case Zt:case er:case Vt:case Ht:case jt:case Bt:case tr:case rr:case vt:case _t:case Ut:case Ft:case qt:case Wt:case zt:case Kt:case Gt:case $t:case Jt:case gt:case nr:case sr:case ir:case or:case ar:case yt:case Yt:case Xt:case Qt:this.eventEmitter.off(e,t);break;default:throw new Error("Invalid event type.")}}}]);var n,a,o,d,u,l,p,h,m,f,g,v,_,y}();function lr(e){var t=e.topic,r=e.message,n=e.senderId,s=e.timestamp,i=e.senderName,a=e.id,o=e.payload;t&&r&&mt(cr,this).emit(t,{message:r,senderId:n,timestamp:s,topic:t,senderName:i,id:a,payload:o})}function pr(e){var t=e.peerId,r=e.mode;t===this.localParticipant.id?this.localParticipant.mode=r:this.participants.get(t).mode=r,this.activePresenterId!==this.localParticipant.id||(0,Pe.kR)(r)||(this.activePresenterId=null,this.eventEmitter.emit(Rt,this.activePresenterId)),this.eventEmitter.emit(yt,{participantId:t,mode:r})}var hr=n(7080),mr=n(5071),fr=n(4973),gr=n(9027);function vr(e,t,r){return t=(0,Ee.A)(t),(0,ke.A)(e,_r()?Reflect.construct(t,r||[],(0,Ee.A)(e).constructor):t.apply(e,r))}function _r(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(_r=function(){return!!e})()}var yr=function(e){function t(e,n,s,i){return(0,r.A)(this,t),vr(this,t,[e,n,s,i])}return(0,Te.A)(t,e),(0,s.A)(t)}((0,s.A)(function e(t,n,s,i){(0,r.A)(this,e),this.deviceId=t,this.groupId=n,this.kind=s,this.label=i})),br=function(e){function t(e,n,s,i){return(0,r.A)(this,t),vr(this,t,[e,n,s,i])}return(0,Te.A)(t,e),(0,s.A)(t)}(yr),wr=function(e){function t(e,n,s,i){return(0,r.A)(this,t),vr(this,t,[e,n,s,i])}return(0,Te.A)(t,e),(0,s.A)(t)}(yr),Sr=function(e){function t(e,n,s,i){return(0,r.A)(this,t),vr(this,t,[e,n,s,i])}return(0,Te.A)(t,e),(0,s.A)(t)}(yr),Rr={AUDIO:"audio",VIDEO:"video",AUDIO_AND_VIDEO:"audio_video"},kr=(n(328),n(7654));function Er(e,t){return null==e||null==t?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function Tr(e,t){return null==e||null==t?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function Cr(e){let t,r,n;function s(e,n,s=0,i=e.length){if(s<i){if(0!==t(n,n))return i;do{const t=s+i>>>1;r(e[t],n)<0?s=t+1:i=t}while(s<i)}return s}return 2!==e.length?(t=Er,r=(t,r)=>Er(e(t),r),n=(t,r)=>e(t)-r):(t=e===Er||e===Tr?e:Pr,r=e,n=e),{left:s,center:function(e,t,r=0,i=e.length){const a=s(e,t,r,i-1);return a>r&&n(e[a-1],t)>-n(e[a],t)?a-1:a},right:function(e,n,s=0,i=e.length){if(s<i){if(0!==t(n,n))return i;do{const t=s+i>>>1;r(e[t],n)<=0?s=t+1:i=t}while(s<i)}return s}}}function Pr(){return 0}const Or=Cr(Er).right,xr=(Cr(function(e){return null===e?NaN:+e}).center,Or);function Dr(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e)}return this}function Ir(){var e,t=[.5],r=[0,1],n=1;function s(s){return null!=s&&s<=s?r[xr(t,s,0,n)]:e}return s.domain=function(e){return arguments.length?(t=Array.from(e),n=Math.min(t.length,r.length-1),s):t.slice()},s.range=function(e){return arguments.length?(r=Array.from(e),n=Math.min(t.length,r.length-1),s):r.slice()},s.invertExtent=function(e){var n=r.indexOf(e);return[t[n-1],t[n]]},s.unknown=function(t){return arguments.length?(e=t,s):e},s.copy=function(){return Ir().domain(t).range(r).unknown(e)},Dr.apply(s,arguments)}function Ar(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function Mr(e,t,r){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:r;throw new TypeError("Private element is not present on this object")}function Lr(e,t,r){return t=zr(t),function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Gr()?Reflect.construct(t,r||[],zr(e).constructor):t.apply(e,r))}function Nr(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function jr(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Br(e,t){return e.get(Mr(e,t))}function Ur(e,t,r){Nr(e,t),t.set(e,r)}function Fr(e,t,r){return e.set(Mr(e,t),r),r}function qr(e,t){Nr(e,t),t.add(e)}function Wr(e,t,r){return t&&function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,nn(n.key),n)}}(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function Vr(e,t,r){return(t=nn(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Hr(){return Hr="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=en(e,t);if(n){var s=Object.getOwnPropertyDescriptor(n,t);return s.get?s.get.call(arguments.length<3?e:r):s.value}},Hr.apply(null,arguments)}function zr(e){return(zr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Kr(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Xr(e,t)}function Gr(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Gr=function(){return!!e})()}function $r(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function Jr(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?$r(Object(r),!0).forEach(function(t){Vr(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$r(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function Qr(e,t){if(null==e)return{};var r,n,s=function(e,t){if(null==e)return{};var r={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(-1!==t.indexOf(n))continue;r[n]=e[n]}return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],-1===t.indexOf(r)&&{}.propertyIsEnumerable.call(e,r)&&(s[r]=e[r])}return s}function Yr(e,t,r,n){return(Yr="undefined"!=typeof Reflect&&Reflect.set?Reflect.set:function(e,t,r,n){var s,i=en(e,t);if(i){if((s=Object.getOwnPropertyDescriptor(i,t)).set)return s.set.call(n,r),!0;if(!s.writable)return!1}if(s=Object.getOwnPropertyDescriptor(n,t)){if(!s.writable)return!1;s.value=r,Object.defineProperty(n,t,s)}else Vr(n,t,r);return!0})(e,t,r,n)}function Xr(e,t){return(Xr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function Zr(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,s,i,a,o=[],c=!0,d=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=i.call(r)).done)&&(o.push(n.value),o.length!==t);c=!0);}catch(u){d=!0,s=u}finally{try{if(!c&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(d)throw s}}return o}}(e,t)||sn(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function en(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=zr(e)););return e}function tn(e,t,r,n,s,i){return function(e,t,r,n,s){if(!Yr(e,t,r,n||e)&&s)throw new TypeError("failed to set property");return r}(zr(e.prototype),t,r,n,s)}function rn(e){return function(e){if(Array.isArray(e))return Ar(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||sn(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function nn(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}function sn(e,t){if(e){if("string"==typeof e)return Ar(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Ar(e,t):void 0}}var an="https://speed.cloudflare.com",on={autoStart:!0,downloadApiUrl:"".concat(an,"/__down"),uploadApiUrl:"".concat(an,"/__up"),logMeasurementApiUrl:null,logAimApiUrl:"https://aim.cloudflare.com/__log",turnServerUri:"turn.speed.cloudflare.com:50000",turnServerCredsApiUrl:"".concat(an,"/turn-creds"),turnServerUser:null,turnServerPass:null,rpkiInvalidHost:"invalid.rpki.cloudflare.com",cfTraceUrl:"".concat(an,"/cdn-cgi/trace"),includeCredentials:!1,measurements:[{type:"latency",numPackets:1},{type:"download",bytes:1e5,count:1,bypassMinDuration:!0},{type:"latency",numPackets:20},{type:"download",bytes:1e5,count:9},{type:"download",bytes:1e6,count:8},{type:"upload",bytes:1e5,count:8},{type:"packetLoss",numPackets:1e3,batchSize:10,batchWaitTime:10,responsesWaitTime:3e3},{type:"upload",bytes:1e6,count:6},{type:"download",bytes:1e7,count:6},{type:"upload",bytes:1e7,count:4},{type:"download",bytes:25e6,count:4},{type:"upload",bytes:25e6,count:4},{type:"download",bytes:1e8,count:3},{type:"upload",bytes:5e7,count:3},{type:"download",bytes:25e7,count:2}],measureDownloadLoadedLatency:!0,measureUploadLoadedLatency:!0,loadedLatencyThrottle:400,bandwidthFinishRequestDuration:1e3,estimatedServerTime:10,latencyPercentile:.5,bandwidthPercentile:.9,bandwidthMinRequestDuration:10,loadedRequestMinDuration:250,loadedLatencyMaxPoints:20},cn={aimMeasurementScoring:{packetLoss:Ir([.01,.05,.25,.5],[10,5,0,-10,-20]),latency:Ir([10,20,50,100,500],[20,10,5,0,-10,-20]),loadedLatencyIncrease:Ir([10,20,50,100,500],[20,10,5,0,-10,-20]),jitter:Ir([10,20,100,500],[10,5,0,-10,-20]),download:Ir([1e6,1e7,5e7,1e8],[0,5,10,20,30]),upload:Ir([1e6,1e7,5e7,1e8],[0,5,10,20,30])},aimExperiencesDefs:{streaming:{input:["latency","packetLoss","download","loadedLatencyIncrease"],pointThresholds:[15,20,40,60]},gaming:{input:["latency","packetLoss","loadedLatencyIncrease"],pointThresholds:[5,15,25,30]},rtc:{input:["latency","jitter","packetLoss","loadedLatencyIncrease"],pointThresholds:[5,15,25,40]}}},dn=function(e){var t=e.headers.get("server-timing");if(t){var r=t.match(/dur=([0-9.]+)/);if(r)return+r[1]}},un=function(e){return e.responseStart-e.requestStart},ln=function(e){return e.responseEnd-e.responseStart},pn=function(e){return e.ping+e.payloadDownloadTime},hn=function(e){return e.ttfb},mn=function(e,t){var r=e.duration,n=e.transferSize,s=r/1e3;return s?8*(n||1.005*+t)/s:void 0},fn=function(e,t){var r=e.duration/1e3;return r?8*t*1.005/r:void 0},gn=kr(function(e){return"0".repeat(e)}),vn=new WeakMap,_n=new WeakMap,yn=new WeakMap,bn=new WeakMap,wn=new WeakMap,Sn=new WeakMap,Rn=new WeakMap,kn=new WeakMap,En=new WeakMap,Tn=new WeakMap,Cn=new WeakMap,Pn=new WeakMap,On=new WeakMap,xn=new WeakMap,Dn=new WeakMap,In=new WeakMap,An=new WeakMap,Mn=new WeakMap,Ln=new WeakMap,Nn=new WeakMap,jn=new WeakMap,Bn=new WeakMap,Un=new WeakSet,Fn=Wr(function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.downloadApiUrl,s=r.uploadApiUrl,i=r.throttleMs,a=void 0===i?0:i,o=r.estimatedServerTime,c=void 0===o?0:o;if(jr(this,e),qr(this,Un),Ur(this,vn,{}),Ur(this,_n,{}),Vr(this,"finishRequestDuration",1e3),Vr(this,"getServerTime",dn),Ur(this,yn,function(e){return e}),Ur(this,bn,function(){}),Ur(this,wn,function(){}),Ur(this,Sn,function(){}),Ur(this,Rn,function(){}),Ur(this,kn,function(){}),Ur(this,En,void 0),Ur(this,Tn,void 0),Ur(this,Cn,void 0),Ur(this,Pn,!1),Ur(this,On,{down:!1,up:!1}),Ur(this,xn,{down:{},up:{}}),Ur(this,Dn,0),Ur(this,In,0),Ur(this,An,0),Ur(this,Mn,-1/0),Ur(this,Ln,0),Ur(this,Nn,0),Ur(this,jn,void 0),Ur(this,Bn,void 0),!t)throw new Error("Missing measurements argument");if(!n)throw new Error("Missing downloadApiUrl argument");if(!s)throw new Error("Missing uploadApiUrl argument");Fr(En,this,t),Fr(Tn,this,n),Fr(Cn,this,s),Fr(Ln,this,a),Fr(Nn,this,Math.max(0,c))},[{key:"results",get:function(){return Br(xn,this)}},{key:"qsParams",get:function(){return Br(vn,this)},set:function(e){Fr(vn,this,e)}},{key:"fetchOptions",get:function(){return Br(_n,this)},set:function(e){Fr(_n,this,e)}},{key:"responseHook",set:function(e){Fr(yn,this,e)}},{key:"onRunningChange",set:function(e){Fr(bn,this,e)}},{key:"onNewMeasurementStarted",set:function(e){Fr(wn,this,e)}},{key:"onMeasurementResult",set:function(e){Fr(Sn,this,e)}},{key:"onFinished",set:function(e){Fr(Rn,this,e)}},{key:"onConnectionError",set:function(e){Fr(kn,this,e)}},{key:"pause",value:function(){clearTimeout(Br(Bn,this)),Mr(Un,this,Hn).call(this),Mr(Un,this,qn).call(this,!1)}},{key:"play",value:function(){Br(Pn,this)||(Mr(Un,this,qn).call(this,!0),Mr(Un,this,Vn).call(this))}}]);function qn(e){var t=this;e!==Br(Pn,this)&&(Fr(Pn,this,e),setTimeout(function(){return Br(bn,t).call(t,Br(Pn,t))}))}function Wn(e,t){var r=this,n=Br(En,this)[e],s=n.bytes,i=n.dir,a=Br(xn,this),o=a[i].hasOwnProperty(s)?a[i][s]:{timings:[],numMeasurements:Br(En,this).filter(function(e){var t=e.bytes,r=e.dir;return s===t&&i===r}).map(function(e){return e.count}).reduce(function(e,t){return e+t},0)};t&&o.timings.push(t),o.timings=o.timings.slice(-o.numMeasurements),a[i][s]=o,t?setTimeout(function(){Br(Sn,r).call(r,Jr({type:i,bytes:s},t),a)}):Br(wn,this).call(this,Br(En,this)[e],a)}function Vn(){var e=this,t=Br(En,this),r=t[Br(Dn,this)];if(Br(In,this)>=r.count){var n=Br(On,this);if(Br(Mn,this)>this.finishRequestDuration&&!r.bypassMinDuration){var s=r.dir;Br(On,this)[s]=!0,Object.values(Br(On,this)).every(function(e){return e})&&Br(Rn,this).call(this,Br(xn,this))}Fr(In,this,0),Fr(Mn,this,-1/0),performance.clearResourceTimings();do{Fr(Dn,this,Br(Dn,this)+1)}while(Br(Dn,this)<t.length&&n[t[Br(Dn,this)].dir]);if(Br(Dn,this)>=t.length)return Fr(On,this,{down:!0,up:!0}),Mr(Un,this,qn).call(this,!1),void Br(Rn,this).call(this,Br(xn,this));r=t[Br(Dn,this)]}var i=Br(Dn,this);0===Br(In,this)&&Mr(Un,this,Wn).call(this,i);var a=r,o=a.bytes,c="down"===a.dir,d=Br(c?Tn:Cn,this),u=Object.assign({},Br(vn,this));c&&(u.bytes="".concat(o));var l,p="".concat(d.startsWith("http")||d.startsWith("//")?"":window.location.origin).concat(d,"?").concat(Object.entries(u).map(function(e){var t=Zr(e,2),r=t[0],n=t[1];return"".concat(r,"=").concat(n)}).join("&")),h=Object.assign({},c?{}:{method:"POST",body:gn(o)},Br(_n,this)),m=Fr(jn,this,fetch(p,h).then(function(e){if(e.ok)return e;throw Error(e.statusText)}).then(function(t){return e.getServerTime&&(l=e.getServerTime(t)),t}).then(function(t){return t.text().then(function(r){return Br(yn,e)&&Br(yn,e).call(e,{url:p,headers:t.headers,body:r}),r})}).then(function(t,r){if(m._cancel)r("cancelled");else{var n=performance.getEntriesByName(p).slice(-1)[0],s={transferSize:n.transferSize,ttfb:un(n),payloadDownloadTime:ln(n),serverTime:l||-1,measTime:new Date};if(s.ping=Math.max(.01,s.ttfb-(l||Br(Nn,e))),s.duration=(c?pn:hn)(s),s.bps=(c?mn:fn)(s,o),c&&o){var a=+o;s.transferSize&&(s.transferSize<a||s.transferSize)}Mr(Un,e,Wn).call(e,i,s);var d=s.duration;Fr(Mn,e,Br(Mn,e)<0?d:Math.min(Br(Mn,e),d)),Fr(In,e,Br(In,e)+1),Fr(An,e,0),Br(Ln,e)?Fr(Bn,e,setTimeout(function(){return Mr(Un,e,Vn).call(e)},Br(Ln,e))):Mr(Un,e,Vn).call(e)}}).catch(function(t){var r,n;m._cancel||(Fr(An,e,(r=Br(An,e),n=r++,r)),n<20?Mr(Un,e,Vn).call(e):(Fr(An,e,0),Mr(Un,e,qn).call(e,!1),Br(kn,e).call(e,"Connection failed to ".concat(p,". Gave up after ").concat(20," retries."))))}))}function Hn(){var e=Br(jn,this);e&&(e._cancel=!0)}var zn=["measureParallelLatency","parallelLatencyThrottleMs","downloadApiUrl","uploadApiUrl","estimatedServerTime"],Kn=new WeakMap,Gn=new WeakSet,$n=function(e){function t(e){var r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=n.measureParallelLatency,i=void 0!==s&&s,a=n.parallelLatencyThrottleMs,o=void 0===a?100:a,c=n.downloadApiUrl,d=n.uploadApiUrl,u=n.estimatedServerTime,l=void 0===u?0:u,p=Qr(n,zn);return jr(this,t),qr(r=Lr(this,t,[e,Jr({downloadApiUrl:c,uploadApiUrl:d,estimatedServerTime:l},p)]),Gn),Ur(r,Kn,void 0),i&&(Fr(Kn,r,new Fn([{dir:"down",bytes:0,count:1/0,bypassMinDuration:!0}],{downloadApiUrl:c,uploadApiUrl:d,estimatedServerTime:l,throttleMs:o})),Br(Kn,r).qsParams={during:"".concat(e[0].dir,"load")},tn(t,"onRunningChange",Mr(Gn,r,Jn),r,1),tn(t,"onConnectionError",function(){return Br(Kn,r).pause()},r,1)),r}return Kr(t,e),Wr(t,[{key:"latencyResults",get:function(){return Br(Kn,this)&&Br(Kn,this).results.down[0].timings}},{key:"onParallelLatencyResult",set:function(e){Br(Kn,this)&&(Br(Kn,this).onMeasurementResult=function(t){return e(t)})}},{key:"fetchOptions",get:function(){return e=this,Hr(zr(t.prototype),"fetchOptions",e);var e},set:function(e){tn(t,"fetchOptions",e,this,1),Br(Kn,this)&&(Br(Kn,this).fetchOptions=e)}},{key:"onRunningChange",set:function(e){var r=this;tn(t,"onRunningChange",function(t){Mr(Gn,r,Jn).call(r,t),e(t)},this,1)}},{key:"onConnectionError",set:function(e){var r=this;tn(t,"onConnectionError",function(){Br(Kn,r)&&Br(Kn,r).pause(),e.apply(void 0,arguments)},this,1)}}])}(Fn);function Jn(e){var t=this;Br(Kn,this)&&(e?setTimeout(function(){return Br(Kn,t).play()},20):Br(Kn,this).pause())}var Qn=["measurementId","logApiUrl"],Yn=new WeakMap,Xn=new WeakMap,Zn=new WeakMap,es=new WeakMap,ts=new WeakSet,rs=function(e){function t(e){var r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=n.measurementId,i=n.logApiUrl,a=Qr(n,Qn);return jr(this,t),qr(r=Lr(this,t,[e,a]),ts),Ur(r,Yn,void 0),Ur(r,Xn,void 0),Ur(r,Zn,void 0),Ur(r,es,void 0),Fr(Yn,r,s),Fr(es,r,i),tn(t,"qsParams",i?{measId:Br(Yn,r)}:{},r,1),tn(t,"responseHook",function(e){return Mr(ts,r,ns).call(r,e)},r,1),tn(t,"onMeasurementResult",function(e){return Mr(ts,r,ss).call(r,e)},r,1),r}return Kr(t,e),Wr(t,[{key:"qsParams",set:function(e){tn(t,"qsParams",Br(es,this)?Jr({measId:Br(Yn,this)},e):e,this,1)}},{key:"responseHook",set:function(e){var r=this;tn(t,"responseHook",function(t){e(t),Mr(ts,r,ns).call(r,t)},this,1)}},{key:"onMeasurementResult",set:function(e){var r=this;tn(t,"onMeasurementResult",function(t){for(var n=arguments.length,s=new Array(n>1?n-1:0),i=1;i<n;i++)s[i-1]=arguments[i];e.apply(void 0,[t].concat(s)),Mr(ts,r,ss).call(r,t)},this,1)}}])}($n);function ns(e){Br(es,this)&&(Fr(Zn,this,+e.headers.get("cf-meta-request-time")),Fr(Xn,this,e.body.slice(-300).split("___").pop()))}function ss(e){if(Br(es,this)){var t={type:e.type,bytes:e.bytes,ping:Math.round(e.ping),ttfb:Math.round(e.ttfb),payloadDownloadTime:Math.round(e.payloadDownloadTime),duration:Math.round(e.duration),transferSize:Math.round(e.transferSize),serverTime:Math.round(e.serverTime),token:Br(Xn,this),requestTime:Br(Zn,this),measId:Br(Yn,this)};Fr(Xn,this,null),Fr(Zn,this,null),fetch(Br(es,this),Jr({method:"POST",body:JSON.stringify(t)},this.fetchOptions))}}var is=new WeakMap,as=new WeakMap,os=new WeakMap,cs=new WeakSet,ds=Wr(function e(t){if(jr(this,e),qr(this,cs),Ur(this,is,!1),Ur(this,as,void 0),Ur(this,os,void 0),!t)throw new Error("Missing operation to perform");Fr(os,this,t),this.play()},[{key:"pause",value:function(){Mr(cs,this,ps).call(this),Mr(cs,this,us).call(this,!1)}},{key:"stop",value:function(){this.pause()}},{key:"play",value:function(){Br(is,this)||(Mr(cs,this,us).call(this,!0),Mr(cs,this,ls).call(this))}}]);function us(e){e!==Br(is,this)&&Fr(is,this,e)}function ls(){var e=this,t=Fr(as,this,Br(os,this).call(this).then(function(){!t._cancel&&Mr(cs,e,ls).call(e)}))}function ps(){var e=Br(as,this);e&&(e._cancel=!0)}var hs=new WeakMap,ms=Wr(function e(){var t=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.download,s=r.upload;if(jr(this,e),Vr(this,"qsParams",{}),Vr(this,"fetchOptions",{}),Ur(this,hs,[]),!n&&!s)throw new Error("Missing at least one of download/upload config");[[n,"download"],[s,"upload"]].filter(function(e){return Zr(e,1)[0]}).forEach(function(e){var t=Zr(e,2),r=t[0],n=t[1],s=r.apiUrl,i=r.chunkSize;if(!s)throw new Error("Missing ".concat(n," apiUrl argument"));if(!i)throw new Error("Missing ".concat(n," chunkSize argument"))});var i=function(e){var r=e.apiUrl,n=e.qsParams,s=void 0===n?{}:n,i=e.fetchOptions,a=void 0===i?{}:i;return new ds(function(){var e=Object.assign({},s,t.qsParams),n="".concat(r.startsWith("http")||r.startsWith("//")?"":window.location.origin).concat(r,"?").concat(Object.entries(e).map(function(e){var t=Zr(e,2),r=t[0],n=t[1];return"".concat(r,"=").concat(n)}).join("&")),i=Object.assign({},a,t.fetchOptions);return fetch(n,i).then(function(e){if(e.ok)return e;throw Error(e.statusText)}).then(function(e){return e.text()})})};n&&Br(hs,this).push(i({apiUrl:n.apiUrl,qsParams:{bytes:"".concat(n.chunkSize)}})),s&&Br(hs,this).push(i({apiUrl:s.apiUrl,fetchOptions:{method:"POST",body:"0".repeat(s.chunkSize)}}))},[{key:"pause",value:function(){Br(hs,this).forEach(function(e){return e.pause()})}},{key:"stop",value:function(){this.pause()}},{key:"play",value:function(){Br(hs,this).forEach(function(e){return e.play()})}}]),fs=["iceServers","acceptIceCandidate","dataChannelCfg"],gs=new WeakMap,vs=new WeakMap,_s=new WeakMap,ys=new WeakMap,bs=new WeakMap,ws=Wr(function e(){var t=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.iceServers,s=void 0===n?[]:n,i=r.acceptIceCandidate,a=void 0===i?function(e){var t=e.protocol||"";if(!t&&e.candidate){var r=e.candidate.split(" ");r.length>=3&&(t=r[2])}return"udp"===t.toLowerCase()}:i,o=r.dataChannelCfg,c=void 0===o?{ordered:!1,maxRetransmits:0}:o,d=Qr(r,fs);jr(this,e),Vr(this,"onOpen",function(){}),Vr(this,"onClose",function(){}),Vr(this,"onMessageReceived",function(){}),Ur(this,gs,!1),Ur(this,vs,void 0),Ur(this,_s,void 0),Ur(this,ys,void 0),Ur(this,bs,void 0);var u=new RTCPeerConnection(Jr({iceServers:s},d)),l=new RTCPeerConnection(Jr({iceServers:s},d)),p=u.createDataChannel("channel",c);p.onopen=function(){Fr(gs,t,!0),t.onOpen()},p.onclose=function(){return t.close()},l.ondatachannel=function(e){var r=e.channel;r.onclose=function(){return t.close()},r.onmessage=function(e){return t.onMessageReceived(e.data)},Fr(bs,t,r)},u.onicecandidate=function(e){e.candidate&&a(e.candidate)&&l.addIceCandidate(e.candidate)},l.onicecandidate=function(e){e.candidate&&a(e.candidate)&&u.addIceCandidate(e.candidate)},u.createOffer().then(function(e){return u.setLocalDescription(e)}).then(function(){return l.setRemoteDescription(u.localDescription)}).then(function(){return l.createAnswer()}).then(function(e){return l.setLocalDescription(e)}).then(function(){return u.setRemoteDescription(l.localDescription)}),Fr(vs,this,u),Fr(_s,this,l),Fr(ys,this,p),Fr(gs,this,!1)},[{key:"send",value:function(e){return Br(ys,this).send(e)}},{key:"close",value:function(){return Br(vs,this)&&Br(vs,this).close(),Br(_s,this)&&Br(_s,this).close(),Br(ys,this)&&Br(ys,this).close(),Br(bs,this)&&Br(bs,this).close(),Br(gs,this)&&this.onClose(),Fr(gs,this,!1),this}}]),Ss=new WeakMap,Rs=new WeakMap,ks=new WeakMap,Es=new WeakMap,Ts=new WeakMap,Cs=new WeakMap,Ps=Wr(function e(){var t=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.turnServerUri,s=r.turnServerCredsApi,i=r.turnServerCredsApiParser,a=void 0===i?function(e){return{turnServerUser:e.username,turnServerPass:e.credential,turnServerUri:e.server}}:i,o=r.turnServerCredsApiIncludeCredentials,c=void 0!==o&&o,d=r.turnServerUser,u=r.turnServerPass,l=r.numMsgs,p=void 0===l?100:l,h=r.batchSize,m=void 0===h?10:h,f=r.batchWaitTime,g=void 0===f?10:f,v=r.responsesWaitTime,_=void 0===v?5e3:v,y=r.connectionTimeout,b=void 0===y?5e3:y;if(jr(this,e),Ur(this,Ss,function(){}),Ur(this,Rs,function(){}),Ur(this,ks,function(){}),Vr(this,"onMsgSent",function(){}),Vr(this,"onAllMsgsSent",function(){}),Vr(this,"onMsgReceived",function(){}),Ur(this,Es,{}),Ur(this,Ts,void 0),Ur(this,Cs,void 0),!n&&!s)throw new Error("Missing turnServerCredsApi or turnServerUri argument");if(!(d&&u||s))throw new Error("Missing either turnServerCredsApi or turnServerUser+turnServerPass arguments");Fr(Cs,this,p),(d&&u?Promise.resolve({turnServerUser:d,turnServerPass:u}):fetch(s,{credentials:c?"include":void 0}).then(function(e){return e.json()}).then(function(e){if(e.error)throw e.error;return e}).then(a)).catch(function(e){return Br(Ss,t).call(t,e)}).then(function(e){var r=e.turnServerUser,s=e.turnServerPass,i=e.turnServerUri,a=Fr(Ts,t,new ws({iceServers:[{urls:"turn:".concat(i||n,"?transport=udp"),username:r,credential:s}],iceTransportPolicy:"relay"})),o=!1;setTimeout(function(){o||(a.close(),Br(Rs,t).call(t,"ICE connection timeout!"))},b);var c=Br(Es,t);a.onOpen=function(){o=!0;var e=t;!function t(r){if(r<=p){for(var n=r;n<=Math.min(p,r+m-1);)c[n]=!1,a.send(n),e.onMsgSent(n),n++;setTimeout(function(){return t(n)},g)}else{e.onAllMsgsSent(Object.keys(c).length);var s=function(){a.close(),Br(ks,e).call(e,e.results)},i=setTimeout(s,_),o=Object.values(Br(Es,e)).filter(function(e){return!e}).length;a.onMessageReceived=function(t){clearTimeout(i),c[t]=!0,e.onMsgReceived(t),--o<=0&&Object.values(Br(Es,e)).every(function(e){return e})?s():i=setTimeout(s,_)}}}(1)},a.onMessageReceived=function(e){c[e]=!0,t.onMsgReceived(e)}}).catch(function(e){return Br(Rs,t).call(t,e.toString())})},[{key:"onCredentialsFailure",set:function(e){Fr(Ss,this,e)}},{key:"onConnectionError",set:function(e){Fr(Rs,this,e)}},{key:"onFinished",set:function(e){Fr(ks,this,e)}},{key:"results",get:function(){var e=Br(Cs,this),t=Object.keys(Br(Es,this)).length,r=Object.entries(Br(Es,this)).filter(function(e){return!Zr(e,2)[1]}).map(function(e){return+Zr(e,1)[0]});return{totalMessages:e,numMessagesSent:t,packetLoss:r.length/t,lostMessages:r}}}]),Os=["downloadChunkSize","uploadChunkSize","downloadApiUrl","uploadApiUrl"],xs=new WeakMap,Ds=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.downloadChunkSize,s=r.uploadChunkSize,i=r.downloadApiUrl,a=r.uploadApiUrl,o=Qr(r,Os);return jr(this,t),Ur(e=Lr(this,t,[o]),xs,void 0),(n||s)&&(Fr(xs,e,new ms({download:n?{apiUrl:i,chunkSize:n}:null,upload:s?{apiUrl:a,chunkSize:s}:null})),tn(t,"onCredentialsFailure",tn(t,"onConnectionError",tn(t,"onFinished",function(){return Br(xs,e).stop()},e,1),e,1),e,1)),e}return Kr(t,e),Wr(t,[{key:"qsParams",set:function(e){Br(xs,this)&&(Br(xs,this).qsParams=e)}},{key:"fetchOptions",set:function(e){Br(xs,this)&&(Br(xs,this).fetchOptions=e)}},{key:"onCredentialsFailure",set:function(e){var r=this;tn(t,"onCredentialsFailure",function(){e.apply(void 0,arguments),Br(xs,r)&&Br(xs,r).stop()},this,1)}},{key:"onConnectionError",set:function(e){var r=this;tn(t,"onConnectionError",function(){e.apply(void 0,arguments),Br(xs,r)&&Br(xs,r).stop()},this,1)}},{key:"onFinished",set:function(e){var r=this;tn(t,"onFinished",function(){e.apply(void 0,arguments),Br(xs,r)&&Br(xs,r).stop()},this,1)}}])}(Ps),Is=["reachable"],As=Wr(function e(t){var r=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=n.timeout,i=void 0===s?-1:s,a=n.fetchOptions,o=void 0===a?{}:a;jr(this,e),Vr(this,"onFinished",function(){});var c=!1,d=function(e){var n=e.reachable,s=Qr(e,Is);c||(c=!0,r.onFinished(Jr({targetUrl:t,reachable:n},s)))};fetch(t,o).then(function(e){d({reachable:!0,response:e})}).catch(function(e){d({reachable:!1,error:e})}),i>0&&setTimeout(function(){return d({reachable:!1,error:"Request timeout"})},i)}),Ms=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;if(!e.length)return 0;var r=e.slice().sort(function(e,t){return e-t}),n=(e.length-1)*t,s=n%1;if(0===s)return r[Math.round(n)];var i=[Math.floor,Math.ceil].map(function(e){return r[e(n)]});return i[0]+(i[1]-i[0])*s},Ls=new WeakMap,Ns=new WeakMap,js=Wr(function e(t){var r=this;jr(this,e),Vr(this,"getLatencyPoints",function(e){return e.timings.map(function(e){return e.ping})}),Vr(this,"getLatency",function(e){return Ms(r.getLatencyPoints(e),Br(Ls,r).latencyPercentile)}),Vr(this,"getBandwidthPoints",function(e){return Object.entries(e).map(function(e){var t=Zr(e,2),r=t[0];return t[1].timings.map(function(e){var t=e.bps,n=e.duration,s=e.ping,i=e.measTime,a=e.serverTime,o=e.transferSize;return{bytes:+r,bps:t,duration:n,ping:s,measTime:i,serverTime:a,transferSize:o}})}).flat()}),Vr(this,"getBandwidth",function(e){return Ms(r.getBandwidthPoints(e).filter(function(e){return e.duration>=Br(Ls,r).bandwidthMinRequestDuration}).map(function(e){return e.bps}).filter(function(e){return e}),Br(Ls,r).bandwidthPercentile)}),Vr(this,"getLoadedLatency",function(e){return r.getLatency({timings:Br(Ns,r).call(r,e)})}),Vr(this,"getLoadedJitter",function(e){return r.getJitter({timings:Br(Ns,r).call(r,e)})}),Vr(this,"getLoadedLatencyPoints",function(e){return r.getLatencyPoints({timings:Br(Ns,r).call(r,e)})}),Vr(this,"getPacketLoss",function(e){return e.packetLoss}),Vr(this,"getPacketLossDetails",function(e){return e}),Vr(this,"getReachability",function(e){return!!e.reachable}),Vr(this,"getReachabilityDetails",function(e){return{host:e.host,reachable:e.reachable}}),Ur(this,Ls,void 0),Ur(this,Ns,function(e){return Object.values(e).filter(function(e){return e.timings.length&&Math.min.apply(Math,rn(e.timings.map(function(e){return e.duration})))>=Br(Ls,r).loadedRequestMinDuration}).map(function(e){return e.sideLatency||[]}).flat().slice(-Br(Ls,r).loadedLatencyMaxPoints)}),Fr(Ls,this,t)},[{key:"getJitter",value:function(e){var t=this.getLatencyPoints(e);return t.length<2?null:t.reduce(function(e,t){var r=e.sumDeltas,n=void 0===r?0:r,s=e.prevLatency;return{sumDeltas:n+(void 0!==s?Math.abs(s-t):0),prevLatency:t}},{}).sumDeltas/(t.length-1)}}]),Bs=["bad","poor","average","good","great"],Us={loadedLatencyIncrease:function(e){return e.latency&&(e.downLoadedLatency||e.upLoadedLatency)?Math.max(e.downLoadedLatency,e.upLoadedLatency)-e.latency:void 0}},Fs={packetLoss:0},qs=new WeakMap,Ws=Wr(function e(t){jr(this,e),Ur(this,qs,void 0),Fr(qs,this,t)},[{key:"getScores",value:function(e){var t=Object.assign.apply(Object,rn(Object.entries(Br(qs,this).aimMeasurementScoring).map(function(t){var r=Zr(t,2),n=r[0],s=r[1],i=Us.hasOwnProperty(n)?Us[n](e):e[n];return void 0===i?Fs.hasOwnProperty(n)?Vr({},n,Fs[n]):{}:Vr({},n,void 0===i?0:+s(i))})));return Object.assign.apply(Object,[{}].concat(rn(Object.entries(Br(qs,this).aimExperiencesDefs).filter(function(e){return Zr(e,2)[1].input.every(function(e){return t.hasOwnProperty(e)})}).map(function(e){var r=Zr(e,2),n=r[0],s=r[1],i=s.input,a=s.pointThresholds,o=Math.max(0,i.map(function(e){return t[e]}).reduce(function(e,t){return e+t},0)),c=Ir(a,[0,1,2,3,4])(o);return Vr({},n,{points:o,classificationIdx:c,classificationName:Bs[c]})}))))}}]),Vs=new WeakMap,Hs=new WeakMap,zs=new WeakMap,Ks=new WeakMap,Gs=new WeakMap,$s=new WeakMap,Js=new WeakMap,Qs=new WeakMap,Ys=Wr(function e(t){var r=this;jr(this,e),Vr(this,"raw",void 0),Vr(this,"getUnloadedLatency",function(){return Br(Ks,r).call(r,"getLatency","latency")}),Vr(this,"getUnloadedJitter",function(){return Br(Ks,r).call(r,"getJitter","latency")}),Vr(this,"getUnloadedLatencyPoints",function(){return Br(Ks,r).call(r,"getLatencyPoints","latency",[])}),Vr(this,"getDownLoadedLatency",function(){return Br(Ks,r).call(r,"getLoadedLatency","download")}),Vr(this,"getDownLoadedJitter",function(){return Br(Ks,r).call(r,"getLoadedJitter","download")}),Vr(this,"getDownLoadedLatencyPoints",function(){return Br(Ks,r).call(r,"getLoadedLatencyPoints","download",[])}),Vr(this,"getUpLoadedLatency",function(){return Br(Ks,r).call(r,"getLoadedLatency","upload")}),Vr(this,"getUpLoadedJitter",function(){return Br(Ks,r).call(r,"getLoadedJitter","upload")}),Vr(this,"getUpLoadedLatencyPoints",function(){return Br(Ks,r).call(r,"getLoadedLatencyPoints","upload",[])}),Vr(this,"getDownloadBandwidth",function(){return Br(Ks,r).call(r,"getBandwidth","download")}),Vr(this,"getDownloadBandwidthPoints",function(){return Br(Ks,r).call(r,"getBandwidthPoints","download",[])}),Vr(this,"getUploadBandwidth",function(){return Br(Ks,r).call(r,"getBandwidth","upload")}),Vr(this,"getUploadBandwidthPoints",function(){return Br(Ks,r).call(r,"getBandwidthPoints","upload",[])}),Vr(this,"getPacketLoss",function(){return Br(Ks,r).call(r,"getPacketLoss","packetLoss")}),Vr(this,"getPacketLossDetails",function(){return Br(Ks,r).call(r,"getPacketLossDetails","packetLoss",void 0,!0)}),Vr(this,"getScores",function(){return Br(zs,r).getScores(r.getSummary())}),Ur(this,Vs,void 0),Ur(this,Hs,void 0),Ur(this,zs,void 0),Ur(this,Ks,function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return r.raw.hasOwnProperty(t)&&r.raw[t].started?s&&r.raw[t].error?{error:r.raw[t].error}:Br(Hs,r)[e](r.raw[t].results):n}),Ur(this,Gs,function(){return Br(Ks,r).call(r,"getReachability","v4Reachability")}),Ur(this,$s,function(){return Br(Ks,r).call(r,"getReachabilityDetails","v4Reachability")}),Ur(this,Js,function(){return Br(Ks,r).call(r,"getReachability","v6Reachability")}),Ur(this,Qs,function(){return Br(Ks,r).call(r,"getReachabilityDetails","v6Reachability")}),Fr(Vs,this,t),this.clear(),Fr(Hs,this,new js(Br(Vs,this))),Fr(zs,this,new Ws(Br(Vs,this)))},[{key:"isFinished",get:function(){return Object.values(this.raw).every(function(e){return e.finished})}},{key:"clear",value:function(){this.raw=Object.assign.apply(Object,[{}].concat(rn(rn(new Set(Br(Vs,this).measurements.map(function(e){return e.type}))).map(function(e){return Vr({},e,{started:!1,finished:!1,results:{}})}))))}},{key:"getSummary",value:function(){var e={download:this.getDownloadBandwidth,upload:this.getUploadBandwidth,latency:this.getUnloadedLatency,jitter:this.getUnloadedJitter,downLoadedLatency:this.getDownLoadedLatency,downLoadedJitter:this.getDownLoadedJitter,upLoadedLatency:this.getUpLoadedLatency,upLoadedJitter:this.getUpLoadedJitter,packetLoss:this.getPacketLoss,v4Reachability:Br(Gs,this),v6Reachability:Br(Js,this)};return Object.assign.apply(Object,rn(Object.entries(e).map(function(e){var t=Zr(e,2),r=t[0],n=(0,t[1])();return void 0===n?{}:Vr({},r,n)})))}}]),Xs=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e?Math.round(e*Math.pow(10,t))/Math.pow(10,t):e},Zs=function(e){return e.map(function(e){return Xs(e,2)})},ei=function(e){return e.map(function(e){return{bytes:+e.bytes,bps:Xs(e.bps)}})},ti={latencyMs:["getUnloadedLatencyPoints",Zs],download:["getDownloadBandwidthPoints",ei],upload:["getUploadBandwidthPoints",ei],downLoadedLatencyMs:["getDownLoadedLatencyPoints",Zs],upLoadedLatencyMs:["getUpLoadedLatencyPoints",Zs],packetLoss:["getPacketLossDetails",function(e){return e.error?void 0:{numMessages:e.numMessagesSent,lossRatio:Xs(e.packetLoss,4)}}]},ri=["type"],ni=["numPackets"],si=["bytes"],ii=["latency","latencyUnderLoad","download","upload"],ai=function(){return"".concat(Math.round(1e16*Math.random()))},oi=new WeakMap,ci=new WeakMap,di=new WeakMap,ui=new WeakMap,li=new WeakMap,pi=new WeakMap,hi=new WeakMap,mi=new WeakMap,fi=new WeakMap,gi=new WeakMap,vi=new WeakMap,_i=new WeakSet,yi=Wr(function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};jr(this,e),qr(this,_i),Vr(this,"onRunningChange",function(){}),Vr(this,"onResultsChange",function(){}),Ur(this,oi,function(){}),Ur(this,ci,function(){}),Ur(this,di,void 0),Ur(this,ui,void 0),Ur(this,li,ai()),Ur(this,pi,-1),Ur(this,hi,void 0),Ur(this,mi,1e6),Ur(this,fi,1e6),Ur(this,gi,!1),Ur(this,vi,!1),Fr(di,this,Object.assign({},on,t,cn)),Fr(ui,this,new Ys(Br(di,this))),Br(di,this).autoStart&&this.play()},[{key:"results",get:function(){return Br(ui,this)}},{key:"isRunning",get:function(){return Br(gi,this)}},{key:"isFinished",get:function(){return Br(vi,this)}},{key:"onFinish",set:function(e){Fr(oi,this,e)}},{key:"onError",set:function(e){Fr(ci,this,e)}},{key:"pause",value:function(){ii.includes(Mr(_i,this,Si).call(this))&&Br(hi,this).pause(),Mr(_i,this,bi).call(this,!1)}},{key:"play",value:function(){Br(gi,this)||(Mr(_i,this,bi).call(this,!0),Mr(_i,this,Ti).call(this))}},{key:"restart",value:function(){Mr(_i,this,ki).call(this),this.play()}}]);function bi(e){e!==Br(gi,this)&&(Fr(gi,this,e),this.onRunningChange(Br(gi,this)))}function wi(e){var t=this;e!==Br(vi,this)&&(Fr(vi,this,e),e&&setTimeout(function(){return Br(oi,t).call(t,t.results)}))}function Si(){return Br(pi,this)<0||Br(pi,this)>=Br(di,this).measurements.length?null:Br(di,this).measurements[Br(pi,this)].type}function Ri(){return Br(ui,this).raw[Mr(_i,this,Si).call(this)]||void 0}function ki(){Mr(_i,this,Ei).call(this),Fr(li,this,ai()),Fr(pi,this,-1),Fr(hi,this,void 0),Mr(_i,this,bi).call(this,!1),Mr(_i,this,wi).call(this,!1),Br(ui,this).clear()}function Ei(){var e=Br(hi,this);e&&(e.onFinished=e.onConnectionError=e.onFail=e.onMsgReceived=e.onCredentialsFailure=e.onMeasurementResult=function(){},ii.includes(Mr(_i,this,Si).call(this))&&e.pause())}function Ti(){var e,t=this;if(!(ii.includes(Mr(_i,this,Si).call(this))&&Mr(_i,this,Ri).call(this)&&Mr(_i,this,Ri).call(this).started)||Mr(_i,this,Ri).call(this).finished||Mr(_i,this,Ri).call(this).finishedCurrentRound||Mr(_i,this,Ri).call(this).error){if(Fr(pi,this,(e=Br(pi,this),++e)),Br(pi,this)>=Br(di,this).measurements.length)return Mr(_i,this,bi).call(this,!1),void Mr(_i,this,wi).call(this,!0);var r,n=Br(di,this).measurements[Br(pi,this)],s=n.type,i=Qr(n,ri),a=Mr(_i,this,Ri).call(this),o=Br(di,this),c=o.downloadApiUrl,d=o.uploadApiUrl,u=o.estimatedServerTime;switch(s){case"v4Reachability":case"v6Reachability":(r=new As("https://".concat(i.host),{fetchOptions:{method:"GET",mode:"no-cors"}})).onFinished=function(e){a.finished=!0,a.results=Jr({host:i.host},e),t.onResultsChange({type:s}),Mr(_i,t,Ti).call(t)};break;case"rpki":(r=new As("https://".concat(Br(di,this).rpkiInvalidHost),{timeout:5e3})).onFinished=function(e){(e.response?e.response.json():Promise.resolve()).then(function(r){a.finished=!0,a.results=Jr({host:Br(di,t).rpkiInvalidHost,filteringInvalids:!e.reachable},r?{asn:r.asn,name:r.name}:{}),t.onResultsChange({type:s}),Mr(_i,t,Ti).call(t)})};break;case"nxdomain":(r=new As("https://".concat(i.nxhost),{fetchOptions:{mode:"no-cors"}})).onFinished=function(e){a.finished=!0,a.results={host:i.nxhost,reachable:e.reachable},t.onResultsChange({type:s}),Mr(_i,t,Ti).call(t)};break;case"packetLoss":case"packetLossUnderLoad":a.finished=!1;var l=i.numPackets,p=Qr(i,ni),h=Br(di,this),m=h.turnServerUri,f=h.turnServerCredsApiUrl,g=h.turnServerUser,v=h.turnServerPass,_=h.includeCredentials;(r=new Ds(Jr({turnServerUri:m,turnServerCredsApi:f,turnServerCredsApiIncludeCredentials:_,turnServerUser:g,turnServerPass:v,numMsgs:l,downloadChunkSize:i.loadDown?Br(mi,this):void 0,uploadChunkSize:i.loadUp?Br(fi,this):void 0,downloadApiUrl:c,uploadApiUrl:d},p))).onMsgReceived=function(){a.results=Object.assign({},r.results),t.onResultsChange({type:s})},r.onFinished=function(){a.finished=!0,t.onResultsChange({type:s}),Mr(_i,t,Ti).call(t)},r.onConnectionError=function(e){a.error=e,t.onResultsChange({type:s}),Br(ci,t).call(t,"Connection error while measuring packet loss: ".concat(e)),Mr(_i,t,Ti).call(t)},r.onCredentialsFailure=function(){a.error="unable to get turn server credentials",t.onResultsChange({type:s}),Br(ci,t).call(t,"Error while measuring packet loss: unable to get turn server credentials."),Mr(_i,t,Ti).call(t)};break;case"latency":case"latencyUnderLoad":a.finished=!1,(r=new rs([{dir:"down",bytes:0,count:i.numPackets,bypassMinDuration:!0}],{downloadApiUrl:c,uploadApiUrl:d,estimatedServerTime:u,logApiUrl:Br(di,this).logMeasurementApiUrl,measurementId:Br(li,this),downloadChunkSize:i.loadDown?Br(mi,this):void 0,uploadChunkSize:i.loadUp?Br(fi,this):void 0})).fetchOptions={credentials:Br(di,this).includeCredentials?"include":void 0},r.onMeasurementResult=r.onNewMeasurementStarted=function(e,r){a.results=Object.assign({},r.down[0]),t.onResultsChange({type:s})},r.onFinished=function(){a.finished=!0,t.onResultsChange({type:s}),Br(gi,t)&&Mr(_i,t,Ti).call(t)},r.onConnectionError=function(e){a.error=e,t.onResultsChange({type:s}),Br(ci,t).call(t,"Connection error while measuring latency: ".concat(e)),Mr(_i,t,Ti).call(t)},r.play();break;case"download":case"upload":if(a.finished||a.error)Mr(_i,this,Ti).call(this);else{delete a.finishedCurrentRound;var y=Br(di,this)["measure".concat("download"===s?"Down":"Up","loadLoadedLatency")];(r=new rs([Jr({dir:"download"===s?"down":"up"},i)],{downloadApiUrl:c,uploadApiUrl:d,estimatedServerTime:u,logApiUrl:Br(di,this).logMeasurementApiUrl,measurementId:Br(li,this),measureParallelLatency:y,parallelLatencyThrottleMs:Br(di,this).loadedLatencyThrottle})).fetchOptions={credentials:Br(di,this).includeCredentials?"include":void 0},r.finishRequestDuration=Br(di,this).bandwidthFinishRequestDuration,r.onNewMeasurementStarted=function(e){var r=e.count,n=e.bytes,i=a.results=Object.assign({},a.results);!i.hasOwnProperty(n)&&(i[n]={timings:[],numMeasurements:0,sideLatency:y?[]:void 0}),i[n].numMeasurements-i[n].timings.length!==r&&(i[n].numMeasurements+=r,t.onResultsChange({type:s}))},r.onMeasurementResult=function(e){var r=e.bytes,n=Qr(e,si);a.results[r].timings.push(n),a.results=Object.assign({},a.results),t.onResultsChange({type:s})},r.onParallelLatencyResult=function(e){a.results[i.bytes].sideLatency.push(e),a.results=Object.assign({},a.results),t.onResultsChange({type:s})},r.onFinished=function(e){var r=!Br(di,t).measurements.slice(Br(pi,t)+1).map(function(e){return e.type}).includes(s),n=Math.min.apply(Math,rn(Object.values("download"===s?e.down:e.up).slice(-1)[0].timings.map(function(e){return e.duration})));if(r||!i.bypassMinDuration&&n>Br(di,t).bandwidthFinishRequestDuration){a.finished=!0,t.onResultsChange({type:s});var o=.5*Object.keys(a.results).map(function(e){return+e}).sort(function(e,t){return t-e})[0];"download"===s&&Fr(mi,t,o),"upload"===s&&Fr(fi,t,o)}else a.finishedCurrentRound=!0;Br(gi,t)&&Mr(_i,t,Ti).call(t)},r.onConnectionError=function(e){a.error=e,t.onResultsChange({type:s}),Br(ci,t).call(t,"Connection error while measuring ".concat(s,": ").concat(e)),Mr(_i,t,Ti).call(t)},r.play()}}Fr(hi,this,r),a.started=!0,this.onResultsChange({type:s})}else Br(hi,this).play()}var Ci=new WeakMap,Pi=new WeakMap,Oi=function(e){function t(e){var r;jr(this,t);for(var n=arguments.length,s=new Array(n>1?n-1:0),i=1;i<n;i++)s[i-1]=arguments[i];return Ur(r=Lr(this,t,[e].concat(s)),Ci,void 0),Ur(r,Pi,function(e){Br(Ci,r)&&function(e,t){var r=t.apiUrl,n={};Object.entries(ti).forEach(function(t){var r=Zr(t,2),s=r[0],i=Zr(r[1],2),a=i[0],o=i[1],c=void 0===o?function(e){return e}:o,d=e[a]();d&&(n[s]=c(d))});var s=e.getScores();s&&(n.scores=Object.assign.apply(Object,[{}].concat(rn(Object.entries(s).map(function(e){var t,r=Zr(e,2);return Vr({},r[0],{points:(t=r[1]).points,classification:t.classificationName})}))))),fetch(r,{method:"POST",body:JSON.stringify(n)})}(e,{apiUrl:Br(Ci,r)})}),tn(t,"onFinish",Br(Pi,r),r,1),Fr(Ci,r,Object.assign({},on,e,cn).logAimApiUrl),r}return Kr(t,e),Wr(t,[{key:"onFinish",set:function(e){var r=this;tn(t,"onFinish",function(t){e(t),Br(Pi,r).call(r,t)},this,1)}}])}(yi),xi=n(9633);function Di(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return Ii(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Ii(e,t):void 0}}(e))||t){r&&(e=r);var n=0,s=function(){};return{s:s,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,o=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){o=!0,i=e},f:function(){try{a||null==r.return||r.return()}finally{if(o)throw i}}}}function Ii(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var Ai=[S],Mi=!1,Li=function(){return(0,s.A)(function e(){(0,r.A)(this,e),(0,i.A)(this,"keyProvider",null)},null,[{key:"setKeyProvider",value:function(e){this.keyProvider=e}},{key:"getKeyProvider",value:function(){return this.keyProvider}},{key:"config",value:function(e){if(!e)throw new Error("'token' is empty, please provide it in config");this.apiKey=e;var t=v($,void 0,y.apply(void 0,Ai));window.STORE=t,J.default.init({store:t})}},{key:"getCameras",value:(_=(0,t.A)(c().mark(function e(){var r,n,s,i;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,r=navigator.userAgent.includes("Firefox"),n=[],!r){e.next=2;break}return e.next=1,new Promise(function(e,r){var s;navigator.mediaDevices.getUserMedia({audio:!1,video:!0}).then((s=(0,t.A)(c().mark(function t(r){var s;return c().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=1,navigator.mediaDevices.enumerateDevices();case 1:s=t.sent,n=s.filter(function(e){return"videoinput"===e.kind}).map(function(e){return new br(e.deviceId,e.groupId,e.kind,e.label)}),e(n),r.getTracks().forEach(function(e){return e.stop()});case 2:case"end":return t.stop()}},t)})),function(e){return s.apply(this,arguments)})).catch(function(e){r(e)})});case 1:e.next=4;break;case 2:return e.next=3,navigator.mediaDevices.enumerateDevices();case 3:s=e.sent,n=s.filter(function(e){return"videoinput"===e.kind}).map(function(e){return new br(e.deviceId,e.groupId,e.kind,e.label)});case 4:return e.abrupt("return",n);case 5:e.prev=5,(i=e.catch(0)).message,i instanceof TypeError&&"TypeError"===i.name&&hr.q.ERROR_CAMERA_ACCESS_UNAVAILABLE.message;case 6:case"end":return e.stop()}},e,null,[[0,5]])})),function(){return _.apply(this,arguments)})},{key:"getMicrophones",value:(g=(0,t.A)(c().mark(function e(){var r,n,s,i;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,r=navigator.userAgent.includes("Firefox"),n=[],!r){e.next=2;break}return e.next=1,new Promise(function(e,r){var s;navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then((s=(0,t.A)(c().mark(function t(r){var s;return c().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=1,navigator.mediaDevices.enumerateDevices();case 1:s=t.sent,n=s.filter(function(e){return"audioinput"===e.kind}).map(function(e){return new wr(e.deviceId,e.groupId,e.kind,e.label)}),e(n),r.getTracks().forEach(function(e){return e.stop()});case 2:case"end":return t.stop()}},t)})),function(e){return s.apply(this,arguments)})).catch(function(e){r(e)})});case 1:e.next=4;break;case 2:return e.next=3,navigator.mediaDevices.enumerateDevices();case 3:s=e.sent,n=s.filter(function(e){return"audioinput"===e.kind}).map(function(e){return new wr(e.deviceId,e.groupId,e.kind,e.label)});case 4:return e.abrupt("return",n);case 5:e.prev=5,(i=e.catch(0)).message,i instanceof TypeError&&"TypeError"===i.name&&hr.q.ERROR_MICROPHONE_ACCESS_UNAVAILABLE.message;case 6:case"end":return e.stop()}},e,null,[[0,5]])})),function(){return g.apply(this,arguments)})},{key:"getPlaybackDevices",value:(f=(0,t.A)(c().mark(function e(){var r,n,s,i;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,r=navigator.userAgent.includes("Firefox"),n=[],!r){e.next=2;break}return e.next=1,new Promise(function(e,r){var s;navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then((s=(0,t.A)(c().mark(function t(r){var s;return c().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=1,navigator.mediaDevices.enumerateDevices();case 1:s=t.sent,n=s.filter(function(e){return"audiooutput"===e.kind}).map(function(e){return new Sr(e.deviceId,e.groupId,e.kind,e.label)}),e(n),r.getTracks().forEach(function(e){return e.stop()});case 2:case"end":return t.stop()}},t)})),function(e){return s.apply(this,arguments)})).catch(function(e){r(e)})});case 1:e.next=4;break;case 2:return e.next=3,navigator.mediaDevices.enumerateDevices();case 3:s=e.sent,n=s.filter(function(e){return"audiooutput"===e.kind}).map(function(e){return new Sr(e.deviceId,e.groupId,e.kind,e.label)});case 4:return e.abrupt("return",n);case 5:e.prev=5,(i=e.catch(0)).message,i instanceof TypeError&&i.name;case 6:case"end":return e.stop()}},e,null,[[0,5]])})),function(){return f.apply(this,arguments)})},{key:"getDevices",value:(m=(0,t.A)(c().mark(function e(){var t,r,n,s,i,a;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=1,navigator.mediaDevices.enumerateDevices();case 1:t=e.sent,r=[],n=Di(t);try{for(n.s();!(s=n.n()).done;)i=s.value,r.push(new yr(i.deviceId,i.groupId,i.kind,i.label))}catch(o){n.e(o)}finally{n.f()}return e.abrupt("return",r);case 2:e.prev=2,(a=e.catch(0)).message,a instanceof TypeError&&("TypeError"===a.name||a.message);case 3:case"end":return e.stop()}},e,null,[[0,2]])})),function(){return m.apply(this,arguments)})},{key:"on",value:function(e,t){if("device-changed"!==e)throw new Error("Unsupported event type");this.addDeviceChangeEvent(),this.eventEmitter.on(e,t)}},{key:"addDeviceChangeEvent",value:function(){var e,r=this;if(!Mi){this.getDevices().then(function(e){r.devices=e});try{navigator.mediaDevices.addEventListener("devicechange",(e=(0,t.A)(c().mark(function e(t){var n,s,i,a,o,d;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.devices,e.next=1,r.getDevices();case 1:r.devices=e.sent,s=new Array,i=Di(r.devices),e.prev=2,o=c().mark(function e(){var t;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=a.value,0==n.filter(function(e){return e.deviceId==t.deviceId&&e.kind==t.kind}).length?s.push(t):n=n.filter(function(e){return!(e.deviceId==t.deviceId&&e.kind==t.kind)});case 1:case"end":return e.stop()}},e)}),i.s();case 3:if((a=i.n()).done){e.next=5;break}return e.delegateYield(o(),"t0",4);case 4:e.next=3;break;case 5:e.next=7;break;case 6:e.prev=6,d=e.catch(2),i.e(d);case 7:return e.prev=7,i.f(),e.finish(7);case 8:0!=s.length&&r.eventEmitter.emit("device-changed",{devices:r.devices}),0!=n.length&&r.eventEmitter.emit("device-changed",{devices:r.devices});case 9:case"end":return e.stop()}},e,null,[[2,6,7,8]])})),function(t){return e.apply(this,arguments)})),Mi=!0}catch(n){n.message,n instanceof TypeError&&("TypeError"===n.name||n.message)}}}},{key:"off",value:function(e,t){if("device-changed"!==e)throw new Error("Unsupported event type");this.eventEmitter.off(e,t)}},{key:"checkPermissions",value:(h=(0,t.A)(c().mark(function e(t){var r,n,s,i,a;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t||(t=Rr.AUDIO_AND_VIDEO),r=new Map,!t.includes(Rr.AUDIO)&&!t.includes(Rr.AUDIO_AND_VIDEO)){e.next=5;break}return n=!0,e.prev=1,e.next=2,navigator.permissions.query({name:"microphone"});case 2:"prompt"!=(s=e.sent).state&&"denied"!=s.state||(n=!1),e.next=4;break;case 3:throw e.prev=3,e.catch(1),Error("Browser does not support microphone permission check");case 4:r.set(Rr.AUDIO,n);case 5:if(!t.includes(Rr.VIDEO)&&!t.includes(Rr.AUDIO_AND_VIDEO)){e.next=10;break}return i=!0,e.prev=6,e.next=7,navigator.permissions.query({name:"camera"});case 7:"prompt"!=(a=e.sent).state&&"denied"!=a.state||(i=!1),e.next=9;break;case 8:throw e.prev=8,e.catch(6),Error("Browser does not support camera permission check");case 9:r.set(Rr.VIDEO,i);case 10:return e.abrupt("return",r);case 11:case"end":return e.stop()}},e,null,[[1,3],[6,8]])})),function(e){return h.apply(this,arguments)})},{key:"requestPermission",value:(p=(0,t.A)(c().mark(function e(t){var r,n,s,i,a,o,d,u,l,p,h,m,f,g,v,_;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t||(t=Rr.AUDIO_AND_VIDEO),r=new Map,!t.includes(Rr.AUDIO_AND_VIDEO)){e.next=12;break}return s={audio:!0,video:!0},i=!0,e.prev=1,e.next=2,navigator.mediaDevices.getUserMedia(s);case 2:n=e.sent,e.next=11;break;case 3:if(e.prev=3,!((h=e.catch(1))instanceof DOMException)){e.next=9;break}m=h.name,e.next="NotAllowedError"===m?4:"NotReadableError"===m?5:"NotFoundError"===m?6:7;break;case 4:return"Permission denied by system"===h.message&&hr.q.ERROR_CAMERA_PERMISSION_DENIED_BY_OS.message,e.abrupt("continue",8);case 5:return ji(h,"video"),e.abrupt("continue",8);case 6:return hr.q.ERROR_CAMERA_NOT_FOUND.message,navigator&&navigator.userAgent&&-1!=navigator.userAgent.indexOf("Firefox")&&hr.q.ERROR_CAMERA_PERMISSION_DENIED_BY_OS.message,e.abrupt("continue",8);case 7:h.message;case 8:e.next=10;break;case 9:h instanceof TypeError&&"TypeError"===h.name?hr.q.ERROR_CAMERA_ACCESS_UNAVAILABLE.message:h.message;case 10:i=!1;case 11:n&&setTimeout(function(){n.getTracks().forEach(function(e){e.stop()})},100),r.set(Rr.AUDIO_AND_VIDEO,i);case 12:if(!t.includes(Rr.VIDEO)){e.next=24;break}return o={audio:!1,video:!0},d=!0,e.prev=13,e.next=14,navigator.mediaDevices.getUserMedia(o);case 14:a=e.sent,e.next=23;break;case 15:if(e.prev=15,!((f=e.catch(13))instanceof DOMException)){e.next=21;break}g=f.name,e.next="NotAllowedError"===g?16:"NotReadableError"===g?17:"NotFoundError"===g?18:19;break;case 16:return"Permission denied by system"===f.message&&hr.q.ERROR_CAMERA_PERMISSION_DENIED_BY_OS.message,e.abrupt("continue",20);case 17:return ji(f,"video"),e.abrupt("continue",20);case 18:return hr.q.ERROR_CAMERA_NOT_FOUND.message,navigator&&navigator.userAgent&&-1!=navigator.userAgent.indexOf("Firefox")&&hr.q.ERROR_CAMERA_PERMISSION_DENIED_BY_OS.message,e.abrupt("continue",20);case 19:f.message;case 20:e.next=22;break;case 21:f instanceof TypeError&&"TypeError"===f.name?hr.q.ERROR_CAMERA_ACCESS_UNAVAILABLE.message:f.message;case 22:d=!1;case 23:a&&a.getTracks().forEach(function(e){e.stop()}),r.set(Rr.VIDEO,d);case 24:if(!t.includes(Rr.AUDIO)){e.next=36;break}return l={audio:!0,video:!1},p=!0,e.prev=25,e.next=26,navigator.mediaDevices.getUserMedia(l);case 26:u=e.sent,e.next=35;break;case 27:if(e.prev=27,!((v=e.catch(25))instanceof DOMException)){e.next=33;break}_=v.name,e.next="NotAllowedError"===_?28:"NotReadableError"===_?29:"NotFoundError"===_?30:31;break;case 28:return"Permission denied by system"===v.message&&hr.q.ERROR_MICROPHONE_PERMISSION_DENIED_BY_OS.message,e.abrupt("continue",32);case 29:return ji(v,"audio"),e.abrupt("continue",32);case 30:return hr.q.ERROR_MICROPHONE_NOT_FOUND.message,navigator&&navigator.userAgent&&-1!=navigator.userAgent.indexOf("Firefox")&&hr.q.ERROR_MICROPHONE_PERMISSION_DENIED_BY_OS.message,e.abrupt("continue",32);case 31:v.message;case 32:e.next=34;break;case 33:v instanceof TypeError&&"TypeError"===v.name?hr.q.ERROR_MICROPHONE_ACCESS_UNAVAILABLE.message:v.message;case 34:p=!1;case 35:u&&u.getTracks().forEach(function(e){e.stop()}),r.set(Rr.AUDIO,p);case 36:return e.abrupt("return",r);case 37:case"end":return e.stop()}},e,null,[[1,3],[13,15],[25,27]])})),function(e){return p.apply(this,arguments)})},{key:"isInt",value:function(e){return"number"==typeof e&&e%1==0}},{key:"getNetworkStats",value:(l=(0,t.A)(c().mark(function e(){var t,r,n,s,i,a,o=arguments;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=(t=o.length>0&&void 0!==o[0]?o[0]:{}).timeoutDuration,n=t.baseUrl,s=void 0===n?"api.videosdk.live":n,r&&this.isInt(r)||(r=6e4),i=new Promise(function(e,t){setTimeout(function(){t("Not able to get NetworkStats due to timeout")},r)}),a=new Promise(function(e,t){if(navigator.onLine){var r=new Oi({measureDownloadLoadedLatency:!1,measureUploadLoadedLatency:!1,measurements:[{type:"upload",bytes:3e6,count:1,bypassMinDuration:!0},{type:"download",bytes:3e6,count:1,bypassMinDuration:!0}],uploadApiUrl:"https://".concat(s,"/test-upload-speed"),downloadApiUrl:"https://".concat(s,"/test-download-speed")});r.isRunning?(r.onFinish=function(t){e({downloadSpeed:parseFloat(Number(t.getDownloadBandwidth()/1048576).toFixed(2)),uploadSpeed:parseFloat(Number(t.getUploadBandwidth()/1048576).toFixed(2))})},r.onError=function(e){t("Not able to get NetworkStats")}):t("Not able to get NetworkStats")}else t("Not able to get NetworkStats due to no Network")}),e.abrupt("return",Promise.race([a,i]));case 1:case"end":return e.stop()}},e,this)})),function(){return l.apply(this,arguments)})},{key:"checkConnection",value:(d=(0,t.A)(c().mark(function e(){var t,r,n,s,i,a,o=arguments;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=(t=o.length>0&&void 0!==o[0]?o[0]:{}).timeoutDuration,n=t.baseUrl,s=void 0===n?"api.videosdk.live":n,r&&this.isInt(r)||(r=6e4),i=new Promise(function(e,t){setTimeout(function(){t("TimeoutError: NetworkStats timeout")},r)}),a=new Promise(function(e,t){navigator.onLine?fetch("https://".concat(s,"/ping")).then(function(r){r.text().then(function(r){"pong"==r?e("Connection established"):t("ConnectionError: Server unreachable")})}).catch(function(e){t("ConnectionError: Server unreachable")}):t("NetworkError: Offline")}),e.abrupt("return",Promise.race([a,i]));case 1:case"end":return e.stop()}},e,this)})),function(){return d.apply(this,arguments)})},{key:"analytics",value:function(e){var t,r,n;!e&&navigator&&navigator.userAgent&&(r=navigator.userAgent,delete(n=u().parse(r)).engine);try{var s;null!==(s=e)&&void 0!==s&&s.browserUserAgent||(r=navigator.userAgent,delete(n=u().parse(r)).engine)}catch(a){}e&&e.rawUserAgent&&(r=e.rawUserAgent,delete(n=u().parse(r)).engine),e||(e={});var i={};i.sdkType=e.sdkType||"javascript",i.sdkVersion=e.sdkVersion||"0.2.14",i.platform=e.platform||(null===(t=n)||void 0===t||null===(t=t.platform)||void 0===t?void 0:t.type)||"","null"==e.browserUserAgent?i.browserUserAgent=void 0:i.browserUserAgent=n,e.deviceUserAgent&&(i.deviceUserAgent=e.deviceUserAgent),this._deviceInfo=i}},{key:"initMeeting",value:function(t){var r,n=t.meetingId,s=t.customCameraVideoTrack,i=void 0===s?void 0:s,a=t.customMicrophoneAudioTrack,o=void 0===a?void 0:a,c=t.autoConsume,d=void 0===c||c,u=t.preferredProtocol,l=t.mode,p=t.multiStream,h=void 0===p||p,m=t.participantId,f=t.name,g=t.micEnabled,v=t.webcamEnabled,_=t.maxResolution,y=t.metaData,b=t.chatEnabled,w=t.useSpartialLayerAnalytics,S=t.signalingBaseUrl,R=t.defaultCamera,E=t.debugMode,T=void 0===E||E;if(!n)throw new Error("'meetingId' is empty, please verify it or generate new meetingId using the API.");var C=m?m.toString():k()({length:8}).toLowerCase(),P=f||k()({length:6}).toLowerCase();switch(this._deviceInfo||this.analytics(),"string"!=typeof u&&(u="UDP_OVER_TCP"),null===(r=u)||void 0===r?void 0:r.toUpperCase()){case"UDP_ONLY":case"UDP_OVER_TCP":case"TCP_ONLY":u=u.toUpperCase();break;default:u="UDP_OVER_TCP"}if(l||(l=Pe.nI.SEND_AND_RECV),l!==Pe.nI.SEND_AND_RECV&&l!==Pe.nI.SIGNALLING_ONLY&&l!==Pe.nI.RECV_ONLY&&l!==Pe.nI.VIEWER&&l!==Pe.nI.CONFERENCE)throw new Error('"mode" can only be either '.concat(Pe.nI.SEND_AND_RECV," or ").concat(Pe.nI.SIGNALLING_ONLY," or ").concat(Pe.nI.RECV_ONLY," "));if(null!=y&&"object"!=(0,e.A)(y))throw new Error('"metaData" can only be object.');var O="react-native"===this._deviceInfo.sdkType,x=O?R?"front"===R?1:0:i?"user"===i.getVideoTracks()[0].getConstraints().facingMode?1:0:O?1:0:0,D=new J.default({roomId:n,peerId:C,secret:this.apiKey,device:"unknown",displayName:P,mode:l,useSimulcast:h,produce:!0,consume:!0,datachannel:!1!==b,micEnabled:!1!==g,webcamEnabled:!1!==v,maxResolution:_||"hd",useSpartialLayerAnalytics:w,_deviceInfo:this._deviceInfo,customCameraVideoTrack:i,customMicrophoneAudioTrack:o,autoConsume:d,preferredProtocol:u,signalingBaseUrl:S,metaData:y,defaultCameraIndex:x,debugMode:T,keyProvider:this.keyProvider});ee.roomClient=D;var I=new Re({id:C,displayName:P,local:!0,mode:l,metaData:y});return new ur(n,I,D)}},{key:"createCameraVideoTrack",value:(o=(0,t.A)(c().mark(function e(t){var r,n,s,i,a,o,d,u,l,p,h,m,f,g,v,_;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.cameraId,n=void 0===r?void 0:r,s=t.encoderConfig,i=void 0===s?void 0:s,a=t.facingMode,o=void 0===a?void 0:a,d=t.optimizationMode,u=void 0===d?void 0:d,l=t.multiStream,p=void 0===l||l,!n){e.next=2;break}return e.next=1,this.getCameras();case 1:(h=e.sent)&&h.some(function(e){return e.deviceId})&&h.some(function(e){return e.deviceId===n});case 2:return e.prev=2,m=i?gr.$.videoProfiles[i]:gr.$.videoProfiles.h360p_w640p,f={video:{deviceId:n||void 0,facingMode:o||void 0,width:m.width,height:m.height,frameRate:m.frameRate}},e.next=3,(0,fr.lp)(f);case 3:return g=e.sent,u&&(g.contentHint=u),g.encoderConfig=i||"h360p_w640p",g.contentHint=u||"",g.multiStream=p,g.cameraId=n,e.abrupt("return",g);case 4:if(e.prev=4,"SecurityError"!==(v=e.catch(2)).name){e.next=5;break}hr.q.ERROR_RN_CAMERA_ACCESS_DENIED_OR_DISMISSED.message,e.next=13;break;case 5:if("DOMException"!==v.name){e.next=6;break}hr.q.ERROR_RN_CAMERA_NOT_FOUND.message,e.next=13;break;case 6:if(!(v instanceof DOMException)){e.next=12;break}_=v.name,e.next="NotAllowedError"===_?7:"NotReadableError"===_?8:"NotFoundError"===_?9:10;break;case 7:return Ni(v,"video"),e.abrupt("continue",11);case 8:return ji(v,"video"),e.abrupt("continue",11);case 9:return hr.q.ERROR_CAMERA_NOT_FOUND.message,navigator&&navigator.userAgent&&-1!=navigator.userAgent.indexOf("Firefox")&&hr.q.ERROR_CAMERA_PERMISSION_DENIED_BY_OS.message,e.abrupt("continue",11);case 10:return v.message,e.abrupt("continue",11);case 11:e.next=13;break;case 12:"getUserMedia is not implemented in this browser"==v.message?hr.q.ERROR_CAMERA_ACCESS_UNAVAILABLE.message:v.message;case 13:case 14:case"end":return e.stop()}},e,this,[[2,4]])})),function(e){return o.apply(this,arguments)})},{key:"createScreenShareVideoTrack",value:(a=(0,t.A)(c().mark(function e(t){var r,n,s,i,a,o,d,u,l,p,h;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.encoderConfig,n=void 0===r?void 0:r,s=t.optimizationMode,i=void 0===s?void 0:s,a=t.withAudio,o=void 0===a?"enable":a,d=t.multiStream,u=void 0!==d&&d,l=n?gr.$.screenShareProfiles[n]:gr.$.screenShareProfiles.h720p_15fps,p={audio:"enable"===o,video:{width:l.resolution.width,height:l.resolution.height,frameRate:l.frameRate}},e.next=1,(0,fr.Zu)(p);case 1:return h=e.sent,i&&(h.contentHint=i),h.multiStream=u,e.abrupt("return",h);case 2:case"end":return e.stop()}},e)})),function(e){return a.apply(this,arguments)})},{key:"createMicrophoneAudioTrack",value:(n=(0,t.A)(c().mark(function e(t){var r,n,s,i,a,o,d,u,l,p,h,m;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.noiseConfig,n=void 0===r?void 0:r,s=t.encoderConfig,i=void 0===s?void 0:s,a=t.microphoneId,!(o=void 0===a?void 0:a)){e.next=2;break}return e.next=1,this.getMicrophones();case 1:(d=e.sent)&&d.some(function(e){return e.deviceId})&&d.some(function(e){return e.deviceId===o});case 2:return e.prev=2,u=i?gr.$.audioProfiles[i]:gr.$.audioProfiles.speech_standard,l={audio:{deviceId:o,sampleRate:u.sampleRate,echoCancellation:n?n&&n.acousticEchoCancellation:u.echoCancellation,autoGainControl:n?n&&n.autoGainControl:u.autoGainControl,noiseSuppression:n?n&&n.noiseSuppression:u.noiseSuppression,channelCount:u.channelCount}},e.next=3,(0,fr.lp)(l);case 3:return(p=e.sent).encoderConfig=i||"speech_standard",p.microphoneId=o,e.abrupt("return",p);case 4:if(e.prev=4,"SecurityError"!==(h=e.catch(2)).name){e.next=5;break}hr.q.ERROR_RN_MIC_ACCESS_DENIED_OR_DISMISSED.message,e.next=13;break;case 5:if("DOMException"!==h.name){e.next=6;break}hr.q.ERROR_RN_MIC_NOT_FOUND.message,e.next=13;break;case 6:if(!(h instanceof DOMException)){e.next=12;break}m=h.name,e.next="NotAllowedError"===m?7:"NotReadableError"===m?8:"NotFoundError"===m?9:10;break;case 7:return Ni(h,"audio"),e.abrupt("continue",11);case 8:return ji(h,"audio"),e.abrupt("continue",11);case 9:return hr.q.ERROR_MICROPHONE_NOT_FOUND.message,navigator&&navigator.userAgent&&-1!=navigator.userAgent.indexOf("Firefox")&&hr.q.ERROR_MICROPHONE_PERMISSION_DENIED_BY_OS.message,e.abrupt("continue",11);case 10:return h.message,e.abrupt("continue",11);case 11:e.next=13;break;case 12:"getUserMedia is not implemented in this browser"==h.message?hr.q.ERROR_MICROPHONE_ACCESS_UNAVAILABLE.message:h.message;case 13:case 14:case"end":return e.stop()}},e,this,[[2,4]])})),function(e){return n.apply(this,arguments)})}]);var n,a,o,d,l,p,h,m,f,g,_}();function Ni(e,t){return("Permission denied"===e.message||"Permission dismissed"===e.message?"video"===t?hr.q.ERROR_CAMERA_ACCESS_DENIED_OR_DISMISSED:hr.q.ERROR_MICROPHONE_ACCESS_DENIED_OR_DISMISSED:e.message.includes("The request is not allowed by the user agent")?"video"===t?hr.q.ERROR_CAMERA_PERMISSION_OR_AUTOPLAY_ISSUE:hr.q.ERROR_MICROPHONE_ACCESS_DENIED_OR_DISMISSED:"Permission denied by system"===e.message?"video"===t?hr.q.ERROR_CAMERA_PERMISSION_DENIED_BY_OS:hr.q.ERROR_MICROPHONE_PERMISSION_DENIED_BY_OS:"video"===t?hr.q.ERROR_GET_VIDEO_MEDIA_PERMISSION_DENIED:hr.q.ERROR_GET_AUDIO_MEDIA_PERMISSION_DENIED).message}function ji(e,t){return("Device in use"===e.message?"video"===t?hr.q.ERROR_CAMERA_IN_USE:hr.q.ERROR_MICROPHONE_IN_USE:"video"===t?hr.q.ERROR_VIDEO_SOURCE_INITIATION_FAILED:hr.q.ERROR_MICROPHONE_IN_USE).message}(0,i.A)(Li,"devices",[]),(0,i.A)(Li,"eventEmitter",new Q),(0,i.A)(Li,"Constants",{errors:hr.s,recordingEvents:{RECORDING_STARTING:"RECORDING_STARTING",RECORDING_STARTED:"RECORDING_STARTED",RECORDING_STOPPING:"RECORDING_STOPPING",RECORDING_STOPPED:"RECORDING_STOPPED"},livestreamEvents:{LIVESTREAM_STARTING:"LIVESTREAM_STARTING",LIVESTREAM_STARTED:"LIVESTREAM_STARTED",LIVESTREAM_STOPPING:"LIVESTREAM_STOPPING",LIVESTREAM_STOPPED:"LIVESTREAM_STOPPED"},characterState:Ce,characterMode:{TEXT:"text",CO_PILOT:"co_pilot",AUTO_PILOT:"auto_pilot",VISION_PILOT:"vision_pilot"},hlsEvents:mr.V,transcriptionEvents:{TRANSCRIPTION_STARTING:"TRANSCRIPTION_STARTING",TRANSCRIPTION_STARTED:"TRANSCRIPTION_STARTED",TRANSCRIPTION_STOPPING:"TRANSCRIPTION_STOPPING",TRANSCRIPTION_STOPPED:"TRANSCRIPTION_STOPPED"},modes:Pe.nI,permission:Rr});var Bi=Li})(),o})())();function Ze(){return Ze=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Ze.apply(null,arguments)}var et="videosdk-live-react-sdk",tt={"participant-joined":et+"-participant-joined","participant-left":et+"-participant-left","speaker-changed":et+"-speaker-changed","presenter-changed":et+"-presenter-changed","main-participant-changed":et+"-main-participant-changed","entry-requested":et+"-entry-requested","entry-responded":et+"-entry-responded","recording-started":et+"-recording-started","recording-stopped":et+"-recording-stopped","chat-message":et+"-chat-message","meeting-joined":et+"-meeting-joined","meeting-left":et+"-meeting-left","live-stream-started":et+"-live-stream-started","live-stream-stopped":et+"-live-stream-stopped","video-state-changed":et+"-video-state-changed","video-seeked":et+"-video-seeked","webcam-requested":et+"-webcam-requested","mic-requested":et+"-mic-requested","pin-state-changed":et+"-pin-state-changed","connection-open":et+"-connection-open","connection-close":et+"-connection-close","switch-meeting":et+"-switch-meeting",error:et+"-error","hls-started":et+"-hls-started","hls-stopped":et+"-hls-stopped","hls-state-changed":et+"-hls-state-changed","recording-state-changed":et+"-recording-state-changed","livestream-state-changed":et+"-livestream-state-changed","meeting-state-changed":et+"-meeting-state-changed","participant-mode-changed":et+"-participant-mode-changed","transcription-state-changed":et+"-transcription-state-changed","transcription-text":et+"-transcription-text","character-joined":et+"-character-joined","character-left":et+"-character-left","whiteboard-started":et+"-whiteboard-started","whiteboard-stopped":et+"-whiteboard-stopped","paused-all-streams":et+"-paused-all-streams","resumed-all-streams":et+"-resumed-all-streams","media-relay-started":et+"-media-relay-started","media-relay-stopped":et+"-media-relay-stopped","media-relay-error":et+"-media-relay-error","media-relay-request-response":et+"-media-relay-request-response","media-relay-request-received":et+"-media-relay-request-received"},rt=new Je;rt.setMaxListeners(9999);var nt=c.createContext(),st=function(e){var t=void 0===e?{}:e,r=t.onParticipantJoined,n=void 0===r?function(){}:r,s=t.onParticipantLeft,i=void 0===s?function(){}:s,a=t.onSpeakerChanged,o=void 0===a?function(){}:a,d=t.onPresenterChanged,u=void 0===d?function(){}:d,l=t.onMainParticipantChanged,p=void 0===l?function(){}:l,h=t.onEntryRequested,m=void 0===h?function(){}:h,f=t.onEntryResponded,g=void 0===f?function(){}:f,v=t.onPausedAllStreams,_=void 0===v?function(){}:v,y=t.onResumedAllStreams,b=void 0===y?function(){}:y,w=t.onRecordingStarted,S=void 0===w?function(){}:w,R=t.onRecordingStopped,k=void 0===R?function(){}:R,E=t.onChatMessage,T=void 0===E?function(){}:E,C=t.onMeetingJoined,P=void 0===C?function(){}:C,O=t.onMeetingLeft,x=void 0===O?function(){}:O,D=t.onLiveStreamStarted,I=void 0===D?function(){}:D,A=t.onLiveStreamStopped,M=void 0===A?function(){}:A,L=t.onVideoStateChanged,N=void 0===L?function(){}:L,j=t.onVideoSeeked,B=void 0===j?function(){}:j,U=t.onWebcamRequested,F=void 0===U?function(){}:U,q=t.onMicRequested,W=void 0===q?function(){}:q,V=t.onPinStateChanged,H=void 0===V?function(){}:V,z=t.onConnectionOpen,K=void 0===z?function(){}:z,G=t.onConnetionClose,$=void 0===G?function(){}:G,J=t.onSwitchMeeting,Q=void 0===J?function(){}:J,Y=t.onError,X=void 0===Y?function(){}:Y,Z=t.onHlsStarted,ee=void 0===Z?function(){}:Z,te=t.onHlsStopped,re=void 0===te?function(){}:te,ne=t.onHlsStateChanged,se=void 0===ne?function(){}:ne,ie=t.onRecordingStateChanged,ae=void 0===ie?function(){}:ie,oe=t.onLivestreamStateChanged,ce=void 0===oe?function(){}:oe,de=t.onMeetingStateChanged,ue=void 0===de?function(){}:de,le=t.onParticipantModeChanged,pe=void 0===le?function(){}:le,he=t.onCharacterJoined,me=void 0===he?function(){}:he,fe=t.onCharacterLeft,ge=void 0===fe?function(){}:fe,ve=t.onMediaRelayStarted,_e=void 0===ve?function(){}:ve,ye=t.onMediaRelayStopped,be=void 0===ye?function(){}:ye,we=t.onMediaRelayError,Se=void 0===we?function(){}:we,Re=t.onMediaRelayRequestResponse,ke=void 0===Re?function(){}:Re,Ee=t.onMediaRelayRequestReceived,Te=void 0===Ee?function(){}:Ee;return c.useEffect(function(){return rt.on(tt["participant-joined"],n),rt.on(tt["participant-left"],i),rt.on(tt["speaker-changed"],o),rt.on(tt["presenter-changed"],u),rt.on(tt["main-participant-changed"],p),rt.on(tt["entry-requested"],m),rt.on(tt["entry-responded"],g),rt.on(tt["paused-all-streams"],_),rt.on(tt["resumed-all-streams"],b),rt.on(tt["recording-started"],S),rt.on(tt["recording-stopped"],k),rt.on(tt["chat-message"],T),rt.on(tt["meeting-joined"],P),rt.on(tt["meeting-left"],x),rt.on(tt["live-stream-started"],I),rt.on(tt["live-stream-stopped"],M),rt.on(tt["video-state-changed"],N),rt.on(tt["video-seeked"],B),rt.on(tt["webcam-requested"],F),rt.on(tt["mic-requested"],W),rt.on(tt["pin-state-changed"],H),rt.on(tt["connection-open"],K),rt.on(tt["connection-close"],$),rt.on(tt["switch-meeting"],Q),rt.on(tt.error,X),rt.on(tt["hls-started"],ee),rt.on(tt["hls-stopped"],re),rt.on(tt["hls-state-changed"],se),rt.on(tt["recording-state-changed"],ae),rt.on(tt["livestream-state-changed"],ce),rt.on(tt["meeting-state-changed"],ue),rt.on(tt["participant-mode-changed"],pe),rt.on(tt["character-joined"],me),rt.on(tt["character-left"],ge),rt.on(tt["media-relay-started"],_e),rt.on(tt["media-relay-stopped"],be),rt.on(tt["media-relay-error"],Se),rt.on(tt["media-relay-request-response"],ke),rt.on(tt["media-relay-request-received"],Te),function(){rt.off(tt["meeting-state-changed"],ue),rt.off(tt["participant-joined"],n),rt.off(tt["participant-left"],i),rt.off(tt["speaker-changed"],o),rt.off(tt["presenter-changed"],u),rt.off(tt["main-participant-changed"],p),rt.off(tt["entry-requested"],m),rt.off(tt["entry-responded"],g),rt.off(tt["paused-all-streams"],_),rt.off(tt["resumed-all-streams"],b),rt.off(tt["recording-started"],S),rt.off(tt["recording-stopped"],k),rt.off(tt["chat-message"],T),rt.off(tt["meeting-joined"],P),rt.off(tt["meeting-left"],x),rt.off(tt["live-stream-started"],I),rt.off(tt["live-stream-stopped"],M),rt.off(tt["video-state-changed"],N),rt.off(tt["video-seeked"],B),rt.off(tt["webcam-requested"],F),rt.off(tt["mic-requested"],W),rt.off(tt["pin-state-changed"],H),rt.off(tt["connection-open"],K),rt.off(tt["connection-close"],$),rt.off(tt["switch-meeting"],Q),rt.off(tt.error,X),rt.off(tt["hls-started"],ee),rt.off(tt["hls-stopped"],re),rt.off(tt["hls-state-changed"],se),rt.off(tt["recording-state-changed"],ae),rt.off(tt["livestream-state-changed"],ce),rt.off(tt["participant-mode-changed"],pe),rt.off(tt["character-joined"],me),rt.off(tt["character-left"],ge),rt.off(tt["media-relay-started"],_e),rt.off(tt["media-relay-stopped"],be),rt.off(tt["media-relay-error"],Se),rt.off(tt["media-relay-request-response"],ke),rt.off(tt["media-relay-request-received"],Te)}},[]),c.useContext(nt)},it=function(e){var t=e.children,r=e.config,n=e.token,s=e.joinWithoutUserInteraction,i=e.reinitialiseMeetingOnConfigChange,a=e.deviceInfo,o=e.keyProvider,u=c.useState(null),l=u[0],p=u[1],h=c.useState(null),m=h[0],f=h[1],g=c.useState(null),v=g[0],_=g[1],y=c.useState(null),b=y[0],w=y[1],S=c.useState(null),R=S[0],k=S[1],E=c.useState(!1),T=E[0],C=E[1],P=c.useState(!1),O=P[0],x=P[1],D=c.useState(!1),I=D[0],A=D[1],M=c.useState(!1),L=M[0],N=M[1],j=c.useState([]),B=j[0],U=j[1],F=c.useState(new Map),q=F[0],W=F[1],V=c.useState(new Map),H=V[0],z=V[1],K=c.useState(new Map),G=K[0],$=K[1],J=c.useState(!1),Q=J[0],Y=J[1],X=c.useState(new Map),Z=X[0],ee=X[1],te=c.useState(!1),re=te[0],ne=te[1],se=c.useState(!1),ie=se[0],ae=se[1],oe=c.useState("RECORDING_STOPPED"),ce=oe[0],de=oe[1],ue=c.useState("LIVESTREAM_STOPPED"),le=ue[0],pe=ue[1],he=c.useState("HLS_STOPPED"),me=he[0],fe=he[1],ge=c.useState({downstreamUrl:null,playbackHlsUrl:null,livestreamUrl:null}),ve=ge[0],_e=ge[1],ye=c.useState("TRANSCRIPTION_STOPPED"),be=ye[0],we=ye[1],Se=c.useRef(),Re=c.useRef(),ke=c.useRef(),Ee=c.useRef(),Te=c.useRef(),Ce=c.useRef(o),Pe=c.useRef(r),Oe=c.useRef(n),xe=c.useRef(!1),De=c.useRef(),Ie=c.useMemo(function(){return i},[]);c.useEffect(function(){Se.current=l},[l]),c.useEffect(function(){Re.current=T},[T]),c.useEffect(function(){ke.current=O},[O]),c.useEffect(function(){Ee.current=I},[I]),c.useEffect(function(){Te.current=L},[L]),c.useEffect(function(){Pe.current=r},[r]),c.useEffect(function(){Oe.current=n},[n]),c.useEffect(function(){De.current=ie},[ie]);var Ae=function(e){W(function(t){return t.set(e.id,e),new Map(t)}),rt.emit(tt["participant-joined"],e)},Me=function(e){W(function(t){return t.delete(e.id),new Map(t)}),rt.emit(tt["participant-left"],e)},Le=function(e){var t,r;k(e),A(e===(null==Se||null===(t=Se.current)||void 0===t||null===(r=t.localParticipant)||void 0===r?void 0:r.id)),rt.emit(tt["presenter-changed"],e)},Ne=function(e){_(e),rt.emit(tt["main-participant-changed"],e)},je=function(e){w(e),rt.emit(tt["speaker-changed"],e)},Be=function(e){U(function(t){return[].concat(t,[e])}),rt.emit(tt["chat-message"],e)},Ue=function(e){rt.emit(tt["entry-requested"],e)},Fe=function(e,t){rt.emit(tt["entry-responded"],e,t)},qe=function(){N(!0),rt.emit(tt["recording-started"])},We=function(){N(!1),rt.emit(tt["recording-stopped"])},Ve=function(e){"live"===e.track.readyState&&("video"===e.kind?x(!0):"audio"===e.kind&&C(!0))},He=function(e){"video"===e.kind?x(!1):"audio"===e.kind&&C(!1)},ze=function(e){Y(!0),rt.emit(tt["live-stream-started"],e)},Ke=function(){Y(!1),rt.emit(tt["live-stream-stopped"])},Ge=function(e){ae(!0),rt.emit(tt["hls-started"],e)},$e=function(){ae(!1),rt.emit(tt["hls-stopped"])},Je=function(e){rt.emit(tt["video-state-changed"],e)},Qe=function(e){rt.emit(tt["video-seeked"],e)},Ye=function(e){rt.emit(tt["webcam-requested"],e)},Ze=function(e){rt.emit(tt["mic-requested"],e)},et=function(e){e.switchRoomId?(U(function(t){return[].concat(t,e.messages)}),rt.emit(tt["meeting-joined"],e)):(xe.current=!0,U(function(t){return[].concat(t,e.messages)}),rt.emit(tt["meeting-joined"],e),ne(!0))},st=function(){rt.emit(tt["meeting-left"]);var e,t=Se.current;t&&("function"==typeof(null==t?void 0:t.off)&&(t.off("meeting-state-changed",ft),t.off("participant-joined",Ae),t.off("participant-left",Me),t.off("presenter-changed",Le),t.off("main-participant-changed",Ne),t.off("speaker-changed",je),t.off("entry-requested",Ue),t.off("entry-responded",Fe),t.off("chat-message",Be),t.off("recording-started",qe),t.off("recording-stopped",We),t.off("meeting-joined",et),t.off("meeting-left",st),t.off("livestream-started",ze),t.off("livestream-stopped",Ke),t.off("video-state-changed",Je),t.off("video-seeked",Qe),t.off("webcam-requested",Ye),t.off("mic-requested",Ze),t.off("pin-state-changed",it),t.off("paused-all-streams",at),t.off("resumed-all-streams",ot),t.off("connection-open",ct),t.off("connection-close",dt),t.off("switch-meeting",ut),t.off("error",lt),t.off("hls-started",Ge),t.off("hls-stopped",$e),t.off("recording-state-changed",pt),t.off("livestream-state-changed",ht),t.off("hls-state-changed",mt),t.off("participant-mode-changed",St),t.off("whiteboard-stopped",yt),t.off("whiteboard-started",_t),t.off("transcription-state-changed",gt),t.off("character-joined",bt),t.off("character-left",wt)),"function"==typeof(null==t||null===(e=t.localParticipant)||void 0===e?void 0:e.off)&&(t.localParticipant.off("stream-enabled",Ve),t.localParticipant.off("stream-disabled",He)),p(null),f(null),_(null),w(null),k(null),C(!1),x(!1),A(!1),N(!1),U([]),Y(!1),W(new Map),z(new Map),$(new Map),ee(new Map),ne(!1),ae(!1),de("RECORDING_STOPPED"),pe("LIVESTREAM_STOPPED"),fe("HLS_STOPPED"),we("TRANSCRIPTION_STOPPED"),_e({downstreamUrl:null,playbackHlsUrl:null,livestreamUrl:null}))},it=function(e){var t=e.participantId,r=e.state,n=e.pinnedBy;$(function(e){return r.cam||r.share?e.set(t,r):e.delete(t),new Map(e)}),rt.emit(tt["pin-state-changed"],{participantId:t,state:r,pinnedBy:n})},at=function(e){var t=e.kind;rt.emit(tt["paused-all-streams"],{kind:t})},ot=function(e){var t=e.kind;rt.emit(tt["resumed-all-streams"],{kind:t})},ct=function(e){ee(function(t){return t.set(e.id,e),new Map(t)}),rt.emit(tt["connection-open"],e)},dt=function(e){ee(function(t){return t.delete(e),new Map(t)}),rt.emit(tt["connection-close"],e)},ut=function(e){rt.emit(tt["switch-meeting"],e)},lt=function(e){rt.emit(tt.error,e)},pt=function(e){de(null==e?void 0:e.status),rt.emit(tt["recording-state-changed"],e)},ht=function(e){pe(null==e?void 0:e.status),rt.emit(tt["livestream-state-changed"],e)},mt=function(e){fe(null==e?void 0:e.status),"HLS_PLAYABLE"==(null==e?void 0:e.status)?_e({downstreamUrl:null==e?void 0:e.downstreamUrl,playbackHlsUrl:null==e?void 0:e.playbackHlsUrl,livestreamUrl:null==e?void 0:e.livestreamUrl}):"HLS_STOPPED"==(null==e?void 0:e.status)&&_e({downstreamUrl:null,playbackHlsUrl:null,livestreamUrl:null}),rt.emit(tt["hls-state-changed"],e)},ft=function(e){rt.emit(tt["meeting-state-changed"],e)},gt=function(e){we(null==e?void 0:e.status),rt.emit(tt["transcription-state-changed"],e)},vt=function(e){rt.emit(tt["transcription-text"],e)},_t=function(e){rt.emit(tt["whiteboard-started"],e)},yt=function(e){rt.emit(tt["whiteboard-stopped"],e)},bt=function(e){z(function(t){return t.set(e.id,e),new Map(t)}),rt.emit(tt["character-joined"],e)},wt=function(e){z(function(t){return t.delete(e.id),new Map(t)}),rt.emit(tt["character-left"],e)},St=function(e){var t,r;W(function(t){var r=t.get(e.participantId);return r.mode=e.mode,t.set(r.id,r),new Map(t)}),e.participantId===(null==Se||null===(t=Se.current)||void 0===t||null===(r=t.localParticipant)||void 0===r?void 0:r.id)&&f(function(t){return t.mode=e.mode,t}),rt.emit(tt["participant-mode-changed"],e)},Rt=function(e){rt.emit(tt["media-relay-started"],e)},kt=function(e){rt.emit(tt["media-relay-stopped"],e)},Et=function(e){rt.emit(tt["media-relay-error"],e)},Tt=function(e){rt.emit(tt["media-relay-request-response"],e)},Ct=function(e){rt.emit(tt["media-relay-request-received"],e)},Pt=function(){var e=Xe.VideoSDK&&Xe.VideoSDK.initMeeting(Pe.current);p(e);var t=e.localParticipant,r=e.participants,n=e.characters;r.set(t.id,t),W(r),z(n),f(t),e.on("meeting-state-changed",ft),e.on("participant-joined",Ae),e.on("participant-left",Me),e.on("presenter-changed",Le),e.on("main-participant-changed",Ne),e.on("speaker-changed",je),e.on("entry-requested",Ue),e.on("entry-responded",Fe),e.on("chat-message",Be),e.on("recording-started",qe),e.on("recording-stopped",We),e.on("meeting-joined",et),e.on("meeting-left",st),e.on("livestream-started",ze),e.on("livestream-stopped",Ke),e.on("video-state-changed",Je),e.on("video-seeked",Qe),e.on("webcam-requested",Ye),e.on("mic-requested",Ze),e.on("pin-state-changed",it),e.on("paused-all-streams",at),e.on("resumed-all-streams",ot),e.on("connection-open",ct),e.on("connection-close",dt),e.on("switch-meeting",ut),e.on("error",lt),e.on("hls-started",Ge),e.on("hls-stopped",$e),e.on("recording-state-changed",pt),e.on("livestream-state-changed",ht),e.on("hls-state-changed",mt),e.on("participant-mode-changed",St),e.on("transcription-state-changed",gt),e.on("transcription-text",vt),e.on("whiteboard-started",_t),e.on("whiteboard-stopped",yt),e.on("character-joined",bt),e.on("character-left",wt),e.on("media-relay-started",Rt),e.on("media-relay-stopped",kt),e.on("media-relay-error",Et),e.on("media-relay-request-response",Tt),e.on("media-relay-request-received",Ct),e.localParticipant.on("stream-enabled",Ve),e.localParticipant.on("stream-disabled",He),e.join()},Ot=function(){var e=Se.current;e&&e.leave()},xt=function(e){void 0===e&&(e=void 0);var t=Se.current;t&&t.unmuteMic(e)},Dt=function(){var e=Se.current;e&&e.muteMic()},It=function(){var e=Se.current;e&&e.disableWebcam()},At=function(e){void 0===e&&(e=void 0);var t=Se.current;t&&t.enableWebcam(e)},Mt=function(){var e=Se.current;e&&e.disableScreenShare()},Lt=function(e){void 0===e&&(e=void 0);var t=Se.current;t&&t.enableScreenShare(e)},Nt=function(){Xe.VideoSDK.config(Oe.current),Ce.current&&Xe.VideoSDK.setKeyProvider(Ce.current),a?Xe.VideoSDK.analytics(a):Xe.VideoSDK.analytics({sdkType:"react-web",sdkVersion:"0.3.14"}),s&&Pt()};return c.useEffect(function(){Nt()},[]),c.useEffect(function(){Ie&&xe.current&&(Ot(),Nt(),!s&&Pt())},[r.meetingId,n,Ie]),d.createElement(nt.Provider,{value:{meetingId:null==l?void 0:l.id,meeting:l,baseUrl:null==l?void 0:l.baseUrl,localParticipant:m,mainParticipant:v,activeSpeakerId:b,participants:q,characters:H,presenterId:R,localMicOn:T,localWebcamOn:O,localScreenShareOn:I,messages:B,isRecording:L,isLiveStreaming:Q,pinnedParticipants:G,connections:Z,isHls:ie,recordingState:ce,livestreamState:le,hlsState:me,hlsUrls:ve,transcriptionState:be,isMeetingJoined:re,selectedCameraDevice:null==l?void 0:l.selectedCameraDevice,selectedMicrophoneDevice:null==l?void 0:l.selectedMicrophoneDevice,join:Pt,leave:Ot,end:function(){var e=Se.current;e&&e.end()},pauseAllStreams:function(e){var t=Se.current;t&&t.pauseAllStreams(e)},resumeAllStreams:function(e){var t=Se.current;t&&t.resumeAllStreams(e)},startRecording:function(e,t,r,n){var s=Se.current;s&&s.startRecording(e,t,r,n)},stopRecording:function(){var e=Se.current;e&&(Te.current&&e.stopRecording())},sendChatMessage:function(e){var t=Se.current;t&&t.sendChatMessage(e)},respondEntry:function(e,t){var r=Se.current;r&&r.respondEntry(e,t)},muteMic:Dt,unmuteMic:xt,toggleMic:function(e){void 0===e&&(e=void 0),Re.current?Dt():xt(e)},disableWebcam:It,enableWebcam:At,toggleWebcam:function(e){void 0===e&&(e=void 0),ke.current?It():At(e)},disableScreenShare:Mt,enableScreenShare:Lt,toggleScreenShare:function(e){void 0===e&&(e=void 0),Ee.current?Mt():Lt(e)},switchTo:function(e){var t=e.meetingId,r=e.token,n=Se.current;n&&n.switchTo({meetingId:t,token:r})},getMics:function(){try{var e=Se.current;return Promise.resolve(function(){if(e)return Promise.resolve(e.getMics())}())}catch(t){return Promise.reject(t)}},getWebcams:function(){try{var e=Se.current;return Promise.resolve(function(){if(e)return Promise.resolve(e.getWebcams())}())}catch(t){return Promise.reject(t)}},changeWebcam:function(e){var t=Se.current;t&&t.changeWebcam(e)},replaceWebcamStream:function(e){var t=Se.current;t&&t.replaceWebcamStream(e)},changeMic:function(e){var t=Se.current;t&&t.changeMic(e)},changeMode:function(e){var t=Se.current;t&&t.changeMode(e)},startVideo:function(e){var t=e.link,r=Se.current;r&&r.startVideo({link:t})},stopVideo:function(){var e=Se.current;e&&e.stopVideo()},resumeVideo:function(){var e=Se.current;e&&e.resumeVideo()},pauseVideo:function(e){var t=e.currentTime,r=Se.current;r&&r.pauseVideo({currentTime:t})},seekVideo:function(e){var t=e.currentTime,r=Se.current;r&&r.seekVideo({currentTime:t})},startLivestream:function(e,t){var r=Se.current;r&&r.startLivestream(e,t)},stopLivestream:function(){var e=Se.current;e&&e.stopLivestream()},connectTo:function(e){var t=e.meetingId,r=e.payload;try{var n=Se.current,s=function(){if(n)return Promise.resolve(n.connectTo({meetingId:t,payload:r})).then(function(){})}();return Promise.resolve(s&&s.then?s.then(function(){}):void 0)}catch(i){return Promise.reject(i)}},startHls:function(e,t){var r=Se.current;r&&r.startHls(e,t)},stopHls:function(){var e=Se.current;e&&e.stopHls()},enableAdaptiveSubscription:function(){var e=Se.current;e&&e.enableAdaptiveSubscription()},disableAdaptiveSubscription:function(){var e=Se.current;e&&e.disableAdaptiveSubscription()},requestMediaRelay:function(e){var t=e.destinationMeetingId,r=e.token,n=e.kinds,s=Se.current;s&&s.requestMediaRelay({destinationMeetingId:t,token:r,kinds:n})},stopMediaRelay:function(e){var t=Se.current;t&&t.stopMediaRelay(e)}}},t)},at=function(e,t){var r={},n=r.onStreamEnabled,s=void 0===n?function(){}:n,i=r.onStreamDisabled,a=void 0===i?function(){}:i,o=r.onMediaStatusChanged,d=void 0===o?function(){}:o,u=r.onVideoQualityChanged,l=void 0===u?function(){}:u,p=r.onStreamPaused,h=void 0===p?function(){}:p,m=r.onStreamResumed,f=void 0===m?function(){}:m,g=r.onProducerAdded,v=void 0===g?function(){}:g,_=r.onProducerRemoved,y=void 0===_?function(){}:_,b=r.onConsumerAdded,w=void 0===b?function(){}:b,S=r.onConsumerRemoved,R=void 0===S?function(){}:S,k=c.useState(null),E=k[0],T=k[1],C=c.useState(null),P=C[0],O=C[1],x=c.useState(null),D=x[0],I=x[1],A=c.useState(null),M=A[0],L=A[1],N=st(),j=c.useMemo(function(){var t;return{participants:null==N?void 0:N.participants,localParticipant:null==N?void 0:N.localParticipant,activeSpeakerId:null==N?void 0:N.activeSpeakerId,mainParticipant:null==N?void 0:N.mainParticipant,pinState:(null==N||null===(t=N.pinnedParticipants)||void 0===t?void 0:t.get(e))||{cam:!1,share:!1}}},[N]),B=j.participants,U=j.localParticipant,F=j.activeSpeakerId,q=j.mainParticipant,W=j.pinState,V=null==B?void 0:B.get(e),H=c.useState(null==V?void 0:V.webcamOn),z=H[0],K=H[1],G=c.useState(null==V?void 0:V.micOn),$=G[0],J=G[1],Q=c.useState(null==V?void 0:V.mode),Y=Q[0],X=Q[1],Z=function(e){if("live"===e.track.readyState)switch(e.kind){case"video":null!=E&&T(null),T(e);break;case"audio":null!=P&&O(null),O(e);break;case"share":null!=D&&I(null),I(e);break;case"shareAudio":null!=M&&L(null),L(e)}},ee=function(e){Z(e),s(e)},te=function(t){e===t.participantId&&X(t.mode)},re=function(e){!function(e){switch(e.kind){case"video":T(null);break;case"audio":O(null);break;case"share":I(null);break;case"shareAudio":L(null)}}(e),a(e)},ne=function(e){var t=e.peerId,r=e.prevQuality,n=e.currentQuality;l({peerId:t,prevQuality:r,currentQuality:n})},se=function(e){var t=e.kind,r=e.peerId,n=e.newStatus;"audio"==t?J(n):"video"==t&&K(n),d({kind:t,peerId:r,newStatus:n})};return c.useEffect(function(){var e=null==V?void 0:V.streams;return e&&e.forEach(function(e){Z(e)}),null!=V&&V.micOn&&J($),null!=V&&V.webcamOn&&K(z),null==V||V.on("stream-enabled",ee),null==V||V.on("stream-disabled",re),null==V||V.on("stream-paused",function(e){h(e)}),null==V||V.on("stream-resumed",function(e){f(e)}),null==V||V.on("media-status-changed",se),null==V||V.on("video-quality-changed",ne),null==V||V.on("producer-added",function(e){v(e)}),null==V||V.on("producer-removed",function(e){y(e)}),null==V||V.on("consumer-added",function(e){w(e)}),null==V||V.on("consumer-removed",function(e){R(e)}),rt.on(tt["participant-mode-changed"],te),function(){null==V||V.off("stream-enabled",ee),null==V||V.off("stream-disabled",re),null==V||V.off("media-status-changed",se),null==V||V.off("video-quality-changed",ne),rt.off(tt["participant-mode-changed"],te)}},[V]),{displayName:null==V?void 0:V.displayName,participant:V,webcamStream:E,micStream:P,screenShareStream:D,screenShareAudioStream:M,webcamOn:z||!!E,micOn:$||!!P,mode:Y,metaData:null==V?void 0:V.metaData,screenShareOn:!!D,isLocal:(null==U?void 0:U.id)===e,isActiveSpeaker:F===e,isMainParticipant:(null==q?void 0:q.id)===e,pinState:W,consumeMicStreams:function(){null==V||V.consumeMicStreams()},consumeWebcamStreams:function(){null==V||V.consumeWebcamStreams()},stopConsumingMicStreams:function(){null==V||V.stopConsumingMicStreams()},stopConsumingWebcamStreams:function(){null==V||V.stopConsumingWebcamStreams()},setQuality:function(e){null==V||V.setQuality(e)},setScreenShareQuality:function(e){null==V||V.setScreenShareQuality(e)},setViewPort:function(e,t){null==V||V.setViewPort(e,t)},enableMic:function(){null==V||V.enableMic()},disableMic:function(){null==V||V.disableMic()},enableWebcam:function(){null==V||V.enableWebcam()},disableWebcam:function(){null==V||V.disableWebcam()},captureImage:function(e){var t=void 0===e?{}:e,r=t.height,n=t.width;return Promise.resolve(null==V?void 0:V.captureImage({height:r,width:n}))},pin:function(e){null==V||V.pin(e)},unpin:function(e){null==V||V.unpin(e)},remove:function(){null==V||V.remove()},getAudioStats:function(){return Promise.resolve(null==V?void 0:V.getAudioStats())},getVideoStats:function(){return Promise.resolve(null==V?void 0:V.getVideoStats())},getShareStats:function(){return Promise.resolve(null==V?void 0:V.getShareStats())},getShareAudioStats:function(){return Promise.resolve(null==V?void 0:V.getShareAudioStats())}}};"undefined"==typeof Symbol||(Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator"))),"undefined"==typeof Symbol||(Symbol.asyncIterator||(Symbol.asyncIterator=Symbol("Symbol.asyncIterator"))),Xe.VideoSDK.Constants,c.forwardRef(function(e,t){var r=e.participantId,n=e.type,s=void 0===n?"video":n,i=e.containerStyle,a=void 0===i?{}:i,o=e.className,u=void 0===o?"":o,l=e.classNameVideo,p=void 0===l?"":l,h=e.videoStyle,m=void 0===h?{}:h,f=at(r),g=f.webcamOn,v=f.webcamStream,_=f.isLocal,y=f.screenShareStream,b=f.screenShareOn,w=c.useRef(null);return c.useEffect(function(){var e="share"===s?y:v,t="share"===s?b:g;if(w.current)if(t&&e){var r=new MediaStream;r.addTrack(e.track),w.current.srcObject=r,w.current.setAttribute("playsinline",""),w.current.setAttribute("x5-playsinline",""),w.current.setAttribute("webkit-playsinline",""),w.current.play().catch(function(e){})}else w.current.srcObject=null},[s].concat("share"===s?[b,y]:"video"===s?[g,v]:[])),d.createElement("div",{ref:t,className:"video-container participant-video-"+r+" "+(u||""),style:Ze({objectFit:"share"===s?"contain":"none",height:"100%"},a)},d.createElement("video",{width:"100%",height:"100%",ref:w,autoPlay:!0,className:p,style:_&&"share"!==s?Ze({transform:"scaleX(-1)",WebkitTransform:"scaleX(-1)"},m):m}))});export{it as M,Ie as l,st as u};
